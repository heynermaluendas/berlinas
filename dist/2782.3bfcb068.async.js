!(function(){var og=(hr,qt,N)=>new Promise((Oe,Qe)=>{var v=se=>{try{V(N.next(se))}catch(W){Qe(W)}},it=se=>{try{V(N.throw(se))}catch(W){Qe(W)}},V=se=>se.done?Oe(se.value):Promise.resolve(se.value).then(v,it);V((N=N.apply(hr,qt)).next())});(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2782],{64183:function(hr,qt,N){"use strict";var Oe=N(67294),Qe=N(51224),v=function(){return v=Object.assign||function(V){for(var se,W=1,ne=arguments.length;W<ne;W++){se=arguments[W];for(var G in se)Object.prototype.hasOwnProperty.call(se,G)&&(V[G]=se[G])}return V},v.apply(this,arguments)},it=(0,Oe.forwardRef)(function(V,se){return Oe.createElement(Qe.P,v({},V,{chartType:"Area",ref:se}))});qt.Z=it},35099:function(hr,qt,N){"use strict";var Oe=N(67294),Qe=N(51224),v=function(){return v=Object.assign||function(V){for(var se,W=1,ne=arguments.length;W<ne;W++){se=arguments[W];for(var G in se)Object.prototype.hasOwnProperty.call(se,G)&&(V[G]=se[G])}return V},v.apply(this,arguments)},it=(0,Oe.forwardRef)(function(V,se){return Oe.createElement(Qe.P,v({},V,{chartType:"Gauge",ref:se}))});qt.Z=it},65337:function(hr,qt,N){"use strict";var Oe=N(67294),Qe=N(51224),v=function(){return v=Object.assign||function(V){for(var se,W=1,ne=arguments.length;W<ne;W++){se=arguments[W];for(var G in se)Object.prototype.hasOwnProperty.call(se,G)&&(V[G]=se[G])}return V},v.apply(this,arguments)},it=(0,Oe.forwardRef)(function(V,se){return Oe.createElement(Qe.P,v({},V,{chartType:"Liquid",ref:se}))});qt.Z=it},92688:function(hr,qt,N){"use strict";var Oe=N(67294),Qe=N(51224),v=function(){return v=Object.assign||function(V){for(var se,W=1,ne=arguments.length;W<ne;W++){se=arguments[W];for(var G in se)Object.prototype.hasOwnProperty.call(se,G)&&(V[G]=se[G])}return V},v.apply(this,arguments)},it=(0,Oe.forwardRef)(function(V,se){return Oe.createElement(Qe.P,v({},V,{chartType:"WordCloud",ref:se}))});qt.Z=it},88372:function(hr,qt,N){"use strict";N.d(qt,{f:function(){return ge}});var Oe=N(4942),Qe=N(28459),v=N(93967),it=N.n(v),V=N(67294),se=N(76509),W=N(1413),ne=N(98082),G=function(ae){return(0,Oe.Z)({},ae.componentCls,{width:"100%","&-wide":{maxWidth:1152,margin:"0 auto"}})};function Ke(ht){return(0,ne.Xj)("ProLayoutGridContent",function(ae){var At=(0,W.Z)((0,W.Z)({},ae),{},{componentCls:".".concat(ht)});return[G(At)]})}var De=N(85893),ge=function(ae){var At=(0,V.useContext)(se.X),wt=ae.children,et=ae.contentWidth,mr=ae.className,pr=ae.style,yn=(0,V.useContext)(Qe.ZP.ConfigContext),bi=yn.getPrefixCls,$n=ae.prefixCls||bi("pro"),Mt=et||At.contentWidth,ze="".concat($n,"-grid-content"),Wt=Ke(ze),ct=Wt.wrapSSR,nr=Wt.hashId,Lr=Mt==="Fixed"&&At.layout==="top";return ct((0,De.jsx)("div",{className:it()(ze,nr,mr,(0,Oe.Z)({},"".concat(ze,"-wide"),Lr)),style:pr,children:(0,De.jsx)("div",{className:"".concat($n,"-grid-content-children ").concat(nr).trim(),children:wt})}))}},83832:function(hr,qt,N){"use strict";N.d(qt,{S:function(){return W}});var Oe=N(1413),Qe=N(91),v=N(74330),it=N(67294),V=N(85893),se=["isLoading","pastDelay","timedOut","error","retry"],W=function(G){var Ke=G.isLoading,De=G.pastDelay,ge=G.timedOut,ht=G.error,ae=G.retry,At=(0,Qe.Z)(G,se);return(0,V.jsx)("div",{style:{paddingBlockStart:100,textAlign:"center"},children:(0,V.jsx)(v.Z,(0,Oe.Z)({size:"large"},At))})}},76509:function(hr,qt,N){"use strict";N.d(qt,{X:function(){return Qe}});var Oe=N(67294),Qe=(0,Oe.createContext)({})},4157:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(hr){try{let G=function(){V||(V=!0,v())},Ke=function(){try{it.documentElement.doScroll("left")}catch(De){return void setTimeout(Ke,50)}G()};var W=G,ne=Ke,N=(N=document.getElementsByTagName("script"))[N.length-1],qt=N.getAttribute("data-injectcss"),N=N.getAttribute("data-disable-injectsvg");if(!N){var Oe,Qe,v,it,V,se=function(De,ge){ge.parentNode.insertBefore(De,ge)};if(qt&&!hr.__iconfont__svg__cssinject__){hr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(De){console&&console.log(De)}}Oe=function(){var De,ge=document.createElement("div");ge.innerHTML=hr._iconfont_svg_string_3580659,(ge=ge.getElementsByTagName("svg")[0])&&(ge.setAttribute("aria-hidden","true"),ge.style.position="absolute",ge.style.width=0,ge.style.height=0,ge.style.overflow="hidden",ge=ge,(De=document.body).firstChild?se(ge,De.firstChild):De.appendChild(ge))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(Oe,0):(Qe=function(){document.removeEventListener("DOMContentLoaded",Qe,!1),Oe()},document.addEventListener("DOMContentLoaded",Qe,!1)):document.attachEvent&&(v=Oe,it=hr.document,V=!1,Ke(),it.onreadystatechange=function(){it.readyState=="complete"&&(it.onreadystatechange=null,G())})}}catch(G){}}(window)},10578:function(hr){"use strict";var qt=Object.prototype.hasOwnProperty,N="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(N=!1));function Qe(se,W,ne){this.fn=se,this.context=W,this.once=ne||!1}function v(se,W,ne,G,Ke){if(typeof ne!="function")throw new TypeError("The listener must be a function");var De=new Qe(ne,G||se,Ke),ge=N?N+W:W;return se._events[ge]?se._events[ge].fn?se._events[ge]=[se._events[ge],De]:se._events[ge].push(De):(se._events[ge]=De,se._eventsCount++),se}function it(se,W){--se._eventsCount===0?se._events=new Oe:delete se._events[W]}function V(){this._events=new Oe,this._eventsCount=0}V.prototype.eventNames=function(){var W=[],ne,G;if(this._eventsCount===0)return W;for(G in ne=this._events)qt.call(ne,G)&&W.push(N?G.slice(1):G);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(ne)):W},V.prototype.listeners=function(W){var ne=N?N+W:W,G=this._events[ne];if(!G)return[];if(G.fn)return[G.fn];for(var Ke=0,De=G.length,ge=new Array(De);Ke<De;Ke++)ge[Ke]=G[Ke].fn;return ge},V.prototype.listenerCount=function(W){var ne=N?N+W:W,G=this._events[ne];return G?G.fn?1:G.length:0},V.prototype.emit=function(W,ne,G,Ke,De,ge){var ht=N?N+W:W;if(!this._events[ht])return!1;var ae=this._events[ht],At=arguments.length,wt,et;if(ae.fn){switch(ae.once&&this.removeListener(W,ae.fn,void 0,!0),At){case 1:return ae.fn.call(ae.context),!0;case 2:return ae.fn.call(ae.context,ne),!0;case 3:return ae.fn.call(ae.context,ne,G),!0;case 4:return ae.fn.call(ae.context,ne,G,Ke),!0;case 5:return ae.fn.call(ae.context,ne,G,Ke,De),!0;case 6:return ae.fn.call(ae.context,ne,G,Ke,De,ge),!0}for(et=1,wt=new Array(At-1);et<At;et++)wt[et-1]=arguments[et];ae.fn.apply(ae.context,wt)}else{var mr=ae.length,pr;for(et=0;et<mr;et++)switch(ae[et].once&&this.removeListener(W,ae[et].fn,void 0,!0),At){case 1:ae[et].fn.call(ae[et].context);break;case 2:ae[et].fn.call(ae[et].context,ne);break;case 3:ae[et].fn.call(ae[et].context,ne,G);break;case 4:ae[et].fn.call(ae[et].context,ne,G,Ke);break;default:if(!wt)for(pr=1,wt=new Array(At-1);pr<At;pr++)wt[pr-1]=arguments[pr];ae[et].fn.apply(ae[et].context,wt)}}return!0},V.prototype.on=function(W,ne,G){return v(this,W,ne,G,!1)},V.prototype.once=function(W,ne,G){return v(this,W,ne,G,!0)},V.prototype.removeListener=function(W,ne,G,Ke){var De=N?N+W:W;if(!this._events[De])return this;if(!ne)return it(this,De),this;var ge=this._events[De];if(ge.fn)ge.fn===ne&&(!Ke||ge.once)&&(!G||ge.context===G)&&it(this,De);else{for(var ht=0,ae=[],At=ge.length;ht<At;ht++)(ge[ht].fn!==ne||Ke&&!ge[ht].once||G&&ge[ht].context!==G)&&ae.push(ge[ht]);ae.length?this._events[De]=ae.length===1?ae[0]:ae:it(this,De)}return this},V.prototype.removeAllListeners=function(W){var ne;return W?(ne=N?N+W:W,this._events[ne]&&it(this,ne)):(this._events=new Oe,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,hr.exports=V},36829:function(hr){"use strict";var qt=Object.prototype.hasOwnProperty,N="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(N=!1));function Qe(se,W,ne){this.fn=se,this.context=W,this.once=ne||!1}function v(se,W,ne,G,Ke){if(typeof ne!="function")throw new TypeError("The listener must be a function");var De=new Qe(ne,G||se,Ke),ge=N?N+W:W;return se._events[ge]?se._events[ge].fn?se._events[ge]=[se._events[ge],De]:se._events[ge].push(De):(se._events[ge]=De,se._eventsCount++),se}function it(se,W){--se._eventsCount===0?se._events=new Oe:delete se._events[W]}function V(){this._events=new Oe,this._eventsCount=0}V.prototype.eventNames=function(){var W=[],ne,G;if(this._eventsCount===0)return W;for(G in ne=this._events)qt.call(ne,G)&&W.push(N?G.slice(1):G);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(ne)):W},V.prototype.listeners=function(W){var ne=N?N+W:W,G=this._events[ne];if(!G)return[];if(G.fn)return[G.fn];for(var Ke=0,De=G.length,ge=new Array(De);Ke<De;Ke++)ge[Ke]=G[Ke].fn;return ge},V.prototype.listenerCount=function(W){var ne=N?N+W:W,G=this._events[ne];return G?G.fn?1:G.length:0},V.prototype.emit=function(W,ne,G,Ke,De,ge){var ht=N?N+W:W;if(!this._events[ht])return!1;var ae=this._events[ht],At=arguments.length,wt,et;if(ae.fn){switch(ae.once&&this.removeListener(W,ae.fn,void 0,!0),At){case 1:return ae.fn.call(ae.context),!0;case 2:return ae.fn.call(ae.context,ne),!0;case 3:return ae.fn.call(ae.context,ne,G),!0;case 4:return ae.fn.call(ae.context,ne,G,Ke),!0;case 5:return ae.fn.call(ae.context,ne,G,Ke,De),!0;case 6:return ae.fn.call(ae.context,ne,G,Ke,De,ge),!0}for(et=1,wt=new Array(At-1);et<At;et++)wt[et-1]=arguments[et];ae.fn.apply(ae.context,wt)}else{var mr=ae.length,pr;for(et=0;et<mr;et++)switch(ae[et].once&&this.removeListener(W,ae[et].fn,void 0,!0),At){case 1:ae[et].fn.call(ae[et].context);break;case 2:ae[et].fn.call(ae[et].context,ne);break;case 3:ae[et].fn.call(ae[et].context,ne,G);break;case 4:ae[et].fn.call(ae[et].context,ne,G,Ke);break;default:if(!wt)for(pr=1,wt=new Array(At-1);pr<At;pr++)wt[pr-1]=arguments[pr];ae[et].fn.apply(ae[et].context,wt)}}return!0},V.prototype.on=function(W,ne,G){return v(this,W,ne,G,!1)},V.prototype.once=function(W,ne,G){return v(this,W,ne,G,!0)},V.prototype.removeListener=function(W,ne,G,Ke){var De=N?N+W:W;if(!this._events[De])return this;if(!ne)return it(this,De),this;var ge=this._events[De];if(ge.fn)ge.fn===ne&&(!Ke||ge.once)&&(!G||ge.context===G)&&it(this,De);else{for(var ht=0,ae=[],At=ge.length;ht<At;ht++)(ge[ht].fn!==ne||Ke&&!ge[ht].once||G&&ge[ht].context!==G)&&ae.push(ge[ht]);ae.length?this._events[De]=ae.length===1?ae[0]:ae:it(this,De)}return this},V.prototype.removeAllListeners=function(W){var ne;return W?(ne=N?N+W:W,this._events[ne]&&it(this,ne)):(this._events=new Oe,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,hr.exports=V},15085:function(hr){"use strict";var qt=Object.prototype.hasOwnProperty,N="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(N=!1));function Qe(se,W,ne){this.fn=se,this.context=W,this.once=ne||!1}function v(se,W,ne,G,Ke){if(typeof ne!="function")throw new TypeError("The listener must be a function");var De=new Qe(ne,G||se,Ke),ge=N?N+W:W;return se._events[ge]?se._events[ge].fn?se._events[ge]=[se._events[ge],De]:se._events[ge].push(De):(se._events[ge]=De,se._eventsCount++),se}function it(se,W){--se._eventsCount===0?se._events=new Oe:delete se._events[W]}function V(){this._events=new Oe,this._eventsCount=0}V.prototype.eventNames=function(){var W=[],ne,G;if(this._eventsCount===0)return W;for(G in ne=this._events)qt.call(ne,G)&&W.push(N?G.slice(1):G);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(ne)):W},V.prototype.listeners=function(W){var ne=N?N+W:W,G=this._events[ne];if(!G)return[];if(G.fn)return[G.fn];for(var Ke=0,De=G.length,ge=new Array(De);Ke<De;Ke++)ge[Ke]=G[Ke].fn;return ge},V.prototype.listenerCount=function(W){var ne=N?N+W:W,G=this._events[ne];return G?G.fn?1:G.length:0},V.prototype.emit=function(W,ne,G,Ke,De,ge){var ht=N?N+W:W;if(!this._events[ht])return!1;var ae=this._events[ht],At=arguments.length,wt,et;if(ae.fn){switch(ae.once&&this.removeListener(W,ae.fn,void 0,!0),At){case 1:return ae.fn.call(ae.context),!0;case 2:return ae.fn.call(ae.context,ne),!0;case 3:return ae.fn.call(ae.context,ne,G),!0;case 4:return ae.fn.call(ae.context,ne,G,Ke),!0;case 5:return ae.fn.call(ae.context,ne,G,Ke,De),!0;case 6:return ae.fn.call(ae.context,ne,G,Ke,De,ge),!0}for(et=1,wt=new Array(At-1);et<At;et++)wt[et-1]=arguments[et];ae.fn.apply(ae.context,wt)}else{var mr=ae.length,pr;for(et=0;et<mr;et++)switch(ae[et].once&&this.removeListener(W,ae[et].fn,void 0,!0),At){case 1:ae[et].fn.call(ae[et].context);break;case 2:ae[et].fn.call(ae[et].context,ne);break;case 3:ae[et].fn.call(ae[et].context,ne,G);break;case 4:ae[et].fn.call(ae[et].context,ne,G,Ke);break;default:if(!wt)for(pr=1,wt=new Array(At-1);pr<At;pr++)wt[pr-1]=arguments[pr];ae[et].fn.apply(ae[et].context,wt)}}return!0},V.prototype.on=function(W,ne,G){return v(this,W,ne,G,!1)},V.prototype.once=function(W,ne,G){return v(this,W,ne,G,!0)},V.prototype.removeListener=function(W,ne,G,Ke){var De=N?N+W:W;if(!this._events[De])return this;if(!ne)return it(this,De),this;var ge=this._events[De];if(ge.fn)ge.fn===ne&&(!Ke||ge.once)&&(!G||ge.context===G)&&it(this,De);else{for(var ht=0,ae=[],At=ge.length;ht<At;ht++)(ge[ht].fn!==ne||Ke&&!ge[ht].once||G&&ge[ht].context!==G)&&ae.push(ge[ht]);ae.length?this._events[De]=ae.length===1?ae[0]:ae:it(this,De)}return this},V.prototype.removeAllListeners=function(W){var ne;return W?(ne=N?N+W:W,this._events[ne]&&it(this,ne)):(this._events=new Oe,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,hr.exports=V},57443:function(hr){"use strict";var qt=Object.prototype.hasOwnProperty,N="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(N=!1));function Qe(se,W,ne){this.fn=se,this.context=W,this.once=ne||!1}function v(se,W,ne,G,Ke){if(typeof ne!="function")throw new TypeError("The listener must be a function");var De=new Qe(ne,G||se,Ke),ge=N?N+W:W;return se._events[ge]?se._events[ge].fn?se._events[ge]=[se._events[ge],De]:se._events[ge].push(De):(se._events[ge]=De,se._eventsCount++),se}function it(se,W){--se._eventsCount===0?se._events=new Oe:delete se._events[W]}function V(){this._events=new Oe,this._eventsCount=0}V.prototype.eventNames=function(){var W=[],ne,G;if(this._eventsCount===0)return W;for(G in ne=this._events)qt.call(ne,G)&&W.push(N?G.slice(1):G);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(ne)):W},V.prototype.listeners=function(W){var ne=N?N+W:W,G=this._events[ne];if(!G)return[];if(G.fn)return[G.fn];for(var Ke=0,De=G.length,ge=new Array(De);Ke<De;Ke++)ge[Ke]=G[Ke].fn;return ge},V.prototype.listenerCount=function(W){var ne=N?N+W:W,G=this._events[ne];return G?G.fn?1:G.length:0},V.prototype.emit=function(W,ne,G,Ke,De,ge){var ht=N?N+W:W;if(!this._events[ht])return!1;var ae=this._events[ht],At=arguments.length,wt,et;if(ae.fn){switch(ae.once&&this.removeListener(W,ae.fn,void 0,!0),At){case 1:return ae.fn.call(ae.context),!0;case 2:return ae.fn.call(ae.context,ne),!0;case 3:return ae.fn.call(ae.context,ne,G),!0;case 4:return ae.fn.call(ae.context,ne,G,Ke),!0;case 5:return ae.fn.call(ae.context,ne,G,Ke,De),!0;case 6:return ae.fn.call(ae.context,ne,G,Ke,De,ge),!0}for(et=1,wt=new Array(At-1);et<At;et++)wt[et-1]=arguments[et];ae.fn.apply(ae.context,wt)}else{var mr=ae.length,pr;for(et=0;et<mr;et++)switch(ae[et].once&&this.removeListener(W,ae[et].fn,void 0,!0),At){case 1:ae[et].fn.call(ae[et].context);break;case 2:ae[et].fn.call(ae[et].context,ne);break;case 3:ae[et].fn.call(ae[et].context,ne,G);break;case 4:ae[et].fn.call(ae[et].context,ne,G,Ke);break;default:if(!wt)for(pr=1,wt=new Array(At-1);pr<At;pr++)wt[pr-1]=arguments[pr];ae[et].fn.apply(ae[et].context,wt)}}return!0},V.prototype.on=function(W,ne,G){return v(this,W,ne,G,!1)},V.prototype.once=function(W,ne,G){return v(this,W,ne,G,!0)},V.prototype.removeListener=function(W,ne,G,Ke){var De=N?N+W:W;if(!this._events[De])return this;if(!ne)return it(this,De),this;var ge=this._events[De];if(ge.fn)ge.fn===ne&&(!Ke||ge.once)&&(!G||ge.context===G)&&it(this,De);else{for(var ht=0,ae=[],At=ge.length;ht<At;ht++)(ge[ht].fn!==ne||Ke&&!ge[ht].once||G&&ge[ht].context!==G)&&ae.push(ge[ht]);ae.length?this._events[De]=ae.length===1?ae[0]:ae:it(this,De)}return this},V.prototype.removeAllListeners=function(W){var ne;return W?(ne=N?N+W:W,this._events[ne]&&it(this,ne)):(this._events=new Oe,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,hr.exports=V},42870:function(hr,qt,N){"use strict";N.d(qt,{zP:function(){return F5},JE:function(){return DP},ns:function(){return L5}});var Oe=N(67294),Qe=(0,Oe.createContext)({});function v(){return(0,Oe.useContext)(Qe)}var it={},V={},se=e=>V[e],W=(e,t)=>{V[e]=t},ne=e=>it[e],G=(e,t)=>{it[e]=t},Ke={},De={},ge=34,ht=10,ae=13;function At(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function wt(e,t){var r=At(e);return function(i,a){return t(r(i),a,e)}}function et(e){var t=Object.create(null),r=[];return e.forEach(function(i){for(var a in i)a in t||r.push(t[a]=a)}),r}function mr(e,t){var r=e+"",i=r.length;return i<t?new Array(t-i+1).join(0)+r:r}function pr(e){return e<0?"-"+mr(-e,6):e>9999?"+"+mr(e,6):mr(e,4)}function yn(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":pr(e.getUTCFullYear(),4)+"-"+mr(e.getUTCMonth()+1,2)+"-"+mr(e.getUTCDate(),2)+(a?"T"+mr(t,2)+":"+mr(r,2)+":"+mr(i,2)+"."+mr(a,3)+"Z":i?"T"+mr(t,2)+":"+mr(r,2)+":"+mr(i,2)+"Z":r||t?"T"+mr(t,2)+":"+mr(r,2)+"Z":"")}function bi(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(w,R){var U,q,ce=a(w,function(Se,ke){if(U)return U(Se,ke-1);q=Se,U=R?wt(Se,R):At(Se)});return ce.columns=q||[],ce}function a(w,R){var U=[],q=w.length,ce=0,Se=0,ke,Fe=q<=0,rt=!1;w.charCodeAt(q-1)===ht&&--q,w.charCodeAt(q-1)===ae&&--q;function mt(){if(Fe)return De;if(rt)return rt=!1,Ke;var cr,kt=ce,dr;if(w.charCodeAt(kt)===ge){for(;ce++<q&&w.charCodeAt(ce)!==ge||w.charCodeAt(++ce)===ge;);return(cr=ce)>=q?Fe=!0:(dr=w.charCodeAt(ce++))===ht?rt=!0:dr===ae&&(rt=!0,w.charCodeAt(ce)===ht&&++ce),w.slice(kt+1,cr-1).replace(/""/g,'"')}for(;ce<q;){if((dr=w.charCodeAt(cr=ce++))===ht)rt=!0;else if(dr===ae)rt=!0,w.charCodeAt(ce)===ht&&++ce;else if(dr!==r)continue;return w.slice(kt,cr)}return Fe=!0,w.slice(kt,q)}for(;(ke=mt())!==De;){for(var er=[];ke!==Ke&&ke!==De;)er.push(ke),ke=mt();R&&(er=R(er,Se++))==null||U.push(er)}return U}function u(w,R){return w.map(function(U){return R.map(function(q){return A(U[q])}).join(e)})}function h(w,R){return R==null&&(R=et(w)),[R.map(A).join(e)].concat(u(w,R)).join(`
`)}function m(w,R){return R==null&&(R=et(w)),u(w,R).join(`
`)}function g(w){return w.map(E).join(`
`)}function E(w){return w.map(A).join(e)}function A(w){return w==null?"":w instanceof Date?yn(w):t.test(w+="")?'"'+w.replace(/"/g,'""')+'"':w}return{parse:i,parseRows:a,format:h,formatBody:m,formatRows:g,formatRow:E,formatValue:A}}var $n=bi(","),Mt=$n.parse,ze=$n.parseRows,Wt=$n.format,ct=$n.formatBody,nr=$n.formatRows,Lr=$n.formatRow,K=$n.formatValue,_e=63710088e-1,Y={centimeters:_e*100,centimetres:_e*100,degrees:_e/111325,feet:_e*3.28084,inches:_e*39.37,kilometers:_e/1e3,kilometres:_e/1e3,meters:_e,metres:_e,miles:_e/1609.344,millimeters:_e*1e3,millimetres:_e*1e3,nauticalmiles:_e/1852,radians:1,yards:_e*1.0936},ve={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/_e,yards:1.0936133},fe={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function He(e,t,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function at(e,t,r){switch(r===void 0&&(r={}),e){case"Point":return _t(t).geometry;case"LineString":return zr(t).geometry;case"Polygon":return Pt(t).geometry;case"MultiPoint":return bn(t).geometry;case"MultiLineString":return Fn(t).geometry;case"MultiPolygon":return dn(t).geometry;default:throw new Error(e+" is invalid")}}function _t(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ue(e[0])||!ue(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return He(i,t,r)}function Tt(e,t,r){return r===void 0&&(r={}),Qr(e.map(function(i){return _t(i,t)}),r)}function Pt(e,t,r){r===void 0&&(r={});for(var i=0,a=e;i<a.length;i++){var u=a[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<u[u.length-1].length;h++)if(u[u.length-1][h]!==u[0][h])throw new Error("First and last Position are not equivalent.")}var m={type:"Polygon",coordinates:e};return He(m,t,r)}function Xr(e,t,r){return r===void 0&&(r={}),Qr(e.map(function(i){return Pt(i,t)}),r)}function zr(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return He(i,t,r)}function gn(e,t,r){return r===void 0&&(r={}),Qr(e.map(function(i){return zr(i,t)}),r)}function Qr(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function Fn(e,t,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return He(i,t,r)}function bn(e,t,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return He(i,t,r)}function dn(e,t,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return He(i,t,r)}function un(e,t,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return He(i,t,r)}function Qn(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function Vr(e,t){t===void 0&&(t="kilometers");var r=Y[t];if(!r)throw new Error(t+" units is invalid");return e*r}function Dn(e,t){t===void 0&&(t="kilometers");var r=Y[t];if(!r)throw new Error(t+" units is invalid");return e/r}function Wr(e,t){return ji(Dn(e,t))}function Jr(e){var t=e%360;return t<0&&(t+=360),t}function ji(e){var t=e%(2*Math.PI);return t*180/Math.PI}function gi(e){var t=e%360;return t*Math.PI/180}function Eo(e,t,r){if(t===void 0&&(t="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Vr(Dn(e,t),r)}function $i(e,t,r){if(t===void 0&&(t="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=fe[t];if(!i)throw new Error("invalid original units");var a=fe[r];if(!a)throw new Error("invalid final units");return e/i*a}function ue(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Xi(e){return!!e&&e.constructor===Object}function co(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!ue(t))throw new Error("bbox must only contain numbers")})}function bo(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Sa(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function da(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ds(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ds(e[0]);throw new Error("coordinates must only contain numbers")}function Xo(e,t,r){if(!t||!r)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.type)}function Xs(e,t,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.geometry.type)}function vu(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,a=e.features;i<a.length;i++){var u=a[i];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+u.geometry.type)}}function Vo(e){return e.type==="Feature"?e.geometry:e}function fo(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function ho(e,t,r){if(e!==null)for(var i,a,u,h,m,g,E,A=0,w=0,R,U=e.type,q=U==="FeatureCollection",ce=U==="Feature",Se=q?e.features.length:1,ke=0;ke<Se;ke++){E=q?e.features[ke].geometry:ce?e.geometry:e,R=E?E.type==="GeometryCollection":!1,m=R?E.geometries.length:1;for(var Fe=0;Fe<m;Fe++){var rt=0,mt=0;if(h=R?E.geometries[Fe]:E,h!==null){g=h.coordinates;var er=h.type;switch(A=r&&(er==="Polygon"||er==="MultiPolygon")?1:0,er){case null:break;case"Point":if(t(g,w,ke,rt,mt)===!1)return!1;w++,rt++;break;case"LineString":case"MultiPoint":for(i=0;i<g.length;i++){if(t(g[i],w,ke,rt,mt)===!1)return!1;w++,er==="MultiPoint"&&rt++}er==="LineString"&&rt++;break;case"Polygon":case"MultiLineString":for(i=0;i<g.length;i++){for(a=0;a<g[i].length-A;a++){if(t(g[i][a],w,ke,rt,mt)===!1)return!1;w++}er==="MultiLineString"&&rt++,er==="Polygon"&&mt++}er==="Polygon"&&rt++;break;case"MultiPolygon":for(i=0;i<g.length;i++){for(mt=0,a=0;a<g[i].length;a++){for(u=0;u<g[i][a].length-A;u++){if(t(g[i][a][u],w,ke,rt,mt)===!1)return!1;w++}mt++}rt++}break;case"GeometryCollection":for(i=0;i<h.geometries.length;i++)if(ho(h.geometries[i],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function pt(e,t,r,i){var a=r;return ho(e,function(u,h,m,g,E){h===0&&r===void 0?a=u:a=t(a,u,h,m,g,E)},i),a}function Z(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&t(e.features[r].properties,r)!==!1;r++);break;case"Feature":t(e.properties,0);break}}function Q(e,t,r){var i=r;return Z(e,function(a,u){u===0&&r===void 0?i=a:i=t(i,a,u)}),i}function Ee(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function Ve(e,t,r){var i=r;return Ee(e,function(a,u){u===0&&r===void 0?i=a:i=t(i,a,u)}),i}function Le(e){var t=[];return ho(e,function(r){t.push(r)}),t}function jt(e,t){var r,i,a,u,h,m,g,E,A,w,R=0,U=e.type==="FeatureCollection",q=e.type==="Feature",ce=U?e.features.length:1;for(r=0;r<ce;r++){for(m=U?e.features[r].geometry:q?e.geometry:e,E=U?e.features[r].properties:q?e.properties:{},A=U?e.features[r].bbox:q?e.bbox:void 0,w=U?e.features[r].id:q?e.id:void 0,g=m?m.type==="GeometryCollection":!1,h=g?m.geometries.length:1,a=0;a<h;a++){if(u=g?m.geometries[a]:m,u===null){if(t(null,R,E,A,w)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,R,E,A,w)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(t(u.geometries[i],R,E,A,w)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function Zt(e,t,r){var i=r;return jt(e,function(a,u,h,m,g){u===0&&r===void 0?i=a:i=t(i,a,u,h,m,g)}),i}function ur(e,t){jt(e,function(r,i,a,u,h){var m=r===null?null:r.type;switch(m){case null:case"Point":case"LineString":case"Polygon":return t(He(r,a,{bbox:u,id:h}),i,0)===!1?!1:void 0}var g;switch(m){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var A=r.coordinates[E],w={type:g,coordinates:A};if(t(He(w,a),i,E)===!1)return!1}})}function Ft(e,t,r){var i=r;return ur(e,function(a,u,h){u===0&&h===0&&r===void 0?i=a:i=t(i,a,u,h)}),i}function L(e,t){ur(e,function(r,i,a){var u=0;if(r.geometry){var h=r.geometry.type;if(!(h==="Point"||h==="MultiPoint")){var m,g=0,E=0,A=0;if(ho(r,function(w,R,U,q,ce){if(m===void 0||i>g||q>E||ce>A){m=w,g=i,E=q,A=ce,u=0;return}var Se=lineString([m,w],r.properties);if(t(Se,i,a,ce,u)===!1)return!1;u++,m=w})===!1)return!1}}})}function O(e,t,r){var i=r,a=!1;return L(e,function(u,h,m,g,E){a===!1&&r===void 0?i=u:i=t(i,u,h,m,g,E),a=!0}),i}function j(e,t){if(!e)throw new Error("geojson is required");ur(e,function(r,i,a){if(r.geometry!==null){var u=r.geometry.type,h=r.geometry.coordinates;switch(u){case"LineString":if(t(r,i,a,0,0)===!1)return!1;break;case"Polygon":for(var m=0;m<h.length;m++)if(t(lineString(h[m],r.properties),i,a,m)===!1)return!1;break}}})}function $(e,t,r){var i=r;return j(e,function(a,u,h,m){u===0&&r===void 0?i=a:i=t(i,a,u,h,m)}),i}function de(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.segmentIndex||0,h=t.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),h=h||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":h=h||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var g=m.coordinates;switch(m.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=g.length+u-1),lineString([g[u],g[u+1]],h,t);case"Polygon":return a<0&&(a=g.length+a),u<0&&(u=g[a].length+u-1),lineString([g[a][u],g[a][u+1]],h,t);case"MultiLineString":return i<0&&(i=g.length+i),u<0&&(u=g[i].length+u-1),lineString([g[i][u],g[i][u+1]],h,t);case"MultiPolygon":return i<0&&(i=g.length+i),a<0&&(a=g[i].length+a),u<0&&(u=g[i][a].length-u-1),lineString([g[i][a][u],g[i][a][u+1]],h,t)}throw new Error("geojson is invalid")}function Ie(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.coordIndex||0,h=t.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),h=h||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":h=h||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var g=m.coordinates;switch(m.type){case"Point":return point(g,h,t);case"MultiPoint":return i<0&&(i=g.length+i),point(g[i],h,t);case"LineString":return u<0&&(u=g.length+u),point(g[u],h,t);case"Polygon":return a<0&&(a=g.length+a),u<0&&(u=g[a].length+u),point(g[a][u],h,t);case"MultiLineString":return i<0&&(i=g.length+i),u<0&&(u=g[i].length+u),point(g[i][u],h,t);case"MultiPolygon":return i<0&&(i=g.length+i),a<0&&(a=g[i].length+a),u<0&&(u=g[i][a].length-u),point(g[i][a][u],h,t)}throw new Error("geojson is invalid")}var Ze={REGISTERED_PROTOCOLS:{}},ee=Object.defineProperty,be=Object.defineProperties,ut=Object.getOwnPropertyDescriptors,Dt=Object.getOwnPropertySymbols,ir=Object.prototype.hasOwnProperty,Ct=Object.prototype.propertyIsEnumerable,tr=(e,t,r)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Br=(e,t)=>{for(var r in t||(t={}))ir.call(t,r)&&tr(e,r,t[r]);if(Dt)for(var r of Dt(t))Ct.call(t,r)&&tr(e,r,t[r]);return e},Nr=(e,t)=>be(e,ut(t)),Bt=e=>Ze.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))],Fr=class extends Error{constructor(e,t,r,i){super(`AJAXError: ${t} (${e}): ${r}`),this.status=e,this.statusText=t,this.url=r,this.body=i}};function Cr(e,t){const r=new XMLHttpRequest,i=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",i,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(const a in e.headers)e.headers.hasOwnProperty(a)&&r.setRequestHeader(a,e.headers[a]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){let a=r.response;if(e.type==="json")try{a=JSON.parse(r.response)}catch(u){return t(u)}t(null,a,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{const a=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new Fr(r.status,r.statusText,i.toString(),a))}},r.cancel=r.abort,r.send(e.body),r}function Ir(e){return new Promise((t,r)=>{Cr(e,(i,a,u,h,m)=>{i?r({err:i,data:null,xhr:m}):t({err:null,data:a,cacheControl:u,expires:h,xhr:m})})})}function Zn(e,t){return Cr(e,t)}var Gr=(e,t)=>(Bt(e.url)||Zn)(Nr(Br({},e),{type:"json"}),t),Kn=(e,t)=>(Bt(e.url)||Zn)(Nr(Br({},e),{type:"arrayBuffer"}),t),Di=(e,t)=>Zn(Nr(Br({},e),{method:"POST"}),t),oi=(e,t)=>Zn(Nr(Br({},e),{method:"GET"}),t);function Ti(e){const t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Aa(e,t){const r=new window.Image,i=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=()=>{t(null,r),i.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=di})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?i.createObjectURL(a):di}function Ni(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(i=>{t(null,i)}).catch(i=>{t(new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}var oo=(e,t,r)=>{const i=(a,u)=>{if(a)t(a);else if(u){const h=typeof createImageBitmap=="function",m=r?r(u):u;h?Ni(m,t):Aa(m,t)}};return e.type==="json"?Gr(e,i):Kn(e,i)},mi=(e,t)=>{typeof createImageBitmap=="function"?Ni(e,t):Aa(e,t)},Jn=(e=>(e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e))(Jn||{}),ui={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function To(e,t,r){const i=e.classList;for(const a in ui)ui.hasOwnProperty(a)&&i.remove(`l7-${r}-anchor-${a}`);i.add(`l7-${r}-anchor-${t}`)}function Ls(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function ro(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function po(){}var _u=.7,ms=1/_u,Yi="\\s*([+-]?\\d+)\\s*",ra="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ao="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",So=/^#([0-9a-f]{3,8})$/,Fa=new RegExp("^rgb\\("+[Yi,Yi,Yi]+"\\)$"),Qi=new RegExp("^rgb\\("+[ao,ao,ao]+"\\)$"),Wa=new RegExp("^rgba\\("+[Yi,Yi,Yi,ra]+"\\)$"),Ba=new RegExp("^rgba\\("+[ao,ao,ao,ra]+"\\)$"),gu=new RegExp("^hsl\\("+[ra,ao,ao]+"\\)$"),vs=new RegExp("^hsla\\("+[ra,ao,ao,ra]+"\\)$"),Rc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ls(po,na,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Zo,formatHex:Zo,formatHsl:qi,formatRgb:Qa,toString:Qa});function Zo(){return this.rgb().formatHex()}function qi(){return qo(this).formatHsl()}function Qa(){return this.rgb().formatRgb()}function na(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=So.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?ie(t):r===3?new Er(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?ye(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?ye(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Fa.exec(e))?new Er(t[1],t[2],t[3],1):(t=Qi.exec(e))?new Er(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Wa.exec(e))?ye(t[1],t[2],t[3],t[4]):(t=Ba.exec(e))?ye(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=gu.exec(e))?ia(t[1],t[2]/100,t[3]/100,1):(t=vs.exec(e))?ia(t[1],t[2]/100,t[3]/100,t[4]):Rc.hasOwnProperty(e)?ie(Rc[e]):e==="transparent"?new Er(NaN,NaN,NaN,0):null}function ie(e){return new Er(e>>16&255,e>>8&255,e&255,1)}function ye(e,t,r,i){return i<=0&&(e=t=r=NaN),new Er(e,t,r,i)}function Je(e){return e instanceof po||(e=na(e)),e?(e=e.rgb(),new Er(e.r,e.g,e.b,e.opacity)):new Er}function Gt(e,t,r,i){return arguments.length===1?Je(e):new Er(e,t,r,i==null?1:i)}function Er(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}Ls(Er,Gt,ro(po,{brighter:function(e){return e=e==null?ms:Math.pow(ms,e),new Er(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?_u:Math.pow(_u,e),new Er(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:mn,formatHex:mn,formatRgb:Ci,toString:Ci}));function mn(){return"#"+Yo(this.r)+Yo(this.g)+Yo(this.b)}function Ci(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Yo(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function ia(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new gs(e,t,r,i)}function qo(e){if(e instanceof gs)return new gs(e.h,e.s,e.l,e.opacity);if(e instanceof po||(e=na(e)),!e)return new gs;if(e instanceof gs)return e;e=e.rgb();var t=e.r/255,r=e.g/255,i=e.b/255,a=Math.min(t,r,i),u=Math.max(t,r,i),h=NaN,m=u-a,g=(u+a)/2;return m?(t===u?h=(r-i)/m+(r<i)*6:r===u?h=(i-t)/m+2:h=(t-r)/m+4,m/=g<.5?u+a:2-u-a,h*=60):m=g>0&&g<1?0:h,new gs(h,m,g,e.opacity)}function _s(e,t,r,i){return arguments.length===1?qo(e):new gs(e,t,r,i==null?1:i)}function gs(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}Ls(gs,_s,ro(po,{brighter:function(e){return e=e==null?ms:Math.pow(ms,e),new gs(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?_u:Math.pow(_u,e),new gs(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,a=2*r-i;return new Er(of(e>=240?e-240:e+120,a,i),of(e,a,i),of(e<120?e+240:e-120,a,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function of(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function Rf(e){return typeof e=="string"?!!d3.color(e):!1}function ai(e){const t=na(e),r=[0,0,0,0];return t!=null&&(r[0]=t.r/255,r[1]=t.g/255,r[2]=t.b/255,r[3]=t.opacity),r}function ys(e){const t=e&&e[0],r=e&&e[1],i=e&&e[2];return t+r*256+i*65536-1}function Fs(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function au(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;let i=null;const a=r.createLinearGradient(0,0,256,1),u=e.positions[0],h=e.positions[e.positions.length-1];for(let m=0;m<e.colors.length;++m){const g=(e.positions[m]-u)/(h-u);a.addColorStop(g,e.colors[m])}return r.fillStyle=a,r.fillRect(0,0,256,1),i=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),t=null,r=null,{data:i,width:256,height:1}}function yu(e,t){let r=window.document.createElement("canvas"),i=r.getContext("2d");r.width=256,r.height=1;const a=i.createLinearGradient(0,0,256,1),u=t[1]-t[0];for(let g=0;g<e.colors.length;++g){const E=Math.max((e.positions[g]-t[0])/u,0);a.addColorStop(E,e.colors[g])}i.fillStyle=a,i.fillRect(0,0,256,1);const h=i.getImageData(0,0,256,1).data,m=Co(i,h);return r=null,i=null,m}function Nu(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;const i=r.createImageData(256,1);return i.data.fill(0),e.positions.forEach((a,u)=>{const h=ai(e.colors[u]);i.data[a*4+0]=h[0]*255,i.data[a*4+1]=h[1]*255,i.data[a*4+2]=h[2]*255,i.data[a*4+3]=h[3]*255}),t=null,r=null,i}function Mc(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");r.globalAlpha=1,t.width=256,t.height=1;const i=256/e.colors.length;for(let h=0;h<e.colors.length;h++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[h],r.moveTo(h*i,0),r.lineTo((h+1)*i,0),r.stroke();const a=r.getImageData(0,0,256,1).data,u=Co(r,a);return t=null,r=null,u}function xs(e,t){let r=window.document.createElement("canvas"),i=r.getContext("2d");i.globalAlpha=1,r.width=256,r.height=1;const a=t[1]-t[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(let m=0;m<e.colors.length;m++)i.beginPath(),i.lineWidth=2,i.strokeStyle=e.colors[m],i.moveTo((e.positions[m]-t[0])/a*255,0),i.lineTo((e.positions[m+1]-t[0])/a*255,0),i.stroke();const u=i.getImageData(0,0,256,1).data,h=Co(i,u);return r=null,i=null,h}function Co(e,t){const r=e.createImageData(256,1);for(let i=0;i<r.data.length;i+=4)r.data[i+0]=t[i+0],r.data[i+1]=t[i+1],r.data[i+2]=t[i+2],r.data[i+3]=t[i+3];return r}function xu(e){switch(e==null?void 0:e.type){case"cat":return[0,255];default:return[0,1]}}var is={BACK:1029,FRONT:1028};function Al(e){switch(e){case"GAODE1.x":return is.BACK;case"GAODE2.x":return is.BACK;case"MAPBOX":return is.FRONT;case"SIMPLE":return is.FRONT;case"GLOBEL":return is.BACK;case"DEBAULT":return is.FRONT;default:return is.FRONT}}var ch=N(74691),af=N.n(ch),Mf=N(50361),If=N.n(Mf),Pf=N(23279),fh=N.n(Pf),hh=N(27361),rp=N.n(hh),Ic=N(51584),Eu=N.n(Ic),ph=N(18446),_o=N.n(ph),Tl=N(14293),Ju=N.n(Tl),Bs=N(81763),el=N.n(Bs),Ys=N(68630),ku=N.n(Ys),Ns=N(47037),Uu=N.n(Ns),tl=N(36719),dh=N.n(tl),mh=N(82492),Ji=N.n(mh),np=N(30236),sf=N.n(np),Of=N(97019),jo=N.n(Of),Df=N(23493),vh=N.n(Df),os=N(44908),zu=N.n(os),bu=N(11700),rl=N.n(bu),uf=N(23560),Xl=N.n(uf),su=N(13218),Pc=N.n(su),nl=N(52353),Vu=N.n(nl),Lf=N(68929),Oc=N.n(Lf),Yn={isNil:Ju(),merge:Ji(),throttle:vh(),isString:Uu(),debounce:fh(),pull:jo(),isTypedArray:dh(),isPlainObject:ku(),isNumber:el(),isBoolean:Eu(),isEqual:_o(),cloneDeep:If(),uniq:zu(),clamp:af(),upperFirst:rl(),get:rp(),mergeWith:sf(),isFunction:Xl(),isObject:Pc(),isUndefined:Vu(),camelCase:Oc()},{pull:lf}=Yn;function _h(e){let t=e;return typeof e=="string"&&(t=window.document.getElementById(e)),t}function Zu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Yl(e){return Zu(e).split(/\s+/)}function Ff(e){var t;const r=(t=document==null?void 0:document.documentElement)==null?void 0:t.style;if(!r)return e[0];for(const i in e)if(e[i]&&e[i]in r)return e[i];return e[0]}function Mi(e,t,r){const i=window.document.createElement(e);return t&&(i.className=t||""),r&&r.appendChild(i),i}function oa(e){const t=e.parentNode;t&&t.removeChild(e)}function Ta(e,t){if(e.classList!==void 0){const r=Yl(t);for(let i=0,a=r.length;i<a;i++)e.classList.add(r[i])}else if(!Cl(e,t)){const r=Dc(e);il(e,(r?r+" ":"")+t)}}function Es(e,t){e.classList!==void 0?Yl(t).forEach(i=>{e.classList.remove(i)}):il(e,Zu((" "+Dc(e)+" ").replace(" "+t+" "," ")))}function Cl(e,t){if(e.classList!==void 0)return e.classList.contains(t);const r=Dc(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}function il(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function wl(e,t,r){r===void 0?Cl(e,t)?Es(e,t):Ta(e,t):r?Ta(e,t):Es(e,t)}function Dc(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ql(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var qs=Ff(["transform","WebkitTransform"]);function cf(e,t){e.style[qs]=t}function gh(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{const e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function yh(e){const t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,t.join(""))}function ol(){var e;const t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;const i=((e=t.content)==null?void 0:e.split(",")).find(a=>{const[u]=a.split("=");return u==="initial-scale"});return i?i.split("=")[1]*1:1}var Jo=ol()<1?1:window.devicePixelRatio;function al(e,t){e.setAttribute("style",`${e.style.cssText}${t}`)}function Kl(e){return e.split(";").map(t=>t.trim()).filter(t=>t)}function Rl(e,t){var r;const i=Kl((r=e.getAttribute("style"))!=null?r:""),a=Kl(t),u=lf(i,...a);e.setAttribute("style",u.join(";"))}function ip(e){return Object.entries(e).map(([t,r])=>`${t}: ${r}`).join(";")}function ff(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function Lc(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function sl(e){e.innerHTML=""}function Bf(e){e.setAttribute("draggable","false")}function Fc(e,t){if(typeof t=="string"){const r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)e.append(r.firstChild)}else Array.isArray(t)?e.append(...t):e.append(t)}function Nf(e,t){var r;const i=Array.isArray(t)?t:[t];let a=e;for(;a instanceof Element&&a!==window.document.body;){if(i.find(u=>a==null?void 0:a.matches(u)))return a;a=(r=a==null?void 0:a.parentElement)!=null?r:null}}function Bc(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function kf(){return typeof importScripts=="function"}var $l=kf()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ql=navigator==null?void 0:navigator.userAgent,Ml=!!Ql.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),go=Ql.indexOf("Android")>-1||Ql.indexOf("Adr")>-1;function hf(){const e=Ql,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let r=!0;for(const i of t)if(e.indexOf(i)>0){r=!1;break}return r}function Su(e,t){e.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}var Il=class{constructor(e=16){this.duration=16,this.timestamp=new Date().getTime(),this.duration=e}run(e){const t=new Date().getTime(),r=t-this.timestamp;this.timestamp=t,r>=this.duration&&e()}};function Ei(e){var t=[1/0,1/0,-1/0,-1/0];return ho(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}Ei.default=Ei;var mo=Ei;function as(e){return typeof e=="number"}var ul=2*Math.PI*6378137/2;function Jl(e,t){const[r,i,a,u]=t;return e.lng>r&&e.lng<=a&&e.lat>i&&e.lat<=u}function Nc(e){const t=[1/0,1/0,-1/0,-1/0];return e.forEach(r=>{const{coordinates:i}=r;Uf(t,i)}),t}function Uf(e,t){return Array.isArray(t[0])?t.forEach(r=>{Uf(e,r)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function zf(e,t){return ec(e,t)}function ec(e,t){return Array.isArray(e[0])?e.map(r=>ec(r,t)):t(e)}function Au(e,t=!0,r={enable:!0,decimal:1}){e=Vf(e,t);const i=e[0],a=e[1];let u=i*ul/180,h=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return h=h*ul/180,r.enable&&(u=Number(u.toFixed(r.decimal)),h=Number(h.toFixed(r.decimal))),e.length===3?[u,h,e[2]]:[u,h]}function Ca(e,t=6){const r=e[0],i=e[1];let a=r/ul*180,u=i/ul*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),t!=null&&(a=Number(a.toFixed(t)),u=Number(u.toFixed(t))),e.length===3?[a,u,e[2]]:[a,u]}function wo(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function tc(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Vf(e,t){if(t===!1)return e;const r=wo(e[0]);let i=tc(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function zi(e){const t=85.0511287798,r=Math.max(Math.min(t,e[1]),-t),i=256<<20;let a=Math.PI/180,u=e[0]*a,h=r*a;h=Math.log(Math.tan(Math.PI/4+h/2));const m=.5/Math.PI,g=.5,E=-.5/Math.PI;return a=.5,u=i*(m*u+g),h=i*(E*h+a),[Math.floor(u),Math.floor(h)]}function cn(e){const t=.5/Math.PI,r=.5,i=-.5/Math.PI;let a=.5;const u=256<<20;let[h,m]=e;h=(h/u-r)/t,m=(m/u-a)/i,m=(Math.atan(Math.pow(Math.E,m))-Math.PI/4)*2,a=Math.PI/180;const g=m/a;return[h/a,g]}function bs(e,t){const r=85.0511287798,i=Math.PI/180,a=6378137;return t=Math.max(Math.min(r,t),-r),e*=i,t*=i,t=Math.log(Math.tan(Math.PI/4+t/2)),[e*a,t*a]}function pf(e,t){const r=Math.PI/180,i=6378137,a=e/i/r,u=2*(Math.atan(Math.exp(t/i))-Math.PI/4)/r;return[a,u]}function rc(e,t,r){const i=gi(t[1]-e[1]),a=gi(t[0]-e[0]),u=gi(e[1]),h=gi(t[1]),m=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(u)*Math.cos(h);return Vr(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),r="meters")}function ss(e){const t=Math.PI/180,r=85.0511287798,i=6378137,a=Math.max(Math.min(r,e[1]),-r),u=Math.sin(a*t),h=i*e[0]*t,m=i*Math.log((1+u)/(1-u))/2;return[h,m]}function Ki(e,t){const r=Math.abs(e[1][1]-e[0][1])*t,i=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function kc(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Ur(e){return[[e[0],e[1]],[e[2],e[3]]]}function ju(e){const t=nc(e,[0,0]);return[e[0]/t,e[1]/t]}function nc(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function df(e,t){return e[0]*t[0]+e[1]*t[1]}function ks(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Us(e,t){return Math.acos(df(e,t)/(ks(e)*ks(t)))*180/Math.PI}function mf(e,t){return t[0]>0?t[1]>0?90-Math.atan(t[1]/t[0])*180/Math.PI:90+Math.atan(-t[1]/t[0])*180/Math.PI:t[1]<0?180+(90-Math.atan(t[1]/t[0])*180/Math.PI):270+Math.atan(t[1]/-t[0])*180/Math.PI}function Zf(e,t=100){if(!e||e.length<2)return;const r=[0,1];let i=0;const a=[];for(let u=0;u<e.length-1;u++){const h=e[u],m=e[u+1],g=nc(h,m);i+=g;const E=[h[0]-m[0],h[1]-m[1]];let A=mf(r,E);if(u>0){const w=a[u-1].rotation;w-A>360-w+A&&(A=A+360)}a.push({start:h,end:m,dis:g,rotation:A,duration:0})}return a.map(u=>{u.duration=t*(u.dis/i)}),a}function Ko(e){if(as(e[0]))return e;if(as(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(as(e[0][0][0])){const t=e;let r=0,i=0,a=0;return t.forEach(u=>{u.forEach(h=>{r+=h[0],i+=h[1],a++})}),[r/a,i/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Tu(e){let t=e[0],r=e[1],i=e[0],a=e[1],u=0,h=0,m=0;for(let g=0;g<e.length;g+=2){const E=e[g],A=e[g+1];E&&A&&(t=Math.max(E,t),r=Math.max(A,r),i=Math.min(E,i),a=Math.min(A,a),u+=E,h+=A,m++)}return{center:[u/m,h/m],radius:Math.sqrt(Math.pow(t-i,2)+Math.pow(r-a,2))/2}}function xh(e){return mo(Qr([zr(e)]))}function Uc(e){let i=0;e+="x";const a=Math.floor(9007199254740991/137);for(let u=0;u<e.length;u++)i>a&&(i=Math.floor(i/137)),i=i*131+e.charCodeAt(u);return i}function jf(e){e=e.toString();let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return t>>>0}function Hf(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}var Ss=(e=>(e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e))(Ss||{});function Ks(e,t,r,i,a,u=30,h){let m=r;return h&&(m=Math.round(r*(u-1))/(u-1)),i?ma(e,t,m,i,a):ma(e,t,m,.314,a)}function qn(e,t){const r=1-t;return(e[0]*r+e[1]*t)*r+(e[1]*r+e[2]*t)*t}function zs(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function As(e,t,r){const i=[t[0]-e[0],t[1]-e[1]],a=zs(i,[0,0]),u=Math.atan2(i[1],i[0]),h=a/2/Math.cos(r),m=u+r;return[h*Math.cos(m)+e[0],h*Math.sin(m)+e[1]]}function ma(e,t,r,i,a){if(a===MapType["GAODE2.x"]){const u=amap2Project(e[0],e[1]),h=amap2Project(t[0],t[1]),m=As(u,h,i),g=[u[0],m[0],h[0]],E=[u[1],m[1],h[1]];return[...amap2UnProject(qn(g,r),qn(E,r)),0]}else{const u=As(e,t,i),h=[e[0],u[0],t[0]],m=[e[1],u[1],t[1]];return[qn(h,r),qn(m,r),0]}}function Pl(e,t,r,i,a,u=30,h){let m=r;return h&&(m=Math.round(r*29)/29),ic(e,t,m,a)}function Hu(e,t){const r=[t[0]-e[0],t[1]-e[1]],i=calDistance(r,[0,0]),a=Math.atan2(r[1],r[0]),u=.314,h=i/2/Math.cos(u),m=a+u;return[h*Math.cos(m)+e[0],h*Math.sin(m)+e[1]]}function Vs(e,t){const r=1-t;return(e[0]*r+e[1]*t)*r+(e[1]*r+e[2]*t)*t}function Ga(e,t){const r=[e[0]-t[0],e[1]-t[1]],i=[Math.sin(r[0]/2),Math.sin(r[1]/2)],a=i[1]*i[1]+Math.cos(e[1])*Math.cos(t[1])*i[0]*i[0];return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function ic(e,t,r,i){const a=[degreesToRadians(e[0]),degreesToRadians(e[1])],u=[degreesToRadians(t[0]),degreesToRadians(t[1])];if(i==="GAODE2.x"){const h=Hu(a,u),m=[a[0],h[0],u[0]],g=[a[1],h[1],u[1]];return[Vs(m,r),Vs(g,r),0]}else{const h=Ga(a,u);if(Math.abs(h-Math.PI)<.001)return[(1-r)*a[0]+r*u[0],(1-r)*a[1]+r*u[1]];const m=Math.sin((1-r)*h)/Math.sin(h),g=Math.sin(r*h)/Math.sin(h),E=[Math.sin(a[0]),Math.sin(a[1])],A=[Math.cos(a[0]),Math.cos(a[1])],w=[Math.sin(u[0]),Math.sin(u[1])],R=[Math.cos(u[0]),Math.cos(u[1])],U=m*A[1]*A[0]+g*R[1]*R[0],q=m*A[1]*E[0]+g*R[1]*w[0],ce=m*E[1]+g*w[1];return[radiansToDegrees(Math.atan2(q,U)),radiansToDegrees(Math.atan2(ce,Math.sqrt(U*U+q*q)))]}}function Sn(e,t){let r=0;const i=[];for(let m=0;m<e.length-1;m++){const g=e[m],E=e[m+1],A=Ts(g,E),w=r;r+=A,i.push({p1:g,p2:E,totalDistance:r,distance:A,lastTotalDistance:w})}const a=r*t;let u,h;for(const m of i)if(m.totalDistance>a){const E=m.p1,A=m.p2,w=(a-m.lastTotalDistance)/m.distance,R=fn(A,E,w);u=R[0],h=R[1];break}return{lng:u,lat:h,height:0}}function fn(e,t,r){return[e[0]*r+t[0]*(1-r),e[1]*r+t[1]*(1-r)]}function Ts(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}var Xa=Object.defineProperty,$s=Object.getOwnPropertySymbols,Ro=Object.prototype.hasOwnProperty,Qs=Object.prototype.propertyIsEnumerable,Cu=(e,t,r)=>t in e?Xa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ll=(e,t)=>{for(var r in t||(t={}))Ro.call(t,r)&&Cu(e,r,t[r]);if($s)for(var r of $s(t))Qs.call(t,r)&&Cu(e,r,t[r]);return e};function Vi(e,t){const{featureId:r}=t;let i=e.data.dataArray;return typeof r=="number"&&(i=i.filter(({id:a})=>a===r)),i.map(a=>{const u=Wf(a,t);return ll(ll({},a),u)})}function wa(e,t){return new Promise(r=>{e.inited?r(Vi(e,t)):e.once("update",()=>{r(Vi(e,t))})})}function Wf(e,t){const{offset:r,shape:i,thetaOffset:a,mapVersion:u,segmentNumber:h=30,autoFit:m=!0}=t,{coordinates:g}=e;if(i==="line")return pathLineAtOffset(g,r);const E=g[0],A=g[1],w=typeof a=="string"?e[a]||0:a;let R;switch(i){case"arc":R=arcLineAtOffset;break;case"greatcircle":R=greatCircleLineAtOffset;break;default:R=arcLineAtOffset}const[U,q,ce]=R(E,A,r,w,u,h,m);return{lng:U,lat:q,height:ce}}var cl=class{constructor(e=50,t){this.limit=e,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach(e=>{this.delete(e)}),this.cache={},this.order=[]}get(e){const t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}set(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}delete(e){const t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}deleteCache(e){delete this.cache[e]}deleteOrder(e){const t=this.order.findIndex(r=>r===e);t>=0&&this.order.splice(t,1)}appendOrder(e){this.order.push(e)}defaultDestroy(e,t){return null}};function vf(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t*1}function Wu(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t*1}function us(e){if(e.length===0)return 0;let t=e[0]*1;for(let r=1;r<e.length;r++)t+=e[r]*1;return t}function oc(e){if(e.length===0)throw new Error("mean requires at least one data point");return us(e)/e.length}function wu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();let t=e[0],r=NaN,i=0,a=1;for(let u=1;u<e.length+1;u++)e[u]!==t?(a>i&&(i=a,r=t),a=1,t=e[u]):a++;return r*1}var ac={min:Wu,max:vf,mean:oc,sum:us,mode:wu};function Ol(e,t){return e.map(r=>r[t])}function _f(e,t){return ac[e](t)}function gf(e,t){t===void 0&&(t={});var r=Number(e[0]),i=Number(e[1]),a=Number(e[2]),u=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var h=[r,i],m=[r,u],g=[a,u],E=[a,i];return Pt([[h,E,g,m,h]],t.properties,{bbox:e,id:t.id})}var fl=N(72895),Dl=N.n(fl),Ll=(e=>(e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e))(Ll||{}),aa=(e=>(e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e))(aa||{}),Js=0,zc=1,uu=2;function eu(e){e.forEach(t=>{t.isCurrent&&(t.isVisible=t.isLoaded)})}function Gf(e){e.forEach(t=>{t.properties.state=Js}),e.forEach(t=>{t.isCurrent&&!Zc(t)&&sc(t)}),e.forEach(t=>{t.isVisible=!!(t.properties.state&uu)})}function Vc(e){e.forEach(r=>{r.properties.state=Js}),e.forEach(r=>{r.isCurrent&&Zc(r)}),e.slice().sort((r,i)=>r.z-i.z).forEach(r=>{r.isVisible=!!(r.properties.state&uu),r.children.length&&(r.isVisible||r.properties.state&zc)?r.children.forEach(i=>{i.properties.state=zc}):r.isCurrent&&sc(r)})}function Zc(e){for(;e;){if(e.isLoaded)return e.properties.state|=uu,!0;e=e.parent}return!1}function sc(e){e.children.forEach(t=>{t.isLoaded?t.properties.state|=uu:sc(t)})}var l=256,f=[-1/0,-1/0,1/0,1/0],c=.2,d=5,x={[Ll.Realtime]:eu,[Ll.Overlap]:Gf,[Ll.Replace]:Vc},S=()=>{};function T(e,t,r){const i=Math.floor((e+180)/360*Math.pow(2,r)),a=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[i,a]}function M(e,t,r){const i=e/Math.pow(2,r)*360-180,a=Math.PI-2*Math.PI*t/Math.pow(2,r),u=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[i,u]}var k=(e,t,r)=>{const[i,a]=M(e,t,r),[u,h]=M(e+1,t+1,r);return[i,h,u,a]};function X({zoom:e,latLonBounds:t,maxZoom:r=1/0,minZoom:i=0,zoomOffset:a=0,extent:u=f}){let h=Math.ceil(e)+a;if(Number.isFinite(i)&&h<i)return[];Number.isFinite(r)&&h>r&&(h=r);const[m,g,E,A]=t,w=[Math.max(m,u[0]),Math.max(g,u[1]),Math.min(E,u[2]),Math.min(A,u[3])],R=[],[U,q]=T(w[0],w[1],h),[ce,Se]=T(w[2],w[3],h);for(let mt=U;mt<=ce;mt++)for(let er=Se;er<=q;er++)R.push({x:mt,y:er,z:h});const ke=(ce+U)/2,Fe=(q+Se)/2,rt=(mt,er)=>Math.abs(mt-ke)+Math.abs(er-Fe);return R.sort((mt,er)=>rt(mt.x,mt.y)-rt(er.x,er.y)),R}var oe=(e,t,r,i=!0)=>{const a=Math.pow(2,r),u=a-1,h=a;let m=e;const g=t;return i&&(m<0?m=m+h:m>u&&(m=m%h)),{warpX:m,warpY:g}},le=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),he=class extends fl.EventEmitter{constructor(e){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;const{x:t,y:r,z:i,tileSize:a,warp:u=!0}=e;this.x=t,this.y=r,this.z=i,this.warp=u||!0,this.tileSize=a}get isLoading(){return this.loadStatus===aa.Loading}get isLoaded(){return this.loadStatus===aa.Loaded}get isFailure(){return this.loadStatus===aa.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===aa.Cancelled}get isDone(){return[aa.Loaded,aa.Cancelled,aa.Failure].includes(this.loadStatus)}get bounds(){return k(this.x,this.y,this.z)}get bboxPolygon(){const[e,t,r,i]=this.bounds,a=[(r-e)/2,(i-t)/2];return gf(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:a,meta:`
      ${this.key}
      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit("layerLoaded")}loadData(e){return le(this,arguments,function*({getData:t,onLoad:r,onError:i}){this.loadDataId++;const a=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=aa.Loading;let u=null,h;try{const{x:m,y:g,z:E,bounds:A,tileSize:w,warp:R}=this,{warpX:U,warpY:q}=oe(m,g,E,R),{signal:ce}=this.abortController;u=yield t({x:U,y:q,z:E,bounds:A,tileSize:w,signal:ce,warp:R},this)}catch(m){h=m}if(a===this.loadDataId&&!(this.isCancelled&&!u)){if(h||!u){this.loadStatus=aa.Failure,i(h,this);return}this.loadStatus=aa.Loaded,this.data=u,r(this)}})}reloadData(e){this.isLoading&&this.abortLoad(),this.loadData(e)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=aa.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}},Pe=(e,t)=>{const r=Ur(e),i=Ki(r,t),a=360*3-180,u=85.0511287798065;return[Math.max(i[0][0],-a),Math.max(i[0][1],-u),Math.min(i[1][0],a),Math.min(i[1][1],u)]},we=(e,t)=>{const r=Ur(e),i=Ur(t);return kc(r,i)},Xe=Object.defineProperty,Ae=Object.defineProperties,We=Object.getOwnPropertyDescriptors,nt=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable,Rt=(e,t,r)=>t in e?Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Xt=(e,t)=>{for(var r in t||(t={}))vt.call(t,r)&&Rt(e,r,t[r]);if(nt)for(var r of nt(t))Vt.call(t,r)&&Rt(e,r,t[r]);return e},or=(e,t)=>Ae(e,We(t)),{throttle:Pr}=Yn,wr=(e=>(e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e))(wr||{}),en=class extends Dl(){constructor(e){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=Pr((t,r)=>{this.update(t,r)},16),this.onTileLoad=t=>{this.emit("tile-loaded",t),this.updateTileVisible(),this.loadFinished()},this.onTileError=(t,r)=>{this.emit("tile-error",{error:t,tile:r}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=t=>{this.emit("tile-unload",t),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:f,getTileData:S,warp:!0,updateStrategy:Ll.Replace},this.updateOptions(e)}get isLoaded(){return this.currentTiles.every(e=>e.isDone)}get tiles(){return Array.from(this.cacheTiles.values()).sort((t,r)=>t.z-r.z)}updateOptions(e){const t=e.minZoom===void 0?this.options.minZoom:Math.ceil(e.minZoom),r=e.maxZoom===void 0?this.options.maxZoom:Math.floor(e.maxZoom);this.options=or(Xt(Xt({},this.options),e),{minZoom:t,maxZoom:r})}update(e,t){const r=Math.max(0,Math.ceil(e));if(this.lastViewStates&&this.lastViewStates.zoom===r&&we(this.lastViewStates.latLonBoundsBuffer,t))return;const i=Pe(t,c);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=r;let a=!1;const u=this.getTileIndices(r,i).filter(h=>this.options.warp||h.x>=0&&h.x<Math.pow(2,r));this.emit("tiles-load-start"),this.currentTiles=u.map(({x:h,y:m,z:g})=>{let E=this.getTile(h,m,g);return E?(((E==null?void 0:E.isFailure)||(E==null?void 0:E.isCancelled))&&E.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),E):(E=this.createTile(h,m,g),a=!0,E)}),a&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(const[e,t]of this.cacheTiles){if(!this.currentTiles.includes(t)){this.cacheTiles.delete(e),this.onTileUnload(t);return}this.onTileUnload(t),t.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(e,t,r){const i=this.cacheTiles.get(`${t},${r},${e}`);i&&(this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(e,t,r){const i=this.getTileByLngLat(e,t,r);i&&this.reloadTileById(i.z,i.x,i.y)}reloadTileByExtent(e,t){this.getTileIndices(t,e).forEach(i=>{this.reloadTileById(i.z,i.x,i.y)})}pruneRequests(){const e=[];for(const t of this.cacheTiles.values())t.isLoading&&!t.isCurrent&&!t.isVisible&&e.push(t);for(;e.length>0;)e.shift().abortLoad()}getTileByLngLat(e,t,r){const{zoomOffset:i}=this.options,a=Math.ceil(r)+i,u=T(e,t,a);return this.tiles.filter(m=>m.key===`${u[0]}_${u[1]}_${a}`)[0]}getTileExtent(e,t){return this.getTileIndices(t,e)}getTileByZXY(e,t,r){return this.tiles.filter(a=>a.key===`${t}_${r}_${e}`)[0]}clear(){for(const e of this.cacheTiles.values())e.isLoading?e.abortLoad():this.onTileUnload(e);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){const e=this.options.updateStrategy,t=new Map;for(const a of this.cacheTiles.values())t.set(a.key,a.isVisible),a.isCurrent=!1,a.isVisible=!1;for(const a of this.currentTiles)a.isCurrent=!0,a.isVisible=!0;const r=Array.from(this.cacheTiles.values());typeof e=="function"?e(r):x[e](r);let i=!1;Array.from(this.cacheTiles.values()).forEach(a=>{a.isVisible!==t.get(a.key)?(a.isVisibleChange=!0,i=!0):a.isVisibleChange=!1}),i&&this.emit("tile-update")}getTileIndices(e,t){const{tileSize:r,extent:i,zoomOffset:a}=this.options,u=Math.floor(this.options.maxZoom),h=Math.ceil(this.options.minZoom);return X({maxZoom:u,minZoom:h,zoomOffset:a,tileSize:r,zoom:e,latLonBounds:t,extent:i})}getTileId(e,t,r){return`${e},${t},${r}`}loadFinished(){const e=!this.currentTiles.some(t=>!t.isDone);return e&&this.emit("tiles-load-finished"),e}getTile(e,t,r){const i=this.getTileId(e,t,r);return this.cacheTiles.get(i)}createTile(e,t,r){const i=this.getTileId(e,t,r),a=new he({x:e,y:t,z:r,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(i,a),a.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),a}resizeCacheTiles(){const e=d*this.currentTiles.length;if(this.cacheTiles.size>e){for(const[r,i]of this.cacheTiles)if(!i.isVisible&&!this.currentTiles.includes(i)&&(this.cacheTiles.delete(r),this.onTileUnload(i)),this.cacheTiles.size<=e)break}this.rebuildTileTree()}rebuildTileTree(){for(const e of this.cacheTiles.values())e.parent=null,e.children.length=0;for(const e of this.cacheTiles.values()){const t=this.getNearestAncestor(e.x,e.y,e.z);e.parent=t,t!=null&&t.children&&t.children.push(e)}}getNearestAncestor(e,t,r){for(;r>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),r=r-1;const i=this.getTile(e,t,r);if(i)return i}return null}};function An(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Cn(e){const t=[];let r=/\{([a-z])-([a-z])\}/.exec(e);if(r){const i=r[1].charCodeAt(0),a=r[2].charCodeAt(0);let u;for(u=i;u<=a;++u)t.push(e.replace(r[0],String.fromCharCode(u)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){const i=parseInt(r[2],10);for(let a=parseInt(r[1],10);a<=i;a++)t.push(e.replace(r[0],a.toString()));return t}return t.push(e),t}function vn(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");const{x:r,y:i,z:a}=t,u=Cn(e),h=Math.abs(r+i)%u.length;return(Bt(u[h])?`${u[h]}/{z}/{x}/{y}`:u[h]).replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,i.toString()).replace(/\{z\}/g,a.toString()).replace(/\{bbox\}/g,k(r,i,a).join(",")).replace(/\{-y\}/g,(Math.pow(2,a)-i-1).toString())}function wi(e,t){const{x:r,y:i,z:a,layer:u,version:h="1.0.0",style:m="default",format:g,service:E="WMTS",tileMatrixset:A}=t,w=Cn(e),R=Math.abs(r+i)%w.length;return`${w[R]}&SERVICE=${E}&REQUEST=GetTile&VERSION=${h}&LAYER=${u}&STYLE=${m}&TILEMATRIXSET=${A}&FORMAT=${g}&TILECOL=${r}&TILEROW=${i}&TILEMATRIX=${a}`}function Kr(e,t){return e==null?t:e}var Hn=N(38163),si=N.n(Hn);function jn(e,t){return e.map(r=>r[t]*1)}function Un(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function ei(e){return Array.isArray(e)?e.length===0?!1:!!Un(e[0]):!1}function Bn(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function On(e){const t=Object.isFrozen(e)?Yn.cloneDeep(e):e;return si()(t,!0),t}function Oo(e,t){return e||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}var Do=Object.defineProperty,Ra=Object.defineProperties,va=Object.getOwnPropertyDescriptors,Ao=Object.getOwnPropertySymbols,Lo=Object.prototype.hasOwnProperty,Ja=Object.prototype.propertyIsEnumerable,Na=(e,t,r)=>t in e?Do(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,lu=(e,t)=>{for(var r in t||(t={}))Lo.call(t,r)&&Na(e,r,t[r]);if(Ao)for(var r of Ao(t))Ja.call(t,r)&&Na(e,r,t[r]);return e},Ya=(e,t)=>Ra(e,va(t));function Zs(e,t){const{x:r,y:i,x1:a,y1:u,coordinates:h,geometry:m}=t,g=[];if(!Array.isArray(e))return{dataArray:[]};if(m)return e.filter(E=>E[m]&&E[m].type&&E[m].coordinates&&E[m].coordinates.length>0).forEach((E,A)=>{const w=On(E[m]);ur(w,R=>{const U=da(R),q=Ya(lu({},E),{_id:A,coordinates:U});g.push(q)})}),{dataArray:g};for(let E=0;E<e.length;E++){const A=e[E];let w=[];if(h){let U="Polygon";Array.isArray(h[0])||(U="Point"),Array.isArray(h[0])&&!Array.isArray(h[0][0])&&(U="LineString"),w=On({type:U,coordinates:A[h]}).coordinates}else if(r&&i&&a&&u){const U=[parseFloat(A[r]),parseFloat(A[i])],q=[parseFloat(A[a]),parseFloat(A[u])];w=[U,q]}else r&&i&&(w=[parseFloat(A[r]),parseFloat(A[i])]);const R=Ya(lu({},A),{_id:E,coordinates:w});g.push(R)}return{dataArray:g}}function Cs(e,t){const r=Mt(e);return Zs(r,t)}var uc=Object.defineProperty,Fl=Object.defineProperties,Ru=Object.getOwnPropertyDescriptors,Gu=Object.getOwnPropertySymbols,Xu=Object.prototype.hasOwnProperty,cu=Object.prototype.propertyIsEnumerable,Yu=(e,t,r)=>t in e?uc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ka=(e,t)=>{for(var r in t||(t={}))Xu.call(t,r)&&Yu(e,r,t[r]);if(Gu)for(var r of Gu(t))cu.call(t,r)&&Yu(e,r,t[r]);return e},Ho=(e,t)=>Fl(e,Ru(t));function ls(e){const t=e.toString();let r=5381,i=t.length;for(;i;)r=r*33^t.charCodeAt(--i);return r>>>0}function tu(e,t){return t===void 0?null:typeof(e.properties[t]*1)=="number"?e.properties[t]*1:e.properties&&e.properties[t]?ls(e.properties[t]+"")%1000019:null}function fu(e,t){const r=[],i={};return e.features?(e.features=e.features.filter(a=>{const u=a.geometry;return a!=null&&u&&u.type&&u.coordinates&&u.coordinates.length>0}),e=On(e),e.features.length===0?{dataArray:[],featureKeys:i}:(ur(e,(a,u)=>{let h=tu(a,t==null?void 0:t.featureId);h===null&&(h=u);const m=h,g=da(a),E=Ho(ka({},a.properties),{coordinates:g,_id:m});r.push(E)}),{dataArray:r,featureKeys:i})):(e.features=[],{dataArray:[]})}function yi(e,t,r,i){for(var a=i,u=r-t>>1,h=r-t,m,g=e[t],E=e[t+1],A=e[r],w=e[r+1],R=t+3;R<r;R+=3){var U=Ma(e[R],e[R+1],g,E,A,w);if(U>a)m=R,a=U;else if(U===a){var q=Math.abs(R-u);q<h&&(m=R,h=q)}}a>i&&(m-t>3&&yi(e,t,m,i),e[m+2]=a,r-m>3&&yi(e,m,r,i))}function Ma(e,t,r,i,a,u){var h=a-r,m=u-i;if(h!==0||m!==0){var g=((e-r)*h+(t-i)*m)/(h*h+m*m);g>1?(r=a,i=u):g>0&&(r+=h*g,i+=m*g)}return h=e-r,m=t-i,h*h+m*m}function Fo(e,t,r,i){var a={id:typeof e=="undefined"?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return Mu(a),a}function Mu(e){var t=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")lc(e,t);else if(r==="Polygon"||r==="MultiLineString")for(var i=0;i<t.length;i++)lc(e,t[i]);else if(r==="MultiPolygon")for(i=0;i<t.length;i++)for(var a=0;a<t[i].length;a++)lc(e,t[i][a])}function lc(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function hl(e,t){var r=[];if(e.type==="FeatureCollection")for(var i=0;i<e.features.length;i++)cc(r,e.features[i],t,i);else e.type==="Feature"?cc(r,e,t):cc(r,{geometry:e},t);return r}function cc(e,t,r,i){if(t.geometry){var a=t.geometry.coordinates,u=t.geometry.type,h=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),m=[],g=t.id;if(r.promoteId?g=t.properties[r.promoteId]:r.generateId&&(g=i||0),u==="Point")pl(a,m);else if(u==="MultiPoint")for(var E=0;E<a.length;E++)pl(a[E],m);else if(u==="LineString")qu(a,m,h,!1);else if(u==="MultiLineString")if(r.lineMetrics){for(E=0;E<a.length;E++)m=[],qu(a[E],m,h,!1),e.push(Fo(g,"LineString",m,t.properties));return}else js(a,m,h,!1);else if(u==="Polygon")js(a,m,h,!0);else if(u==="MultiPolygon")for(E=0;E<a.length;E++){var A=[];js(a[E],A,h,!0),m.push(A)}else if(u==="GeometryCollection"){for(E=0;E<t.geometry.geometries.length;E++)cc(e,{id:g,geometry:t.geometry.geometries[E],properties:t.properties},r,i);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Fo(g,u,m,t.properties))}}function pl(e,t){t.push(jc(e[0])),t.push(Eh(e[1])),t.push(0)}function qu(e,t,r,i){for(var a,u,h=0,m=0;m<e.length;m++){var g=jc(e[m][0]),E=Eh(e[m][1]);t.push(g),t.push(E),t.push(0),m>0&&(i?h+=(a*E-g*u)/2:h+=Math.sqrt(Math.pow(g-a,2)+Math.pow(E-u,2))),a=g,u=E}var A=t.length-3;t[2]=1,yi(t,0,A,r),t[A+2]=1,t.size=Math.abs(h),t.start=0,t.end=t.size}function js(e,t,r,i){for(var a=0;a<e.length;a++){var u=[];qu(e[a],u,r,i),t.push(u)}}function jc(e){return e/360+.5}function Eh(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function ws(e,t,r,i,a,u,h,m){if(r/=t,i/=t,u>=r&&h<i)return e;if(h<r||u>=i)return null;for(var g=[],E=0;E<e.length;E++){var A=e[E],w=A.geometry,R=A.type,U=a===0?A.minX:A.minY,q=a===0?A.maxX:A.maxY;if(U>=r&&q<i){g.push(A);continue}else if(q<r||U>=i)continue;var ce=[];if(R==="Point"||R==="MultiPoint")cs(w,ce,r,i,a);else if(R==="LineString")op(w,ce,r,i,a,!1,m.lineMetrics);else if(R==="MultiLineString")fc(w,ce,r,i,a,!1);else if(R==="Polygon")fc(w,ce,r,i,a,!0);else if(R==="MultiPolygon")for(var Se=0;Se<w.length;Se++){var ke=[];fc(w[Se],ke,r,i,a,!0),ke.length&&ce.push(ke)}if(ce.length){if(m.lineMetrics&&R==="LineString"){for(Se=0;Se<ce.length;Se++)g.push(Fo(A.id,R,ce[Se],A.tags));continue}(R==="LineString"||R==="MultiLineString")&&(ce.length===1?(R="LineString",ce=ce[0]):R="MultiLineString"),(R==="Point"||R==="MultiPoint")&&(R=ce.length===3?"Point":"MultiPoint"),g.push(Fo(A.id,R,ce,A.tags))}}return g.length?g:null}function cs(e,t,r,i,a){for(var u=0;u<e.length;u+=3){var h=e[u+a];h>=r&&h<=i&&(t.push(e[u]),t.push(e[u+1]),t.push(e[u+2]))}}function op(e,t,r,i,a,u,h){for(var m=ap(e),g=a===0?Qd:Jd,E=e.start,A,w,R=0;R<e.length-3;R+=3){var U=e[R],q=e[R+1],ce=e[R+2],Se=e[R+3],ke=e[R+4],Fe=a===0?U:q,rt=a===0?Se:ke,mt=!1;h&&(A=Math.sqrt(Math.pow(U-Se,2)+Math.pow(q-ke,2))),Fe<r?rt>r&&(w=g(m,U,q,Se,ke,r),h&&(m.start=E+A*w)):Fe>i?rt<i&&(w=g(m,U,q,Se,ke,i),h&&(m.start=E+A*w)):sp(m,U,q,ce),rt<r&&Fe>=r&&(w=g(m,U,q,Se,ke,r),mt=!0),rt>i&&Fe<=i&&(w=g(m,U,q,Se,ke,i),mt=!0),!u&&mt&&(h&&(m.end=E+A*w),t.push(m),m=ap(e)),h&&(E+=A)}var er=e.length-3;U=e[er],q=e[er+1],ce=e[er+2],Fe=a===0?U:q,Fe>=r&&Fe<=i&&sp(m,U,q,ce),er=m.length-3,u&&er>=3&&(m[er]!==m[0]||m[er+1]!==m[1])&&sp(m,m[0],m[1],m[2]),m.length&&t.push(m)}function ap(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function fc(e,t,r,i,a,u){for(var h=0;h<e.length;h++)op(e[h],t,r,i,a,u,!1)}function sp(e,t,r,i){e.push(t),e.push(r),e.push(i)}function Qd(e,t,r,i,a,u){var h=(u-t)/(i-t);return e.push(u),e.push(r+(a-r)*h),e.push(1),h}function Jd(e,t,r,i,a,u){var h=(u-r)/(a-r);return e.push(t+(i-t)*h),e.push(u),e.push(1),h}function bh(e,t){var r=t.buffer/t.extent,i=e,a=ws(e,1,-1-r,r,0,-1,2,t),u=ws(e,1,1-r,2+r,0,-1,2,t);return(a||u)&&(i=ws(e,1,-r,1+r,0,-1,2,t)||[],a&&(i=Jp(a,1).concat(i)),u&&(i=i.concat(Jp(u,-1)))),i}function Jp(e,t){for(var r=[],i=0;i<e.length;i++){var a=e[i],u=a.type,h;if(u==="Point"||u==="MultiPoint"||u==="LineString")h=yf(a.geometry,t);else if(u==="MultiLineString"||u==="Polygon"){h=[];for(var m=0;m<a.geometry.length;m++)h.push(yf(a.geometry[m],t))}else if(u==="MultiPolygon")for(h=[],m=0;m<a.geometry.length;m++){for(var g=[],E=0;E<a.geometry[m].length;E++)g.push(yf(a.geometry[m][E],t));h.push(g)}r.push(Fo(a.id,u,h,a.tags))}return r}function yf(e,t){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function up(e,t){if(e.transformed)return e;var r=1<<e.z,i=e.x,a=e.y,u,h,m;for(u=0;u<e.features.length;u++){var g=e.features[u],E=g.geometry,A=g.type;if(g.geometry=[],A===1)for(h=0;h<E.length;h+=2)g.geometry.push(Bl(E[h],E[h+1],t,r,i,a));else for(h=0;h<E.length;h++){var w=[];for(m=0;m<E[h].length;m+=2)w.push(Bl(E[h][m],E[h][m+1],t,r,i,a));g.geometry.push(w)}}return e.transformed=!0,e}function Bl(e,t,r,i,a,u){return[Math.round(r*(e*i-a)),Math.round(r*(t*i-u))]}function Xf(e,t,r,i,a){for(var u=t===a.maxZoom?0:a.tolerance/((1<<t)*a.extent),h={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},m=0;m<e.length;m++){h.numFeatures++,em(h,e[m],u,a);var g=e[m].minX,E=e[m].minY,A=e[m].maxX,w=e[m].maxY;g<h.minX&&(h.minX=g),E<h.minY&&(h.minY=E),A>h.maxX&&(h.maxX=A),w>h.maxY&&(h.maxY=w)}return h}function em(e,t,r,i){var a=t.geometry,u=t.type,h=[];if(u==="Point"||u==="MultiPoint")for(var m=0;m<a.length;m+=3)h.push(a[m]),h.push(a[m+1]),e.numPoints++,e.numSimplified++;else if(u==="LineString")lp(h,a,e,r,!1,!1);else if(u==="MultiLineString"||u==="Polygon")for(m=0;m<a.length;m++)lp(h,a[m],e,r,u==="Polygon",m===0);else if(u==="MultiPolygon")for(var g=0;g<a.length;g++){var E=a[g];for(m=0;m<E.length;m++)lp(h,E[m],e,r,!0,m===0)}if(h.length){var A=t.tags||null;if(u==="LineString"&&i.lineMetrics){A={};for(var w in t.tags)A[w]=t.tags[w];A.mapbox_clip_start=a.start/a.size,A.mapbox_clip_end=a.end/a.size}var R={geometry:h,type:u==="Polygon"||u==="MultiPolygon"?3:u==="LineString"||u==="MultiLineString"?2:1,tags:A};t.id!==null&&(R.id=t.id),e.features.push(R)}}function lp(e,t,r,i,a,u){var h=i*i;if(i>0&&t.size<(a?h:i)){r.numPoints+=t.length/3;return}for(var m=[],g=0;g<t.length;g+=3)(i===0||t[g+2]>h)&&(r.numSimplified++,m.push(t[g]),m.push(t[g+1])),r.numPoints++;a&&tm(m,u),e.push(m)}function tm(e,t){for(var r=0,i=0,a=e.length,u=a-2;i<a;u=i,i+=2)r+=(e[i]-e[u])*(e[i+1]+e[u+1]);if(r>0===t)for(i=0,a=e.length;i<a/2;i+=2){var h=e[i],m=e[i+1];e[i]=e[a-2-i],e[i+1]=e[a-1-i],e[a-2-i]=h,e[a-1-i]=m}}function rm(e,t){return new Sh(e,t)}function Sh(e,t){t=this.options=Ah(Object.create(this.options),t);var r=t.debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=hl(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=bh(i,t),i.length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Sh.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sh.prototype.splitTile=function(e,t,r,i,a,u,h){for(var m=[e,t,r,i],g=this.options,E=g.debug;m.length;){i=m.pop(),r=m.pop(),t=m.pop(),e=m.pop();var A=1<<t,w=Yf(t,r,i),R=this.tiles[w];if(!R&&(E>1&&console.time("creation"),R=this.tiles[w]=Xf(e,t,r,i,g),this.tileCoords.push({z:t,x:r,y:i}),E)){E>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,R.numFeatures,R.numPoints,R.numSimplified),console.timeEnd("creation"));var U="z"+t;this.stats[U]=(this.stats[U]||0)+1,this.total++}if(R.source=e,a){if(t===g.maxZoom||t===a)continue;var q=1<<a-t;if(r!==Math.floor(u/q)||i!==Math.floor(h/q))continue}else if(t===g.indexMaxZoom||R.numPoints<=g.indexMaxPoints)continue;if(R.source=null,e.length!==0){E>1&&console.time("clipping");var ce=.5*g.buffer/g.extent,Se=.5-ce,ke=.5+ce,Fe=1+ce,rt,mt,er,cr,kt,dr;rt=mt=er=cr=null,kt=ws(e,A,r-ce,r+ke,0,R.minX,R.maxX,g),dr=ws(e,A,r+Se,r+Fe,0,R.minX,R.maxX,g),e=null,kt&&(rt=ws(kt,A,i-ce,i+ke,1,R.minY,R.maxY,g),mt=ws(kt,A,i+Se,i+Fe,1,R.minY,R.maxY,g),kt=null),dr&&(er=ws(dr,A,i-ce,i+ke,1,R.minY,R.maxY,g),cr=ws(dr,A,i+Se,i+Fe,1,R.minY,R.maxY,g),dr=null),E>1&&console.timeEnd("clipping"),m.push(rt||[],t+1,r*2,i*2),m.push(mt||[],t+1,r*2,i*2+1),m.push(er||[],t+1,r*2+1,i*2),m.push(cr||[],t+1,r*2+1,i*2+1)}}},Sh.prototype.getTile=function(e,t,r){var i=this.options,a=i.extent,u=i.debug;if(e<0||e>24)return null;var h=1<<e;t=(t%h+h)%h;var m=Yf(e,t,r);if(this.tiles[m])return up(this.tiles[m],a);u>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var g=e,E=t,A=r,w;!w&&g>0;)g--,E=Math.floor(E/2),A=Math.floor(A/2),w=this.tiles[Yf(g,E,A)];return!w||!w.source?null:(u>1&&console.log("found parent tile z%d-%d-%d",g,E,A),u>1&&console.time("drilling down"),this.splitTile(w.source,g,E,A,e,t,r),u>1&&console.timeEnd("drilling down"),this.tiles[m]?up(this.tiles[m],a):null)};function Yf(e,t,r){return((1<<e)*r+t)*32+e}function Ah(e,t){for(var r in t)e[r]=t[r];return e}var dl=class{constructor(e,t,r,i){this.vectorLayerCache={},this.x=t,this.y=r,this.z=i,this.vectorTile=e}getTileData(e){return!e||!this.vectorTile.layers[e]?[]:this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features}getFeatureById(){throw new Error("Method not implemented.")}},Th=Object.defineProperty,hc=Object.defineProperties,Ch=Object.getOwnPropertyDescriptors,Bo=Object.getOwnPropertySymbols,Hc=Object.prototype.hasOwnProperty,wh=Object.prototype.propertyIsEnumerable,pc=(e,t,r)=>t in e?Th(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ml=(e,t)=>{for(var r in t||(t={}))Hc.call(t,r)&&pc(e,r,t[r]);if(Bo)for(var r of Bo(t))wh.call(t,r)&&pc(e,r,t[r]);return e},dc=(e,t)=>hc(e,Ch(t)),xf=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),Ef={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function Nl(e){let t=0;for(let r=0,i=e.length,a=i-1,u,h;r<i;a=r++)u=e[r],h=e[a],t+=(h.x-u.x)*(u.y+h.y);return t}function Wc(e){const t=e.length;if(t<=1)return[e];const r=[];let i,a;for(let u=0;u<t;u++){const h=Nl(e[u]);h!==0&&(a===void 0&&(a=h<0),a===h<0?(i&&r.push(i),i=[e[u]]):i.push(e[u]))}return i&&r.push(i),r}var Gc=["Unknown","Point","LineString","Polygon"];function ed(e,t,r,i,a){let u=a.geometry;const h=a.type,m=a.tags,g=a.id,E=e*Math.pow(2,i),A=e*t,w=e*r;let R=Gc[h],U,q;function ce(ke){for(let Fe=0;Fe<ke.length;Fe++){const rt=ke[Fe];if(rt[3])break;const mt=180-(rt[1]+w)*360/E,er=(rt[0]+A)*360/E-180,cr=360/Math.PI*Math.atan(Math.exp(mt*Math.PI/180))-90;ke[Fe]=[er,cr,0,1]}}switch(h){case 1:const ke=[];for(U=0;U<u.length;U++)ke[U]=u[U][0];u=ke,ce(u);break;case 2:for(U=0;U<u.length;U++)ce(u[U]);break;case 3:for(u=Wc(u),U=0;U<u.length;U++)for(q=0;q<u[U].length;q++)ce(u[U][q]);break}return u.length===1?u=u[0]:R="Multi"+R,{type:"Feature",geometry:{type:R,coordinates:u},properties:m,id:g,tileOrigin:[0,0],coord:""}}var kl=(e,t,r,i)=>xf(void 0,null,function*(){return new Promise(a=>{const u=t.getTile(e.z,e.x,e.y),m={layers:{defaultLayer:{features:u?u.features.map(E=>ed(i,r.x,r.y,r.z,E)):[]}}},g=new dl(m,e.x,e.y,e.z);a(g)})});function Xc(e){const t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?t:ml(ml({},t),e.geojsonvtOptions)}function Rh(e,t){const r=Xc(t),i=r.extent||4096,a=rm(e,r),u=(m,g)=>kl(g,a,m,i),h=dc(ml(ml({},Ef),t),{getTileData:u});return{data:e,dataArray:[],tilesetOptions:h,isTile:!0}}var cp=Object.defineProperty,fp=Object.defineProperties,hp=Object.getOwnPropertyDescriptors,Iu=Object.getOwnPropertySymbols,mc=Object.prototype.hasOwnProperty,td=Object.prototype.propertyIsEnumerable,pp=(e,t,r)=>t in e?cp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dp=(e,t)=>{for(var r in t||(t={}))mc.call(t,r)&&pp(e,r,t[r]);if(Iu)for(var r of Iu(t))td.call(t,r)&&pp(e,r,t[r]);return e},mp=(e,t)=>fp(e,hp(t));function vc(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:i,requestParameters:a={}}=t,u=new Promise(g=>{e instanceof HTMLImageElement||Bc(e)?g([e]):nm(e,a,E=>{g(E)})}),h=Oo(i,r);return{originData:e,images:u,_id:1,dataArray:[{_id:0,coordinates:h}]}}function nm(e,t,r){const i=[];if(typeof e=="string")oo(mp(dp({},t),{url:e}),(a,u)=>{u&&(i.push(u),r(i))});else{const a=e.length;let u=0;e.forEach(h=>{oo(mp(dp({},t),{url:h}),(m,g)=>{u++,g&&i.push(g),u===a&&r(i)})})}return vc}var vl=Object.defineProperty,vp=Object.defineProperties,Yc=Object.getOwnPropertyDescriptors,Ul=Object.getOwnPropertySymbols,rd=Object.prototype.hasOwnProperty,_c=Object.prototype.propertyIsEnumerable,qf=(e,t,r)=>t in e?vl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Kf=(e,t)=>{for(var r in t||(t={}))rd.call(t,r)&&qf(e,r,t[r]);if(Ul)for(var r of Ul(t))_c.call(t,r)&&qf(e,r,t[r]);return e},es=(e,t)=>vp(e,Yc(t)),ts=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),_a=(e,t,r,i)=>ts(void 0,null,function*(){const a={x:t.x,y:t.y,z:t.z},u=vn(e,a);return new Promise(h=>{i?i(a,(m,g)=>{if(m||!g){const E={layers:{defaultLayer:{features:[]}}},A=new dl(E,t.x,t.y,t.z);h(A)}else{const E={layers:{defaultLayer:{features:g.features}}},A=new dl(E,t.x,t.y,t.z);h(A)}}):oi(es(Kf({},r),{url:u}),(m,g)=>{if(m||!g){const E={layers:{defaultLayer:{features:[]}}},A=new dl(E,t.x,t.y,t.z);h(A)}else{const A={layers:{defaultLayer:{features:JSON.parse(g)}}},w=new dl(A,t.x,t.y,t.z);h(w)}})})});function ru(e,t){const r=(a,u)=>_a(e,u,t==null?void 0:t.requestParameters,t.getCustomData),i=es(Kf({},t),{getTileData:r});return{dataArray:[],tilesetOptions:i,isTile:!0}}var nd=N(38929),$f=N(3614),id=N.n($f),im=Object.defineProperty,om=Object.defineProperties,od=Object.getOwnPropertyDescriptors,ad=Object.getOwnPropertySymbols,sd=Object.prototype.hasOwnProperty,fs=Object.prototype.propertyIsEnumerable,ud=(e,t,r)=>t in e?im(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_p=(e,t)=>{for(var r in t||(t={}))sd.call(t,r)&&ud(e,r,t[r]);if(ad)for(var r of ad(t))fs.call(t,r)&&ud(e,r,t[r]);return e},gp=(e,t)=>om(e,od(t)),yp=class{constructor(e,t,r,i){this.vectorLayerCache={},this.x=t,this.y=r,this.z=i,this.vectorTile=new nd.VectorTile(new(id())(e))}getTileData(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];const t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;const r=[];for(let i=0;i<t.length;i++){const u=t.feature(i).toGeoJSON(this.x,this.y,this.z);r.push(gp(_p({},u),{properties:_p({id:u.id},u.properties)}))}return this.vectorLayerCache[e]=r,r}getFeatureById(){throw new Error("Method not implemented.")}},xp=Object.defineProperty,am=Object.defineProperties,sm=Object.getOwnPropertyDescriptors,Ep=Object.getOwnPropertySymbols,ld=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable,pe=(e,t,r)=>t in e?xp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ne=(e,t)=>{for(var r in t||(t={}))ld.call(t,r)&&pe(e,r,t[r]);if(Ep)for(var r of Ep(t))B.call(t,r)&&pe(e,r,t[r]);return e},It=(e,t)=>am(e,sm(t)),$t=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),Lt={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},yt=(e,t,r,i,a)=>$t(void 0,null,function*(){const u=vn(e,t);return new Promise(h=>{if(a)a({x:r.x,y:r.y,z:r.z},(m,g)=>{if(m||!g)h(void 0);else{const E=new yp(g,r.x,r.y,r.z);h(E)}});else{const m=Kn(It(Ne({},i),{url:u}),(g,E)=>{if(g||!E)h(void 0);else{const A=new yp(E,r.x,r.y,r.z);h(A)}});r.xhrCancel=()=>m.cancel()}})});function br(e,t){const r=Array.isArray(e)?e[0]:e,i=(u,h)=>yt(r,u,h,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData),a=It(Ne(Ne({},Lt),t),{getTileData:i});return{data:r,dataArray:[],tilesetOptions:a,isTile:!0}}function _r(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r;case"%":return t%r;case"^":return Math.pow(t,r);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return r===-1?Math.atan(t):Math.atan2(t,r);case"min":return Math.min(t,r);case"max":return Math.max(t,r);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Mr(e,t){const{width:r,height:i}=t[0],a=t.map(g=>g.rasterData),u=r*i,h=[],m=JSON.stringify(e);for(let g=0;g<u;g++){const E=JSON.parse(m),A=Sr(E,a,g);if(typeof A=="number")h.push(A);else{const w=kr(E);h.push(w)}}return h}function Sr(e,t,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return t[e[1]][r]}catch(i){return console.warn("Raster Data err!"),0}e.map((i,a)=>{if(Array.isArray(i)&&i.length>0)switch(i[0]){case"band":try{e[a]=t[i[1]][r]}catch(u){console.warn("Raster Data err!"),e[a]=0}break;default:Sr(i,t,r)}})}function Or(e){const[t,r=-1,i=-1]=e;return t===void 0?(console.warn("Express err!"),["+",0,0]):[t.replace(/\s+/g,""),r,i]}function kr(e){const t=Or(e),r=t[0];let i=t[1],a=t[2];return Array.isArray(i)&&(i=kr(e[1])),Array.isArray(a)&&(a=kr(e[2])),_r(r,i,a)}var gr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:Dr}};function Dr(e,t){const r=e[0].rasterData,i=e[1].rasterData,a=e[2].rasterData,u=[],[h,m]=(t==null?void 0:t.countCut)||[2,98],g=(t==null?void 0:t.RMinMax)||dt(r,h,m),E=(t==null?void 0:t.GMinMax)||dt(i,h,m),A=(t==null?void 0:t.BMinMax)||dt(a,h,m);for(let w=0;w<r.length;w++)u.push(Math.max(0,r[w]-g[0])),u.push(Math.max(0,i[w]-E[0])),u.push(Math.max(0,a[w]-A[0]));return{rasterData:u,rMinMax:g,gMinMax:E,bMinMax:A}}function dt(e,t,r){const i=e.slice().sort((m,g)=>m-g),a=i.length,u=i[Math.ceil(a*t/100)],h=i[Math.ceil(a*r/100)];return[u,h]}var Ht=Object.defineProperty,Ar=Object.defineProperties,Yr=Object.getOwnPropertyDescriptors,sr=Object.getOwnPropertySymbols,tn=Object.prototype.hasOwnProperty,yr=Object.prototype.propertyIsEnumerable,qr=(e,t,r)=>t in e?Ht(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fr=(e,t)=>{for(var r in t||(t={}))tn.call(t,r)&&qr(e,r,t[r]);if(sr)for(var r of sr(t))yr.call(t,r)&&qr(e,r,t[r]);return e},jr=(e,t)=>Ar(e,Yr(t)),wn=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())});function Wn(e,t,r){return wn(this,null,function*(){if(e.length===0)return{rasterData:[0],width:1,heigh:1};const i=yield Promise.all(e.map(({data:g,bands:E=[0]})=>t(g,E))),a=[];i.forEach(g=>{Array.isArray(g)?a.push(...g):a.push(g)});const{width:u,height:h}=a[0];let m;switch(typeof r){case"function":m=r(a);break;case"object":Array.isArray(r)?m={rasterData:Mr(r,a)}:m=Hr(r,a);break;default:m={rasterData:a[0].rasterData}}return jr(fr({},m),{width:u,height:h})})}function Hr(e,t){const r=gr[e.type];if(r.type==="function")return r.method(t,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?xr(r.expression,t):{rasterData:Mr(r.expression,t)}}function xr(e,t){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const r=Mr(e.r||["band",0],t),i=Mr(e.g||["band",0],t),a=Mr(e.b||["band",0],t);return[r,i,a]}function Qt(e,t,r,i){return wn(this,null,function*(){const a=yield Wn(e,t,r);i(null,{data:a})})}function Mn(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:i,width:a,height:u,min:h,max:m,format:g,operation:E}=t;let A,w,R;if(g===void 0||Bn(e))A=Array.from(e),w=a,R=u;else{const ce=Array.isArray(e)?e:[e];A=Wn(ce,g,E)}const U=Oo(i,r);return{_id:1,dataArray:[{_id:1,data:A,width:w,height:R,min:h,max:m,coordinates:U}]}}var lt=N(1413),P=N(4942);let ti=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),F=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({});const zn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{camelCase:ki,isNil:sa,upperFirst:Ua}=Yn;class ri{constructor(){(0,P.Z)(this,"shaderModuleService",void 0),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"config",void 0),(0,P.Z)(this,"quad",zn),(0,P.Z)(this,"enabled",!0),(0,P.Z)(this,"renderToScreen",!1),(0,P.Z)(this,"model",void 0),(0,P.Z)(this,"name",void 0),(0,P.Z)(this,"optionsToUpdate",{})}getName(){return this.name}setName(t){this.name=t}getType(){return ti.PostProcessing}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.shaderModuleService=t.getContainer().shaderModuleService;const{createAttribute:i,createBuffer:a,createModel:u}=this.rendererService,{vs:h,fs:m,uniforms:g}=this.setupShaders();this.model=u({vs:h,fs:m,attributes:{a_Position:i({buffer:a({data:[-4,-4,4,-4,0,4],type:F.FLOAT}),size:2})},uniforms:(0,lt.Z)((0,lt.Z)({u_Texture:null},g),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}render(t,r){const i=t.multiPassRenderer.getPostProcessor(),{useFramebuffer:a,getViewportSize:u,clear:h}=this.rendererService,{width:m,height:g}=u();a(this.renderToScreen?null:i.getWriteFBO(),()=>{h({framebuffer:i.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});const E=(0,lt.Z)({u_BloomFinal:0,u_Texture:i.getReadFBO(),u_ViewportSize:[m,g]},this.convertOptionsToUniforms(this.optionsToUpdate));r&&(E.u_BloomFinal=1,E.u_Texture2=r),this.model.draw({uniforms:E})})}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setRenderToScreen(t){this.renderToScreen=t}updateOptions(t){this.optionsToUpdate=(0,lt.Z)((0,lt.Z)({},this.optionsToUpdate),t)}setupShaders(){throw new Error("Method not implemented.")}convertOptionsToUniforms(t){const r={};return Object.keys(t).forEach(i=>{sa(t[i])||(r[`u_${Ua(ki(i))}`]=t[i])}),r}}function ua(e){let t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break;default:}return t}const vo=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function la(e,t=!1){const r={};return e=e.replace(vo,(i,a,u)=>{const h=u.split(":"),m=h[0].trim();let g="";switch(h.length>1&&(g=h[1].trim()),a){case"bool":g=g==="true";break;case"float":case"int":g=Number(g);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":g?g=g.replace("[","").replace("]","").split(",").reduce((E,A)=>(E.push(Number(A.trim())),E),[]):g=new Array(ua(a)).fill(0);break;default:}return r[m]=g,`${t?"uniform ":""}${a} ${m};
`}),{content:e,uniforms:r}}function ea(e){let{content:t,uniforms:r}=la(e,!0);return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(i,a,u)=>{u=u.trim().replace(/^.*$/gm,g=>`uniform ${g}`);const{content:h,uniforms:m}=la(u);return Object.assign(r,m),`${a}{
${h}
};`}),{content:t,uniforms:r}}function No(e){const t={};return e.replace(vo,(r,i,a)=>{const u=a.trim();return t[u]?"":(t[u]=!0,`uniform ${i} ${u};
`)})}const Ia=null;function hs(e){return Ia.indexOf(e)}const{clamp:ca}=Yn,li=2,rs=4,Hi=64,Nn=128,xi=256,Li=512,ga=8192,_l=16384,Me=32768,Ut=null,bt=131072,on=262144,hi=524288,so=1048576,te=2097152,xe=4194304,Ue=8388608,St=16777216,xt=null;function Ge(e,t){return e=ca(Math.floor(e),0,255),t=ca(Math.floor(t),0,255),256*e+t}function tt(e){const{color:t,radius:r,tileX:i,tileY:a,shape:u,opacity:h,stroke:m,strokeWidth:g,strokeOpacity:E}=e,A=[],w=[],R=[],U=[Ge(t[0],t[1]),Ge(t[2],t[3])],q=[Ge(m[0],m[1]),Ge(m[2],m[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(([ce,Se])=>{A.push([...U,(ce+1)*Ue+(Se+1)*te+getShapeIndex(u)*bt+r,(i+512)*hi+(a+512)*Hi]),w.push([...q,g,E]),R.push([h,0,0,0])}),{packedBuffer:A,packedBuffer2:w,packedBuffer3:R}}function ot(e,t){if(e===0&&!t)return 0;if(e===1&&t)return 4294967295;const r=t?1:0,i=Math.floor(e*127);return i*xt+r*St+i*bt+r*Ut+i*Li+r*xi+i*li+r}const Ce={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};let Ye=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),me=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({});const $e={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"};var Et={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};let Nt=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),ar=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Jt=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),vr=function(e){return e.AND="and",e.OR="or",e}({}),$r=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Tr=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e.CUSTOM="threshold",e}({}),ln=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Kt=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({});const Gn=["mapload","mapchange","mapAfterFrameChange"];var Wi=N(49296),ya=N.n(Wi),Rs=N(36829),bp=N.n(Rs);const Ms=30;function cd({characterSet:e,getFontWidth:t,fontHeight:r,buffer:i,maxCanvasWidth:a,mapping:u={},xOffset:h=0,yOffset:m=0}){let g=0,E=h;Array.from(e).forEach((w,R)=>{if(!u[w]){const U=t(w,R);E+Ms>a&&(E=0,g++),u[w]={x:E,y:m+g*Ms,width:Ms,height:Ms,advance:U},E+=Ms}});const A=r+i*2;return{mapping:u,xOffset:E,yOffset:m+g*A,canvasHeight:um(m+(g+1)*A)}}function zl(e,t,r){let i=0,a=0,u=0,h=[];const m={};for(const E of e)if(!m[E.id]){const{size:A}=E;i+A+t>r&&(Mh(m,h,a),i=0,a=u+a+t,u=0,h=[]),h.push({icon:E,xOffset:i}),i=i+A+t,u=Math.max(u,A)}h.length>0&&Mh(m,h,a);const g=um(u+a+t);return{mapping:m,canvasHeight:g}}function Mh(e,t,r){for(const i of t){const{icon:a,xOffset:u}=i;e[a.id]=(0,lt.Z)((0,lt.Z)({},a),{},{x:u,y:r,image:a.image,width:a.width,height:a.height})}}function um(e){return Math.pow(2,Math.ceil(Math.log2(e)))}const cv=dv(),fv="sans-serif",fd="normal",Qf=24,lm=3,Ih=.25,hv=8,xa=1024,ko=1,cm=1,pv=3,W0=null;function dv(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function fm(e,t,r,i){e.font=`${i} ${r}px ${t}`,e.fillStyle="black",e.textBaseline="middle"}function hd(e,t){for(let r=0;r<e.length;r++)t.data[4*r+3]=e[r]}class Jf extends Rs.EventEmitter{constructor(...t){super(...t),(0,P.Z)(this,"fontAtlas",void 0),(0,P.Z)(this,"iconFontMap",void 0),(0,P.Z)(this,"iconFontGlyphs",{}),(0,P.Z)(this,"fontOptions",void 0),(0,P.Z)(this,"key",void 0),(0,P.Z)(this,"cache",new cl(pv))}get scale(){return cm}get canvas(){const t=this.cache.get(this.key);return t&&t.data}get mapping(){const t=this.cache.get(this.key);return t&&t.mapping||{}}getCanvasByKey(t){const r=this.cache.get(t);return r&&r.data}getMappingByKey(t){const r=this.cache.get(t);return r&&r.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:fv,fontWeight:fd,characterSet:cv,fontSize:Qf,buffer:lm,sdf:!0,cutoff:Ih,radius:hv,iconfont:!1},this.key="",this.iconFontMap=new Map}addIconGlyphs(t){t.forEach(r=>{this.iconFontGlyphs[r.name]=r.unicode})}addIconFont(t,r){this.iconFontMap.set(t,r)}getIconFontKey(t){return this.iconFontMap.get(t)||t}getGlyph(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}setFontOptions(t){this.fontOptions=(0,lt.Z)((0,lt.Z)({},this.fontOptions),t),this.key=this.getKey();const r=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(i&&r.length===0)return;const a=this.generateFontAtlas(this.key,r,i);this.fontAtlas=a,this.cache.set(this.key,a)}addFontFace(t,r){const i=document.createElement("style");i.type="text/css",i.innerText=`
        @font-face{
            font-family: '${t}';
            src: url('${r}') format('woff2'),
            url('${r}') format('woff'),
            url('${r}') format('truetype');
        }`,i.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${t}`,"L7text"),document.fonts.ready.then(()=>{this.emit("fontloaded",{fontFamily:t})})}catch(a){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(a)}},document.getElementsByTagName("head")[0].appendChild(i)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(t,r,i){const{fontFamily:a,fontWeight:u,fontSize:h,buffer:m,sdf:g,radius:E,cutoff:A,iconfont:w}=this.fontOptions;let R=i&&i.data;R||(R=window.document.createElement("canvas"),R.width=xa);const U=R.getContext("2d",{willReadFrequently:!0});fm(U,a,h,u);const{mapping:q,canvasHeight:ce,xOffset:Se,yOffset:ke}=cd((0,lt.Z)({getFontWidth:rt=>U.measureText(rt).width,fontHeight:h*cm,buffer:m,characterSet:r,maxCanvasWidth:xa},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),Fe=U.getImageData(0,0,R.width,R.height);if(R.height=ce,U.putImageData(Fe,0,0),fm(U,a,h,u),g){const rt=new(ya())(h,m,E,A,a,u),mt=U.getImageData(0,0,rt.size,rt.size);for(const er of r){if(w){const cr=String.fromCharCode(parseInt(er.replace("&#x","").replace(";",""),16)),kt=rt.draw(cr);hd(kt,mt)}else hd(rt.draw(er),mt);U.putImageData(mt,q[er].x,q[er].y)}}else for(const rt of r)U.fillText(rt,q[rt].x,q[rt].y+h*ko);return{xOffset:Se,yOffset:ke,mapping:q,data:R,width:R.width,height:R.height}}getKey(){const{fontFamily:t,fontWeight:r}=this.fontOptions;return`${t}_${r}`}getNewChars(t,r){const i=this.cache.get(t);if(!i)return r;const a=[],u=i.mapping,h=new Set(Object.keys(u));return new Set(r).forEach(g=>{h.has(g)||a.push(g)}),a}}var Yt=N(15861);const mv=3,Ea=1024,qc=64;class Kc extends Rs.EventEmitter{constructor(...t){super(...t),(0,P.Z)(this,"canvasHeight",128),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"canvas",void 0),(0,P.Z)(this,"iconData",void 0),(0,P.Z)(this,"iconMap",void 0),(0,P.Z)(this,"ctx",void 0),(0,P.Z)(this,"loadingImageCount",0)}isLoading(){return this.loadingImageCount===0}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}addImage(t,r){var i=this;return(0,Yt.Z)(function*(){let a=new Image;i.loadingImageCount++,i.hasImage(t)?console.warn("Image Id already exists"):i.iconData.push({id:t,size:qc}),i.updateIconMap(),a=yield i.loadImage(r);const u=i.iconData.find(h=>h.id===t);u&&(u.image=a,u.width=a.width,u.height=a.height),i.update()})()}addImageMini(t,r,i){const a=i.getSceneConfig().canvas;let u=a.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:qc}),this.updateIconMap(),this.loadImageMini(r,a).then(h=>{u=h;const m=this.iconData.find(g=>g.id===t);m&&(m.image=u,m.width=u.width,m.height=u.height),this.update()})}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(t){return this.iconMap.hasOwnProperty(t)}removeImage(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(r=>r.id!==t),delete this.iconMap[t],this.update())}destroy(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}loadImage(t){return new Promise((r,i)=>{if(t instanceof HTMLImageElement){r(t);return}const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{r(a)},a.onerror=()=>{i(new Error("Could not load image at "+t))},a.src=t instanceof File?URL.createObjectURL(t):t})}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}updateIconAtlas(){this.canvas.width=Ea,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(t=>{const{x:r,y:i,image:a,width:u=64,height:h=64}=this.iconMap[t],g=Math.max(u,h)/qc,E=h/g,A=u/g;a&&this.ctx.drawImage(a,r+(qc-A)/2,i+(qc-E)/2,A,E)})}updateIconMap(){const{mapping:t,canvasHeight:r}=zl(this.iconData,mv,Ea);this.iconMap=t,this.canvasHeight=r}loadImageMini(t,r){return new Promise((i,a)=>{const u=r.createImage();u.crossOrigin="anonymous",u.onload=()=>{i(u)},u.onerror=()=>{a(new Error("Could not load image at "+t))},u.src=t})}}var no=N(85975);class pd{constructor(){(0,P.Z)(this,"viewport",void 0),(0,P.Z)(this,"overridedViewProjectionMatrix",void 0),(0,P.Z)(this,"viewMatrixInverse",void 0),(0,P.Z)(this,"cameraPosition",void 0)}init(){}update(t){this.viewport=t,this.viewMatrixInverse=no.create(),no.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){const[t,r]=this.viewport.getCenter();return[t,r]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(t,r){return this.viewport.projectFlat(t,r)}setViewProjectionMatrix(t){this.overridedViewProjectionMatrix=t}}const hm={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"};class Ph{constructor(){(0,P.Z)(this,"container",void 0),(0,P.Z)(this,"controlCorners",void 0),(0,P.Z)(this,"controlContainer",void 0),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"controls",[]),(0,P.Z)(this,"unAddControls",[])}init(t,r){this.container=t.container,this.scene=r,this.mapsService=r.mapService,this.initControlPos()}addControl(t,r){r.mapService.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}getControlByName(t){return this.controls.find(r=>r.controlOption.name===t)}removeControl(t){const r=this.controls.indexOf(t);return r>-1&&this.controls.splice(r,1),t.remove(),this}addControls(){this.unAddControls.forEach(t=>{t.addTo(this.scene),this.controls.push(t)}),this.unAddControls=[]}destroy(){for(const t of this.controls)t.remove();this.controls=[],this.clearControlPos()}initControlPos(){const t=this.controlCorners={},r="l7-",i=this.controlContainer=Mi("div",r+"control-container",this.container);function a(h=[]){const m=h.map(g=>r+g).join(" ");t[h.filter(g=>!["row","column"].includes(g)).join("")]=Mi("div",m,i)}function u(h){return[...h.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),hm[h]]}Object.values(Ye).forEach(h=>{a(u(h))}),this.checkCornerOverlap()}clearControlPos(){for(const t in this.controlCorners)this.controlCorners[t]&&oa(this.controlCorners[t]);this.controlContainer&&oa(this.controlContainer)}checkCornerOverlap(){const t=window.MutationObserver;if(t)for(const r of Object.keys(this.controlCorners)){const i=r.match(/^(top|bottom)(left|right)$/);if(i){const[,a,u]=i,h=this.controlCorners[`${a}${u}`];new t(([{target:g}])=>{h&&(h.style[a]=g.clientHeight+"px")}).observe(this.controlCorners[`${u}${a}`],{childList:!0,attributes:!0})}}}}class $c{constructor(){(0,P.Z)(this,"container",void 0),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"markers",[]),(0,P.Z)(this,"markerLayers",[]),(0,P.Z)(this,"unAddMarkers",[]),(0,P.Z)(this,"unAddMarkerLayers",[])}addMarkerLayer(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}removeMarkerLayer(t){t.destroy(),this.markerLayers.indexOf(t);const r=this.markerLayers.indexOf(t);r>-1&&this.markerLayers.splice(r,1)}addMarker(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}addMarkers(){this.unAddMarkers.forEach(t=>{t.addTo(this.scene),this.markers.push(t)}),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach(t=>{this.markerLayers.push(t),t.addTo(this.scene)}),this.unAddMarkers=[]}removeMarker(t){t.remove(),this.markers.indexOf(t);const r=this.markers.indexOf(t);r>-1&&this.markers.splice(r,1)}removeAllMarkers(){this.destroy()}init(t){this.scene=t,this.mapsService=t.mapService}destroy(){this.markers.forEach(t=>{t.remove()}),this.markers=[],this.markerLayers.forEach(t=>{t.destroy()}),this.markerLayers=[]}removeMakerLayerMarker(t){t.destroy()}}class vv{constructor(){(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"popups",[]),(0,P.Z)(this,"unAddPopups",[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(t){t!=null&&t.isOpen()&&t.remove();const r=this.popups.indexOf(t);r>-1&&this.popups.splice(r,1);const i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}destroy(){this.popups.forEach(t=>t.remove())}addPopup(t){t&&t.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach(r=>{r.getOptions().autoClose&&this.removePopup(r)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",()=>{this.removePopup(t)})}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach(t=>{this.addPopup(t),this.unAddPopups=[]})}init(t){this.scene=t,this.mapsService=t.mapService}}var X0={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"};const{merge:qa}=Yn,bf={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},_v={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:vr.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0};class n{constructor(){(0,P.Z)(this,"sceneConfigCache",{}),(0,P.Z)(this,"layerConfigCache",{}),(0,P.Z)(this,"layerAttributeConfigCache",{})}getSceneConfig(t){return this.sceneConfigCache[t]}getSceneWarninfo(t){return X0[t]}setSceneConfig(t,r){this.sceneConfigCache[t]=(0,lt.Z)((0,lt.Z)({},bf),r)}getLayerConfig(t){return this.layerConfigCache[t]}setLayerConfig(t,r,i){this.layerConfigCache[r]=(0,lt.Z)({},qa({},this.sceneConfigCache[t],_v,i))}getAttributeConfig(t){return this.layerAttributeConfigCache[t]}setAttributeConfig(t,r){this.layerAttributeConfigCache[t]=(0,lt.Z)((0,lt.Z)({},this.layerAttributeConfigCache[t]),r)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}}var o=N(98333);const s=Math.PI/180,p=512,_=4003e4;function y({latitude:e=0,zoom:t=0,scale:r,highPrecision:i=!1,flipY:a=!1}){r=r!==void 0?r:Math.pow(2,t);const u={},h=p*r,m=Math.cos(e*s),g=h/360,E=g/m,A=h/_/m;if(u.pixelsPerMeter=[A,-A,A],u.metersPerPixel=[1/A,-1/A,1/A],u.pixelsPerDegree=[g,-E,A],u.degreesPerPixel=[1/g,-1/E,1/A],i){const w=s*Math.tan(e*s)/m,R=g*w/2,U=h/_*w,q=U/E*A;u.pixelsPerDegree2=[0,-R,U],u.pixelsPerMeter2=[q,0,q],a&&(u.pixelsPerDegree2[1]=-u.pixelsPerDegree2[1],u.pixelsPerMeter2[1]=-u.pixelsPerMeter2[1])}return a&&(u.pixelsPerMeter[1]=-u.pixelsPerMeter[1],u.metersPerPixel[1]=-u.metersPerPixel[1],u.pixelsPerDegree[1]=-u.pixelsPerDegree[1],u.degreesPerPixel[1]=-u.degreesPerPixel[1]),u}const b=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];class C{constructor(t){(0,P.Z)(this,"needRefresh",!0),(0,P.Z)(this,"coordinateSystem",void 0),(0,P.Z)(this,"viewportCenter",void 0),(0,P.Z)(this,"viewportCenterProjection",void 0),(0,P.Z)(this,"pixelsPerDegree",void 0),(0,P.Z)(this,"pixelsPerDegree2",void 0),(0,P.Z)(this,"pixelsPerMeter",void 0),this.cameraService=t}refresh(t){const r=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),{pixelsPerMeter:u,pixelsPerDegree:h}=y({latitude:a[1],zoom:r});this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=u,this.pixelsPerDegree=h,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===me.LNGLAT||this.coordinateSystem===me.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===me.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===me.P20_OFFSET&&this.calculateLnglatOffset(a,r,i,!0),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(t){this.coordinateSystem=t}getViewportCenter(){return this.viewportCenter}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(t,r,i,a){const{pixelsPerMeter:u,pixelsPerDegree:h,pixelsPerDegree2:m}=y({latitude:t[1],zoom:r,scale:i,flipY:a,highPrecision:!0});let g=this.cameraService.getViewMatrix();const E=this.cameraService.getProjectionMatrix();let A=no.multiply([],E,g);const w=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,r));this.viewportCenterProjection=o.fF([],[w[0],w[1],0,1],A),g=this.cameraService.getViewMatrixUncentered()||g,A=no.multiply([],E,g),A=no.multiply([],A,b),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=u,this.pixelsPerDegree=h,this.pixelsPerDegree2=m}}class I extends Rs.EventEmitter{constructor(...t){super(...t),(0,P.Z)(this,"renderMap",new Map),(0,P.Z)(this,"enable",!1),(0,P.Z)(this,"renderEnable",!1),(0,P.Z)(this,"cacheLogs",{})}setEnable(t){this.enable=!!t}log(t,r){if(!this.enable)return;const i=t.split(".");let a=null;i.forEach((u,h)=>{a!==null?(a[u]||(a[u]={}),h!==i.length-1&&(a=a[u])):(this.cacheLogs[u]||(this.cacheLogs[u]={}),h!==i.length-1&&(a=this.cacheLogs[u])),h===i.length-1&&(a[u]=(0,lt.Z)((0,lt.Z)({time:Date.now()},a[u]),r))})}getLog(t){switch(typeof t){case"string":return this.cacheLogs[t];case"object":return t.map(r=>this.cacheLogs[r]).filter(r=>r!==void 0);case"undefined":return this.cacheLogs}}removeLog(t){delete this.cacheLogs[t]}generateRenderUid(){return this.renderEnable?Hf():""}renderDebug(t){this.renderEnable=t}renderStart(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t)||{};this.renderMap.set(t,(0,lt.Z)((0,lt.Z)({},r),{},{renderUid:t,renderStart:Date.now()}))}renderEnd(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t);if(r){const i=r.renderStart,a=Date.now();this.emit("renderEnd",(0,lt.Z)((0,lt.Z)({},r),{},{renderEnd:a,renderDuration:a-i})),this.renderMap.delete(t)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}var D=N(50840),z=N.n(D);const H={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"};class J extends bp(){get mapService(){return this.container.mapService}constructor(t){super(),(0,P.Z)(this,"indragging",!1),(0,P.Z)(this,"hammertime",void 0),(0,P.Z)(this,"lastClickTime",0),(0,P.Z)(this,"lastClickXY",[-1,-1]),(0,P.Z)(this,"clickTimer",void 0),(0,P.Z)(this,"$containter",void 0),(0,P.Z)(this,"onDrag",r=>{const i=this.interactionEvent(r);i.type=H[i.type],i.type==="dragging"?this.indragging=!0:this.indragging=!1,this.emit(Nt.Drag,i)}),(0,P.Z)(this,"onHammer",r=>{r.srcEvent.stopPropagation();const i=this.interactionEvent(r);this.emit(Nt.Hover,i)}),(0,P.Z)(this,"onTouch",r=>{const i=r.touches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchstart"})}),(0,P.Z)(this,"onTouchEnd",r=>{if(r.changedTouches.length>0){const i=r.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchend"})}}),(0,P.Z)(this,"onTouchMove",r=>{const i=r.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchmove"})}),(0,P.Z)(this,"onHover",r=>{const{clientX:i,clientY:a}=r;let u=i,h=a;const m=r.type,g=this.mapService.getMapContainer();if(g){const{top:A,left:w}=g.getBoundingClientRect();u=u-w-g.clientLeft,h=h-A-g.clientTop}const E=this.mapService.containerToLngLat([u,h]);if(m==="click"){this.isDoubleTap(u,h,E);return}if(m==="touch"){this.isDoubleTap(u,h,E);return}m!=="click"&&m!=="dblclick"&&this.emit(Nt.Hover,{x:u,y:h,lngLat:E,type:m,target:r})}),this.container=t}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Nt.Hover)}triggerHover({x:t,y:r}){this.emit(Nt.Hover,{x:t,y:r})}triggerSelect(t){this.emit(Nt.Select,{featureId:t})}triggerActive(t){this.emit(Nt.Active,{featureId:t})}addEventListenerOnMap(){const t=this.mapService.getMapContainer();if(t){const r=new(z()).Manager(t);r.add(new(z()).Tap({event:"dblclick",taps:2})),r.add(new(z()).Tap({event:"click"})),r.add(new(z()).Pan({threshold:0,pointers:0})),r.add(new(z()).Press({})),r.on("dblclick click",this.onHammer),r.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=r}}removeEventListenerOnMap(){const t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}interactionEvent(t){const{type:r,pointerType:i}=t;let a,u;i==="touch"?(u=Math.floor(t.pointers[0].clientY),a=Math.floor(t.pointers[0].clientX)):(u=Math.floor(t.srcEvent.y),a=Math.floor(t.srcEvent.x));const h=this.mapService.getMapContainer();if(h){const{top:g,left:E}=h.getBoundingClientRect();a-=E,u-=g}const m=this.mapService.containerToLngLat([a,u]);return{x:a,y:u,lngLat:m,type:r,target:t.srcEvent}}isDoubleTap(t,r,i){const a=new Date().getTime();let u="click";a-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-r)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),u="dblclick",this.emit(Nt.Hover,{x:t,y:r,lngLat:i,type:u})):(this.lastClickTime=a,this.lastClickXY=[t,r],this.clickTimer=setTimeout(()=>{u="click",this.emit(Nt.Hover,{x:t,y:r,lngLat:i,type:u})},400))}}let re=0;function Te(e){let t=e;if(typeof e=="string"&&(t=document.getElementById(e)),t){const r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id=`l7-scene-${re++}`,r.classList.add("l7-scene"),t.appendChild(r),r}return null}function Re(e){var t;let r=!0;if((e==null||(t=e.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement){var i;let u=e==null||(i=e.target)===null||i===void 0?void 0:i.target;for(;u;){var a;const h=Array.from(u.classList);if(h.includes("l7-marker")||h.includes("l7-popup")){r=!1;break}u=(a=u)===null||a===void 0?void 0:a.parentElement}}return r}let qe=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({});class je{constructor(t){var r=this;(0,P.Z)(this,"pickedColors",void 0),(0,P.Z)(this,"pickedTileLayers",[]),(0,P.Z)(this,"pickingFBO",void 0),(0,P.Z)(this,"width",0),(0,P.Z)(this,"height",0),(0,P.Z)(this,"alreadyInPicking",!1),(0,P.Z)(this,"pickBufferScale",1),(0,P.Z)(this,"pickFromPickingFBO",function(){var i=(0,Yt.Z)(function*(a,{x:u,y:h,lngLat:m,type:g,target:E}){let A=!1;const{readPixelsAsync:w,getViewportSize:R}=r.rendererService,{width:U,height:q}=R(),{enableHighlight:ce,enableSelect:Se}=a.getLayerConfig(),ke=u*Jo,Fe=h*Jo;if(ke>U-1*Jo||ke<0||Fe>q-1*Jo||Fe<0)return!1;const rt=yield w({x:Math.floor(ke/r.pickBufferScale),y:Math.floor((q-(h+1)*Jo)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=rt,rt[0]!==0||rt[1]!==0||rt[2]!==0){const mt=ys(rt),er=a.layerPickService.getFeatureById(mt);mt!==a.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");const cr={x:u,y:h,type:g,lngLat:m,featureId:mt,feature:er,target:E};er&&(A=!0,a.setCurrentPickId(mt),r.triggerHoverOnLayer(a,cr))}else{const mt={x:u,y:h,lngLat:m,type:a.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:E,feature:null};r.triggerHoverOnLayer(a,(0,lt.Z)((0,lt.Z)({},mt),{},{type:"unpick"})),r.triggerHoverOnLayer(a,mt),a.setCurrentPickId(null)}if(ce&&a.layerPickService.highlightPickedFeature(rt),Se&&g==="click"&&(rt==null?void 0:rt.toString())!==[0,0,0,0].toString()){const mt=ys(rt);a.getCurrentSelectedId()===null||mt!==a.getCurrentSelectedId()?(a.layerPickService.selectFeature(rt),a.setCurrentSelectedId(mt)):(a.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),a.setCurrentSelectedId(null))}return A});return function(a,u){return i.apply(this,arguments)}}()),this.container=t}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(t){const{createTexture2D:r,createFramebuffer:i,getViewportSize:a}=this.rendererService;let{width:u,height:h}=a();this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,u=Math.round(u/this.pickBufferScale),h=Math.round(h/this.pickBufferScale);const m=r({width:u,height:h,usage:qe.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=i({color:m,depth:!0,width:u,height:h}),this.interactionService.on(Nt.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(t,r,i){var a=this;return(0,Yt.Z)(function*(){const{useFramebufferAsync:u,clear:h}=a.rendererService;a.resizePickingFBO(),t.hooks.beforePickingEncode.call(),yield u(a.pickingFBO,(0,Yt.Z)(function*(){h({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0})})),t.hooks.afterPickingEncode.call();const m=yield a.pickBox(t,r);i(m)})()}pickBox(t,r){var i=this;return(0,Yt.Z)(function*(){const[a,u,h,m]=r.map(ke=>{const Fe=ke<0?0:ke;return Math.floor(Fe*Jo/i.pickBufferScale)}),{readPixelsAsync:g,getViewportSize:E}=i.rendererService,{width:A,height:w}=E();if(a>(A-1)*Jo/i.pickBufferScale||h<0||u>(w-1)*Jo/i.pickBufferScale||m<0)return[];const R=Math.min(A/i.pickBufferScale,h)-a,U=Math.min(w/i.pickBufferScale,m)-u,q=yield g({x:a,y:Math.floor(w/i.pickBufferScale-(m+1)),width:R,height:U,data:new Uint8Array(R*U*4),framebuffer:i.pickingFBO}),ce=[],Se={};for(let ke=0;ke<q.length/4;ke=ke+1){const Fe=q.slice(ke*4,ke*4+4),rt=ys(Fe);if(rt!==-1&&!Se[rt]){const mt=t.layerPickService.getFeatureById(rt);ce.push((0,lt.Z)((0,lt.Z)({},mt),{},{pickedFeatureIdx:rt})),Se[rt]=!0}}return ce})()}handleCursor(t,r){const{cursor:i="",cursorEnabled:a}=t.getLayerConfig();if(a){const h=this.mapService.version==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),m=h==null?void 0:h.style.getPropertyValue("cursor");r==="unmousemove"&&m!==""?h==null||h.style.setProperty("cursor",""):r==="mousemove"&&(h==null||h.style.setProperty("cursor",i))}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(t){var r=this;return(0,Yt.Z)(function*(){!r.layerService.needPick(t.type)||!r.isPickingAllLayer()||(r.alreadyInPicking=!0,yield r.pickingLayers(t),r.layerService.renderLayers(),r.alreadyInPicking=!1)})()}isPickingAllLayer(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}resizePickingFBO(){const{getViewportSize:t}=this.rendererService,{width:r,height:i}=t();(this.width!==r||this.height!==i)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(i/this.pickBufferScale)}),this.width=r,this.height=i)}pickingLayers(t){var r=this;return(0,Yt.Z)(function*(){const{clear:i,useFramebufferAsync:a}=r.rendererService;r.resizePickingFBO();const u=r.layerService.getRenderList();for(const h of u.filter(m=>m.needPick(t.type)).reverse()){yield a(r.pickingFBO,(0,Yt.Z)(function*(){i({framebuffer:r.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),h.layerPickService.pickRender(t)}));const m=yield r.pickFromPickingFBO(h,t);if(r.layerService.pickedLayerId=m?+h.id:-1,m&&!h.getLayerConfig().enablePropagation)break}})()}triggerHoverOnLayer(t,r){Re(r)&&(this.handleCursor(t,r.type),t.emit(r.type,r))}}class ft{constructor(t=!0){(0,P.Z)(this,"autoStart",void 0),(0,P.Z)(this,"startTime",0),(0,P.Z)(this,"oldTime",0),(0,P.Z)(this,"running",!1),(0,P.Z)(this,"elapsedTime",0),this.autoStart=t}start(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const r=(typeof performance=="undefined"?Date:performance).now();t=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=t}return t}}const{throttle:gt}=Yn;class zt extends Rs.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(t){super(),(0,P.Z)(this,"pickedLayerId",-1),(0,P.Z)(this,"clock",new ft),(0,P.Z)(this,"alreadyInRendering",!1),(0,P.Z)(this,"layers",[]),(0,P.Z)(this,"layerList",[]),(0,P.Z)(this,"layerRenderID",void 0),(0,P.Z)(this,"sceneInited",!1),(0,P.Z)(this,"animateInstanceCount",0),(0,P.Z)(this,"shaderPicking",!0),(0,P.Z)(this,"enableRender",!0),(0,P.Z)(this,"reRender",gt(()=>{this.renderLayers()},32)),(0,P.Z)(this,"throttleRenderLayers",gt(()=>{this.renderLayers()},16)),this.container=t}needPick(t){return this.updateLayerRenderList(),this.layerList.some(r=>r.needPick(t))}add(t){this.layers.push(t),this.sceneInited&&t.init().then(()=>{this.renderLayers()})}addMask(t){this.sceneInited&&t.init().then(()=>{this.renderLayers()})}initLayers(){var t=this;return(0,Yt.Z)(function*(){t.sceneInited=!0,t.layers.forEach(function(){var r=(0,Yt.Z)(function*(i){i.startInit||(yield i.init(),t.updateLayerRenderList())});return function(i){return r.apply(this,arguments)}}())})()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(t){return this.layers.find(r=>r.id===t)}getLayerByName(t){return this.layers.find(r=>r.name===t)}remove(t,r){var i=this;return(0,Yt.Z)(function*(){r?r.layerChildren=r.layerChildren.filter(a=>a!==t):i.layers=i.layers.filter(a=>a!==t),t.destroy(),i.reRender(),i.emit("layerChange",i.layers)})()}removeAllLayers(){var t=this;return(0,Yt.Z)(function*(){t.destroy(),t.reRender()})()}setEnableRender(t){this.enableRender=t}renderLayers(){var t=this;return(0,Yt.Z)(function*(){if(t.alreadyInRendering||!t.enableRender)return;t.updateLayerRenderList();const r=t.debugService.generateRenderUid();t.debugService.renderStart(r),t.alreadyInRendering=!0,t.clear();for(const i of t.layerList)i.prerender();t.renderService.beginFrame();for(const i of t.layerList){const{enableMask:a}=i.getLayerConfig();i.masks.filter(u=>u.inited).length>0&&a&&t.renderMask(i.masks),i.getLayerConfig().enableMultiPassRenderer?yield i.renderMultiPass():i.render()}t.renderService.endFrame(),t.debugService.renderEnd(r),t.alreadyInRendering=!1})()}renderMask(t){let r=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});const i=t.length>1?Jt.MULTIPLE:Jt.SINGLE;for(const a of t)a.render({isStencil:!0,stencilType:i,stencilIndex:r++})}beforeRenderData(t){var r=this;return(0,Yt.Z)(function*(){(yield t.hooks.beforeRenderData.promise())&&r.renderLayers()})()}renderTileLayerMask(t){let r=0;const{enableMask:i=!0}=t.getLayerConfig();let a=t.tileMask?1:0;const u=t.masks.filter(m=>m.inited);a=a+(i?u.length:1);const h=a>1?Jt.MULTIPLE:Jt.SINGLE;if((t.tileMask||u.length&&i)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.length&&i)for(const m of u)m.render({isStencil:!0,stencilType:h,stencilIndex:r++});t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:h,stencilIndex:r++,stencilOperation:vr.OR})}renderTileLayer(t){var r=this;return(0,Yt.Z)(function*(){r.renderTileLayerMask(t),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():yield t.render()})()}updateLayerRenderList(){this.layerList=[],this.layers.filter(t=>t.inited).filter(t=>t.isVisible()).sort((t,r)=>t.zIndex-r.zIndex).forEach(t=>{this.layerList.push(t)})}destroy(){this.layers.forEach(t=>{t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}startAnimate(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}stopAnimate(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){const t=ai(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}var Ot=N(91);const{isNil:rr}=Yn;class Rr{constructor(t){(0,P.Z)(this,"name",void 0),(0,P.Z)(this,"type",void 0),(0,P.Z)(this,"scale",void 0),(0,P.Z)(this,"descriptor",void 0),(0,P.Z)(this,"featureBufferLayout",[]),(0,P.Z)(this,"needRescale",!1),(0,P.Z)(this,"needRemapping",!1),(0,P.Z)(this,"needRegenerateVertices",!1),(0,P.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,P.Z)(this,"vertexAttribute",void 0),(0,P.Z)(this,"defaultCallback",r=>{if(r.length===0){var i;return((i=this.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return r.map((a,u)=>{var h;return((h=this.scale)===null||h===void 0?void 0:h.scalers[u].func)(a)})}),this.setProps(t)}setProps(t){Object.assign(this,t)}mapping(t){var r;if((r=this.scale)!==null&&r!==void 0&&r.callback){var i;const a=(i=this.scale)===null||i===void 0?void 0:i.callback(...t);if(!rr(a))return[a]}return this.defaultCallback(t)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}const Zr=["buffer","update","name"],xn=["buffer","update","name"],nn={[F.FLOAT]:4,[F.UNSIGNED_BYTE]:1,[F.UNSIGNED_SHORT]:2};class In{constructor(t){(0,P.Z)(this,"attributesAndIndices",void 0),(0,P.Z)(this,"attributes",[]),(0,P.Z)(this,"triangulation",void 0),(0,P.Z)(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}registerStyleAttribute(t){let r=this.getLayerStyleAttribute(t.name||"");return r?r.setProps(t):(r=new Rr(t),this.attributes.push(r)),r}unRegisterStyleAttribute(t){const r=this.attributes.findIndex(i=>i.name===t);r>-1&&this.attributes.splice(r,1)}updateScaleAttribute(t){this.attributes.forEach(r=>{var i;const a=r.name,u=(i=r.scale)===null||i===void 0?void 0:i.field;(t[a]||u&&t[u])&&(r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0)})}updateStyleAttribute(t,r,i){let a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute((0,lt.Z)((0,lt.Z)({},r),{},{name:t})));const{scale:u}=r;u&&a&&(a.scale=u,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(t){return this.attributes.find(r=>r.name===t)}getLayerAttributeScale(t){var r;const i=this.getLayerStyleAttribute(t),a=i==null||(r=i.scale)===null||r===void 0?void 0:r.scalers;return a&&a[0]?a[0].func:null}updateAttributeByFeatureRange(t,r,i=0,a,u){const h=this.attributes.find(m=>m.name===t);if(h&&h.descriptor){const{descriptor:m}=h,{update:g,buffer:E,size:A=0}=m,w=nn[E.type||F.FLOAT];if(g){const{elements:R,sizePerElement:U}=this.featureLayout,q=R.slice(i,a);if(!q.length)return;const{offset:ce}=q[0],Se=ce*A*w,ke=q.map(({featureIdx:Fe,vertices:rt,normals:mt},er)=>{const cr=rt.length/U,kt=[];for(let dr=0;dr<cr;dr++){const Pn=mt?mt.slice(dr*3,dr*3+3):[];kt.push(...g(r[Fe],Fe,rt.slice(dr*U,dr*U+U),er,Pn))}return kt}).flat();h.vertexAttribute.updateBuffer({data:ke,offset:Se}),u==null||u.emit(`legend:${t}`,u.getLegend(t))}}}createAttributesAndIndices(t,r,i,a){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const u=this.attributes.map(ce=>(ce.resetDescriptor(),ce.descriptor));let h=0,m=0;const g=[];let E=3;t.forEach((ce,Se)=>{const{indices:ke,vertices:Fe,normals:rt,size:mt,indexes:er,count:cr}=this.triangulation(ce,i);typeof cr=="number"&&(m+=cr),ke.forEach(dr=>{g.push(dr+h)}),E=mt;const kt=Fe.length/mt;this.featureLayout.sizePerElement=E,this.featureLayout.elements.push({featureIdx:Se,vertices:Fe,normals:rt,offset:h}),h+=kt;for(let dr=0;dr<kt;dr++){const Pn=(rt==null?void 0:rt.slice(dr*3,dr*3+3))||[],_i=Fe.slice(dr*mt,dr*mt+mt);let En=0;er&&er[dr]!==void 0&&(En=er[dr]),u.forEach((fi,Gi)=>{fi&&fi.update&&fi.buffer.data.push(...fi.update(ce,Se,_i,dr,Pn,En))})}});const{createAttribute:A,createBuffer:w,createElements:R}=this.rendererService,U={};u.forEach((ce,Se)=>{if(ce){const{buffer:ke,update:Fe,name:rt}=ce,mt=(0,Ot.Z)(ce,Zr),er=A((0,lt.Z)({buffer:w(ke)},mt));U[ce.name||""]=er,this.attributes[Se].vertexAttribute=er}});const q=R({data:g,type:F.UNSIGNED_INT,count:g.length});return this.attributesAndIndices={attributes:U,elements:q,count:m},Object.values(this.attributes).filter(ce=>ce.scale).forEach(ce=>{const Se=ce.name;a==null||a.emit(`legend:${Se}`,a.getLegend(Se))}),this.attributesAndIndices}createAttributes(t,r){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const i=this.attributes.map(A=>(A.resetDescriptor(),A.descriptor));let a=0;const u=[];let h=3;t.forEach((A,w)=>{const{indices:R,vertices:U,normals:q,size:ce,indexes:Se}=this.triangulation(A);R.forEach(Fe=>{u.push(Fe+a)}),h=ce;const ke=U.length/ce;this.featureLayout.sizePerElement=h,this.featureLayout.elements.push({featureIdx:w,vertices:U,normals:q,offset:a}),a+=ke;for(let Fe=0;Fe<ke;Fe++){const rt=(q==null?void 0:q.slice(Fe*3,Fe*3+3))||[],mt=U.slice(Fe*ce,Fe*ce+ce);let er=0;Se&&Se[Fe]!==void 0&&(er=Se[Fe]),i.forEach((cr,kt)=>{cr&&cr.update&&cr.buffer.data.push(...cr.update(A,w,mt,Fe,rt,er))})}});const{createAttribute:m,createBuffer:g}=this.rendererService,E={};return i.forEach((A,w)=>{if(A){const{buffer:R,update:U,name:q}=A,ce=(0,Ot.Z)(A,xn),Se=m((0,lt.Z)({buffer:g(R)},ce));E[A.name||""]=Se,this.attributes[w].vertexAttribute=Se}}),{attributes:E}}clearAllAttributes(){var t;this.attributes.forEach(r=>{r.vertexAttribute&&r.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}var rn=N(34155);function ci(e,t,r,i){function a(u){return u instanceof r?u:new r(function(h){h(u)})}return new(r||(r=Promise))(function(u,h){function m(A){try{E(i.next(A))}catch(w){h(w)}}function g(A){try{E(i.throw(A))}catch(w){h(w)}}function E(A){A.done?u(A.value):a(A.value).then(m,g)}E((i=i.apply(e,t||[])).next())})}function Vn(e,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,a,u,h;return h={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function m(E){return function(A){return g([E,A])}}function g(E){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(u=E[0]&2?a.return:E[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,E[1])).done)return u;switch(a=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,a=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){r.label=E[1];break}if(E[0]===6&&r.label<u[1]){r.label=u[1],u=E;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(E);break}u[2]&&r.ops.pop(),r.trys.pop();continue}E=t.call(e,r)}catch(A){E=[6,A],a=0}finally{i=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function hn(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),a,u=[],h;try{for(;(t===void 0||t-- >0)&&!(a=i.next()).done;)u.push(a.value)}catch(m){h={error:m}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(h)throw h.error}}return u}function pi(e,t,r){if(r||arguments.length===2)for(var i=0,a=t.length,u;i<a;i++)(u||!(i in t))&&(u||(u=Array.prototype.slice.call(t,0,i)),u[i]=t[i]);return e.concat(u||Array.prototype.slice.call(t))}function ni(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ri={exports:{}},Tn={exports:{}},Ii={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1===0}e.exports=t.default})(Ii,Ii.exports);var Fi={},Wo={exports:{}},Uo={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];var u=i.pop();return r.call(this,i,u)}},e.exports=t.default})(Uo,Uo.exports);var eo={};Object.defineProperty(eo,"__esModule",{value:!0}),eo.fallback=ps,eo.wrap=Za;var ta=eo.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,za=eo.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Va=eo.hasNextTick=typeof rn=="object"&&typeof rn.nextTick=="function";function ps(e){setTimeout(e,0)}function Za(e){return function(t){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];return e(function(){return t.apply(void 0,r)})}}var ja;ta?ja=queueMicrotask:za?ja=setImmediate:Va?ja=rn.nextTick:ja=ps,eo.default=Za(ja),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=g;var r=Uo.exports,i=m(r),a=eo,u=m(a),h=Fi;function m(w){return w&&w.__esModule?w:{default:w}}function g(w){return(0,h.isAsync)(w)?function(){for(var R=[],U=arguments.length;U--;)R[U]=arguments[U];var q=R.pop(),ce=w.apply(this,R);return E(ce,q)}:(0,i.default)(function(R,U){var q;try{q=w.apply(this,R)}catch(ce){return U(ce)}if(q&&typeof q.then=="function")return E(q,U);U(null,q)})}function E(w,R){return w.then(function(U){A(R,null,U)},function(U){A(R,U&&U.message?U:new Error(U))})}function A(w,R,U){try{w(R,U)}catch(q){(0,u.default)(function(ce){throw ce},q)}}e.exports=t.default}(Wo,Wo.exports),Object.defineProperty(Fi,"__esModule",{value:!0}),Fi.isAsyncIterable=Fi.isAsyncGenerator=Fi.isAsync=void 0;var fa=Wo.exports,Ka=Si(fa);function Si(e){return e&&e.__esModule?e:{default:e}}function uo(e){return e[Symbol.toStringTag]==="AsyncFunction"}function io(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function Ui(e){return typeof e[Symbol.asyncIterator]=="function"}function Hs(e){if(typeof e!="function")throw new Error("expected a function");return uo(e)?(0,Ka.default)(e):e}Fi.default=Hs,Fi.isAsync=uo,Fi.isAsyncGenerator=io,Fi.isAsyncIterable=Ui;var ha={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i,a){if(a===void 0&&(a=i.length),!a)throw new Error("arity is undefined");function u(){for(var h=this,m=[],g=arguments.length;g--;)m[g]=arguments[g];return typeof m[a-1]=="function"?i.apply(this,m):new Promise(function(E,A){m[a-1]=function(w){for(var R=[],U=arguments.length-1;U-- >0;)R[U]=arguments[U+1];if(w)return A(w);E(R.length>1?R:R[0])},i.apply(h,m)})}return u}e.exports=t.default})(ha,ha.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Ii.exports,i=g(r),a=Fi,u=g(a),h=ha.exports,m=g(h);function g(E){return E&&E.__esModule?E:{default:E}}t.default=(0,m.default)(function(E,A,w){var R=(0,i.default)(A)?[]:{};E(A,function(U,q,ce){(0,u.default)(U)(function(Se){for(var ke,Fe=[],rt=arguments.length-1;rt-- >0;)Fe[rt]=arguments[rt+1];Fe.length<2&&(ke=Fe,Fe=ke[0]),R[q]=Fe,ce(Se)})},function(U){return w(U,R)})},3),e.exports=t.default}(Tn,Tn.exports);var yo={exports:{}},$o={exports:{}},$a={exports:{}},Pi={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i){function a(){for(var u=[],h=arguments.length;h--;)u[h]=arguments[h];if(i!==null){var m=i;i=null,m.apply(this,u)}}return Object.assign(a,i),a}e.exports=t.default})(Pi,Pi.exports);var gl={exports:{}},nu={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=t.default})(nu,nu.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=A;var r=Ii.exports,i=h(r),a=nu.exports,u=h(a);function h(w){return w&&w.__esModule?w:{default:w}}function m(w){var R=-1,U=w.length;return function(){return++R<U?{value:w[R],key:R}:null}}function g(w){var R=-1;return function(){var q=w.next();return q.done?null:(R++,{value:q.value,key:R})}}function E(w){var R=w?Object.keys(w):[],U=-1,q=R.length;return function ce(){var Se=R[++U];return Se==="__proto__"?ce():U<q?{value:w[Se],key:Se}:null}}function A(w){if((0,i.default)(w))return m(w);var R=(0,u.default)(w);return R?g(R):E(w)}e.exports=t.default}(gl,gl.exports);var Pu={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i){return function(){for(var a=[],u=arguments.length;u--;)a[u]=arguments[u];if(i===null)throw new Error("Callback was already called.");var h=i;i=null,h.apply(this,a)}}e.exports=t.default})(Pu,Pu.exports);var Qo={exports:{}},Ou={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=r,e.exports=t.default})(Ou,Ou.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=Ou.exports,i=a(r);function a(h){return h&&h.__esModule?h:{default:h}}function u(h,m,g,E){var A=!1,w=!1,R=!1,U=0,q=0;function ce(){U>=m||R||A||(R=!0,h.next().then(function(Fe){var rt=Fe.value,mt=Fe.done;if(!(w||A)){if(R=!1,mt){A=!0,U<=0&&E(null);return}U++,g(rt,q,Se),q++,ce()}}).catch(ke))}function Se(Fe,rt){if(U-=1,!w){if(Fe)return ke(Fe);if(Fe===!1){A=!0,w=!0;return}if(rt===i.default||A&&U<=0)return A=!0,E(null);ce()}}function ke(Fe){w||(R=!1,A=!0,E(Fe))}ce()}e.exports=t.default}(Qo,Qo.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Pi.exports,i=U(r),a=gl.exports,u=U(a),h=Pu.exports,m=U(h),g=Fi,E=Qo.exports,A=U(E),w=Ou.exports,R=U(w);function U(q){return q&&q.__esModule?q:{default:q}}t.default=function(q){return function(ce,Se,ke){if(ke=(0,i.default)(ke),q<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!ce)return ke(null);if((0,g.isAsyncGenerator)(ce))return(0,A.default)(ce,q,Se,ke);if((0,g.isAsyncIterable)(ce))return(0,A.default)(ce[Symbol.asyncIterator](),q,Se,ke);var Fe=(0,u.default)(ce),rt=!1,mt=!1,er=0,cr=!1;function kt(Pn,_i){if(!mt)if(er-=1,Pn)rt=!0,ke(Pn);else if(Pn===!1)rt=!0,mt=!0;else{if(_i===R.default||rt&&er<=0)return rt=!0,ke(null);cr||dr()}}function dr(){for(cr=!0;er<q&&!rt;){var Pn=Fe();if(Pn===null){rt=!0,er<=0&&ke(null);return}er+=1,Se(Pn.value,Pn.key,(0,m.default)(kt))}cr=!1}dr()}},e.exports=t.default}($a,$a.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=$a.exports,i=g(r),a=Fi,u=g(a),h=ha.exports,m=g(h);function g(A){return A&&A.__esModule?A:{default:A}}function E(A,w,R,U){return(0,i.default)(w)(A,(0,u.default)(R),U)}t.default=(0,m.default)(E,4),e.exports=t.default}($o,$o.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=$o.exports,i=h(r),a=ha.exports,u=h(a);function h(g){return g&&g.__esModule?g:{default:g}}function m(g,E,A){return(0,i.default)(g,1,E,A)}t.default=(0,u.default)(m,3),e.exports=t.default}(yo,yo.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=m;var r=Tn.exports,i=h(r),a=yo.exports,u=h(a);function h(g){return g&&g.__esModule?g:{default:g}}function m(g,E){return(0,i.default)(u.default,g,E)}e.exports=t.default}(Ri,Ri.exports);var hu=ni(Ri.exports),pu=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var t=arguments,r=[],i=0;i<arguments.length;i++)r[i]=t[i];return this.args=r,hu(this.tasks)},e.prototype.tap=function(t,r){var i=this;this.tasks.push(function(a){r.apply(void 0,pi([],hn(i.args),!1)),a(null,t)})},e}(),Qc={exports:{}},Sf={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Ii.exports,i=Se(r),a=Ou.exports,u=Se(a),h=$o.exports,m=Se(h),g=Pi.exports,E=Se(g),A=Pu.exports,w=Se(A),R=Fi,U=Se(R),q=ha.exports,ce=Se(q);function Se(mt){return mt&&mt.__esModule?mt:{default:mt}}function ke(mt,er,cr){cr=(0,E.default)(cr);var kt=0,dr=0,Pn=mt.length,_i=!1;Pn===0&&cr(null);function En(fi,Gi){fi===!1&&(_i=!0),_i!==!0&&(fi?cr(fi):(++dr===Pn||Gi===u.default)&&cr(null))}for(;kt<Pn;kt++)er(mt[kt],kt,(0,w.default)(En))}function Fe(mt,er,cr){return(0,m.default)(mt,1/0,er,cr)}function rt(mt,er,cr){var kt=(0,i.default)(mt)?ke:Fe;return kt(mt,(0,U.default)(er),cr)}t.default=(0,ce.default)(rt,3),e.exports=t.default})(Sf,Sf.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=m;var r=Sf.exports,i=h(r),a=Tn.exports,u=h(a);function h(g){return g&&g.__esModule?g:{default:g}}function m(g,E){return(0,u.default)(i.default,g,E)}e.exports=t.default}(Qc,Qc.exports);var Jc=ni(Qc.exports),Sp=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return Jc(this.tasks)},e.prototype.tapPromise=function(t,r){var i=this;this.tasks.push(function(a){return ci(i,void 0,void 0,function(){return Vn(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),a(null,t),[2]}})})})},e}(),Oh={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Pi.exports,i=A(r),a=Pu.exports,u=A(a),h=Fi,m=A(h),g=ha.exports,E=A(g);function A(R){return R&&R.__esModule?R:{default:R}}function w(R,U){if(U=(0,i.default)(U),!Array.isArray(R))return U(new Error("First argument to waterfall must be an array of functions"));if(!R.length)return U();var q=0;function ce(ke){var Fe=(0,m.default)(R[q++]);Fe.apply(void 0,ke.concat([(0,u.default)(Se)]))}function Se(ke){for(var Fe=[],rt=arguments.length-1;rt-- >0;)Fe[rt]=arguments[rt+1];if(ke!==!1){if(ke||q===R.length)return U.apply(void 0,[ke].concat(Fe));ce(Fe)}}ce([])}t.default=(0,E.default)(w),e.exports=t.default})(Oh,Oh.exports);var eh=ni(Oh.exports),dd=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return eh(this.tasks)},e.prototype.tap=function(t,r){this.tasks.length===0?this.tasks.push(function(i){var a=r();i(a?null:!1,a)}):this.tasks.push(function(i,a){var u=r.apply(void 0,pi([],hn(i),!1));a(u?null:!1,t)})},e}(),Ap=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return hu(this.tasks)},e.prototype.tap=function(t,r){this.tasks.push(function(i){var a=r();i(a,t)})},e}(),md=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],i=0;i<arguments.length;i++)r[i]=t[i];return this.args=r,hu(this.tasks)},e.prototype.tapPromise=function(t,r){var i=this;this.tasks.push(function(a){return ci(i,void 0,void 0,function(){return Vn(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,pi([],hn(this.args),!1))];case 1:return u.sent(),a(null,t),[2]}})})})},e}(),ef=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],i=0;i<arguments.length;i++)r[i]=t[i];return this.args=r,hu(this.tasks)},e.prototype.tapPromise=function(t,r){var i=this;this.tasks.push(function(a){return ci(i,void 0,void 0,function(){var u;return Vn(this,function(h){switch(h.label){case 0:return[4,r.apply(void 0,pi([],hn(this.args),!1))];case 1:return u=h.sent(),a(u,t),[2]}})})})},e}(),Tp=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return eh(this.tasks)},e.prototype.tapPromise=function(t,r){this.tasks.length===0?this.tasks.push(function(i){r().then(function(a){i(null,a)})}):this.tasks.push(function(i,a){r(i).then(function(u){a(null,u)})})},e}(),Dh=N(63844),Af=N.n(Dh);class Lh extends Rs.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(t){super(),(0,P.Z)(this,"destroyed",!1),(0,P.Z)(this,"loaded",!1),(0,P.Z)(this,"id",void 0),(0,P.Z)(this,"inited",!1),(0,P.Z)(this,"rendering",!1),(0,P.Z)(this,"$container",void 0),(0,P.Z)(this,"canvas",void 0),(0,P.Z)(this,"markerContainer",void 0),(0,P.Z)(this,"resizeDetector",void 0),(0,P.Z)(this,"hooks",void 0),(0,P.Z)(this,"handleWindowResized",()=>{this.emit("resize"),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())}),(0,P.Z)(this,"handleMapCameraChanged",r=>{this.cameraService.update(r),this.render()}),this.container=t,this.hooks={init:new md},this.id=t.id}init(t){var r=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",()=>this.render()),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Yt.Z)(function*(){r.debugService.log("map.mapInitStart",{type:r.map.version}),yield new Promise(i=>{r.map.onCameraChanged(a=>{r.cameraService.init(),r.cameraService.update(a),i()}),r.map.init()}),r.map.onCameraChanged(r.handleMapCameraChanged),r.map.addMarkerContainer(),r.markerService.addMarkers(),r.markerService.addMarkerLayers(),r.popupService.initPopup(),r.interactionService.init(),r.interactionService.on(Nt.Drag,r.addSceneEvent.bind(r))})),this.hooks.init.tapPromise("initRenderer",(0,Yt.Z)(function*(){var i;const a=((i=r.map)===null||i===void 0?void 0:i.getOverlayContainer())||void 0;if(a?r.$container=a:r.$container=Te(r.configService.getSceneConfig(r.id).id||""),r.$container){if(r.canvas=Mi("canvas","",r.$container),r.setCanvas(),yield r.rendererService.init(r.canvas,r.configService.getSceneConfig(r.id),t.gl),r.registerContextLost(),r.initContainer(),r.resizeDetector=Af()({strategy:"scroll"}),r.resizeDetector.listenTo(r.$container,r.handleWindowResized),window.matchMedia){var u;(u=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||u===void 0||u.addListener(r.handleWindowResized.bind("screen"))}}else console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");r.pickingService.init(r.id)})),this.render()}registerContextLost(){const t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",()=>this.emit("webglcontextlost"))}addLayer(t){this.layerService.sceneService=this,this.layerService.add(t)}addMask(t){this.layerService.sceneService=this,this.layerService.addMask(t)}render(){var t=this;return(0,Yt.Z)(function*(){t.rendering||t.destroyed||(t.rendering=!0,t.inited?(yield t.layerService.initLayers(),yield t.layerService.renderLayers()):(yield t.hooks.init.promise(),t.destroyed&&t.destroy(),yield t.layerService.initLayers(),t.layerService.renderLayers(),t.controlService.addControls(),t.loaded=!0,t.emit("loaded"),t.inited=!0),t.rendering=!1)})()}addFontFace(t,r){this.fontService.addFontFace(t,r)}getSceneContainer(){return this.$container}exportPng(t){var r=this;return(0,Yt.Z)(function*(){var i;const a=(i=r.$container)===null||i===void 0?void 0:i.getElementsByTagName("canvas")[0];return yield r.render(),t==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png")})()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){const t=this.$container.parentElement;t!==null&&(this.markerContainer=Mi("div","l7-marker-container",t))}getMarkerContainer(){return this.markerContainer}destroy(){var t;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(()=>{var r;(r=this.$container)===null||r===void 0||r.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()}),(t=this.$container)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$container),this.emit("destroy")}initContainer(){var t,r;const i=Jo,a=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,u=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,h=this.canvas;h&&(h.width=a*i,h.height=u*i),this.rendererService.viewport({x:0,y:0,width:i*a,height:i*u})}setCanvas(){var t,r;const i=Jo,a=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,u=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,h=this.canvas;h.width=a*i,h.height=u*i,h.style.width="100%",h.style.height="100%"}addSceneEvent(t){this.emit(t.type,t)}}const{uniq:vd}=Yn,Cp="#define PI 3.14159265359",wp=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Rp=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,_d=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,Mp=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float activeType = v_PickingResult.a;
  if(activeType > 0.0) {
    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;
    highLightColor = highLightColor * COLOR_SCALE;
    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));
    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  }
  else {
    return color;
  }

  
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Ip=`layout(location = 3) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  if(u_PickingStage == PICKING_HIGHLIGHT) {
    if(isVertexPicked(pickingColor)) {
       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);
       return;
    }
    if(isVertexSelected(pickingColor)) {
     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);
      return;
    }

  } else {
      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);
      return;
  }

  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));

  // // Stores the picking color so that the fragment shader can render it during picking
  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Fh=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_activeMix;
};`,gd=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,th=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,yd=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,rh=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};

layout(std140) uniform LayerUniforms {
  mat4 u_Mvp;
  vec2 u_sceneCenterMercator;
};
`,Pp=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Tf=/precision\s+(high|low|medium)p\s+float/,Bh=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Nh=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,pm=/void\s+main\s*\([^)]*\)\s*\{\n?/;class gv{constructor(){(0,P.Z)(this,"moduleCache",{}),(0,P.Z)(this,"rawContentCache",{})}registerBuiltinModules(){this.destroy(),this.registerModule("common",{vs:Cp,fs:Cp}),this.registerModule("decode",{vs:Rp,fs:""}),this.registerModule("scene_uniforms",{vs:rh,fs:rh}),this.registerModule("picking_uniforms",{vs:Fh,fs:Fh}),this.registerModule("projection",{vs:th,fs:th}),this.registerModule("project",{vs:gd,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Pp}),this.registerModule("lighting",{vs:_d,fs:""}),this.registerModule("light",{vs:wp,fs:""}),this.registerModule("picking",{vs:Ip,fs:Mp}),this.registerModule("rotation_2d",{vs:yd,fs:""})}registerModule(t,r){r.vs=r.vs.replace(/\r\n/g,`
`),r.fs=r.fs.replace(/\r\n/g,`
`);const{vs:i,fs:a,uniforms:u,inject:h}=r,{content:m,uniforms:g}=ea(i),{content:E,uniforms:A}=ea(a);this.rawContentCache[t]={fs:E,inject:h,uniforms:(0,lt.Z)((0,lt.Z)((0,lt.Z)({},g),A),u),vs:m}}destroy(){this.moduleCache={},this.rawContentCache={}}getModule(t){let r=this.rawContentCache[t].vs,i=this.rawContentCache[t].fs;const a=this.rawContentCache[t].inject;let u={};a!=null&&a["vs:#decl"]&&(r=(a==null?void 0:a["vs:#decl"])+r,u=ea(a==null?void 0:a["vs:#decl"]).uniforms),a!=null&&a["vs:#main-start"]&&(r=r.replace(pm,U=>U+(a==null?void 0:a["vs:#main-start"]))),a!=null&&a["fs:#decl"]&&(i=(a==null?void 0:a["fs:#decl"])+i);const{content:h,includeList:m}=this.processModule(r,[],"vs"),{content:g,includeList:E}=this.processModule(i,[],"fs");let A="";const w=vd(m.concat(E).concat(t)).reduce((U,q)=>(0,lt.Z)((0,lt.Z)({},U),this.rawContentCache[q].uniforms),(0,lt.Z)({},u));Tf.test(g)||(A=A+Bh),A=A+g;let R="";return Tf.test(h)||(R=R+Bh),R=R+h,this.moduleCache[t]={fs:A.trim(),uniforms:w,vs:R.trim()},this.moduleCache[t]}processModule(t,r,i){return{content:t.replace(Nh,(u,h)=>{const g=h.split(" ")[0].replace(/"/g,"");if(r.indexOf(g)>-1)return"";const E=this.rawContentCache[g][i];r.push(g);const{content:A}=this.processModule(E,r,i);return A}),includeList:r}}injectDefines(t){return Object.keys(t).reduce((i,a)=>i+`#define ${a.toUpperCase()} ${t[a]};
`,`
`)}}class Op{constructor(){(0,P.Z)(this,"shaderModuleService",void 0),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"cameraService",void 0),(0,P.Z)(this,"mapService",void 0),(0,P.Z)(this,"interactionService",void 0),(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"config",void 0)}getName(){return""}getType(){return ti.Normal}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.cameraService=t.getContainer().cameraService,this.mapService=t.getContainer().mapService,this.interactionService=t.getContainer().interactionService,this.layerService=t.getContainer().layerService,this.shaderModuleService=t.getContainer().shaderModuleService}render(t){}}class yv extends Op{getName(){return"clear"}init(t,r){super.init(t,r)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}class dm{constructor(t){(0,P.Z)(this,"passes",[]),(0,P.Z)(this,"layer",void 0),(0,P.Z)(this,"renderFlag",void 0),(0,P.Z)(this,"width",0),(0,P.Z)(this,"height",0),this.postProcessor=t}setLayer(t){this.layer=t}setRenderFlag(t){this.renderFlag=t}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var t=this;return(0,Yt.Z)(function*(){for(const r of t.passes)yield r.render(t.layer);yield t.postProcessor.render(t.layer)})()}resize(t,r){(this.width!==t||this.height!==r)&&(this.postProcessor.resize(t,r),this.width=t,this.height=r)}add(t,r){t.getType()===ti.PostProcessing?this.postProcessor.add(t,this.layer,r):(t.init(this.layer,r),this.passes.push(t))}insert(t,r,i){t.init(this.layer,r),this.passes.splice(i,0,t)}destroy(){this.passes.length=0}}class Y0 extends Op{constructor(...t){var r;super(...t),r=this,(0,P.Z)(this,"pickingFBO",void 0),(0,P.Z)(this,"layer",void 0),(0,P.Z)(this,"width",0),(0,P.Z)(this,"height",0),(0,P.Z)(this,"alreadyInRendering",!1),(0,P.Z)(this,"pickFromPickingFBO",({x:i,y:a,lngLat:u,type:h})=>{if(!this.layer.isVisible()||!this.layer.needPick(h))return;const{getViewportSize:m,readPixelsAsync:g,useFramebuffer:E}=this.rendererService,{width:A,height:w}=m(),{enableHighlight:R,enableSelect:U}=this.layer.getLayerConfig(),q=i*Jo,ce=a*Jo;if(q>A||q<0||ce>w||ce<0)return;let Se;E(this.pickingFBO,(0,Yt.Z)(function*(){var ke;if(Se=yield g({x:Math.round(q),y:Math.round(w-(a+1)*Jo),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),Se[0]!==0||Se[1]!==0||Se[2]!==0){const Fe=ys(Se),rt=r.layer.getSource().getFeatureById(Fe),mt={x:i,y:a,type:h,lngLat:u,featureId:Fe,feature:rt};rt&&(r.layer.setCurrentPickId(Fe),r.triggerHoverOnLayer(mt))}else{const Fe={x:i,y:a,lngLat:u,type:r.layer.getCurrentPickId()===null?"un"+h:"mouseout",featureId:null,feature:null};r.triggerHoverOnLayer((0,lt.Z)((0,lt.Z)({},Fe),{},{type:"unpick"})),r.triggerHoverOnLayer(Fe),r.layer.setCurrentPickId(null)}R&&r.highlightPickedFeature(Se),U&&h==="click"&&((ke=Se)===null||ke===void 0?void 0:ke.toString())!==[0,0,0,0].toString()&&r.selectFeature(Se)}))})}getType(){return ti.Normal}getName(){return"pixelPicking"}init(t,r){super.init(t,r),this.layer=t;const{createTexture2D:i,createFramebuffer:a,getViewportSize:u}=this.rendererService,{width:h,height:m}=u(),g=i({width:h,height:m,wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=a({color:g}),this.interactionService.on(Nt.Hover,this.pickFromPickingFBO),this.interactionService.on(Nt.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Nt.Active,this.highlightFeatureHandle.bind(this))}render(t){if(this.alreadyInRendering)return;const{getViewportSize:r,useFramebuffer:i,clear:a}=this.rendererService,{width:u,height:h}=r();this.alreadyInRendering=!0,(this.width!==u||this.height!==h)&&(this.pickingFBO.resize({width:u,height:h}),this.width=u,this.height=h),i(this.pickingFBO,()=>{a({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});const m=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(m),this.alreadyInRendering=!1})}triggerHoverOnLayer(t){this.layer.emit(t.type,t)}highlightPickedFeature(t){const[r,i,a]=t;this.layer.hooks.beforeHighlight.call([r,i,a]),this.layerService.renderLayers()}selectFeature(t){const[r,i,a]=t;this.layer.hooks.beforeSelect.call([r,i,a]),this.layerService.renderLayers()}selectFeatureHandle({featureId:t}){const r=Fs(t);this.selectFeature(new Uint8Array(r))}highlightFeatureHandle({featureId:t}){const r=Fs(t);this.highlightPickedFeature(new Uint8Array(r))}}class Dp{constructor(t){(0,P.Z)(this,"passes",[]),(0,P.Z)(this,"readFBO",void 0),(0,P.Z)(this,"writeFBO",void 0),this.rendererService=t,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){const{getViewportSize:t,createTexture2D:r}=this.rendererService,{width:i,height:a}=t();return r({x:0,y:0,width:i,height:a,copy:!0})}getReadFBOTex(){var t=this;const{useFramebuffer:r}=this.rendererService;return new Promise(i=>{r(this.readFBO,(0,Yt.Z)(function*(){i(t.getCurrentFBOTex())}))})}renderBloomPass(t,r){var i=this;return(0,Yt.Z)(function*(){const a=yield i.getReadFBOTex();let u=0;for(;u<4;)yield r.render(t,a),i.swap(),u++})()}render(t){var r=this;return(0,Yt.Z)(function*(){for(let i=0;i<r.passes.length;i++){const a=r.passes[i];a.setRenderToScreen(r.isLastEnabledPass(i)),a.getName()==="bloom"?yield r.renderBloomPass(t,a):(yield a.render(t),i!==r.passes.length-1&&r.swap())}})()}resize(t,r){this.readFBO.resize({width:t,height:r}),this.writeFBO.resize({width:t,height:r})}add(t,r,i){t.init(r,i),this.passes.push(t)}insert(t,r,i,a){t.init(i,a),this.passes.splice(r,0,t)}getPostProcessingPassByName(t){return this.passes.find(r=>r.getName()===t)}init(){const{createFramebuffer:t,createTexture2D:r}=this.rendererService;this.readFBO=t({color:r({width:1,height:1,wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE})}),this.writeFBO=t({color:r({width:1,height:1,wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE})})}isLastEnabledPass(t){for(let r=t+1;r<this.passes.length;r++)if(this.passes[r].isEnabled())return!1;return!0}swap(){const t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}class pa extends Op{getType(){return ti.Normal}getName(){return"render"}init(t,r){super.init(t,r)}render(t){const{useFramebuffer:r,clear:i}=this.rendererService,a=t.multiPassRenderer.getPostProcessor().getReadFBO();r(a,()=>{i({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(u=>{u.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}const Vl=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,q0=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:gc}=Yn;class mm extends ri{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:q0,fs:Vl});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,lt.Z)((0,lt.Z)({},i),{},{u_ViewportSize:[a,u]})}}convertOptionsToUniforms(t){const r={};return gc(t.bloomRadius)||(r.u_radius=t.bloomRadius),gc(t.bloomIntensity)||(r.u_intensity=t.bloomIntensity),gc(t.bloomBaseRadio)||(r.u_baseRadio=t.bloomBaseRadio),r}}const xv=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,xd=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:yc}=Yn;class Ed extends ri{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:xd,fs:xv});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,lt.Z)((0,lt.Z)({},i),{},{u_ViewportSize:[a,u]})}}convertOptionsToUniforms(t){const r={};return yc(t.blurRadius)||(r.u_BlurDir=[t.blurRadius,0]),r}}const Lp=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,bd=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:Sd}=Yn;class vm extends ri{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:bd,fs:Lp});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,lt.Z)((0,lt.Z)({},i),{},{u_ViewportSize:[a,u]})}}convertOptionsToUniforms(t){const r={};return Sd(t.blurRadius)||(r.u_BlurDir=[0,t.blurRadius]),r}}const Ev=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Fp=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class bv extends ri{setupShaders(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Fp,fs:Ev});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("colorhalftone-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,lt.Z)((0,lt.Z)({},i),{},{u_ViewportSize:[a,u]})}}}const Sv=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Av=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class Tv extends ri{setupShaders(){return this.shaderModuleService.registerModule("copy-pass",{vs:Av,fs:Sv}),this.shaderModuleService.getModule("copy-pass")}}const Cv=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Du=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class Ad extends ri{setupShaders(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Du,fs:Cv});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("hexagonalpixelate-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,lt.Z)((0,lt.Z)({},i),{},{u_ViewportSize:[a,u]})}}}const wv=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,xc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class K0 extends ri{setupShaders(){this.shaderModuleService.registerModule("ink-pass",{vs:xc,fs:wv});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("ink-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,lt.Z)((0,lt.Z)({},i),{},{u_ViewportSize:[a,u]})}}}const Rv=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,nh=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class kh extends ri{setupShaders(){return this.shaderModuleService.registerModule("noise-pass",{vs:nh,fs:Rv}),this.shaderModuleService.getModule("noise-pass")}}const Uh=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zh=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`;class Vh extends ri{setupShaders(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Uh,fs:zh}),this.shaderModuleService.getModule("sepia-pass")}}const _m=new n;let Mv=0;function Iv(){const e=new gv,t=new I,r=new pd,i=new C(r),a=new Jf,u=new Kc,h=new $c,m=new vv,g=new Ph,E={id:`${Mv++}`,globalConfigService:_m,shaderModuleService:e,debugService:t,cameraService:r,coordinateSystemService:i,fontService:a,iconService:u,markerService:h,popupService:m,controlService:g,customRenderService:{}},A=new zt(E);E.layerService=A;const w=new Lh(E);E.sceneService=w;const R=new J(E);E.interactionService=R;const U=new je(E);E.pickingService=U;const q={clear:new yv,pixelPicking:new Y0,render:new pa};E.normalPassFactory=Se=>q[Se];const ce={copy:new Tv,bloom:new mm,blurH:new Ed,blurV:new vm,noise:new kh,sepia:new Vh,colorHalftone:new bv,hexagonalPixelate:new Ad,ink:new K0};return E.postProcessingPass=ce,E.postProcessingPassFactory=Se=>ce[Se],E}function Zh(e){const t=(0,lt.Z)({},e);return t.postProcessor=new Dp(t.rendererService),t.multiPassRenderer=new dm(t.postProcessor),t.styleAttributeService=new In(t.rendererService),t}const jh=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];let ds=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({});var Ec=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),Pv=(e,t,r,i)=>Ec(void 0,null,function*(){return new Promise((a,u)=>{t({x:e.x,y:e.y,z:e.z},(h,m)=>{if(h||m.length===0){u(h);return}m&&Qt([{data:m,bands:[0]}],r,i,(g,E)=>{g?u(g):E&&a(E)})})})}),gm=(e,t)=>Ec(void 0,null,function*(){return new Promise((r,i)=>{t({x:e.x,y:e.y,z:e.z},(a,u)=>{if(a||!u){i(a);return}u instanceof ArrayBuffer?mi(u,(h,m)=>{h&&i(h),r(m)}):u instanceof HTMLImageElement?r(u):i(a)})})});function ym(e,t){return Array.isArray(e)?typeof e[0]=="string"?e.map(r=>vn(r,t)):e.map(r=>({url:vn(r.url,t),bands:r.bands||[0]})):vn(e,t)}function Ov(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(t=>({url:t,bands:[0]})):e}function Td(e,t){e.xhrCancel=()=>{t.map(r=>{r.abort()})}}var Dv=Object.defineProperty,Lv=Object.defineProperties,xm=Object.getOwnPropertyDescriptors,Em=Object.getOwnPropertySymbols,Bp=Object.prototype.hasOwnProperty,Fv=Object.prototype.propertyIsEnumerable,Np=(e,t,r)=>t in e?Dv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Bv=(e,t)=>{for(var r in t||(t={}))Bp.call(t,r)&&Np(e,r,t[r]);if(Em)for(var r of Em(t))Fv.call(t,r)&&Np(e,r,t[r]);return e},bm=(e,t)=>Lv(e,xm(t)),Nv=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),$0=(e,t,r,i,a)=>Nv(void 0,null,function*(){const u=Ov(t.url);if(u.length>1){const{rasterFiles:h,xhrList:m,errList:g}=yield Q0(u,t);if(Td(e,m),g.length>0){r(g,null);return}Qt(h,i,a,r)}else{const h=Kn(t,(m,g)=>{if(m)r(m);else if(g){const E=[{data:g,bands:u[0].bands}];Qt(E,i,a,r)}});Td(e,[h])}});function Q0(e,t){return Nv(this,null,function*(){const r=[],i=[],a=[];for(let u=0;u<e.length;u++){const h=e[u],m=bm(Bv({},t),{url:h.url}),g=h.bands,{err:E,data:A,xhr:w}=yield Ir(bm(Bv({},m),{type:"arrayBuffer"}));E&&a.push(E),i.push(w),r.push({data:A,bands:g})}return{rasterFiles:r,xhrList:i,errList:a}})}var J0=Object.defineProperty,e_=Object.defineProperties,t_=Object.getOwnPropertyDescriptors,kv=Object.getOwnPropertySymbols,r_=Object.prototype.hasOwnProperty,bc=Object.prototype.propertyIsEnumerable,kp=(e,t,r)=>t in e?J0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Up=(e,t)=>{for(var r in t||(t={}))r_.call(t,r)&&kp(e,r,t[r]);if(kv)for(var r of kv(t))bc.call(t,r)&&kp(e,r,t[r]);return e},Hh=(e,t)=>e_(e,t_(t)),Sm=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),UE=(e,t,r,i)=>Sm(void 0,null,function*(){const{format:a=sg,operation:u,requestParameters:h={}}=i,m=Hh(Up({},h),{url:ym(e,t)});return new Promise((g,E)=>{$0(r,m,(A,w)=>{A?E(A):w&&g(w)},a,u)})}),ag=(e,t,r,i)=>Sm(void 0,null,function*(){let a;const u=Array.isArray(e)?e[0]:e;return i.wmtsOptions?a=((i==null?void 0:i.getURLFromTemplate)||wi)(u,Up(Up({},t),i.wmtsOptions)):a=((i==null?void 0:i.getURLFromTemplate)||vn)(u,t),new Promise((h,m)=>{var g;const E=oo(Hh(Up({},i==null?void 0:i.requestParameters),{url:a,type:((g=i==null?void 0:i.requestParameters)==null?void 0:g.type)||"arrayBuffer"}),(A,w)=>{A?m(A):w&&h(w)},i.transformResponse);r.xhrCancel=()=>E.cancel()})}),sg=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),zE=Object.defineProperty,VE=Object.defineProperties,ZE=Object.getOwnPropertyDescriptors,ug=Object.getOwnPropertySymbols,jE=Object.prototype.hasOwnProperty,HE=Object.prototype.propertyIsEnumerable,lg=(e,t,r)=>t in e?zE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cg=(e,t)=>{for(var r in t||(t={}))jE.call(t,r)&&lg(e,r,t[r]);if(ug)for(var r of ug(t))HE.call(t,r)&&lg(e,r,t[r]);return e},WE=(e,t)=>VE(e,ZE(t)),GE={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},uO=[ds.ARRAYBUFFER,ds.RGB];function XE(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function YE(e,t={}){if(XE(e))throw new Error("tile server url is error");let r=(t==null?void 0:t.dataType)||ds.IMAGE;r===ds.RGB&&(r=ds.ARRAYBUFFER);const i=(u,h)=>{switch(r){case ds.IMAGE:return ag(e,u,h,t);case ds.CUSTOMIMAGE:case ds.CUSTOMTERRAINRGB:return gm(h,t==null?void 0:t.getCustomData);case ds.ARRAYBUFFER:return UE(e,u,h,t);case ds.CUSTOMARRAYBUFFER:case ds.CUSTOMRGB:return Pv(h,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||sg,t==null?void 0:t.operation);default:return ag(e,u,h,t)}},a=WE(cg(cg({},GE),t),{getTileData:i});return{data:e,dataArray:[],tilesetOptions:a,isTile:!0}}var qE=Object.defineProperty,KE=Object.defineProperties,$E=Object.getOwnPropertyDescriptors,Uv=Object.getOwnPropertySymbols,fg=Object.prototype.hasOwnProperty,hg=Object.prototype.propertyIsEnumerable,pg=(e,t,r)=>t in e?qE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,QE=(e,t)=>{for(var r in t||(t={}))fg.call(t,r)&&pg(e,r,t[r]);if(Uv)for(var r of Uv(t))hg.call(t,r)&&pg(e,r,t[r]);return e},JE=(e,t)=>KE(e,$E(t)),eb=(e,t)=>{var r={};for(var i in e)fg.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&Uv)for(var i of Uv(e))t.indexOf(i)<0&&hg.call(e,i)&&(r[i]=e[i]);return r};function tb(e,t){const r=t,{extent:i=[121.168,30.2828,121.384,30.4219],coordinates:a,width:u,height:h}=r,m=eb(r,["extent","coordinates","width","height"]);e.length<2&&console.warn("RGB\u89E3\u6790\u9700\u89812\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[g,E]=m.bands||[0,1],A=[e[g],e[E]],w=[];for(let q=0;q<A[0].length;q++)w.push((A[1][q]-A[0][q])/(A[1][q]+A[0][q]));const R=Oo(a,i);return{_id:1,dataArray:[JE(QE({_id:1,data:w,width:u,height:h},m),{coordinates:R})]}}var rb=Object.defineProperty,nb=Object.defineProperties,ib=Object.getOwnPropertyDescriptors,zv=Object.getOwnPropertySymbols,dg=Object.prototype.hasOwnProperty,mg=Object.prototype.propertyIsEnumerable,vg=(e,t,r)=>t in e?rb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ob=(e,t)=>{for(var r in t||(t={}))dg.call(t,r)&&vg(e,r,t[r]);if(zv)for(var r of zv(t))mg.call(t,r)&&vg(e,r,t[r]);return e},ab=(e,t)=>nb(e,ib(t)),sb=(e,t)=>{var r={};for(var i in e)dg.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&zv)for(var i of zv(e))t.indexOf(i)<0&&mg.call(e,i)&&(r[i]=e[i]);return r};function ub(e,t){const r=t,{extent:i,coordinates:a,width:u,height:h}=r,m=sb(r,["extent","coordinates","width","height"]);e.length<3&&console.warn("RGB\u89E3\u6790\u9700\u8981\u4E09\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[g,E,A]=m.bands||[0,1,2],w=[e[g],e[E],e[A]],R=[],[U,q]=(m==null?void 0:m.countCut)||[2,98],ce=(m==null?void 0:m.RMinMax)||dt(w[0],U,q),Se=(m==null?void 0:m.GMinMax)||dt(w[1],U,q),ke=(m==null?void 0:m.BMinMax)||dt(w[2],U,q);for(let mt=0;mt<w[0].length;mt++)R.push(Math.max(0,w[0][mt]-ce[0])),R.push(Math.max(0,w[1][mt]-Se[0])),R.push(Math.max(0,w[2][mt]-ke[0]));const Fe=Oo(a,i);return{_id:1,dataArray:[ab(ob({_id:1,data:R,width:u,height:h,rMinMax:ce,gMinMax:Se,bMinMax:ke},m),{coordinates:Fe})]}}var lb=Object.defineProperty,cb=Object.defineProperties,fb=Object.getOwnPropertyDescriptors,Vv=Object.getOwnPropertySymbols,_g=Object.prototype.hasOwnProperty,gg=Object.prototype.propertyIsEnumerable,yg=(e,t,r)=>t in e?lb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,hb=(e,t)=>{for(var r in t||(t={}))_g.call(t,r)&&yg(e,r,t[r]);if(Vv)for(var r of Vv(t))gg.call(t,r)&&yg(e,r,t[r]);return e},pb=(e,t)=>cb(e,fb(t)),db=(e,t)=>{var r={};for(var i in e)_g.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&Vv)for(var i of Vv(e))t.indexOf(i)<0&&gg.call(e,i)&&(r[i]=e[i]);return r};function mb(e,t){const r=t,{extent:i,coordinates:a,min:u,max:h,width:m,height:g,format:E,operation:A}=r,w=db(r,["extent","coordinates","min","max","width","height","format","operation"]);let R;if(E===void 0||Bn(e))R=Array.from(e);else{const ce=Array.isArray(e)?e:[e];R=Wn(ce,E,A)}const U=Oo(a,i);return{_id:1,dataArray:[pb(hb({_id:1,data:R,width:m,height:g},w),{min:u,max:h,coordinates:U})]}}var vb=Object.defineProperty,_b=Object.defineProperties,gb=Object.getOwnPropertyDescriptors,xg=Object.getOwnPropertySymbols,yb=Object.prototype.hasOwnProperty,xb=Object.prototype.propertyIsEnumerable,Eg=(e,t,r)=>t in e?vb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bg=(e,t)=>{for(var r in t||(t={}))yb.call(t,r)&&Eg(e,r,t[r]);if(xg)for(var r of xg(t))xb.call(t,r)&&Eg(e,r,t[r]);return e},Eb=(e,t)=>_b(e,gb(t)),bb=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),Sb={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},Ab=e=>bb(void 0,null,function*(){return new Promise(t=>{const[r,i,a,u]=e.bounds,h={layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,x:(r+a)/2,y:(i+u)/2},geometry:{type:"LineString",coordinates:[[a,u],[a,i],[r,i],[r,i]]}}]}}};t(h)})});function Tb(e,t){const r=a=>Ab(a),i=Eb(bg(bg({},Sb),t),{getTileData:r});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var Cb=N(72571),wb=N(69848),Rb=N.n(wb),Mb=Object.defineProperty,Sg=Object.getOwnPropertySymbols,Ib=Object.prototype.hasOwnProperty,Pb=Object.prototype.propertyIsEnumerable,Ag=(e,t,r)=>t in e?Mb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Tg=(e,t)=>{for(var r in t||(t={}))Ib.call(t,r)&&Ag(e,r,t[r]);if(Sg)for(var r of Sg(t))Pb.call(t,r)&&Ag(e,r,t[r]);return e};function Cg(e,t){const{radius:r=40,maxZoom:i=18,minZoom:a=0,zoom:u=2}=t;if(e.pointIndex){const g=e.pointIndex.getClusters(e.extent,Math.floor(u));return e.dataArray=Ob(g),e}const h=new(Rb())({radius:r,minZoom:a,maxZoom:i}),m={type:"FeatureCollection",features:[]};return m.features=e.dataArray.map(g=>({type:"Feature",geometry:{type:"Point",coordinates:g.coordinates},properties:Tg({},g)})),h.load(m.features),h}function Ob(e){return e.map((t,r)=>Tg({coordinates:t.geometry.coordinates,_id:r+1},t.properties))}function Db(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function Lb(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function wg(e){if(e.length===0)return 0;let t=e[0],r=0,i;for(let a=1;a<e.length;a++)i=t+e[a]*1,Math.abs(t)>=Math.abs(e[a])?r+=t-i+e[a]:r+=e[a]-i+t,t=i;return t+r*1}function Fb(e){if(e.length===0)throw new Error("mean requires at least one data point");return wg(e)/e.length}var Bb={min:Lb,max:Db,mean:Fb,sum:wg},Nb=Object.defineProperty,Rg=Object.getOwnPropertySymbols,kb=Object.prototype.hasOwnProperty,Ub=Object.prototype.propertyIsEnumerable,Mg=(e,t,r)=>t in e?Nb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Am=(e,t)=>{for(var r in t||(t={}))kb.call(t,r)&&Mg(e,r,t[r]);if(Rg)for(var r of Rg(t))Ub.call(t,r)&&Mg(e,r,t[r]);return e},Ig=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),{cloneDeep:zb,isFunction:Pg,isString:Vb,mergeWith:Zb}=Yn;function jb(e,t){if(Array.isArray(t))return t}var Hb=class extends Cb.EventEmitter{constructor(e,t){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new pu},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=e,this.initCfg(t),this.init().then(()=>{this.inited=!0,this.emit("update",{type:"inited"})})}getSourceCfg(){return this.cfg}getClusters(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}getClustersLeaves(e){return this.clusterIndex.getLeaves(e,1/0)}getParserType(){return this.parser.type}updateClusterData(e){const{method:t="sum",field:r}=this.clusterOptions;let i=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,i.forEach(a=>{a.id||(a.properties.point_count=1)}),(r||Pg(t))&&(i=i.map(a=>{const u=a.id;if(u){const m=this.clusterIndex.getLeaves(u,1/0).map(E=>E.properties);let g;if(Vb(t)&&r){const E=jn(m,r);g=Bb[t](E)}Pg(t)&&(g=t(m)),a.properties.stat=g}else a.properties.point_count=1;return a})),this.data=se("geojson")({type:"FeatureCollection",features:i}),this.executeTrans()}getFeatureById(e){const{type:t="geojson",geometry:r}=this.parser;if(t==="geojson"&&!this.cluster){const i=e<this.originData.features.length?this.originData.features[e]:"null",a=zb(i);if(a!=null&&a.properties&&(this.transforms.length!==0||this.dataArrayChanged)){const u=this.data.dataArray.find(h=>h._id===e);a.properties=u}return a}else return t==="json"&&r?this.data.dataArray.find(i=>i._id===e):e<this.data.dataArray.length?this.data.dataArray[e]:"null"}updateFeaturePropertiesById(e,t){this.data.dataArray=this.data.dataArray.map(r=>r._id===e?Am(Am({},r),t):r),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(e,t){const r=this.data.dataArray.find(i=>i[e]===t);return r==null?void 0:r._id}setData(e,t){this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then(()=>{this.emit("update",{type:"update"})})}reloadAllTile(){var e;(e=this.tileset)==null||e.reloadAll()}reloadTilebyId(e,t,r){var i;(i=this.tileset)==null||i.reloadTileById(e,t,r)}reloadTileByLnglat(e,t,r){var i;(i=this.tileset)==null||i.reloadTileByLnglat(e,t,r)}getTileExtent(e,t){var r;return(r=this.tileset)==null?void 0:r.getTileExtent(e,t)}getTileByZXY(e,t,r){var i;return(i=this.tileset)==null?void 0:i.getTileByZXY(e,t,r)}reloadTileByExtent(e,t){var r;(r=this.tileset)==null||r.reloadTileByExtent(e,t)}destroy(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(e=this.tileset)==null||e.destroy()}processData(){return Ig(this,null,function*(){return new Promise((e,t)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),e({})}catch(r){t(r)}})})}initCfg(e){this.cfg=Zb(this.cfg,e,jb);const t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=Am(Am({},this.clusterOptions),t.clusterOptions)))}init(){return Ig(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){const e=this.parser,t=e.type||"geojson",r=se(t);this.data=r(this.originData,e),this.tileset=this.initTileset(),!e.cancelExtent&&(this.extent=Nc(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:e}=this.data;return e?(this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new en(Am({},e))):void 0}executeTrans(){this.transforms.forEach(t=>{const{type:r}=t,i=ne(r)(this.data,t);Object.assign(this.data,i)})}initCluster(){if(!this.cluster)return;const e=this.clusterOptions||{};this.clusterIndex=Cg(this.data,e)}caculClusterExtent(e){let t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=Ki(Ur(this.extent),e)),t[0].concat(t[1])}};function Wb(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.filter(r)),e}var n_=6378e3;function Gb(e,t){const r=e.dataArray,{size:i=10}=t,a=i/(2*Math.PI*n_)*(256<<20)/2,{gridHash:u,gridOffset:h}=Xb(r,i),m=$b(u,h,t);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:m}}function Xb(e,t){let r=1/0,i=-1/0,a;for(const g of e)a=g.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,i=a>i?a:i);const u=(r+i)/2,h=Yb(t,u);if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};const m={};for(const g of e){const E=g.coordinates[1],A=g.coordinates[0];if(Number.isFinite(E)&&Number.isFinite(A)){const w=Math.floor((E+90)/h.yOffset),R=Math.floor((A+180)/h.xOffset),U=`${w}-${R}`;m[U]=m[U]||{count:0,points:[]},m[U].count+=1,m[U].points.push(g)}}return{gridHash:m,gridOffset:h}}function Yb(e,t){const r=qb(e),i=Kb(t,e);return{yOffset:r,xOffset:i}}function qb(e){return e/n_*(180/Math.PI)}function Kb(e,t){return t/n_*(180/Math.PI)/Math.cos(e*Math.PI/180)}function $b(e,t,r){return Object.keys(e).reduce((i,a,u)=>{const h=a.split("-"),m=parseInt(h[0],10),g=parseInt(h[1],10),E={};if(r.field&&r.method){const A=Ol(e[a].points,r.field);E[r.method]=ac[r.method](A)}return Object.assign(E,{_id:u,coordinates:zi([-180+t.xOffset*(g+.5),-90+t.yOffset*(m+.5)]),rawData:e[a].points,count:e[a].count}),i.push(E),i},[])}var Cd=Math.PI/3,Qb=[0,Cd,2*Cd,3*Cd,4*Cd,5*Cd];function Jb(e){return e[0]}function e2(e){return e[1]}function t2(){var e=0,t=0,r=1,i=1,a=Jb,u=e2,h,m,g;function E(w){var R={},U=[],q,ce=w.length;for(q=0;q<ce;++q)if(!(isNaN(ke=+a.call(null,Se=w[q],q,w))||isNaN(Fe=+u.call(null,Se,q,w)))){var Se,ke,Fe,rt=Math.round(Fe=Fe/g),mt=Math.round(ke=ke/m-(rt&1)/2),er=Fe-rt;if(Math.abs(er)*3>1){var cr=ke-mt,kt=mt+(ke<mt?-1:1)/2,dr=rt+(Fe<rt?-1:1),Pn=ke-kt,_i=Fe-dr;cr*cr+er*er>Pn*Pn+_i*_i&&(mt=kt+(rt&1?1:-1)/2,rt=dr)}var En=mt+"-"+rt,fi=R[En];fi?fi.push(Se):(U.push(fi=R[En]=[Se]),fi.x=(mt+(rt&1)/2)*m,fi.y=rt*g)}return U}function A(w){var R=0,U=0;return Qb.map(function(q){var ce=Math.sin(q)*w,Se=-Math.cos(q)*w,ke=ce-R,Fe=Se-U;return R=ce,U=Se,[ke,Fe]})}return E.hexagon=function(w){return"m"+A(w==null?h:+w).join("l")+"z"},E.centers=function(){for(var w=[],R=Math.round(t/g),U=Math.round(e/m),q=R*g;q<i+h;q+=g,++R)for(var ce=U*m+(R&1)*m/2;ce<r+m/2;ce+=m)w.push([ce,q]);return w},E.mesh=function(){var w=A(h).slice(0,4).join("l");return E.centers().map(function(R){return"M"+R+"m"+w}).join("")},E.x=function(w){return arguments.length?(a=w,E):a},E.y=function(w){return arguments.length?(u=w,E):u},E.radius=function(w){return arguments.length?(h=+w,m=h*2*Math.sin(Cd),g=h*1.5,E):h},E.size=function(w){return arguments.length?(e=t=0,r=+w[0],i=+w[1],E):[r-e,i-t]},E.extent=function(w){return arguments.length?(e=+w[0][0],t=+w[0][1],r=+w[1][0],i=+w[1][1],E):[[e,t],[r,i]]},E.radius(1)}var r2=Object.defineProperty,n2=Object.defineProperties,i2=Object.getOwnPropertyDescriptors,Og=Object.getOwnPropertySymbols,o2=Object.prototype.hasOwnProperty,a2=Object.prototype.propertyIsEnumerable,Dg=(e,t,r)=>t in e?r2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s2=(e,t)=>{for(var r in t||(t={}))o2.call(t,r)&&Dg(e,r,t[r]);if(Og)for(var r of Og(t))a2.call(t,r)&&Dg(e,r,t[r]);return e},u2=(e,t)=>n2(e,i2(t)),l2=6378e3;function c2(e,t){const r=e.dataArray,{size:i=10,method:a="sum"}=t,u=i/(2*Math.PI*l2)*(256<<20)/2,h=r.map(A=>{const[w,R]=zi(A.coordinates);return u2(s2({},A),{coordinates:[w,R]})});return{dataArray:t2().radius(u).x(A=>A.coordinates[0]).y(A=>A.coordinates[1])(h).map((A,w)=>{if(t.field&&a){const R=Ol(A,t.field);A[a]=ac[a](R)}return{[t.method]:A[a],count:A.length,rawData:A,coordinates:[A.x,A.y],_id:w}}),radius:u,xOffset:u,yOffset:u,type:"hexagon"}}var f2=Object.defineProperty,Lg=Object.getOwnPropertySymbols,h2=Object.prototype.hasOwnProperty,p2=Object.prototype.propertyIsEnumerable,Fg=(e,t,r)=>t in e?f2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Bg=(e,t)=>{for(var r in t||(t={}))h2.call(t,r)&&Fg(e,r,t[r]);if(Lg)for(var r of Lg(t))p2.call(t,r)&&Fg(e,r,t[r]);return e};function d2(e,t){const{sourceField:r,targetField:i,data:a}=t,u={};return a.forEach(h=>{u[h[r]]=h}),e.dataArray=e.dataArray.map(h=>{const m=h[i];return Bg(Bg({},h),u[m])}),e}function m2(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.map(r)),e}var lO=N(4771);W("rasterTile",YE),W("mvt",br),W("geojsonvt",Rh),W("testTile",Tb),W("geojson",fu),W("jsonTile",ru),W("image",vc),W("csv",Cs),W("json",Zs),W("raster",Mn),W("rasterRgb",mb),W("rgb",ub),W("ndi",tb),G("cluster",Cg),G("filter",Wb),G("join",d2),G("map",m2),G("grid",Gb),G("hexagon",c2);var v2=Hb,Zv=N(10578),_2=N.n(Zv);class g2 extends Zv.EventEmitter{getMarkerLayerContainerSize(){}constructor(t){super(),(0,P.Z)(this,"markerOption",void 0),(0,P.Z)(this,"popup",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"lngLat",void 0),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"added",!1),(0,P.Z)(this,"preLngLat",{lng:0,lat:0}),(0,P.Z)(this,"onMarkerDragStart",r=>{const i=this.mapsService.getContainer();if(!i)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});const{left:a,top:u}=i.getClientRects()[0],{x:h,y:m}=r;this.preLngLat=this.mapsService.containerToLngLat([h-a,m-u]),this.mapsService.on("mousemove",this.onMarkerDragMove),document.addEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragstart",this.lngLat)}),(0,P.Z)(this,"onMarkerDragMove",r=>{const{lng:i,lat:a}=this.preLngLat,{lng:u,lat:h}=r.lnglat,m={lng:this.lngLat.lng+u-i,lat:this.lngLat.lat+h-a};this.setLnglat(m),this.preLngLat=r.lnglat,this.emit("dragging",m)}),(0,P.Z)(this,"onMarkerDragEnd",()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragend",this.lngLat)}),(0,P.Z)(this,"eventHandle",r=>{this.polyfillEvent(r),this.emit(r.type,{target:r,data:this.markerOption.extData,lngLat:this.lngLat})}),(0,P.Z)(this,"touchStartTime",void 0),this.markerOption=(0,lt.Z)((0,lt.Z)({},this.getDefault()),t),Su(["update","onMove","onMapClick","updatePositionWhenZoom"],this),this.init()}getDefault(){return{element:void 0,anchor:Jn.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}addTo(t){this.scene=t,this.mapsService=t.mapService;const{element:r}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}remove(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();const{element:t}=this.markerOption;return t&&oa(t),this.popup&&this.popup.remove(),this}setLnglat(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(t){if(!this.added)return this.once("added",()=>{this.setElement(t)}),this;const{element:r}=this.markerOption;return r&&oa(r),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once("added",()=>{this.openPopup()}),this;const t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}closePopup(){this.added||this.once("added",()=>{this.closePopup()});const t=this.popup;return t&&t.remove(),this}setPopup(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){const t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(t){this.markerOption.draggable=t,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(t){this.markerOption.extData=t}update(){if(!this.mapsService)return;const{element:t,anchor:r}=this.markerOption;this.updatePosition(),cf(t,`${ui[r]}`)}updatePositionWhenZoom(t){if(!this.mapsService)return;const{element:r,offsets:i}=this.markerOption,{lng:a,lat:u}=this.lngLat;if(r){r.style.display="block",r.style.whiteSpace="nowrap";const{containerHeight:h,containerWidth:m,bounds:g}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!g)return;const E=t.map,A=t.center,w=t.zoom,R=E.DE(this.lngLat,w,A);if(R.x=Math.round(R.x+i[0]),R.y=Math.round(R.y-i[1]),Math.abs(g[0][0])>180||Math.abs(g[1][0])>180){if(R.x>m){const U=this.mapsService.lngLatToContainer([a-360,u]);R.x=U.x}if(R.x<0){const U=this.mapsService.lngLatToContainer([a+360,u]);R.x=U.x}}(R.x>m||R.x<0||R.y>h||R.y<0)&&(r.style.display="none"),r.style.left=R.x+"px",r.style.top=R.y+"px",r.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}onMapClick(t){const{element:r}=this.markerOption;this.popup&&r&&this.togglePopup()}getCurrentContainerSize(){const t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}updateDraggable(){const{element:t}=this.markerOption;t==null||t.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(t==null||t.addEventListener("mousedown",this.onMarkerDragStart))}updatePosition(){if(!this.mapsService)return;const{element:t,offsets:r}=this.markerOption,{lng:i,lat:a}=this.lngLat,u=this.mapsService.lngLatToContainer([i,a]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";const{containerHeight:h,containerWidth:m,bounds:g}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!g)return;if(Math.abs(g[0][0])>180||Math.abs(g[1][0])>180){if(u.x>m){const E=this.mapsService.lngLatToContainer([i-360,a]);u.x=E.x}if(u.x<0){const E=this.mapsService.lngLatToContainer([i+360,a]);u.x=E.x}}(u.x>m||u.x<0||u.y>h||u.y<0)&&(t.style.display="none"),t.style.left=u.x+r[0]+"px",t.style.top=u.y-r[1]+"px"}}init(){let{element:t}=this.markerOption;const{color:r,anchor:i}=this.markerOption;if(!t){t=Mi("div"),this.markerOption.element=t;const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","48px"),a.setAttributeNS(null,"width","48px"),a.setAttributeNS(null,"viewBox","0 0 1024 1024");const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),u.setAttributeNS(null,"fill",r),a.appendChild(u),t.appendChild(a)}Ta(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(a=>{var u,h;const m=((u=this.markerOption)===null||u===void 0?void 0:u.style)&&((h=this.markerOption)===null||h===void 0?void 0:h.style[a]);t&&(t.style[a]=m)}),To(t,i,"marker")}registerMarkerEvent(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}unRegisterMarkerEvent(){const t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}polyfillEvent(t){!this.mapsService||this.mapsService.version!=="GAODE2.x"||hf()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}addDragHandler(t){return null}onUp(t){throw new Error("Method not implemented.")}}const{merge:y2}=Yn;class cO extends null{constructor(t){var r;super(),_defineProperty(this,"markers",[]),_defineProperty(this,"markerLayerOption",void 0),_defineProperty(this,"clusterIndex",void 0),_defineProperty(this,"points",[]),_defineProperty(this,"clusterMarkers",[]),_defineProperty(this,"mapsService",void 0),_defineProperty(this,"scene",void 0),_defineProperty(this,"zoom",void 0),_defineProperty(this,"bbox",void 0),_defineProperty(this,"inited",void 0),_defineProperty(this,"containerSize",void 0),this.markerLayerOption=y2(this.getDefault(),t),bindAll(["update"],this),this.zoom=((r=this.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99}getDefault(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}addTo(t){return this.scene=t,this.mapsService=t.mapService,this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}setContainerSize(){if(!this.mapsService)return;const t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}getContainerSize(){return this.containerSize}addMarker(t){const r=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),r&&(this.addPoint(t,this.markers.length),this.mapsService)){const i=this.mapsService.getZoom(),a=this.mapsService.getBounds();this.bbox=padBounds(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}removeMarker(t){this.markers.indexOf(t);const r=this.markers.indexOf(t);r>-1&&(this.markers.splice(r,1),this.markerLayerOption.cluster&&(this.removePoint(r),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}hide(){this.markers.map(t=>{t.getElement().style.opacity="0"}),this.clusterMarkers.map(t=>{t.getElement().style.opacity="0"})}show(){this.markers.map(t=>{t.getElement().style.opacity="1"}),this.clusterMarkers.map(t=>{t.getElement().style.opacity="1"})}getMarkers(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}getOriginMarkers(){return this.markers}addMarkers(){this.getMarkers().forEach(t=>{t.addTo(this.scene)})}clear(){this.markers.forEach(t=>{t.remove()}),this.clusterMarkers.forEach(t=>{t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}destroy(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}addPoint(t,r){const{lng:i,lat:a}=t.getLnglat(),u={geometry:{type:"Point",coordinates:[i,a]},properties:_objectSpread(_objectSpread({},t.getExtData()),{},{marker_id:r})};this.points.push(u),this.clusterIndex&&this.clusterIndex.load(this.points)}removePoint(t){const r=this.points.findIndex(i=>i.properties.marker_id===t);r>-1&&this.points.splice(r,1),this.clusterIndex&&this.clusterIndex.load(this.points)}initCluster(){if(!this.markerLayerOption.cluster)return;const{radius:t,minZoom:r=0,maxZoom:i}=this.markerLayerOption.clusterOption;this.clusterIndex=new Supercluster({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}getClusterMarker(t,r){const i=t[0].concat(t[1]),a=this.clusterIndex.getClusters(i,r);this.clusterMarkers.forEach(u=>{u.remove()}),this.clusterMarkers=[],a.forEach(u=>{var h;const{field:m,method:g}=this.markerLayerOption.clusterOption;if((h=u.properties)!==null&&h!==void 0&&h.cluster_id){var E;const w=this.getLeaves((E=u.properties)===null||E===void 0?void 0:E.cluster_id);if(u.properties.clusterData=w,m&&g){const R=w==null?void 0:w.map(Se=>({[m]:Se.properties[m]})),U=Satistics.getColumn(R,m),q=Satistics.getSatByColumn(g,U),ce="point_"+g;u.properties[ce]=q.toFixed(2)}}const A=this.clusterMarker(u);this.clusterMarkers.push(A),A.addTo(this.scene)})}getLeaves(t,r=1/0,i=0){return t?this.clusterIndex.getLeaves(t,r,i):null}clusterMarker(t){const r=this.markerLayerOption.clusterOption,{element:i=this.generateElement.bind(this)}=r;return new Marker({element:i(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]})}normalMarker(t){const r=t.properties.marker_id;return this.markers[r]}update(){if(!this.mapsService||this.markers.length===0)return;const t=this.mapsService.getZoom(),r=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!boundsContains(this.bbox,r))&&(this.bbox=padBounds(r,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}generateElement(t){const r=DOM.create("div","l7-marker-cluster"),i=DOM.create("div","",r),a=DOM.create("span","",i),{field:u,method:h}=this.markerLayerOption.clusterOption;t.properties.point_count=t.properties.point_count||1;const m=u&&h?t.properties["point_"+h]||t.properties[u]:t.properties.point_count;return a.textContent=m,r}}var fO=N(4157);class ih extends _2(){constructor(t){super(),(0,P.Z)(this,"controlOption",void 0),(0,P.Z)(this,"container",void 0),(0,P.Z)(this,"isShow",void 0),(0,P.Z)(this,"sceneContainer",void 0),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"renderService",void 0),(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"controlService",void 0),(0,P.Z)(this,"configService",void 0),ih.controlCount++,this.controlOption=(0,lt.Z)((0,lt.Z)({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(t){const r=this.getDefault(t);Object.entries(t).forEach(([i,a])=>{a===void 0&&(t[i]=r[i])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,lt.Z)((0,lt.Z)({},this.controlOption),t)}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Ta(this.container,"l7-control");const{className:r,style:i}=this.controlOption;return r&&this.setClassName(r),i&&this.setStyle(i),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;oa(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return Mi("div")}onRemove(){}show(){const t=this.container;Es(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){const t=this.container;Ta(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(t){return{position:Ye.TOPRIGHT,name:`${ih.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){const r=this.mapsService.getContainer();r!==null&&r.focus()}}setPosition(t=Ye.TOPLEFT){const r=this.controlService;return r&&r.removeControl(this),this.controlOption.position=t,r&&r.addControl(this,this.sceneContainer),this}setClassName(t){const r=this.container,{className:i}=this.controlOption;i&&Es(r,i),t&&Ta(r,t)}setStyle(t){const r=this.container;t?r.setAttribute("style",t):r.removeAttribute("style")}insertContainer(){const t=this.controlOption.position,r=this.container;if(t instanceof Element)t.appendChild(r);else{const i=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?i.insertBefore(r,i.firstChild):i.appendChild(r)}}checkUpdateOption(t,r){return r.some(i=>i in t)}}(0,P.Z)(ih,"controlCount",0);class jv extends ih{constructor(...t){super(...t),(0,P.Z)(this,"isDisable",!1),(0,P.Z)(this,"button",void 0),(0,P.Z)(this,"buttonText",void 0),(0,P.Z)(this,"buttonIcon",void 0)}setIsDisable(t){if(this.isDisable=t,t){var r;(r=this.button)===null||r===void 0||r.setAttribute("disabled","true")}else{var i;(i=this.button)===null||i===void 0||i.removeAttribute("disabled")}}createButton(t=""){return Mi("button",`l7-button-control ${t}`)}onAdd(){this.button=this.createButton(),this.isDisable=!1;const{title:t,btnText:r,btnIcon:i}=this.controlOption;return this.setBtnTitle(t),this.setBtnText(r),this.setBtnIcon(i),this.button}onRemove(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}setOptions(t){const{title:r,btnText:i,btnIcon:a}=t;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(r),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(a),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(i),super.setOptions(t)}setBtnTitle(t){var r;(r=this.button)===null||r===void 0||r.setAttribute("title",t!=null?t:"")}setBtnIcon(t){if(this.buttonIcon&&oa(this.buttonIcon),t){var r;const u=(r=this.button)===null||r===void 0?void 0:r.firstChild;if(u){var i;(i=this.button)===null||i===void 0||i.insertBefore(t,u)}else{var a;(a=this.button)===null||a===void 0||a.appendChild(t)}this.buttonIcon=t}}setBtnText(t){if(this.button)if(Es(this.button,"l7-button-control--row"),Es(this.button,"l7-button-control--column"),t){let i=this.buttonText;if(!i){var r;i=Mi("div","l7-button-control__text"),(r=this.button)===null||r===void 0||r.appendChild(i),this.buttonText=i}i.innerText=t,Ta(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(oa(this.buttonText),this.buttonText=void 0)}}class Tm extends Zv.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,r){super(),(0,P.Z)(this,"popperDOM",void 0),(0,P.Z)(this,"contentDOM",void 0),(0,P.Z)(this,"button",void 0),(0,P.Z)(this,"option",void 0),(0,P.Z)(this,"isShow",!1),(0,P.Z)(this,"content",void 0),(0,P.Z)(this,"timeout",null),(0,P.Z)(this,"show",()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),Es(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&Tm.conflictPopperList.forEach(i=>{i!==this&&i.isShow&&i.hide()}),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick),this)),(0,P.Z)(this,"hide",()=>this.isShow?(Ta(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this),(0,P.Z)(this,"setHideTimeout",()=>{this.timeout||(this.timeout=window.setTimeout(()=>{this.isShow&&(this.hide(),this.timeout=null)},300))}),(0,P.Z)(this,"clearHideTimeout",()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)}),(0,P.Z)(this,"onBtnClick",()=>{this.isShow?this.hide():this.show()}),(0,P.Z)(this,"onPopperUnClick",i=>{Nf(i.target,[".l7-button-control",".l7-popper-content"])||this.hide()}),(0,P.Z)(this,"onBtnMouseLeave",()=>{this.setHideTimeout()}),(0,P.Z)(this,"onBtnMouseMove",()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=t,this.option=r,this.init(),r.unique&&Tm.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(sl(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}init(){const{trigger:t}=this.option;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),oa(this.popperDOM)}resetPopperPosition(){const t={},{container:r,offset:i=[0,0],placement:a}=this.option,[u,h]=i,m=this.button.getBoundingClientRect(),g=r.getBoundingClientRect(),{left:E,right:A,top:w,bottom:R}=ff(m,g);let U=!1,q=!1;/^(left|right)/.test(a)?(a.includes("left")?t.right=`${m.width+A}px`:a.includes("right")&&(t.left=`${m.width+E}px`),a.includes("start")?t.top=`${w}px`:a.includes("end")?t.bottom=`${R}px`:(t.top=`${w+m.height/2}px`,q=!0,t.transform=`translate(${u}px, calc(${h}px - 50%))`)):/^(top|bottom)/.test(a)&&(a.includes("top")?t.bottom=`${m.height+R}px`:a.includes("bottom")&&(t.top=`${m.height+w}px`),a.includes("start")?t.left=`${E}px`:a.includes("end")?t.right=`${A}px`:(t.left=`${E+m.width/2}px`,U=!0,t.transform=`translate(calc(${u}px - 50%), ${h}px)`)),t.transform=`translate(calc(${u}px - ${U?"50%":"0%"}), calc(${h}px - ${q?"50%":"0%"})`;const ce=a.split("-");ce.length&&Ta(this.popperDOM,ce.map(Se=>`l7-popper-${Se}`).join(" ")),al(this.popperDOM,ip(t))}createPopper(){const{container:t,className:r="",content:i}=this.option,a=Mi("div",`l7-popper l7-popper-hide ${r}`),u=Mi("div","l7-popper-content"),h=Mi("div","l7-popper-arrow");return a.appendChild(u),a.appendChild(h),t.appendChild(a),this.popperDOM=a,this.contentDOM=u,i&&this.setContent(i),a}}(0,P.Z)(Tm,"conflictPopperList",[]);const x2={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"};class E2 extends jv{constructor(...t){super(...t),(0,P.Z)(this,"popper",void 0)}getPopper(){return this.popper}hide(){this.popper.hide(),super.hide()}getDefault(t){var r;const i=super.getDefault(t),a=(r=t==null?void 0:t.position)!==null&&r!==void 0?r:i.position;return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{popperPlacement:a instanceof Element?"bottom":x2[a],popperTrigger:"click"})}onAdd(){const t=super.onAdd();return this.initPopper(),t}onRemove(){this.popper.destroy()}initPopper(){const{popperClassName:t,popperPlacement:r,popperTrigger:i}=this.controlOption,a=this.mapsService.getMapContainer();return this.popper=new Tm(this.button,{className:t,placement:r,trigger:i,container:a,unique:!0}),this.popper.on("show",()=>{this.emit("popperShow",this)}).on("hide",()=>{this.emit("popperHide",this)}),this.popper}setOptions(t){if(super.setOptions(t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){const r=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(r)}}}var zp=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(zp||{});class Ng extends E2{constructor(...t){super(...t),(0,P.Z)(this,"selectValue",[]),(0,P.Z)(this,"optionDOMList",void 0),(0,P.Z)(this,"createNormalOption",r=>{const i=this.selectValue.includes(r.value),a=Mi("div",`l7-select-control-item ${i?zp.ActiveOptionClassName:""}`);this.getIsMultiple()?a.appendChild(this.createCheckbox(i)):a.appendChild(this.createRadio(i)),r.icon&&a.appendChild(r.icon);const u=Mi("span");return u.innerText=r.text,a.appendChild(u),a}),(0,P.Z)(this,"onItemClick",r=>{if(this.getIsMultiple()){const i=this.selectValue.findIndex(a=>a===r.value);i>-1?this.selectValue.splice(i,1):this.selectValue=[...this.selectValue,r.value]}else this.selectValue=[r.value];this.setSelectValue(this.selectValue)})}setOptions(t){super.setOptions(t);const{options:r}=t;r&&this.popper.setContent(this.getPopperContent(r))}onAdd(){const t=super.onAdd(),{defaultValue:r}=this.controlOption;return r&&(this.selectValue=this.transSelectValue(r)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}getSelectValue(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}setSelectValue(t,r=!0){const i=this.transSelectValue(t);this.optionDOMList.forEach(a=>{const u=a.getAttribute(zp.OptionValueAttrKey),h=a.querySelector("input[type=checkbox]"),m=a.querySelector("input[type=radio]"),g=i.includes(u),E=(A,w)=>{wl(a,zp.ActiveOptionClassName,w),A&&Lc(A,w)};E(h,g),E(m,g)}),this.selectValue=i,r&&this.emit("selectChange",this.getIsMultiple()?i:i[0])}getIsMultiple(){return!1}getPopperContent(t){const r=this.isImageOptions(),i=Mi("div",r?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Ta(i,"l7-select-control--multiple");const a=t.map((u,h)=>{const m=r?this.createImageOption(u):this.createNormalOption(u);return m.setAttribute(zp.OptionValueAttrKey,u.value),m.setAttribute(zp.OptionIndexAttrKey,window.String(h)),m.addEventListener("click",this.onItemClick.bind(this,u)),m});return i.append(...a),this.optionDOMList=a,i}createImageOption(t){const r=this.selectValue.includes(t.value),i=Mi("div",`l7-select-control-item ${r?zp.ActiveOptionClassName:""}`),a=Mi("img");a.setAttribute("src",t.img),Bf(a),i.appendChild(a);const u=Mi("div","l7-select-control-item-row");this.getIsMultiple()&&i.appendChild(this.createCheckbox(r));const h=Mi("span");return h.innerText=t.text,u.appendChild(h),i.appendChild(u),i}createCheckbox(t){const r=Mi("input");return r.setAttribute("type","checkbox"),t&&Lc(r,!0),r}createRadio(t){const r=Mi("input");return r.setAttribute("type","radio"),t&&Lc(r,!0),r}isImageOptions(){return!!this.controlOption.options.find(t=>t.img)}transSelectValue(t){return Array.isArray(t)?t:[t]}}const oh=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");const r=document.createElementNS("http://www.w3.org/2000/svg","use");return r.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${e}`),t.appendChild(r),t};class b2 extends jv{constructor(...t){var r;super(...t),r=this,(0,P.Z)(this,"onClick",(0,Yt.Z)(function*(){const{onExport:i}=r.controlOption;i==null||i(yield r.getImage())})),(0,P.Z)(this,"mergeImage",(0,Yt.Z)(function*(...i){var a,u;const{imageType:h}=r.controlOption,{width:m=0,height:g=0}=(a=(u=r.mapsService.getContainer())===null||u===void 0?void 0:u.getBoundingClientRect())!==null&&a!==void 0?a:{},E=document.createElement("canvas");E.width=m,E.height=g;const A=E.getContext("2d");return(yield Promise.all(i.map(R=>new Promise(U=>{const q=new Image;q.onload=()=>{U(q)},q.src=R})))).forEach(R=>{A==null||A.drawImage(R,0,0,m,g)}),E.toDataURL(`image/${h}`)}))}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),t}getDefault(t){return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:oh("l7-icon-export-picture"),imageType:"png"})}getImage(){var t=this;return(0,Yt.Z)(function*(){const r=yield t.mapsService.exportMap("png"),i=yield t.scene.exportPng("png");return t.mergeImage(...[r,i].filter(a=>a))})()}}const kg=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],ah=(()=>{if(typeof document=="undefined")return!1;const e=kg[0],t={};for(const r of kg)if((r==null?void 0:r[1])in document){for(const[a,u]of r.entries())t[e[a]]=u;return t}return!1})(),Ug={change:ah.fullscreenchange,error:ah.fullscreenerror};let Zl={request(e=document.documentElement,t){return new Promise((r,i)=>{const a=()=>{Zl.off("change",a),r()};Zl.on("change",a);const u=e[ah.requestFullscreen](t);u instanceof Promise&&u.then(a).catch(i)})},exit(){return new Promise((e,t)=>{if(!Zl.isFullscreen){e();return}const r=()=>{Zl.off("change",r),e()};Zl.on("change",r);const i=document[ah.exitFullscreen]();i instanceof Promise&&i.then(r).catch(t)})},toggle(e,t){return Zl.isFullscreen?Zl.exit():Zl.request(e,t)},onchange(e){Zl.on("change",e)},onerror(e){Zl.on("error",e)},on(e,t){const r=Ug[e];r&&document.addEventListener(r,t,!1)},off(e,t){const r=Ug[e];r&&document.removeEventListener(r,t,!1)},raw:ah};Object.defineProperties(Zl,{isFullscreen:{get:()=>!!document[ah.fullscreenElement]},element:{enumerable:!0,get:()=>{var e;return(e=document[ah.fullscreenElement])!==null&&e!==void 0?e:void 0}},isEnabled:{enumerable:!0,get:()=>!!document[ah.fullscreenEnabled]}}),ah||(Zl={isEnabled:!1});var i_=Zl;class S2 extends jv{constructor(t){var r;super(t),r=this,(0,P.Z)(this,"isFullscreen",!1),(0,P.Z)(this,"mapContainer",void 0),(0,P.Z)(this,"toggleFullscreen",(0,Yt.Z)(function*(){i_.isEnabled&&(yield i_.toggle(r.mapContainer))})),(0,P.Z)(this,"onClick",()=>{this.toggleFullscreen()}),(0,P.Z)(this,"onFullscreenChange",()=>{this.isFullscreen=!!document.fullscreenElement;const{btnText:i,btnIcon:a,title:u,exitBtnText:h,exitBtnIcon:m,exitTitle:g}=this.controlOption;this.isFullscreen?(this.setBtnTitle(g),this.setBtnText(h),this.setBtnIcon(m)):(this.setBtnTitle(u),this.setBtnText(i),this.setBtnIcon(a)),this.emit("fullscreenChange",this.isFullscreen)}),i_.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316")}setOptions(t){const{exitBtnText:r,exitBtnIcon:i,exitTitle:a}=t;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(r),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(a)),super.setOptions(t)}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),this.mapContainer=_h(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}onRemove(){super.onRemove(),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}getDefault(t){return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{title:"\u5168\u5C4F",btnIcon:oh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:oh("l7-icon-exit-fullscreen")})}}class A2 extends jv{constructor(t){var r;super(t),r=this,(0,P.Z)(this,"getGeoLocation",()=>new Promise((i,a)=>{window.navigator.geolocation.getCurrentPosition(({coords:u})=>{const{longitude:h,latitude:m}=u!=null?u:{};!isNaN(h)&&!isNaN(m)?i([h,m]):a()},u=>{a(u)})})),(0,P.Z)(this,"onClick",(0,Yt.Z)(function*(){if(!window.navigator.geolocation)return;const{transform:i}=r.controlOption,a=yield r.getGeoLocation(),u=r.mapsService.getZoom();r.mapsService.setZoomAndCenter(u>15?u:15,i?yield i(a):a)})),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D")}getDefault(t){return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{title:"\u5B9A\u4F4D",btnIcon:oh("l7-icon-reposition")})}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),t}}function zg(e){return Object.keys(e!=null?e:{}).every(t=>["layer","name","img"].includes(t))}class Vg extends Ng{constructor(...t){super(...t),(0,P.Z)(this,"onLayerChange",()=>{var r;(r=this.controlOption.layers)!==null&&r!==void 0&&r.length||(this.selectValue=this.getLayerVisible(),this.setOptions({options:this.getLayerOptions()}))}),(0,P.Z)(this,"onLayerVisibleChane",()=>{this.setSelectValue(this.getLayerVisible())}),(0,P.Z)(this,"onSelectChange",()=>{this.layers.forEach(r=>{const i=this.selectValue.includes(r.name),a=r.isVisible();i&&!a&&r.show(),!i&&a&&r.hide()})})}get layers(){const t=this.layerService,{layers:r}=this.controlOption;if(Array.isArray(r)&&r.length){const i=[];return r.forEach(a=>{if(a instanceof Object&&(zg(a)?i.push(a.layer):i.push(a)),typeof a=="string"){const u=t.getLayer(a)||t.getLayerByName(a);u&&i.push(u)}}),i}return t.getLayers()||[]}getDefault(t){var r;return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:oh("l7-icon-layer"),options:[],multiple:(r=t==null?void 0:t.multiple)!==null&&r!==void 0?r:!0})}getLayerVisible(){return this.layers.filter(t=>t.isVisible()).map(t=>t.name)}getLayerOptions(){const{layers:t}=this.controlOption,r=t==null?void 0:t.every(i=>i.img);return t?t==null?void 0:t.map(i=>{if(zg(i))return{text:i.name||i.layer.name,value:i.layer.name,img:r?i.img:void 0};if(typeof i=="string"){const a=this.layerService.getLayer(i)||this.layerService.getLayerByName(i);return{text:a==null?void 0:a.name,value:a==null?void 0:a.name}}return{text:i.name,value:i.name}}):this.layers.map(i=>({text:i.name,value:i.name}))}setOptions(t){const r=this.checkUpdateOption(t,["layers","multiple"]);super.setOptions(t),r&&(this.controlOption.multiple===!1&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}handleSingleSelection(){this.layers.forEach((t,r)=>{r===0?t.show():t.hide()})}onAdd(){var t;return this.controlOption.multiple===!1&&this.handleSingleSelection(),(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),super.onAdd()}onRemove(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}getIsMultiple(){return this.controlOption.multiple}}class Zg extends ih{getDefault(){return{position:Ye.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const t=Mi("div","l7-control-logo");return this.setLogoContent(t),t}onRemove(){return null}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["img","href"])&&(sl(this.container),this.setLogoContent(this.container))}setLogoContent(t){const{href:r,img:i}=this.controlOption,a=Mi("img");if(a.setAttribute("src",i),a.setAttribute("aria-label","AntV logo"),Bf(a),r){const u=Mi("a","l7-control-logo-link");u.target="_blank",u.href=r,u.rel="noopener nofollow",u.setAttribute("rel","noopener nofollow"),u.appendChild(a),t.appendChild(u)}else t.appendChild(a)}}const T2={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},C2={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};class w2 extends Ng{constructor(...t){super(...t),(0,P.Z)(this,"onMapThemeChange",()=>{this.mapsService.setMapStyle(this.selectValue[0])})}getDefault(t){return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:oh("l7-icon-color"),options:[]})}getStyleOptions(){const t=this.mapsService.getType()==="mapbox"?C2:T2;return Object.entries(this.mapsService.getMapStyleConfig()).filter(([r,i])=>typeof i=="string"&&r!=="blank").map(([r,i])=>{var a;const{text:u,img:h}=(a=t[r])!==null&&a!==void 0?a:{};return{text:u!=null?u:r,value:i,img:h,key:r}})}getMapStyle(){return this.mapsService.getMapStyle()}onAdd(){var t;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i;const a=this.controlOption.defaultValue;this.controlOption.defaultValue=(r=(i=this.controlOption.options.find(u=>u.key===a))===null||i===void 0?void 0:i.value)!==null&&r!==void 0?r:a}else{const a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",()=>{const u=this.mapsService.getMapStyle();this.controlOption.defaultValue=u,this.setSelectValue(u,!1)})}return this.on("selectChange",this.onMapThemeChange),super.onAdd()}getIsMultiple(){return!1}}class R2 extends ih{constructor(...t){super(...t),(0,P.Z)(this,"location",[0,0]),(0,P.Z)(this,"onMouseMove",r=>{let i=this.location;const a=r.lngLat||r.lnglat,{transform:u}=this.controlOption;a&&(i=[a.lng,a.lat]),this.location=i,u&&(i=u(i)),this.insertLocation2HTML(i),this.emit("locationChange",i)})}getLocation(){return this.location}getDefault(t){return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{position:Ye.BOTTOMLEFT,transform:([r,i])=>[+(+r).toFixed(6),+(+i).toFixed(6)]})}onAdd(){const t=Mi("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}onRemove(){this.mapsService.off("mousemove",this.onMouseMove)}insertLocation2HTML(t){this.container.innerText=t.join(", ")}}class M2 extends ih{constructor(...t){super(...t),(0,P.Z)(this,"mScale",void 0),(0,P.Z)(this,"iScale",void 0),(0,P.Z)(this,"update",()=>{const r=this.mapsService,{maxWidth:i}=this.controlOption,a=r.getSize()[1]/2,u=r.containerToLngLat([0,a]),h=r.containerToLngLat([i,a]),m=rc([u.lng,u.lat],[h.lng,h.lat]);this.updateScales(m)})}getDefault(t){return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{name:"scale",position:Ye.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){const r=Mi("div","l7-control-scale");this.resetScaleLines(r);const{updateWhenIdle:i}=this.controlOption;return this.mapsService.on(i?"moveend":"mapmove",this.update),this.mapsService.on(i?"zoomend":"zoomchange",this.update),r}onRemove(){const{updateWhenIdle:t}=this.controlOption;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}updateScales(t){const{metric:r,imperial:i}=this.controlOption;r&&t&&this.updateMetric(t),i&&t&&this.updateImperial(t)}resetScaleLines(t){sl(t);const{metric:r,imperial:i,maxWidth:a,lockWidth:u}=this.controlOption;u&&al(t,`width: ${a}px`),r&&(this.mScale=Mi("div","l7-control-scale-line",t)),i&&(this.iScale=Mi("div","l7-control-scale-line",t)),this.update()}updateScale(t,r,i){const{maxWidth:a}=this.controlOption;t.style.width=Math.round(a*i)+"px",t.innerHTML=r}getRoundNum(t){const r=Math.pow(10,(Math.floor(t)+"").length-1);let i=t/r;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,r*i}updateMetric(t){const r=this.getRoundNum(t),i=r<1e3?r+" m":r/1e3+" km";this.updateScale(this.mScale,i,r/t)}updateImperial(t){const r=t*3.2808399;let i,a,u;r>5280?(i=r/5280,a=this.getRoundNum(i),this.updateScale(this.iScale,a+" mi",a/i)):(u=this.getRoundNum(r),this.updateScale(this.iScale,u+" ft",u/r))}}var jg=N(15085);const{cloneDeep:I2}=Yn;class P2{constructor(){(0,P.Z)(this,"mapService",void 0),(0,P.Z)(this,"fontService",void 0)}apply(t,{styleAttributeService:r,mapService:i,fontService:a}){var u=this;this.mapService=i,this.fontService=a,t.hooks.init.tapPromise("DataMappingPlugin",(0,Yt.Z)(function*(){t.log(Et.MappingStart,$r.INIT),u.generateMaping(t,{styleAttributeService:r}),t.log(Et.MappingEnd,$r.INIT)})),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var h=(0,Yt.Z)(function*(m){if(!m)return m;t.dataState.dataMappingNeedUpdate=!1,t.log(Et.MappingStart,$r.UPDATE);const g=u.generateMaping(t,{styleAttributeService:r});return t.log(Et.MappingEnd,$r.UPDATE),g});return function(m){return h.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",()=>{const h=t.getSource();if(t.layerModelNeedUpdate||!h||!h.inited)return;const m=r.getLayerStyleAttributes()||[],g=r.getLayerStyleAttribute("filter"),{dataArray:E}=h.data;if(Array.isArray(E)&&E.length===0)return;const A=m.filter(R=>R.needRemapping);let w=E;if(g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(w=E.filter(R=>this.applyAttributeMapping(g,R)[0])),A.length){const R=this.mapping(t,A,w,t.getEncodedData());t.setEncodedData(R)}})}generateMaping(t,{styleAttributeService:r}){const i=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),{dataArray:u}=t.getSource().data;let h=u;a!=null&&a.scale&&(h=u.filter(g=>this.applyAttributeMapping(a,g)[0])),h=t.processData(h);const m=this.mapping(t,i,h,void 0);return t.setEncodedData(m),t.emit("dataUpdate",null),!0}mapping(t,r,i,a){const u=r.filter(m=>m.scale!==void 0).filter(m=>m.name!=="filter"),h=i.map((m,g)=>{const E=a?a[g]:{},A=(0,lt.Z)({id:m._id,coordinates:m.coordinates},E);return u.forEach(w=>{let R=this.applyAttributeMapping(w,m);(w.name==="color"||w.name==="stroke")&&(R=R.map(U=>ai(U))),A[w.name]=Array.isArray(R)&&R.length===1?R[0]:R,w.name==="shape"&&(A.shape=this.fontService.getIconFontKey(A[w.name]))}),A});return r.forEach(m=>{m.needRemapping=!1}),this.adjustData2Amap2Coordinates(h,t),this.adjustData2SimpleCoordinates(h),h}adjustData2Amap2Coordinates(t,r){if(t.length>0&&this.mapService.version==="GAODE2.x"){const i=r.coordCenter||r.getSource().center;t.filter(a=>!a.originCoordinates).map(a=>{a.version="GAODE2.x",a.originCoordinates=I2(a.coordinates),a.coordinates=this.mapService.coordToAMap2RelativeCoordinates(a.coordinates,i)})}}adjustData2SimpleCoordinates(t){t.length>0&&this.mapService.version==="SIMPLE"&&t.map(r=>{r.simpleCoordinate||(r.coordinates=this.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}unProjectCoordinates(t){if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){const r=[];return t.map(i=>{const a=[];i.map(u=>{a.push(this.mapService.simpleMapCoord.unproject(u))}),r.push(a)}),r}else{const r=[];return t.map(i=>{r.push(this.mapService.simpleMapCoord.unproject(i))}),r}}applyAttributeMapping(t,r){var i;if(!t.scale)return[];const a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],u=[];return a.forEach(({field:m})=>{var g;(r.hasOwnProperty(m)||((g=t.scale)===null||g===void 0?void 0:g.type)==="variable")&&u.push(r[m])}),t.mapping?t.mapping(u):[]}getArrowPoints(t,r){const i=[r[0]-t[0],r[1]-t[1]],a=ju(i);return[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4]}}class O2{constructor(){(0,P.Z)(this,"mapService",void 0)}apply(t){var r=this;this.mapService=t.getContainer().mapService,t.hooks.init.tapPromise("DataSourcePlugin",(0,Yt.Z)(function*(){t.log(Et.SourceInitStart,$r.INIT);let i=t.getSource();if(!i){const{data:a,options:u}=t.sourceOption||t.defaultSourceConfig;i=new v2(a,u),t.setSource(i)}i.inited?(r.updateClusterData(t),t.log(Et.SourceInitEnd,$r.INIT)):yield new Promise(a=>{i.on("update",u=>{u.type==="inited"&&(r.updateClusterData(t),t.log(Et.SourceInitEnd,$r.INIT)),a(null)})})})),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Yt.Z)(function*(){const i=r.updateClusterData(t),a=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||a}))}updateClusterData(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;const r=t.getSource(),i=r.cluster,{zoom:a=0}=r.clusterOptions,u=this.mapService.getZoom()-1,h=t.dataState.dataSourceNeedUpdate;return i&&h&&r.updateClusterData(Math.floor(u)),i&&Math.abs(t.clusterZoom-u)>=1?(a!==Math.floor(u)&&r.updateClusterData(Math.floor(u)),t.clusterZoom=u,!0):!1}}var D2=N(64599),Hg=N.n(D2);function Wg(e,t){var r,i;if(t===void 0){var a=Hg()(e),u;try{for(a.s();!(u=a.n()).done;){var h=u.value;h!=null&&(r===void 0?h>=h&&(r=i=h):(r>h&&(r=h),i<h&&(i=h)))}}catch(w){a.e(w)}finally{a.f()}}else{var m=-1,g=Hg()(e),E;try{for(g.s();!(E=g.n()).done;){var A=E.value;(A=t(A,++m,e))!=null&&(r===void 0?A>=A&&(r=i=A):(r>A&&(r=A),i<A&&(i=A)))}}catch(w){g.e(w)}finally{g.f()}}return[r,i]}var o_=N(88124);function a_(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Gg(e){return e.length===1&&(e=L2(e)),{left:function(t,r,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var u=i+a>>>1;e(t[u],r)<0?i=u+1:a=u}return i},right:function(t,r,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var u=i+a>>>1;e(t[u],r)>0?a=u:i=u+1}return i}}}function L2(e){return function(t,r){return a_(e(t),r)}}var Xg=Gg(a_),F2=Xg.right,hO=Xg.left,Hv=F2,Yg=Array.prototype,pO=Yg.slice,dO=Yg.map,s_=Math.sqrt(50),u_=Math.sqrt(10),l_=Math.sqrt(2);function qg(e,t,r){var i,a=-1,u,h,m;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((i=t<e)&&(u=e,e=t,t=u),(m=Wv(e,t,r))===0||!isFinite(m))return[];if(m>0)for(e=Math.ceil(e/m),t=Math.floor(t/m),h=new Array(u=Math.ceil(t-e+1));++a<u;)h[a]=(e+a)*m;else for(e=Math.floor(e*m),t=Math.ceil(t*m),h=new Array(u=Math.ceil(e-t+1));++a<u;)h[a]=(e-a)/m;return i&&h.reverse(),h}function Wv(e,t,r){var i=(t-e)/Math.max(0,r),a=Math.floor(Math.log(i)/Math.LN10),u=i/Math.pow(10,a);return a>=0?(u>=s_?10:u>=u_?5:u>=l_?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(u>=s_?10:u>=u_?5:u>=l_?2:1)}function c_(e,t,r){var i=Math.abs(t-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),u=i/a;return u>=s_?a*=10:u>=u_?a*=5:u>=l_&&(a*=2),t<e?-a:a}function mO(){var e=identity,t=extent,r=sturges;function i(a){var u,h=a.length,m,g=new Array(h);for(u=0;u<h;++u)g[u]=e(a[u],u,a);var E=t(g),A=E[0],w=E[1],R=r(g,A,w);Array.isArray(R)||(R=tickStep(A,w,R),R=range(Math.ceil(A/R)*R,w,R));for(var U=R.length;R[0]<=A;)R.shift(),--U;for(;R[U-1]>w;)R.pop(),--U;var q=new Array(U+1),ce;for(u=0;u<=U;++u)ce=q[u]=[],ce.x0=u>0?R[u-1]:A,ce.x1=u<U?R[u]:w;for(u=0;u<h;++u)m=g[u],A<=m&&m<=w&&q[bisect(R,m,0,U)].push(a[u]);return q}return i.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),i):e},i.domain=function(a){return arguments.length?(t=typeof a=="function"?a:constant([a[0],a[1]]),i):t},i.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),i):r},i}function vO(e,t,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-t)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function B2(e){return e===null?NaN:+e}function N2(e,t,r){if(r==null&&(r=B2),!!(i=e.length)){if((t=+t)<=0||i<2)return+r(e[0],0,e);if(t>=1)return+r(e[i-1],i-1,e);var i,a=(i-1)*t,u=Math.floor(a),h=+r(e[u],u,e),m=+r(e[u+1],u+1,e);return h+(m-h)*(a-u)}}var Sc="$";function Gv(){}Gv.prototype=Kg.prototype={constructor:Gv,has:function(e){return Sc+e in this},get:function(e){return this[Sc+e]},set:function(e,t){return this[Sc+e]=t,this},remove:function(e){var t=Sc+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Sc&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Sc&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Sc&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Sc&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Sc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Sc)return!1;return!0},each:function(e){for(var t in this)t[0]===Sc&&e(this[t],t.slice(1),this)}};function Kg(e,t){var r=new Gv;if(e instanceof Gv)e.each(function(m,g){r.set(g,m)});else if(Array.isArray(e)){var i=-1,a=e.length,u;if(t==null)for(;++i<a;)r.set(i,e[i]);else for(;++i<a;)r.set(t(u=e[i],i,e),u)}else if(e)for(var h in e)r.set(h,e[h]);return r}var f_=Kg;function _O(){var e=[],t=[],r,i,a;function u(m,g,E,A){if(g>=e.length)return r!=null&&m.sort(r),i!=null?i(m):m;for(var w=-1,R=m.length,U=e[g++],q,ce,Se=map(),ke,Fe=E();++w<R;)(ke=Se.get(q=U(ce=m[w])+""))?ke.push(ce):Se.set(q,[ce]);return Se.each(function(rt,mt){A(Fe,mt,u(rt,g,E,A))}),Fe}function h(m,g){if(++g>e.length)return m;var E,A=t[g-1];return i!=null&&g>=e.length?E=m.entries():(E=[],m.each(function(w,R){E.push({key:R,values:h(w,g)})})),A!=null?E.sort(function(w,R){return A(w.key,R.key)}):E}return a={object:function(m){return u(m,0,k2,U2)},map:function(m){return u(m,0,$g,Qg)},entries:function(m){return h(u(m,0,$g,Qg),0)},key:function(m){return e.push(m),a},sortKeys:function(m){return t[e.length-1]=m,a},sortValues:function(m){return r=m,a},rollup:function(m){return i=m,a}}}function k2(){return{}}function U2(e,t,r){e[t]=r}function $g(){return map()}function Qg(e,t,r){e.set(t,r)}function Xv(){}var Vp=f_.prototype;Xv.prototype=z2.prototype={constructor:Xv,has:Vp.has,add:function(e){return e+="",this[Sc+e]=e,this},remove:Vp.remove,clear:Vp.clear,values:Vp.keys,size:Vp.size,empty:Vp.empty,each:Vp.each};function z2(e,t){var r=new Xv;if(e instanceof Xv)e.each(function(u){r.add(u)});else if(e){var i=-1,a=e.length;if(t==null)for(;++i<a;)r.add(e[i]);else for(;++i<a;)r.add(t(e[i],i,e))}return r}var gO=null,Jg=Array.prototype,ey=Jg.map,Zp=Jg.slice;function Wh(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ty(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var ry={name:"implicit"};function Yv(){var e=f_(),t=[],r=[],i=ry;function a(u){var h=u+"",m=e.get(h);if(!m){if(i!==ry)return i;e.set(h,m=t.push(u))}return r[(m-1)%r.length]}return a.domain=function(u){if(!arguments.length)return t.slice();t=[],e=f_();for(var h=-1,m=u.length,g,E;++h<m;)e.has(E=(g=u[h])+"")||e.set(E,t.push(g));return a},a.range=function(u){return arguments.length?(r=Zp.call(u),a):r.slice()},a.unknown=function(u){return arguments.length?(i=u,a):i},a.copy=function(){return Yv(t,r).unknown(i)},Wh.apply(a,arguments),a}function ny(){var e=ordinal().unknown(void 0),t=e.domain,r=e.range,i=[0,1],a,u,h=!1,m=0,g=0,E=.5;delete e.unknown;function A(){var w=t().length,R=i[1]<i[0],U=i[R-0],q=i[1-R];a=(q-U)/Math.max(1,w-m+g*2),h&&(a=Math.floor(a)),U+=(q-U-a*(w-m))*E,u=a*(1-m),h&&(U=Math.round(U),u=Math.round(u));var ce=sequence(w).map(function(Se){return U+a*Se});return r(R?ce.reverse():ce)}return e.domain=function(w){return arguments.length?(t(w),A()):t()},e.range=function(w){return arguments.length?(i=[+w[0],+w[1]],A()):i.slice()},e.rangeRound=function(w){return i=[+w[0],+w[1]],h=!0,A()},e.bandwidth=function(){return u},e.step=function(){return a},e.round=function(w){return arguments.length?(h=!!w,A()):h},e.padding=function(w){return arguments.length?(m=Math.min(1,g=+w),A()):m},e.paddingInner=function(w){return arguments.length?(m=Math.min(1,w),A()):m},e.paddingOuter=function(w){return arguments.length?(g=+w,A()):g},e.align=function(w){return arguments.length?(E=Math.max(0,Math.min(1,w)),A()):E},e.copy=function(){return ny(t(),i).round(h).paddingInner(m).paddingOuter(g).align(E)},initRange.apply(A(),arguments)}function iy(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return iy(t())},e}function yO(){return iy(ny.apply(null,arguments).paddingInner(1))}var oy=N(92504);function xO(e,t){return(isNumberArray(t)?numberArray:ay)(e,t)}function ay(e,t){var r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),u=new Array(r),h;for(h=0;h<i;++h)a[h]=d_(e[h],t[h]);for(;h<r;++h)u[h]=t[h];return function(m){for(h=0;h<i;++h)u[h]=a[h](m);return u}}function V2(e,t){var r=new Date;return e=+e,t=+t,function(i){return r.setTime(e*(1-i)+t*i),r}}function qv(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Z2(e,t){var r={},i={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=d_(e[a],t[a]):i[a]=t[a];return function(u){for(a in r)i[a]=r[a](u);return i}}var h_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,p_=new RegExp(h_.source,"g");function j2(e){return function(){return e}}function H2(e){return function(t){return e(t)+""}}function W2(e,t){var r=h_.lastIndex=p_.lastIndex=0,i,a,u,h=-1,m=[],g=[];for(e=e+"",t=t+"";(i=h_.exec(e))&&(a=p_.exec(t));)(u=a.index)>r&&(u=t.slice(r,u),m[h]?m[h]+=u:m[++h]=u),(i=i[0])===(a=a[0])?m[h]?m[h]+=a:m[++h]=a:(m[++h]=null,g.push({i:h,x:qv(i,a)})),r=p_.lastIndex;return r<t.length&&(u=t.slice(r),m[h]?m[h]+=u:m[++h]=u),m.length<2?g[0]?H2(g[0].x):j2(t):(t=g.length,function(E){for(var A=0,w;A<t;++A)m[(w=g[A]).i]=w.x(E);return m.join("")})}var G2=N(55302);function X2(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,i=t.slice(),a;return function(u){for(a=0;a<r;++a)i[a]=e[a]*(1-u)+t[a]*u;return i}}function Y2(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function d_(e,t){var r=typeof t,i;return t==null||r==="boolean"?(0,G2.Z)(t):(r==="number"?qv:r==="string"?(i=(0,oy.ZP)(t))?(t=i,o_.ZP):W2:t instanceof oy.ZP?o_.ZP:t instanceof Date?V2:Y2(t)?X2:Array.isArray(t)?ay:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Z2:qv)(e,t)}function q2(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function K2(e){return function(){return e}}function $2(e){return+e}var sy=[0,1];function Lu(e){return e}function m_(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:K2(isNaN(t)?NaN:.5)}function uy(e){var t=e[0],r=e[e.length-1],i;return t>r&&(i=t,t=r,r=i),function(a){return Math.max(t,Math.min(r,a))}}function Q2(e,t,r){var i=e[0],a=e[1],u=t[0],h=t[1];return a<i?(i=m_(a,i),u=r(h,u)):(i=m_(i,a),u=r(u,h)),function(m){return u(i(m))}}function J2(e,t,r){var i=Math.min(e.length,t.length)-1,a=new Array(i),u=new Array(i),h=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++h<i;)a[h]=m_(e[h],e[h+1]),u[h]=r(t[h],t[h+1]);return function(m){var g=Hv(e,m,1,i)-1;return u[g](a[g](m))}}function Kv(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function v_(){var e=sy,t=sy,r=d_,i,a,u,h=Lu,m,g,E;function A(){return m=Math.min(e.length,t.length)>2?J2:Q2,g=E=null,w}function w(R){return isNaN(R=+R)?u:(g||(g=m(e.map(i),t,r)))(i(h(R)))}return w.invert=function(R){return h(a((E||(E=m(t,e.map(i),qv)))(R)))},w.domain=function(R){return arguments.length?(e=ey.call(R,$2),h===Lu||(h=uy(e)),A()):e.slice()},w.range=function(R){return arguments.length?(t=Zp.call(R),A()):t.slice()},w.rangeRound=function(R){return t=Zp.call(R),r=q2,A()},w.clamp=function(R){return arguments.length?(h=R?uy(e):Lu,w):h!==Lu},w.interpolate=function(R){return arguments.length?(r=R,A()):r},w.unknown=function(R){return arguments.length?(u=R,w):u},function(R,U){return i=R,a=U,A()}}function ly(e,t){return v_()(e,t)}var eS=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $v(e){if(!(t=eS.exec(e)))throw new Error("invalid format: "+e);var t;return new __({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}$v.prototype=__.prototype;function __(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}__.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function tS(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Qv(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function wd(e){return e=Qv(Math.abs(e)),e?e[1]:NaN}function rS(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(wd(t)/3)))*3-wd(Math.abs(e)))}function nS(e,t){return function(r,i){for(var a=r.length,u=[],h=0,m=e[0],g=0;a>0&&m>0&&(g+m+1>i&&(m=Math.max(1,i-g)),u.push(r.substring(a-=m,a+m)),!((g+=m+1)>i));)m=e[h=(h+1)%e.length];return u.reverse().join(t)}}function iS(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}function oS(e){e:for(var t=e.length,r=1,i=-1,a;r<t;++r)switch(e[r]){case".":i=a=r;break;case"0":i===0&&(i=r),a=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(a+1):e}var cy;function aS(e,t){var r=Qv(e,t);if(!r)return e+"";var i=r[0],a=r[1],u=a-(cy=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,h=i.length;return u===h?i:u>h?i+new Array(u-h+1).join("0"):u>0?i.slice(0,u)+"."+i.slice(u):"0."+new Array(1-u).join("0")+Qv(e,Math.max(0,t+u-1))[0]}function fy(e,t){var r=Qv(e,t);if(!r)return e+"";var i=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}var hy={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:tS,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return fy(e*100,t)},r:fy,s:aS,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function py(e){return e}var dy=Array.prototype.map,vy=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function sS(e){var t=e.grouping===void 0||e.thousands===void 0?py:nS(dy.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?py:iS(dy.call(e.numerals,String)),h=e.percent===void 0?"%":e.percent+"",m=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function E(w){w=$v(w);var R=w.fill,U=w.align,q=w.sign,ce=w.symbol,Se=w.zero,ke=w.width,Fe=w.comma,rt=w.precision,mt=w.trim,er=w.type;er==="n"?(Fe=!0,er="g"):hy[er]||(rt===void 0&&(rt=12),mt=!0,er="g"),(Se||R==="0"&&U==="=")&&(Se=!0,R="0",U="=");var cr=ce==="$"?r:ce==="#"&&/[boxX]/.test(er)?"0"+er.toLowerCase():"",kt=ce==="$"?i:/[%p]/.test(er)?h:"",dr=hy[er],Pn=/[defgprs%]/.test(er);rt=rt===void 0?6:/[gprs]/.test(er)?Math.max(1,Math.min(21,rt)):Math.max(0,Math.min(20,rt));function _i(En){var fi=cr,Gi=kt,ou,Bu,bl;if(er==="c")Gi=dr(En)+Gi,En="";else{En=+En;var ep=En<0||1/En<0;if(En=isNaN(En)?g:dr(Math.abs(En),rt),mt&&(En=oS(En)),ep&&+En==0&&q!=="+"&&(ep=!1),fi=(ep?q==="("?q:m:q==="-"||q==="("?"":q)+fi,Gi=(er==="s"?vy[8+cy/3]:"")+Gi+(ep&&q==="("?")":""),Pn){for(ou=-1,Bu=En.length;++ou<Bu;)if(bl=En.charCodeAt(ou),48>bl||bl>57){Gi=(bl===46?a+En.slice(ou+1):En.slice(ou))+Gi,En=En.slice(0,ou);break}}}Fe&&!Se&&(En=t(En,1/0));var tp=fi.length+En.length+Gi.length,Hl=tp<ke?new Array(ke-tp+1).join(R):"";switch(Fe&&Se&&(En=t(Hl+En,Hl.length?ke-Gi.length:1/0),Hl=""),U){case"<":En=fi+En+Gi+Hl;break;case"=":En=fi+Hl+En+Gi;break;case"^":En=Hl.slice(0,tp=Hl.length>>1)+fi+En+Gi+Hl.slice(tp);break;default:En=Hl+fi+En+Gi;break}return u(En)}return _i.toString=function(){return w+""},_i}function A(w,R){var U=E((w=$v(w),w.type="f",w)),q=Math.max(-8,Math.min(8,Math.floor(wd(R)/3)))*3,ce=Math.pow(10,-q),Se=vy[8+q/3];return function(ke){return U(ce*ke)+Se}}return{format:E,formatPrefix:A}}var Jv,g_,_y;uS({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function uS(e){return Jv=sS(e),g_=Jv.format,_y=Jv.formatPrefix,Jv}function lS(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,wd(t)-wd(e))+1}function cS(e){return Math.max(0,-wd(Math.abs(e)))}function fS(e,t,r,i){var a=c_(e,t,r),u;switch(i=$v(i==null?",f":i),i.type){case"s":{var h=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(u=rS(a,h))&&(i.precision=u),_y(i,h)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(u=lS(a,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=u-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(u=cS(a))&&(i.precision=u-(i.type==="%")*2);break}}return g_(i)}function Cm(e){var t=e.domain;return e.ticks=function(r){var i=t();return qg(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var a=t();return fS(a[0],a[a.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=t(),a=0,u=i.length-1,h=i[a],m=i[u],g;return m<h&&(g=h,h=m,m=g,g=a,a=u,u=g),g=Wv(h,m,r),g>0?(h=Math.floor(h/g)*g,m=Math.ceil(m/g)*g,g=Wv(h,m,r)):g<0&&(h=Math.ceil(h*g)/g,m=Math.floor(m*g)/g,g=Wv(h,m,r)),g>0?(i[a]=Math.floor(h/g)*g,i[u]=Math.ceil(m/g)*g,t(i)):g<0&&(i[a]=Math.ceil(h*g)/g,i[u]=Math.floor(m*g)/g,t(i)),e},e}function gy(){var e=ly(Lu,Lu);return e.copy=function(){return Kv(e,gy())},Wh.apply(e,arguments),Cm(e)}function hS(e){var t;function r(i){return isNaN(i=+i)?t:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=map.call(i,number),r):e.slice()},r.unknown=function(i){return arguments.length?(t=i,r):t},r.copy=function(){return hS(e).unknown(t)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function yy(e,t){e=e.slice();var r=0,i=e.length-1,a=e[r],u=e[i],h;return u<a&&(h=r,r=i,i=h,h=a,a=u,u=h),e[r]=t.floor(a),e[i]=t.ceil(u),e}function xy(e){return Math.log(e)}function Ey(e){return Math.exp(e)}function pS(e){return-Math.log(-e)}function dS(e){return-Math.exp(-e)}function mS(e){return isFinite(e)?+("1e"+e):e<0?0:e}function vS(e){return e===10?mS:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function _S(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function by(e){return function(t){return-e(-t)}}function gS(e){var t=e(xy,Ey),r=t.domain,i=10,a,u;function h(){return a=_S(i),u=vS(i),r()[0]<0?(a=by(a),u=by(u),e(pS,dS)):e(xy,Ey),t}return t.base=function(m){return arguments.length?(i=+m,h()):i},t.domain=function(m){return arguments.length?(r(m),h()):r()},t.ticks=function(m){var g=r(),E=g[0],A=g[g.length-1],w;(w=A<E)&&(R=E,E=A,A=R);var R=a(E),U=a(A),q,ce,Se,ke=m==null?10:+m,Fe=[];if(!(i%1)&&U-R<ke){if(R=Math.round(R)-1,U=Math.round(U)+1,E>0){for(;R<U;++R)for(ce=1,q=u(R);ce<i;++ce)if(Se=q*ce,!(Se<E)){if(Se>A)break;Fe.push(Se)}}else for(;R<U;++R)for(ce=i-1,q=u(R);ce>=1;--ce)if(Se=q*ce,!(Se<E)){if(Se>A)break;Fe.push(Se)}}else Fe=qg(R,U,Math.min(U-R,ke)).map(u);return w?Fe.reverse():Fe},t.tickFormat=function(m,g){if(g==null&&(g=i===10?".0e":","),typeof g!="function"&&(g=g_(g)),m===1/0)return g;m==null&&(m=10);var E=Math.max(1,i*m/t.ticks().length);return function(A){var w=A/u(Math.round(a(A)));return w*i<i-.5&&(w*=i),w<=E?g(A):""}},t.nice=function(){return r(yy(r(),{floor:function(m){return u(Math.floor(a(m)))},ceil:function(m){return u(Math.ceil(a(m)))}}))},t}function Sy(){var e=gS(v_()).domain([1,10]);return e.copy=function(){return Kv(e,Sy()).base(e.base())},Wh.apply(e,arguments),e}function Ay(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Ty(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function yS(e){var t=1,r=e(Ay(t),Ty(t));return r.constant=function(i){return arguments.length?e(Ay(t=+i),Ty(t)):t},linearish(r)}function xS(){var e=yS(transformer());return e.copy=function(){return copy(e,xS()).constant(e.constant())},initRange.apply(e,arguments)}function Cy(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ES(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function bS(e){return e<0?-e*e:e*e}function SS(e){var t=e(Lu,Lu),r=1;function i(){return r===1?e(Lu,Lu):r===.5?e(ES,bS):e(Cy(r),Cy(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,i()):r},Cm(t)}function y_(){var e=SS(v_());return e.copy=function(){return Kv(e,y_()).exponent(e.exponent())},Wh.apply(e,arguments),e}function EO(){return y_.apply(null,arguments).exponent(.5)}function wy(){var e=[],t=[],r=[],i;function a(){var h=0,m=Math.max(1,t.length);for(r=new Array(m-1);++h<m;)r[h-1]=N2(e,h/m);return u}function u(h){return isNaN(h=+h)?i:t[Hv(r,h)]}return u.invertExtent=function(h){var m=t.indexOf(h);return m<0?[NaN,NaN]:[m>0?r[m-1]:e[0],m<r.length?r[m]:e[e.length-1]]},u.domain=function(h){if(!arguments.length)return e.slice();e=[];for(var m=0,g=h.length,E;m<g;++m)E=h[m],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(a_),a()},u.range=function(h){return arguments.length?(t=Zp.call(h),a()):t.slice()},u.unknown=function(h){return arguments.length?(i=h,u):i},u.quantiles=function(){return r.slice()},u.copy=function(){return wy().domain(e).range(t).unknown(i)},Wh.apply(u,arguments)}function Ry(){var e=0,t=1,r=1,i=[.5],a=[0,1],u;function h(g){return g<=g?a[Hv(i,g,0,r)]:u}function m(){var g=-1;for(i=new Array(r);++g<r;)i[g]=((g+1)*t-(g-r)*e)/(r+1);return h}return h.domain=function(g){return arguments.length?(e=+g[0],t=+g[1],m()):[e,t]},h.range=function(g){return arguments.length?(r=(a=Zp.call(g)).length-1,m()):a.slice()},h.invertExtent=function(g){var E=a.indexOf(g);return E<0?[NaN,NaN]:E<1?[e,i[0]]:E>=r?[i[r-1],t]:[i[E-1],i[E]]},h.unknown=function(g){return arguments.length&&(u=g),h},h.thresholds=function(){return i.slice()},h.copy=function(){return Ry().domain([e,t]).range(a).unknown(u)},Wh.apply(Cm(h),arguments)}function My(){var e=[.5],t=[0,1],r,i=1;function a(u){return u<=u?t[Hv(e,u,0,i)]:r}return a.domain=function(u){return arguments.length?(e=Zp.call(u),i=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(u){return arguments.length?(t=Zp.call(u),i=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(u){var h=t.indexOf(u);return[e[h-1],e[h]]},a.unknown=function(u){return arguments.length?(r=u,a):r},a.copy=function(){return My().domain(e).range(t).unknown(r)},Wh.apply(a,arguments)}var x_=new Date,E_=new Date;function Ku(e,t,r,i){function a(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return a.floor=function(u){return e(u=new Date(+u)),u},a.ceil=function(u){return e(u=new Date(u-1)),t(u,1),e(u),u},a.round=function(u){var h=a(u),m=a.ceil(u);return u-h<m-u?h:m},a.offset=function(u,h){return t(u=new Date(+u),h==null?1:Math.floor(h)),u},a.range=function(u,h,m){var g=[],E;if(u=a.ceil(u),m=m==null?1:Math.floor(m),!(u<h)||!(m>0))return g;do g.push(E=new Date(+u)),t(u,m),e(u);while(E<u&&u<h);return g},a.filter=function(u){return Ku(function(h){if(h>=h)for(;e(h),!u(h);)h.setTime(h-1)},function(h,m){if(h>=h)if(m<0)for(;++m<=0;)for(;t(h,-1),!u(h););else for(;--m>=0;)for(;t(h,1),!u(h););})},r&&(a.count=function(u,h){return x_.setTime(+u),E_.setTime(+h),e(x_),e(E_),Math.floor(r(x_,E_))},a.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?a.filter(i?function(h){return i(h)%u===0}:function(h){return a.count(0,h)%u===0}):a}),a}var b_=Ku(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});b_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ku(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};var Rd=b_,bO=b_.range,Iy=Ku(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),AS=Iy,SO=Iy.range,e0=1e3,wm=6e4,Py=36e5,Oy=864e5,Dy=6048e5;function jp(e){return Ku(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*wm)/Dy})}var S_=jp(0),t0=jp(1),TS=jp(2),CS=jp(3),Md=jp(4),wS=jp(5),RS=jp(6),AO=S_.range,TO=t0.range,CO=TS.range,wO=CS.range,RO=Md.range,MO=wS.range,IO=RS.range,Ly=Ku(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*wm)/Oy},function(e){return e.getDate()-1}),A_=Ly,PO=Ly.range,Fy=Ku(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*e0-e.getMinutes()*wm)},function(e,t){e.setTime(+e+t*Py)},function(e,t){return(t-e)/Py},function(e){return e.getHours()}),MS=Fy,OO=Fy.range,By=Ku(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*e0)},function(e,t){e.setTime(+e+t*wm)},function(e,t){return(t-e)/wm},function(e){return e.getMinutes()}),IS=By,DO=By.range,Ny=Ku(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*e0)},function(e,t){return(t-e)/e0},function(e){return e.getUTCSeconds()}),PS=Ny,LO=Ny.range,r0=Ku(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});r0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ku(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):r0};var OS=r0,FO=r0.range;function Hp(e){return Ku(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/Dy})}var ky=Hp(0),n0=Hp(1),DS=Hp(2),LS=Hp(3),Id=Hp(4),FS=Hp(5),BS=Hp(6),BO=ky.range,NO=n0.range,kO=DS.range,UO=LS.range,zO=Id.range,VO=FS.range,ZO=BS.range,Uy=Ku(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Oy},function(e){return e.getUTCDate()-1}),zy=Uy,jO=Uy.range,T_=Ku(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});T_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ku(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};var Rm=T_,HO=T_.range;function C_(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function w_(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Mm(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function NS(e){var t=e.dateTime,r=e.date,i=e.time,a=e.periods,u=e.days,h=e.shortDays,m=e.months,g=e.shortMonths,E=Im(a),A=Pm(a),w=Im(u),R=Pm(u),U=Im(h),q=Pm(h),ce=Im(m),Se=Pm(m),ke=Im(g),Fe=Pm(g),rt={a:ep,A:tp,b:Hl,B:lv,c:null,d:Gy,e:Gy,f:aA,g:vA,G:gA,H:nA,I:iA,j:oA,L:Xy,m:sA,M:uA,p:eO,q:tO,Q:Jy,s:e1,S:lA,u:cA,U:fA,V:hA,w:pA,W:dA,x:null,X:null,y:mA,Y:_A,Z:yA,"%":Qy},mt={a:rO,A:nO,b:iO,B:oO,c:null,d:qy,e:qy,f:SA,g:DA,G:FA,H:xA,I:EA,j:bA,L:Ky,m:AA,M:TA,p:aO,q:sO,Q:Jy,s:e1,S:CA,u:wA,U:RA,V:MA,w:IA,W:PA,x:null,X:null,y:OA,Y:LA,Z:BA,"%":Qy},er={a:_i,A:En,b:fi,B:Gi,c:ou,d:Hy,e:Hy,f:JS,g:jy,G:Zy,H:Wy,I:Wy,j:qS,L:QS,m:YS,M:KS,p:Pn,q:XS,Q:tA,s:rA,S:$S,u:ZS,U:jS,V:HS,w:VS,W:WS,x:Bu,X:bl,y:jy,Y:Zy,Z:GS,"%":eA};rt.x=cr(r,rt),rt.X=cr(i,rt),rt.c=cr(t,rt),mt.x=cr(r,mt),mt.X=cr(i,mt),mt.c=cr(t,mt);function cr(Xn,lo){return function(Po){var sn=[],Sl=-1,ba=0,Wl=Xn.length,Gl,Qp,kE;for(Po instanceof Date||(Po=new Date(+Po));++Sl<Wl;)Xn.charCodeAt(Sl)===37&&(sn.push(Xn.slice(ba,Sl)),(Qp=Vy[Gl=Xn.charAt(++Sl)])!=null?Gl=Xn.charAt(++Sl):Qp=Gl==="e"?" ":"0",(kE=lo[Gl])&&(Gl=kE(Po,Qp)),sn.push(Gl),ba=Sl+1);return sn.push(Xn.slice(ba,Sl)),sn.join("")}}function kt(Xn,lo){return function(Po){var sn=Mm(1900,void 0,1),Sl=dr(sn,Xn,Po+="",0),ba,Wl;if(Sl!=Po.length)return null;if("Q"in sn)return new Date(sn.Q);if("s"in sn)return new Date(sn.s*1e3+("L"in sn?sn.L:0));if(lo&&!("Z"in sn)&&(sn.Z=0),"p"in sn&&(sn.H=sn.H%12+sn.p*12),sn.m===void 0&&(sn.m="q"in sn?sn.q:0),"V"in sn){if(sn.V<1||sn.V>53)return null;"w"in sn||(sn.w=1),"Z"in sn?(ba=w_(Mm(sn.y,0,1)),Wl=ba.getUTCDay(),ba=Wl>4||Wl===0?n0.ceil(ba):n0(ba),ba=zy.offset(ba,(sn.V-1)*7),sn.y=ba.getUTCFullYear(),sn.m=ba.getUTCMonth(),sn.d=ba.getUTCDate()+(sn.w+6)%7):(ba=C_(Mm(sn.y,0,1)),Wl=ba.getDay(),ba=Wl>4||Wl===0?t0.ceil(ba):t0(ba),ba=A_.offset(ba,(sn.V-1)*7),sn.y=ba.getFullYear(),sn.m=ba.getMonth(),sn.d=ba.getDate()+(sn.w+6)%7)}else("W"in sn||"U"in sn)&&("w"in sn||(sn.w="u"in sn?sn.u%7:"W"in sn?1:0),Wl="Z"in sn?w_(Mm(sn.y,0,1)).getUTCDay():C_(Mm(sn.y,0,1)).getDay(),sn.m=0,sn.d="W"in sn?(sn.w+6)%7+sn.W*7-(Wl+5)%7:sn.w+sn.U*7-(Wl+6)%7);return"Z"in sn?(sn.H+=sn.Z/100|0,sn.M+=sn.Z%100,w_(sn)):C_(sn)}}function dr(Xn,lo,Po,sn){for(var Sl=0,ba=lo.length,Wl=Po.length,Gl,Qp;Sl<ba;){if(sn>=Wl)return-1;if(Gl=lo.charCodeAt(Sl++),Gl===37){if(Gl=lo.charAt(Sl++),Qp=er[Gl in Vy?lo.charAt(Sl++):Gl],!Qp||(sn=Qp(Xn,Po,sn))<0)return-1}else if(Gl!=Po.charCodeAt(sn++))return-1}return sn}function Pn(Xn,lo,Po){var sn=E.exec(lo.slice(Po));return sn?(Xn.p=A[sn[0].toLowerCase()],Po+sn[0].length):-1}function _i(Xn,lo,Po){var sn=U.exec(lo.slice(Po));return sn?(Xn.w=q[sn[0].toLowerCase()],Po+sn[0].length):-1}function En(Xn,lo,Po){var sn=w.exec(lo.slice(Po));return sn?(Xn.w=R[sn[0].toLowerCase()],Po+sn[0].length):-1}function fi(Xn,lo,Po){var sn=ke.exec(lo.slice(Po));return sn?(Xn.m=Fe[sn[0].toLowerCase()],Po+sn[0].length):-1}function Gi(Xn,lo,Po){var sn=ce.exec(lo.slice(Po));return sn?(Xn.m=Se[sn[0].toLowerCase()],Po+sn[0].length):-1}function ou(Xn,lo,Po){return dr(Xn,t,lo,Po)}function Bu(Xn,lo,Po){return dr(Xn,r,lo,Po)}function bl(Xn,lo,Po){return dr(Xn,i,lo,Po)}function ep(Xn){return h[Xn.getDay()]}function tp(Xn){return u[Xn.getDay()]}function Hl(Xn){return g[Xn.getMonth()]}function lv(Xn){return m[Xn.getMonth()]}function eO(Xn){return a[+(Xn.getHours()>=12)]}function tO(Xn){return 1+~~(Xn.getMonth()/3)}function rO(Xn){return h[Xn.getUTCDay()]}function nO(Xn){return u[Xn.getUTCDay()]}function iO(Xn){return g[Xn.getUTCMonth()]}function oO(Xn){return m[Xn.getUTCMonth()]}function aO(Xn){return a[+(Xn.getUTCHours()>=12)]}function sO(Xn){return 1+~~(Xn.getUTCMonth()/3)}return{format:function(Xn){var lo=cr(Xn+="",rt);return lo.toString=function(){return Xn},lo},parse:function(Xn){var lo=kt(Xn+="",!1);return lo.toString=function(){return Xn},lo},utcFormat:function(Xn){var lo=cr(Xn+="",mt);return lo.toString=function(){return Xn},lo},utcParse:function(Xn){var lo=kt(Xn+="",!0);return lo.toString=function(){return Xn},lo}}}var Vy={"-":"",_:" ",0:"0"},iu=/^\s*\d+/,kS=/^%/,US=/[\\^$*+?|[\]().{}]/g;function Mo(e,t,r){var i=e<0?"-":"",a=(i?-e:e)+"",u=a.length;return i+(u<r?new Array(r-u+1).join(t)+a:a)}function zS(e){return e.replace(US,"\\$&")}function Im(e){return new RegExp("^(?:"+e.map(zS).join("|")+")","i")}function Pm(e){for(var t={},r=-1,i=e.length;++r<i;)t[e[r].toLowerCase()]=r;return t}function VS(e,t,r){var i=iu.exec(t.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function ZS(e,t,r){var i=iu.exec(t.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function jS(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function HS(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function WS(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function Zy(e,t,r){var i=iu.exec(t.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function jy(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function GS(e,t,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function XS(e,t,r){var i=iu.exec(t.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function YS(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function Hy(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function qS(e,t,r){var i=iu.exec(t.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function Wy(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function KS(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function $S(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function QS(e,t,r){var i=iu.exec(t.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function JS(e,t,r){var i=iu.exec(t.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function eA(e,t,r){var i=kS.exec(t.slice(r,r+1));return i?r+i[0].length:-1}function tA(e,t,r){var i=iu.exec(t.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function rA(e,t,r){var i=iu.exec(t.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function Gy(e,t){return Mo(e.getDate(),t,2)}function nA(e,t){return Mo(e.getHours(),t,2)}function iA(e,t){return Mo(e.getHours()%12||12,t,2)}function oA(e,t){return Mo(1+A_.count(Rd(e),e),t,3)}function Xy(e,t){return Mo(e.getMilliseconds(),t,3)}function aA(e,t){return Xy(e,t)+"000"}function sA(e,t){return Mo(e.getMonth()+1,t,2)}function uA(e,t){return Mo(e.getMinutes(),t,2)}function lA(e,t){return Mo(e.getSeconds(),t,2)}function cA(e){var t=e.getDay();return t===0?7:t}function fA(e,t){return Mo(S_.count(Rd(e)-1,e),t,2)}function Yy(e){var t=e.getDay();return t>=4||t===0?Md(e):Md.ceil(e)}function hA(e,t){return e=Yy(e),Mo(Md.count(Rd(e),e)+(Rd(e).getDay()===4),t,2)}function pA(e){return e.getDay()}function dA(e,t){return Mo(t0.count(Rd(e)-1,e),t,2)}function mA(e,t){return Mo(e.getFullYear()%100,t,2)}function vA(e,t){return e=Yy(e),Mo(e.getFullYear()%100,t,2)}function _A(e,t){return Mo(e.getFullYear()%1e4,t,4)}function gA(e,t){var r=e.getDay();return e=r>=4||r===0?Md(e):Md.ceil(e),Mo(e.getFullYear()%1e4,t,4)}function yA(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Mo(t/60|0,"0",2)+Mo(t%60,"0",2)}function qy(e,t){return Mo(e.getUTCDate(),t,2)}function xA(e,t){return Mo(e.getUTCHours(),t,2)}function EA(e,t){return Mo(e.getUTCHours()%12||12,t,2)}function bA(e,t){return Mo(1+zy.count(Rm(e),e),t,3)}function Ky(e,t){return Mo(e.getUTCMilliseconds(),t,3)}function SA(e,t){return Ky(e,t)+"000"}function AA(e,t){return Mo(e.getUTCMonth()+1,t,2)}function TA(e,t){return Mo(e.getUTCMinutes(),t,2)}function CA(e,t){return Mo(e.getUTCSeconds(),t,2)}function wA(e){var t=e.getUTCDay();return t===0?7:t}function RA(e,t){return Mo(ky.count(Rm(e)-1,e),t,2)}function $y(e){var t=e.getUTCDay();return t>=4||t===0?Id(e):Id.ceil(e)}function MA(e,t){return e=$y(e),Mo(Id.count(Rm(e),e)+(Rm(e).getUTCDay()===4),t,2)}function IA(e){return e.getUTCDay()}function PA(e,t){return Mo(n0.count(Rm(e)-1,e),t,2)}function OA(e,t){return Mo(e.getUTCFullYear()%100,t,2)}function DA(e,t){return e=$y(e),Mo(e.getUTCFullYear()%100,t,2)}function LA(e,t){return Mo(e.getUTCFullYear()%1e4,t,4)}function FA(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Id(e):Id.ceil(e),Mo(e.getUTCFullYear()%1e4,t,4)}function BA(){return"+0000"}function Qy(){return"%"}function Jy(e){return+e}function e1(e){return Math.floor(+e/1e3)}var Pd,t1,NA,kA,UA;zA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function zA(e){return Pd=NS(e),t1=Pd.format,NA=Pd.parse,kA=Pd.utcFormat,UA=Pd.utcParse,Pd}var Om=1e3,Dm=Om*60,Lm=Dm*60,Fm=Lm*24,VA=Fm*7,r1=Fm*30,R_=Fm*365;function ZA(e){return new Date(e)}function jA(e){return e instanceof Date?+e:+new Date(+e)}function n1(e,t,r,i,a,u,h,m,g){var E=ly(Lu,Lu),A=E.invert,w=E.domain,R=g(".%L"),U=g(":%S"),q=g("%I:%M"),ce=g("%I %p"),Se=g("%a %d"),ke=g("%b %d"),Fe=g("%B"),rt=g("%Y"),mt=[[h,1,Om],[h,5,5*Om],[h,15,15*Om],[h,30,30*Om],[u,1,Dm],[u,5,5*Dm],[u,15,15*Dm],[u,30,30*Dm],[a,1,Lm],[a,3,3*Lm],[a,6,6*Lm],[a,12,12*Lm],[i,1,Fm],[i,2,2*Fm],[r,1,VA],[t,1,r1],[t,3,3*r1],[e,1,R_]];function er(kt){return(h(kt)<kt?R:u(kt)<kt?U:a(kt)<kt?q:i(kt)<kt?ce:t(kt)<kt?r(kt)<kt?Se:ke:e(kt)<kt?Fe:rt)(kt)}function cr(kt,dr,Pn,_i){if(kt==null&&(kt=10),typeof kt=="number"){var En=Math.abs(Pn-dr)/kt,fi=Gg(function(Gi){return Gi[2]}).right(mt,En);fi===mt.length?(_i=c_(dr/R_,Pn/R_,kt),kt=e):fi?(fi=mt[En/mt[fi-1][2]<mt[fi][2]/En?fi-1:fi],_i=fi[1],kt=fi[0]):(_i=Math.max(c_(dr,Pn,kt),1),kt=m)}return _i==null?kt:kt.every(_i)}return E.invert=function(kt){return new Date(A(kt))},E.domain=function(kt){return arguments.length?w(ey.call(kt,jA)):w().map(ZA)},E.ticks=function(kt,dr){var Pn=w(),_i=Pn[0],En=Pn[Pn.length-1],fi=En<_i,Gi;return fi&&(Gi=_i,_i=En,En=Gi),Gi=cr(kt,_i,En,dr),Gi=Gi?Gi.range(_i,En+1):[],fi?Gi.reverse():Gi},E.tickFormat=function(kt,dr){return dr==null?er:g(dr)},E.nice=function(kt,dr){var Pn=w();return(kt=cr(kt,Pn[0],Pn[Pn.length-1],dr))?w(yy(Pn,kt)):E},E.copy=function(){return Kv(E,n1(e,t,r,i,a,u,h,m,g))},E}function HA(){return Wh.apply(n1(Rd,AS,S_,A_,MS,IS,PS,OS,t1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function WO(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function i0(){var e=0,t=1,r,i,a,u,h=Lu,m=!1,g;function E(A){return isNaN(A=+A)?g:h(a===0?.5:(A=(u(A)-r)*a,m?Math.max(0,Math.min(1,A)):A))}return E.domain=function(A){return arguments.length?(r=u(e=+A[0]),i=u(t=+A[1]),a=r===i?0:1/(i-r),E):[e,t]},E.clamp=function(A){return arguments.length?(m=!!A,E):m},E.interpolator=function(A){return arguments.length?(h=A,E):h},E.unknown=function(A){return arguments.length?(g=A,E):g},function(A){return u=A,r=A(e),i=A(t),a=r===i?0:1/(i-r),E}}function Bm(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function i1(){var e=Cm(i0()(Lu));return e.copy=function(){return Bm(e,i1())},ty.apply(e,arguments)}function WA(){var e=loggish(i0()).domain([1,10]);return e.copy=function(){return Bm(e,WA()).base(e.base())},initInterpolator.apply(e,arguments)}function GA(){var e=symlogish(i0());return e.copy=function(){return Bm(e,GA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function o1(){var e=powish(i0());return e.copy=function(){return Bm(e,o1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function GO(){return o1.apply(null,arguments).exponent(.5)}function XA(){var e=[],t=identity;function r(i){if(!isNaN(i=+i))return t((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var a=0,u=i.length,h;a<u;++a)h=i[a],h!=null&&!isNaN(h=+h)&&e.push(h);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(t=i,r):t},r.copy=function(){return XA(t).domain(e)},initInterpolator.apply(r,arguments)}function o0(){var e=0,t=.5,r=1,i,a,u,h,m,g=Lu,E,A=!1,w;function R(U){return isNaN(U=+U)?w:(U=.5+((U=+E(U))-a)*(U<a?h:m),g(A?Math.max(0,Math.min(1,U)):U))}return R.domain=function(U){return arguments.length?(i=E(e=+U[0]),a=E(t=+U[1]),u=E(r=+U[2]),h=i===a?0:.5/(a-i),m=a===u?0:.5/(u-a),R):[e,t,r]},R.clamp=function(U){return arguments.length?(A=!!U,R):A},R.interpolator=function(U){return arguments.length?(g=U,R):g},R.unknown=function(U){return arguments.length?(w=U,R):w},function(U){return E=U,i=U(e),a=U(t),u=U(r),h=i===a?0:.5/(a-i),m=a===u?0:.5/(u-a),R}}function a1(){var e=Cm(o0()(Lu));return e.copy=function(){return Bm(e,a1())},ty.apply(e,arguments)}function YA(){var e=loggish(o0()).domain([.1,1,10]);return e.copy=function(){return copy(e,YA()).base(e.base())},initInterpolator.apply(e,arguments)}function qA(){var e=symlogish(o0());return e.copy=function(){return copy(e,qA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function s1(){var e=powish(o0());return e.copy=function(){return copy(e,s1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function XO(){return s1.apply(null,arguments).exponent(.5)}function u1(e){let t,r=[];function i(a){return a==null?t:a}return i.invert=i,i.domain=i.range=a=>a?(r=a,a):r,i.unknown=a=>a?(t=a,a):t,i.copy=()=>u1(e).unknown(t),i}const{isNil:M_,isString:KA,uniq:$A}=Yn,QA=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,JA={[Tr.LINEAR]:gy,[Tr.POWER]:y_,[Tr.LOG]:Sy,[Tr.IDENTITY]:u1,[Tr.SEQUENTIAL]:i1,[Tr.TIME]:HA,[Tr.QUANTILE]:wy,[Tr.QUANTIZE]:Ry,[Tr.THRESHOLD]:My,[Tr.CAT]:Yv,[Tr.DIVERGING]:a1};class eT{constructor(){(0,P.Z)(this,"scaleOptions",{})}apply(t,{styleAttributeService:r}){var i=this;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Yt.Z)(function*(){var a;t.log(Et.ScaleInitStart,$r.INIT),i.scaleOptions=t.getScaleOptions();const u=r.getLayerStyleAttributes(),h=(a=t.getSource())===null||a===void 0?void 0:a.data.dataArray;Array.isArray(h)&&h.length===0||(i.caculateScalesForAttributes(u||[],h),t.log(Et.ScaleInitEnd,$r.INIT))})),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var a=(0,Yt.Z)(function*(u){if(!u)return u;t.log(Et.ScaleInitStart,$r.UPDATE),i.scaleOptions=t.getScaleOptions();const h=r.getLayerStyleAttributes(),m=t.getSource().data.dataArray;return Array.isArray(m)&&m.length===0||(i.caculateScalesForAttributes(h||[],m),t.log(Et.ScaleInitEnd,$r.UPDATE),t.layerModelNeedUpdate=!0),!0});return function(u){return a.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",()=>{if(t.layerModelNeedUpdate)return;this.scaleOptions=t.getScaleOptions();const a=r.getLayerStyleAttributes(),u=t.getSource().data.dataArray;if(!(Array.isArray(u)&&u.length===0)&&a){const h=a.filter(m=>m.needRescale);h.length&&this.caculateScalesForAttributes(h,u)}})}isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}caculateScalesForAttributes(t,r){t.forEach(i=>{if(i.scale){const a=i.scale,u=i.scale.field;a.names=this.parseFields(M_(u)?[]:u);const h=[];a.names.forEach(m=>{var g;h.push(this.createScale(m,i.name,(g=i.scale)===null||g===void 0?void 0:g.values,r))}),h.some(m=>m.type===ln.VARIABLE)?(a.type=ln.VARIABLE,h.forEach(m=>{if(!a.callback&&a.values!=="text"){var g;switch((g=m.option)===null||g===void 0?void 0:g.type){case Tr.LOG:case Tr.LINEAR:case Tr.POWER:if(a.values&&a.values.length>2){const A=m.scale.ticks(a.values.length);m.scale.domain(A)}a.values?m.scale.range(a.values):m.scale.range(m.option.domain);break;case Tr.QUANTILE:case Tr.QUANTIZE:case Tr.THRESHOLD:m.scale.range(a.values);break;case Tr.IDENTITY:break;case Tr.CAT:a.values?m.scale.range(a.values):m.scale.range(m.option.domain);break;case Tr.DIVERGING:case Tr.SEQUENTIAL:m.scale.interpolator(o_.hD(a.values));break}}if(a.values==="text"){var E;m.scale.range((E=m.option)===null||E===void 0?void 0:E.domain)}})):(a.type=ln.CONSTANT,a.defaultValues=h.map((m,g)=>m.scale(a.names[g]))),a.scalers=h.map(m=>({field:m.field,func:m.scale,option:m.option})),i.needRescale=!1}})}parseFields(t){return Array.isArray(t)?t:KA(t)?t.split("*"):[t]}createScale(t,r,i,a){var u,h;const m=this.scaleOptions[r]&&((u=this.scaleOptions[r])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[r]:this.scaleOptions[t],g={field:t,scale:void 0,type:ln.VARIABLE,option:m};if(!a||!a.length)return m&&m.type?g.scale=this.createDefaultScale(m):(g.scale=Yv([t]),g.type=ln.CONSTANT),g;const E=(h=a.find(A=>!M_(A[t])))===null||h===void 0?void 0:h[t];if(this.isNumber(t)||M_(E)&&!m)g.scale=Yv([t]),g.type=ln.CONSTANT;else{let A=m&&m.type||this.getDefaultType(E);i==="text"&&(A=Tr.CAT),i===void 0&&(A=Tr.IDENTITY);const w=this.createScaleConfig(A,t,m,a);g.scale=this.createDefaultScale(w),g.option=w}return g}getDefaultType(t){let r=Tr.LINEAR;return typeof t=="string"&&(r=QA.test(t)?Tr.TIME:Tr.CAT),r}createScaleConfig(t,r,i,a){const u={type:t};let h=[];if(t===Tr.QUANTILE){const m=new Map;a==null||a.forEach(g=>{m.set(g._id,g[r])}),h=Array.from(m.values())}else h=(a==null?void 0:a.map(m=>m[r]))||[];if(i!=null&&i.domain)u.domain=i==null?void 0:i.domain;else if(t===Tr.CAT||t===Tr.IDENTITY)u.domain=$A(h);else if(t===Tr.QUANTILE)u.domain=h;else if(t===Tr.DIVERGING){const m=Wg(h),g=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(m[0]+m[1])/2;u.domain=[m[0],g,m[1]]}else u.domain=Wg(h);return(0,lt.Z)((0,lt.Z)({},u),i)}createDefaultScale({type:t,domain:r,unknown:i,clamp:a,nice:u}){const h=JA[t]();return r&&h.domain&&h.domain(r),i&&h.unknown(i),a!==void 0&&h.clamp&&h.clamp(a),u!==void 0&&h.nice&&h.nice(u),h}}class tT{apply(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",()=>{t.animateStatus&&t.models.forEach(i=>{i.addUniforms((0,lt.Z)({},t.layerModel.getAnimateUniforms()))})})}}class rT{apply(t){t.hooks.afterInit.tap("LayerMaskPlugin",()=>{const{maskLayers:r,enableMask:i}=t.getLayerConfig();!t.tileLayer&&r&&r.length>0&&t.updateLayerConfig({mask:i})})}}class nT{build(t){return(0,Yt.Z)(function*(){t.prepareBuildModel(),yield t.buildModels()})()}initLayerModel(t){var r=this;return(0,Yt.Z)(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}prepareLayerModel(t){var r=this;return(0,Yt.Z)(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}apply(t){var r=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Yt.Z)(function*(){if(t.getSource().isTile){t.prepareBuildModel();return}t.log(Et.BuildModelStart,$r.INIT),yield r.initLayerModel(t),t.log(Et.BuildModelEnd,$r.INIT)})),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Yt.Z)(function*(a){return!a||t.getSource().isTile?!1:(t.log(Et.BuildModelStart,$r.UPDATE),yield r.prepareLayerModel(t),t.log(Et.BuildModelEnd,$r.UPDATE),!0)});return function(a){return i.apply(this,arguments)}}())}}class iT{apply(t){t.hooks.afterInit.tap("LayerStylePlugin",()=>{const{autoFit:r,fitBoundsOptions:i}=t.getLayerConfig();r&&t.fitBounds(i),t.styleNeedUpdate=!1})}}const oT=["type"],l1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},aT={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},sT={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},uT={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function lT(e){const t={u_DirectionalLights:new Array(3).fill((0,lt.Z)({},sT)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,lt.Z)({},uT)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[aT]),e.forEach(r=>{let{type:i="directional"}=r,a=(0,Ot.Z)(r,oT);const u=l1[i].lights,h=l1[i].num,m=t[h];t[u][m]=(0,lt.Z)((0,lt.Z)({},t[u][m]),a),t[h]++}),t}class cT{apply(t){t.hooks.beforeRender.tap("LightingPlugin",()=>{const{enableLighting:r}=t.getLayerConfig();r&&t.models.forEach(i=>i.addUniforms((0,lt.Z)({},lT())))})}}function c1(e){return e.map(t=>(typeof t=="string"&&(t=[t,{}]),t))}function f1(e,t,r,i){const a=e.multiPassRenderer;return a.add(i("render")),c1(t).forEach(u=>{const[h,m]=u;a.add(r(h),m)}),a.add(r("copy")),a}class fT{constructor(){(0,P.Z)(this,"enabled",void 0)}apply(t,{rendererService:r,postProcessingPassFactory:i,normalPassFactory:a}){t.hooks.init.tapPromise("MultiPassRendererPlugin",()=>{const{enableMultiPassRenderer:u,passes:h=[]}=t.getLayerConfig();this.enabled=!!u&&t.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(t.multiPassRenderer=f1(t,h,i,a),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",()=>{if(this.enabled){const{width:u,height:h}=r.getViewportSize();t.multiPassRenderer.resize(u,h)}})}}let Ln=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function hT(e){switch(e){case"rotation":return{name:"Rotation",type:Kt.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Ln.ROTATION,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{rotation:r=0}=t;return Array.isArray(r)?[r[0]]:[r]}}};case"stroke":return{name:"stroke",type:Kt.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Ln.STROKE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:4,update:t=>{const{stroke:r=[1,1,1,1]}=t;return r}}};case"opacity":return{name:"opacity",type:Kt.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Ln.OPACITY,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{opacity:r=1}=t;return[r]}}};case"extrusionBase":return{name:"extrusionBase",type:Kt.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:Ln.EXTRUSION_BASE,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{extrusionBase:r=0}=t;return[r]}}};case"offsets":return{name:"offsets",type:Kt.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Ln.OFFSETS,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const{offsets:r}=t;return r}}};case"thetaOffset":return{name:"thetaOffset",type:Kt.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{thetaOffset:r=1}=t;return[r]}}};default:return}}const{isNumber:pT}=Yn,Od={NONE:0,ENCODE:1,HIGHLIGHT:2};class dT{constructor(){(0,P.Z)(this,"pickingUniformMap",void 0)}pickOption2Array(){const t=[];return this.pickingUniformMap.forEach(r=>{pT(r)?t.push(r):t.push(...r)}),t}updatePickOption(t,r){Object.keys(t).forEach(h=>{this.pickingUniformMap.set(h,t[h])});const i=r.getLayerConfig().pickingBuffer||0,a=Number(r.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",i),this.pickingUniformMap.set("u_shaderPick",a),r.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(t,{styleAttributeService:r}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();r.registerStyleAttribute({name:"pickingColor",type:Kt.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Ln.PICKING_COLOR,buffer:{data:[],type:F.FLOAT},size:3,update:a=>{const{id:u}=a;return i?Fs(u):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:Od.ENCODE},t),t.models.forEach(a=>a.addUniforms({u_PickingStage:Od.ENCODE})))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:Od.HIGHLIGHT},t),t.models.forEach(a=>a.addUniforms({u_PickingStage:Od.HIGHLIGHT})))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",i=>{const{highlightColor:a,activeMix:u=0}=t.getLayerConfig(),h=typeof a=="string"?ai(a):a||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ys(new Uint8Array(i))});const m={u_PickingStage:Od.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:h.map(g=>g*255),u_activeMix:u};this.updatePickOption(m,t),t.models.forEach(g=>g.addUniforms(m))}),t.hooks.beforeSelect.tap("PixelPickingPlugin",i=>{const{selectColor:a,selectMix:u=0}=t.getLayerConfig(),h=typeof a=="string"?ai(a):a||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ys(new Uint8Array(i))});const m={u_PickingStage:Od.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:h.map(g=>g*255),u_activeMix:u,u_CurrentSelectedId:i,u_SelectColor:h.map(g=>g*255)};this.updatePickOption(m,t),t.models.forEach(g=>g.addUniforms(m))})}}const mT=["mvt","geojsonvt","testTile"];function vT(e){const t=e.getSource();return mT.includes(t.parser.type)}class _T{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("RegisterStyleAttributePlugin",()=>{vT(t)||this.registerBuiltinAttributes(r,t)})}registerBuiltinAttributes(t,r){if(r.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}registerPositionAttribute(t){t.registerStyleAttribute({name:"position",type:Kt.Attribute,descriptor:{name:"a_Position",shaderLocation:Ln.POSITION,buffer:{data:[],type:F.FLOAT},size:3,update:(r,i,a)=>a.length===2?[a[0],a[1],0]:[a[0],a[1],a[2]]}})}registerColorAttribute(t){t.registerStyleAttribute({name:"color",type:Kt.Attribute,descriptor:{name:"a_Color",shaderLocation:Ln.COLOR,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:4,update:r=>{const{color:i}=r;return!i||!i.length?[1,1,1,1]:i}}})}registerVertexIdAttribute(t){t.registerStyleAttribute({name:"vertexId",type:Kt.Attribute,descriptor:{name:"a_vertexId",shaderLocation:Ln.VERTEX_ID,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:(r,i)=>[i]}})}}class gT{constructor(){(0,P.Z)(this,"cameraService",void 0),(0,P.Z)(this,"coordinateSystemService",void 0),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"mapService",void 0),(0,P.Z)(this,"layerService",void 0)}apply(t,{rendererService:r,mapService:i,layerService:a,coordinateSystemService:u,cameraService:h}){this.rendererService=r,this.mapService=i,this.layerService=a,this.coordinateSystemService=u,this.cameraService=h;const m=this.mapService.version;let g=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],E=[0,0],A;this.rendererService.uniformBuffers[0]||(A=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0}),this.rendererService.uniformBuffers[0]=A),t.hooks.beforeRender.tap("ShaderUniformPlugin",()=>{const w=t.getLayerConfig().tileOrigin;this.coordinateSystemService.refresh(w),m==="GAODE2.x"&&(this.setLayerCenter(t),g=this.mapService.map.customCoords.getMVPMatrix(),E=this.mapService.getCustomCoordCenter(),t.getLayerUniformBuffer().subData({offset:0,data:new Uint8Array(new Float32Array([...g,...E]).buffer)}));const{width:R,height:U}=this.rendererService.getViewportSize(),{data:q,uniforms:ce}=this.generateUBO(g,E,R,U);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:q}),this.rendererService.queryVerdorInfo()==="WebGL1"&&t.models.forEach(ke=>{ke.addUniforms((0,lt.Z)((0,lt.Z)({},ce),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}setLayerCenter(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}generateUBO(t,r,i,a){const u=this.cameraService.getProjectionMatrix(),h=this.cameraService.getViewMatrix(),m=this.cameraService.getViewProjectionMatrix(),g=this.cameraService.getModelMatrix(),E=this.coordinateSystemService.getViewportCenterProjection(),A=this.coordinateSystemService.getPixelsPerDegree(),w=this.cameraService.getZoom(),R=this.coordinateSystemService.getPixelsPerDegree2(),U=this.cameraService.getZoomScale(),q=this.coordinateSystemService.getPixelsPerMeter(),ce=this.coordinateSystemService.getCoordinateSystem(),Se=this.cameraService.getCameraPosition(),ke=window.devicePixelRatio,Fe=this.coordinateSystemService.getViewportCenter(),rt=[i,a],mt=this.cameraService.getFocalDistance();return{data:[...h,...u,...m,...g,...E,...A,w,...R,U,...q,ce,...Se,ke,...Fe,...rt,mt,0,0,0],uniforms:{[Ce.ProjectionMatrix]:u,[Ce.ViewMatrix]:h,[Ce.ViewProjectionMatrix]:m,[Ce.Zoom]:w,[Ce.ZoomScale]:U,[Ce.FocalDistance]:mt,[Ce.CameraPosition]:Se,[$e.CoordinateSystem]:ce,[$e.ViewportCenter]:Fe,[$e.ViewportCenterProjection]:E,[$e.PixelsPerDegree]:A,[$e.PixelsPerDegree2]:R,[$e.PixelsPerMeter]:q,[$e.Mvp]:t,u_sceneCenterMercator:r,u_ViewportSize:rt,u_ModelMatrix:g,u_DevicePixelRatio:ke}}}}class yT{apply(t){t.hooks.beforeRender.tap("UpdateModelPlugin",()=>{t.layerModel&&t.layerModel.needUpdate().then(r=>{r&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",()=>{t.layerModelNeedUpdate=!1})}}class xT{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("UpdateStyleAttributePlugin",()=>{this.initStyleAttribute(t,{styleAttributeService:r})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",()=>{t.layerModelNeedUpdate||t.inited&&this.updateStyleAttribute(t,{styleAttributeService:r})})}updateStyleAttribute(t,{styleAttributeService:r}){const i=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter");if(a&&a.needRegenerateVertices){t.layerModelNeedUpdate=!0,i.forEach(u=>u.needRegenerateVertices=!1);return}i.filter(u=>u.needRegenerateVertices).forEach(u=>{r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex,t),u.needRegenerateVertices=!1})}initStyleAttribute(t,{styleAttributeService:r}){(r.getLayerStyleAttributes()||[]).filter(a=>a.needRegenerateVertices).forEach(a=>{r.updateAttributeByFeatureRange(a.name,t.getEncodedData(),a.featureRange.startIndex,a.featureRange.endIndex),a.needRegenerateVertices=!1})}}function ET(){return[new O2,new _T,new eT,new P2,new iT,new rT,new xT,new yT,new fT,new gT,new tT,new cT,new dT,new nT]}const h1={[ar.additive]:{enable:!0,func:{srcRGB:F.ONE,dstRGB:F.ONE,srcAlpha:1,dstAlpha:1}},[ar.none]:{enable:!1},[ar.normal]:{enable:!0,func:{srcRGB:F.SRC_ALPHA,dstRGB:F.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[ar.subtractive]:{enable:!0,func:{srcRGB:F.ONE,dstRGB:F.ONE,srcAlpha:F.ZERO,dstAlpha:F.ONE_MINUS_SRC_COLOR},equation:{rgb:F.FUNC_SUBTRACT,alpha:F.FUNC_SUBTRACT}},[ar.max]:{enable:!0,func:{srcRGB:F.ONE,dstRGB:F.ONE},equation:{rgb:F.MAX_EXT}},[ar.min]:{enable:!0,func:{srcRGB:F.ONE,dstRGB:F.ONE},equation:{rgb:F.MIN_EXT}}};class bT{constructor(t){(0,P.Z)(this,"layer",void 0),this.layer=t}pickRender(t){const i=this.layer.getContainer().layerService,a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}pick(t,r){var i=this;return(0,Yt.Z)(function*(){const u=i.layer.getContainer().pickingService;return t.type==="RasterLayer"?i.pickRasterLayer(t,r):(i.pickRender(r),u.pickFromPickingFBO(t,r))})()}pickRasterLayer(t,r,i){const a=this.layer.getContainer(),u=a.pickingService,h=a.mapService,m=this.layer.getSource().extent,g=Jl(r.lngLat,m),E={x:r.x,y:r.y,type:r.type,lngLat:r.lngLat,target:r,rasterValue:null},A=i||t;if(g){const w=this.readRasterValue(t,m,h,r.x,r.y);return E.rasterValue=w,u.triggerHoverOnLayer(A,E),!0}else return E.type=r.type==="mousemove"?"mouseout":"un"+r.type,u.triggerHoverOnLayer(A,(0,lt.Z)((0,lt.Z)({},E),{},{type:"unpick"})),u.triggerHoverOnLayer(A,E),!1}readRasterValue(t,r,i,a,u){const h=t.getSource().data.dataArray[0],[m=0,g=0,E=10,A=-10]=r,w=i.lngLatToContainer([m,g]),R=i.lngLatToContainer([E,A]),U=R.x-w.x,q=w.y-R.y,ce=[(a-w.x)/U,(u-R.y)/q],Se=h.width||1,ke=h.height||1,Fe=Math.floor(ce[0]*Se),rt=Math.floor(ce[1]*ke),mt=Math.max(0,rt-1)*Se+Fe;return h.data[mt]}selectFeature(t){const r=this.layer,[i,a,u]=t;r.hooks.beforeSelect.call([i,a,u])}highlightPickedFeature(t){const[r,i,a]=t;this.layer.hooks.beforeHighlight.call([r,i,a])}getFeatureById(t){return this.layer.getSource().getFeatureById(t)}}class ST{constructor(t){(0,P.Z)(this,"layer",void 0),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"colorTexture",void 0),(0,P.Z)(this,"key",void 0),this.layer=t;const r=this.layer.getContainer();this.rendererService=r.rendererService}getColorTexture(t,r){const i=this.getTextureKey(t,r);return this.key===i?this.colorTexture:(this.createColorTexture(t,r),this.key=i,this.colorTexture)}createColorTexture(t,r){const{createTexture2D:i}=this.rendererService,a=this.getColorRampBar(t,r),u=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1,unorm:!0});return this.colorTexture=u,u}setColorTexture(t,r,i){this.key=this.getTextureKey(r,i),this.colorTexture=t}destroy(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}getColorRampBar(t,r){switch(t.type){case"cat":return Nu(t);case"quantize":return Mc(t);case"custom":return xs(t,r);case"linear":return yu(t,r);default:return au(t)}}getTextureKey(t,r){var i;return`${t.colors.join("_")}_${t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_")}_${t.type}_${r==null?void 0:r.join("_")}`}}const AT=["passes"],TT=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption","pickingEnabled"],{isEqual:I_,isFunction:p1,isNumber:d1,isObject:du,isPlainObject:CT,isUndefined:wT}=Yn;let m1=0;class Gh extends jg.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){return this.container.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(t={}){super(),(0,P.Z)(this,"id",`${m1++}`),(0,P.Z)(this,"name",`${m1}`),(0,P.Z)(this,"parent",void 0),(0,P.Z)(this,"coordCenter",void 0),(0,P.Z)(this,"type",void 0),(0,P.Z)(this,"visible",!0),(0,P.Z)(this,"zIndex",0),(0,P.Z)(this,"minZoom",void 0),(0,P.Z)(this,"maxZoom",void 0),(0,P.Z)(this,"inited",!1),(0,P.Z)(this,"layerModelNeedUpdate",!1),(0,P.Z)(this,"pickedFeatureID",null),(0,P.Z)(this,"selectedFeatureID",null),(0,P.Z)(this,"styleNeedUpdate",!1),(0,P.Z)(this,"rendering",void 0),(0,P.Z)(this,"forceRender",!1),(0,P.Z)(this,"clusterZoom",0),(0,P.Z)(this,"layerType",void 0),(0,P.Z)(this,"triangulation",void 0),(0,P.Z)(this,"layerPickService",void 0),(0,P.Z)(this,"textureService",void 0),(0,P.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,P.Z)(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,P.Z)(this,"hooks",{init:new ef,afterInit:new Ap,beforeRender:new Ap,beforeRenderData:new Tp,afterRender:new pu,beforePickingEncode:new pu,afterPickingEncode:new pu,beforeHighlight:new pu(["pickedColor"]),afterHighlight:new pu,beforeSelect:new pu(["pickedColor"]),afterSelect:new pu,beforeDestroy:new pu,afterDestroy:new pu}),(0,P.Z)(this,"models",[]),(0,P.Z)(this,"multiPassRenderer",void 0),(0,P.Z)(this,"plugins",void 0),(0,P.Z)(this,"startInit",!1),(0,P.Z)(this,"sourceOption",void 0),(0,P.Z)(this,"layerModel",void 0),(0,P.Z)(this,"shapeOption",void 0),(0,P.Z)(this,"tileLayer",void 0),(0,P.Z)(this,"layerChildren",[]),(0,P.Z)(this,"masks",[]),(0,P.Z)(this,"configService",_m),(0,P.Z)(this,"styleAttributeService",void 0),(0,P.Z)(this,"layerSource",void 0),(0,P.Z)(this,"postProcessingPassFactory",void 0),(0,P.Z)(this,"animateOptions",{enable:!1}),(0,P.Z)(this,"container",void 0),(0,P.Z)(this,"encodedData",void 0),(0,P.Z)(this,"currentPickId",null),(0,P.Z)(this,"rawConfig",void 0),(0,P.Z)(this,"needUpdateConfig",void 0),(0,P.Z)(this,"encodeStyleAttribute",{}),(0,P.Z)(this,"enableShaderEncodeStyles",[]),(0,P.Z)(this,"enableDataEncodeStyles",[]),(0,P.Z)(this,"pendingStyleAttributes",[]),(0,P.Z)(this,"scaleOptions",{}),(0,P.Z)(this,"animateStartTime",void 0),(0,P.Z)(this,"animateStatus",!1),(0,P.Z)(this,"isDestroyed",!1),(0,P.Z)(this,"uniformBuffers",[]),(0,P.Z)(this,"encodeDataLength",0),(0,P.Z)(this,"sourceEvent",()=>{this.dataState.dataSourceNeedUpdate=!0;const r=this.getLayerConfig();r&&r.autoFit&&this.fitBounds(r.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=t.name||this.id,this.zIndex=t.zIndex||0,this.rawConfig=t,this.masks=t.maskLayers||[]}addMask(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(t){this.masks.push(t)}removeMaskLayer(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),t.destroy()}getAttribute(t){return this.styleAttributeService.getLayerStyleAttribute(t)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(t){if(Object.keys(t).map(r=>{r in this.rawConfig&&(this.rawConfig[r]=t[r])}),!this.startInit)this.needUpdateConfig=(0,lt.Z)((0,lt.Z)({},this.needUpdateConfig),t);else{const r=this.container.id;this.configService.setLayerConfig(r,this.id,(0,lt.Z)((0,lt.Z)((0,lt.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}setContainer(t){this.container=t}getContainer(){return this.container}addPlugin(t){return this.plugins.push(t),this}init(){var t=this;return(0,Yt.Z)(function*(){const r=t.container.id;t.startInit=!0,t.configService.setLayerConfig(r,t.id,t.rawConfig),t.layerType=t.rawConfig.layerType;const{enableMultiPassRenderer:i,passes:a}=t.getLayerConfig();i&&a!==null&&a!==void 0&&a.length&&a.length>0&&t.mapService.on("mapAfterFrameChange",()=>{t.renderLayers()}),t.postProcessingPassFactory=t.container.postProcessingPassFactory,t.styleAttributeService=t.container.styleAttributeService,i&&(t.multiPassRenderer=t.container.multiPassRenderer,t.multiPassRenderer.setLayer(t)),t.pendingStyleAttributes.forEach(({attributeName:u,attributeField:h,attributeValues:m,updateOptions:g})=>{t.styleAttributeService.updateStyleAttribute(u,{scale:(0,lt.Z)({field:h},t.splitValuesAndCallbackInAttribute(m,h?void 0:t.getLayerConfig()[u]))},g)}),t.pendingStyleAttributes=[],t.plugins=ET();for(const u of t.plugins)u.apply(t,t.container);t.layerPickService=new bT(t),t.textureService=new ST(t),t.log(Et.LayerInitStart),yield t.hooks.init.promise(),t.log(Et.LayerInitEnd),t.inited=!0,t.emit("inited",{target:t,type:"inited"}),t.emit("add",{target:t,type:"add"}),t.hooks.afterInit.call()})()}log(t,r="init"){var i;if(this.tileLayer||this.isTileLayer)return;const a=`${this.id}.${r}.${t}`,u={id:this.id,type:this.type};(i=this.debugService)===null||i===void 0||i.log(a,u)}updateModelData(t){t.attributes&&t.elements?this.models.map(r=>{r.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}setLayerPickService(t){this.layerPickService=t}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});const{animateOption:t}=this.getLayerConfig();t!=null&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(t,r,i){return this.updateStyleAttribute("color",t,r,i),this}texture(t,r,i){return this.updateStyleAttribute("texture",t,r,i),this}rotate(t,r,i){return this.updateStyleAttribute("rotate",t,r,i),this}size(t,r,i){return this.updateStyleAttribute("size",t,r,i),this}filter(t,r,i){const a=this.updateStyleAttribute("filter",t,r,i);return this.dataState.dataSourceNeedUpdate=a&&this.inited,this}shape(t,r,i){this.shapeOption={field:t,values:r};const a=this.updateStyleAttribute("shape",t,r,i);return this.dataState.dataSourceNeedUpdate=a&&this.inited,this}label(t,r,i){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:r,updateOptions:i}),this}animate(t){let r={};return du(t)?(r.enable=!0,r=(0,lt.Z)((0,lt.Z)({},r),t)):r.enable=t,this.updateLayerConfig({animateOption:r}),this}source(t,r){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:r},this.clusterZoom=0,this)}setData(t,r){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(t,r)):this.on("inited",()=>{this.dataUpdatelog(),this.layerSource.setData(t,r)}),this}dataUpdatelog(){this.log(Et.SourceInitStart,$r.UPDATE),this.layerSource.once("update",()=>{this.log(Et.SourceInitEnd,$r.UPDATE)})}style(t){const{passes:r}=t,i=(0,Ot.Z)(t,AT);r&&c1(r).forEach(u=>{const h=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(u[0]);h&&h.updateOptions(u[1])}),i.borderColor&&(i.stroke=i.borderColor),i.borderWidth&&(i.strokeWidth=i.borderWidth);const a=i;return Object.keys(i).forEach(u=>{const h=i[u];Array.isArray(h)&&h.length===2&&!d1(h[0])&&!d1(h[1])&&(a[u]={field:h[0],value:h[1]})}),this.encodeStyle(a),this.updateLayerConfig(a),this}encodeStyle(t){Object.keys(t).forEach(r=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(r)&&CT(t[r])&&(t[r].field||t[r].value)&&!I_(this.encodeStyleAttribute[r],t[r])?(this.encodeStyleAttribute[r]=t[r],this.updateStyleAttribute(r,t[r].field,t[r].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[r]&&(delete this.encodeStyleAttribute[r],this.dataState.dataSourceNeedUpdate=!0)})}scale(t,r){const i=(0,lt.Z)({},this.scaleOptions);if(du(t)?this.scaleOptions=(0,lt.Z)((0,lt.Z)({},this.scaleOptions),t):this.scaleOptions[t]=r,this.styleAttributeService&&!I_(i,this.scaleOptions)){const a=du(t)?t:{[t]:r};this.styleAttributeService.updateScaleAttribute(a)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(t={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}renderMultiPass(){var t=this;return(0,Yt.Z)(function*(){t.encodeDataLength<=0&&!t.forceRender||(t.multiPassRenderer&&t.multiPassRenderer.getRenderFlag()?yield t.multiPassRenderer.render():t.renderModels())})()}active(t){const r={};return r.enableHighlight=du(t)?!0:t,du(t)?(r.enableHighlight=!0,t.color&&(r.highlightColor=t.color),t.mix&&(r.activeMix=t.mix)):r.enableHighlight=!!t,this.updateLayerConfig(r),this}setActive(t,r){if(du(t)){const{x:i=0,y:a=0}=t;this.updateLayerConfig({highlightColor:du(r)?r.color:this.getLayerConfig().highlightColor,activeMix:du(r)?r.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:du(r)?r.color:this.getLayerConfig().highlightColor,activeMix:du(r)?r.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Fs(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(t){const r={};return r.enableSelect=du(t)?!0:t,du(t)?(r.enableSelect=!0,t.color&&(r.selectColor=t.color),t.mix&&(r.selectMix=t.mix)):r.enableSelect=!!t,this.updateLayerConfig(r),this}setSelect(t,r){if(du(t)){const{x:i=0,y:a=0}=t;this.updateLayerConfig({selectColor:du(r)?r.color:this.getLayerConfig().selectColor,selectMix:du(r)?r.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:du(r)?r.color:this.getLayerConfig().selectColor,selectMix:du(r)?r.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Fs(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(t){this.currentPickId=t}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(t){this.selectedFeatureID=t}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const t=this.mapService.getZoom(),{visible:r,minZoom:i=-1/0,maxZoom:a=1/0}=this.getLayerConfig();return!!r&&t>=i&&t<a}setMultiPass(t,r){if(this.updateLayerConfig({enableMultiPassRenderer:t}),r&&this.updateLayerConfig({passes:r}),t){const{passes:i=[]}=this.getLayerConfig();this.multiPassRenderer=f1(this,i,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:a,height:u}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(a,u)}return this}setMinZoom(t){return this.updateLayerConfig({minZoom:t}),this}getMinZoom(){const{minZoom:t}=this.getLayerConfig();return t}getMaxZoom(){const{maxZoom:t}=this.getLayerConfig();return t}get(t){return this.getLayerConfig()[t]}setMaxZoom(t){return this.updateLayerConfig({maxZoom:t}),this}setAutoFit(t){return this.updateLayerConfig({autoFit:t}),this}fitBounds(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const i=this.getSource().extent;return i.some(u=>Math.abs(u)===1/0)?this:(this.mapService.fitBounds([[i[0],i[1]],[i[2],i[3]]],t),this)}destroy(t=!0){var r,i,a,u,h;if(this.isDestroyed)return;(r=this.layerModel)===null||r===void 0||r.uniformBuffers.forEach(g=>{g.destroy()}),this.layerChildren.map(g=>g.destroy(!1)),this.layerChildren=[];const{maskfence:m}=this.getLayerConfig();m&&(this.masks.map(g=>g.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(i=this.multiPassRenderer)===null||i===void 0||i.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(t),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],(h=this.debugService)===null||h===void 0||h.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var t;this.models.forEach(r=>r.destroy()),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(t=>t.needRescale||t.needRemapping||t.needRegenerateVertices).length}setSource(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const r=this.mapService.getZoom();this.layerSource.updateClusterData(r)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",({type:r})=>{if(this.coordCenter===void 0){var i;const a=this.layerSource.center;this.coordCenter=a,(i=this.mapService)!==null&&i!==void 0&&i.setCoordCenter&&this.mapService.setCoordCenter(a)}if(r==="update"){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(t){this.encodedData=t,this.encodeDataLength=t.length}getEncodedData(){return this.encodedData}getScale(t){return this.styleAttributeService.getLayerAttributeScale(t)}getLegend(t){var r,i,a;const u=this.styleAttributeService.getLayerStyleAttribute(t);return{type:(i=((u==null||(r=u.scale)===null||r===void 0?void 0:r.scalers)||[])[0])===null||i===void 0||(i=i.option)===null||i===void 0?void 0:i.type,field:u==null||(a=u.scale)===null||a===void 0?void 0:a.field,items:this.getLegendItems(t)}}getLegendItems(t){const r=this.styleAttributeService.getLayerAttributeScale(t);return r?r.invertExtent?r.range().map(a=>({value:r.invertExtent(a),[t]:a})):r.ticks?r.ticks().map(a=>({value:a,[t]:r(a)})):r!=null&&r.domain?r.domain().filter(a=>!wT(a)).map(a=>({value:a,[t]:r(a)})):[]:[]}pick({x:t,y:r}){this.interactionService.triggerHover({x:t,y:r})}boxSelect(t,r){this.pickingService.boxPickLayer(this,t,r)}buildLayerModel(t){var r=this;return(0,Yt.Z)(function*(){const{moduleName:i,vertexShader:a,fragmentShader:u,inject:h,triangulation:m,styleOption:g,pickingEnabled:E=!0}=t,A=(0,Ot.Z)(t,TT);r.shaderModuleService.registerModule(i,{vs:a,fs:u,inject:h});const{vs:w,fs:R,uniforms:U}=r.shaderModuleService.getModule(i),{createModel:q}=r.rendererService;return new Promise(ce=>{const{attributes:Se,elements:ke,count:Fe}=r.styleAttributeService.createAttributesAndIndices(r.encodedData,m,g,r),rt=[...r.layerModel.uniformBuffers,...r.rendererService.uniformBuffers,r.getLayerUniformBuffer()];E&&rt.push(r.getPickingUniformBuffer());const mt=(0,lt.Z)({attributes:Se,uniforms:U,fs:R,vs:w,elements:ke,blend:h1[ar.normal],uniformBuffers:rt,textures:r.layerModel.textures},A);Fe&&(mt.count=Fe);const er=q(mt);ce(er)})})()}createAttributes(t){const{triangulation:r}=t,{attributes:i}=this.styleAttributeService.createAttributes(this.encodedData,r);return i}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(t){const{enableHighlight:r=!0,enableSelect:i=!0}=this.getLayerConfig();let a=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&i&&(a=!0),t==="mousemove"&&(r||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(a=!0),this.isVisible()&&a}buildModels(){return(0,Yt.Z)(function*(){throw new Error("Method not implemented.")})()}rebuildModels(){var t=this;return(0,Yt.Z)(function*(){yield t.buildModels()})()}renderMulPass(t){return(0,Yt.Z)(function*(){yield t.render()})()}renderModels(t={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(r=>{r.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t),textures:this.layerModel.textures},(t==null?void 0:t.ispick)||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(t,r,i,a){const u=this.configService.getAttributeConfig(this.id)||{};return I_(u[t],{field:r,values:i})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,{[t]:{field:r,values:i}}),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,lt.Z)({field:r},this.splitValuesAndCallbackInAttribute(i,this.getLayerConfig()[r]))},a):this.pendingStyleAttributes.push({attributeName:t,attributeField:r,attributeValues:i,updateOptions:a}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(t){console.warn("empty fn")}processData(t){return t}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}initLayerModels(){var t=this;return(0,Yt.Z)(function*(){t.models.forEach(a=>a.destroy()),t.models=[],t.uniformBuffers.forEach(a=>{a.destroy()}),t.uniformBuffers=[];const r=t.rendererService.createBuffer({data:new Float32Array(16+4).fill(0),isUBO:!0});t.uniformBuffers.push(r);const i=t.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0});t.uniformBuffers.push(i),t.models=yield t.layerModel.initModels()})()}getLayerUniformBuffer(){return this.uniformBuffers[0]}getPickingUniformBuffer(){return this.uniformBuffers[1]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(t){return{values:p1(t)?void 0:t,callback:p1(t)?t:void 0}}}function RT(e,t){return{enable:e,mask:255,func:{cmp:F.EQUAL,ref:t?1:0,mask:1}}}function v1(e){return e.maskOperation===vr.OR?{enable:!0,mask:255,func:{cmp:F.ALWAYS,ref:1,mask:255},opFront:{fail:F.KEEP,zfail:F.REPLACE,zpass:F.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Jt.SINGLE||e.stencilIndex===0?F.ALWAYS:F.LESS,ref:e.stencilType===Jt.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:F.KEEP,zfail:F.REPLACE,zpass:F.REPLACE}}}const MT={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},a0={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function _1(e){return Math.max(Math.ceil(e/4)*4,4)}const P_={opacity:Ln.OPACITY,stroke:Ln.STROKE,offsets:Ln.OFFSETS,rotation:Ln.ROTATION,extrusionBase:Ln.EXTRUSION_BASE,thetaOffset:15};class Io{constructor(t){(0,P.Z)(this,"triangulation",void 0),(0,P.Z)(this,"uniformBuffers",[]),(0,P.Z)(this,"textures",[]),(0,P.Z)(this,"createTexture2D",void 0),(0,P.Z)(this,"preStyleAttribute",{}),(0,P.Z)(this,"encodeStyleAttribute",{}),(0,P.Z)(this,"layer",void 0),(0,P.Z)(this,"dataTexture",void 0),(0,P.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,P.Z)(this,"dataTextureTest",void 0),(0,P.Z)(this,"configService",void 0),(0,P.Z)(this,"shaderModuleService",void 0),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"iconService",void 0),(0,P.Z)(this,"fontService",void 0),(0,P.Z)(this,"styleAttributeService",void 0),(0,P.Z)(this,"mapService",void 0),(0,P.Z)(this,"cameraService",void 0),(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"pickingService",void 0),(0,P.Z)(this,"attributeUnifoms",void 0),(0,P.Z)(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:r}=this.rendererService;this.createTexture2D=r}getBlend(){const{blend:t="normal"}=this.layer.getLayerConfig();return h1[ar[t]]}getStencil(t){const{mask:r=!1,maskInside:i=!0,enableMask:a,maskOperation:u=vr.AND}=this.layer.getLayerConfig();if(this.layer.type==="MaskLayer")return v1({isStencil:!0,stencilType:Jt.SINGLE});if(t.isStencil)return v1((0,lt.Z)((0,lt.Z)({},t),{},{maskOperation:u}));const h=r||a&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return RT(h,i)}getDefaultStyle(){return{}}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const i=(0,lt.Z)((0,lt.Z)({},r.uniformsOption),t.uniformsOption);return Object.keys(i).forEach(a=>{typeof i[a]=="boolean"&&(i[a]=i[a]?1:0)}),!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}getAnimateUniforms(){return{}}needUpdate(){return(0,Yt.Z)(function*(){return!1})()}buildModels(){return(0,Yt.Z)(function*(){throw new Error("Method not implemented.")})()}initModels(){return(0,Yt.Z)(function*(){throw new Error("Method not implemented.")})()}clearModels(t=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(t){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}startModelAnimate(){const{animateOption:t}=this.layer.getLayerConfig();t.enable&&this.layer.setAnimateStartTime()}getInject(){const t=this.layer.encodeStyleAttribute;let r="";const i=[];this.layer.enableShaderEncodeStyles.forEach(h=>{t[h]?r+=`#define USE_ATTRIBUTE_${h.toUpperCase()} 0.0; 

`:i.push(`  ${a0[h]} u_${h};`);let m=P_[h];!m&&h==="THETA_OFFSET"&&(m=15),r+=`
          #ifdef USE_ATTRIBUTE_${h.toUpperCase()}
          layout(location = ${P_[h]}) in ${a0[h]} a_${h.charAt(0).toUpperCase()+h.slice(1)};
        #endif

        `});const a=i.length?`
layout(std140) uniform AttributeUniforms {
${i.join(`
`)}
};
    `:"";r+=a;let u="";return this.layer.enableShaderEncodeStyles.forEach(h=>{u+=`

    #ifdef USE_ATTRIBUTE_${h.toUpperCase()}
      ${a0[h]} ${h}  = a_${h.charAt(0).toUpperCase()+h.slice(1)};
    #else
      ${a0[h]} ${h} = u_${h};
    #endif

    `}),{"vs:#decl":r,"fs:#decl":a,"vs:#main-start":u}}getStyleAttribute(){const t={};return this.layer.enableShaderEncodeStyles.forEach(r=>{if(!this.layer.encodeStyleAttribute[r]){const i=this.layer.getLayerConfig()[r];let a=typeof i=="undefined"?MT[r]:i;r==="stroke"&&(a=ai(a)),t["u_"+r]=a}}),t}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(t=>{const r=hT(t);r&&(this.styleAttributeService.registerStyleAttribute(r),r.descriptor&&(r.descriptor.shaderLocation=P_[t]))})}updateEncodeAttribute(t,r){this.encodeStyleAttribute[t]=r}initUniformsBuffer(){const t=this.getUniformsBufferInfo(this.getStyleAttribute()),r=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(_1(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),r.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(_1(r.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(t){let r=0;const i=[];return Object.values(t).forEach(a=>{Array.isArray(a)?(i.push(...a),r+=a.length):typeof a=="number"?(i.push(a),r+=1):typeof a=="boolean"&&(i.push(Number(a)),r+=1)}),{uniformsOption:t,uniformsLength:r,uniformsArray:i}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var t,r;const{uniformsArray:i}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:a}=this.getCommonUniformsInfo();(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(i).buffer)}),(r=this.commonUnifoms)===null||r===void 0||r.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)})}}var IT=N(9187),Ac=N.n(IT);const g1=100,YO=36,qO=40;function y1(e){return e/180*Math.acos(-1)}function x1(e){const t=y1(e[0])+Math.PI/2,r=y1(e[1]),i=g1+Math.random()*.4,a=i*Math.cos(r)*Math.cos(t),u=i*Math.cos(r)*Math.sin(t),h=i*Math.sin(r);return[u,h,a]}function KO(e,t){const r=mat4.create(),i=mat4.create(),a=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);t=t||{},e=typeof e!="undefined"?e:1;const m=2+(typeof t.segments!="undefined"?t.segments:32),g=2*m,E=[],A=[],w=[],R=[],U=[],q=[];for(let ce=0;ce<=m;ce++){const Se=ce/m,ke=Se*Math.PI;for(let Fe=0;Fe<=g;Fe++){const rt=Fe/g,mt=rt*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-ke),mat4.identity(r),mat4.rotateY(r,r,mt),vec3.transformMat4(u,a,i),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),w.push(u.slice()),R.push(...u.slice()),vec3.normalize(u,u),U.push(...u.slice()),q.push([rt,1-Se]),R.push(rt,1-Se)}if(ce>0){const Fe=w.length;let rt=Fe-2*(g+1);for(;rt+g+2<Fe;rt++)E.push([rt,rt+1,rt+g+1]),A.push(rt,rt+1,rt+g+1),E.push([rt+g+1,rt+1,rt+g+2]),A.push(rt+g+1,rt+1,rt+g+2)}}return{cells:E,positions:w,uvs:q,positionsArr:R,indicesArr:A,normalArr:U}}var ii=N(31437);const s0=ii.Ue(),$O=ii.Ue(),Is=ii.Ue(),Xh=ii.Ue(),Dd=ii.Ue();function O_(e,t,r,i,a){ii.IH(e,r,i),ii.Fv(e,e),t=ii.al(-e[1],e[0]);const u=ii.al(-r[1],r[0]);return[a/ii.AK(t,u),t]}function Yh(e,t){return ii.t8(e,-t[1],t[0])}function Ld(e,t,r){return ii.lu(e,t,r),ii.Fv(e,e),e}function D_(e,t){return e[0]===t[0]&&e[1]===t[1]}function QO(e){const t=new Map;for(let r=0;r<e.length;r++){const i=e[0].toString()+"-"+e[1].toString();t.get(i)?(e.splice(r,1),r++):t.set(i,i)}return e}class PT{constructor(t={}){(0,P.Z)(this,"complex",void 0),(0,P.Z)(this,"join",void 0),(0,P.Z)(this,"cap",void 0),(0,P.Z)(this,"miterLimit",void 0),(0,P.Z)(this,"thickness",void 0),(0,P.Z)(this,"normal",void 0),(0,P.Z)(this,"lastFlip",-1),(0,P.Z)(this,"miter",ii.al(0,0)),(0,P.Z)(this,"started",!1),(0,P.Z)(this,"dash",!1),(0,P.Z)(this,"totalDistance",0),(0,P.Z)(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let a=r.startIndex;for(let u=1;u<i;u++){const h=t[u-1],m=t[u],g=u<t.length-1?t[u+1]:null,E=this.simpleSegment(r,a,h,m,g);a+=E}if(this.dash)for(let u=0;u<r.positions.length/6;u++)r.positions[u*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}simpleExtrude_gaode2(t,r){const i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const a=t.length;let u=i.startIndex;for(let E=1;E<a;E++){var h,m,g;const A=t[E-1];A.push((h=r[E-1][2])!==null&&h!==void 0?h:0);const w=r[E-1],R=t[E];R.push((m=r[E][2])!==null&&m!==void 0?m:0);const U=r[E],q=E<t.length-1?[...t[E+1],(g=r[E+1][2])!==null&&g!==void 0?g:0]:null,ce=E<r.length-1?r[E+1]:null,Se=this.simpleSegment(i,u,A,R,q,w,U,ce);u+=Se}if(this.dash)for(let E=0;E<i.positions.length/6;E++)i.positions[E*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}extrude_gaode2(t,r){const i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const a=t.length;let u=i.startIndex;for(let E=1;E<a;E++){var h,m,g;const A=t[E-1];A.push((h=r[E-1][2])!==null&&h!==void 0?h:0);const w=r[E-1],R=t[E];R.push((m=r[E][2])!==null&&m!==void 0?m:0);const U=r[E],q=E<t.length-1?[...t[E+1],(g=r[E+1][2])!==null&&g!==void 0?g:0]:null,ce=E<r.length-1?r[E+1]:null,Se=this.segment_gaode2(i,u,A,R,q,w,U,ce);u+=Se}if(this.dash)for(let E=0;E<i.positions.length/6;E++)i.positions[E*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}extrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let a=r.startIndex;for(let u=1;u<i;u++){const h=t[u-1],m=t[u],g=u<t.length-1?t[u+1]:null,E=this.segment(r,a,h,m,g);a+=E}if(this.dash)for(let u=0;u<r.positions.length/6;u++)r.positions[u*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}simpleSegment(t,r,i,a,u){let h=0;const m=t.indices,g=t.positions,E=t.normals,A=zi([a[0],a[1]]),w=zi([i[0],i[1]]);Ld(Is,A,w);let R=0;if(this.dash&&(R=this.lineSegmentDistance(A,w),this.totalDistance+=R),this.normal||(this.normal=ii.Ue(),Yh(this.normal,Is)),this.started||(this.started=!0,this.extrusions(g,E,i,this.normal,this.thickness,this.totalDistance-R)),m.push(r+0,r+1,r+2),!u)Yh(this.normal,Is),this.extrusions(g,E,a,this.normal,this.thickness,this.totalDistance),m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),h+=2;else{const U=zi([u[0],u[1]]);D_(A,U)&&ii.IH(U,A,ii.Fv(U,ii.$X(U,A,w))),Ld(Xh,U,A);const[q,ce]=O_(Dd,ii.Ue(),Is,Xh,this.thickness);let Se=ii.AK(Dd,this.normal)<0?-1:1;this.extrusions(g,E,a,ce,q,this.totalDistance),m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),Se=-1,ii.JG(this.normal,ce),h+=2,this.lastFlip=Se}return h}segment_gaode2(t,r,i,a,u,h,m,g){let E=0;const A=t.indices,w=t.positions,R=t.normals,U=this.cap==="square",q=this.join==="bevel",ce=zi([m[0],m[1]]),Se=zi([h[0],h[1]]);Ld(Is,a,i);let ke=0;if(this.dash&&(ke=this.lineSegmentDistance(ce,Se),this.totalDistance+=ke),this.normal||(this.normal=ii.Ue(),Yh(this.normal,Is)),!this.started)if(this.started=!0,U){const Fe=ii.Ue(),rt=ii.Ue();ii.IH(Fe,this.normal,Is),ii.IH(rt,this.normal,Is),R.push(rt[0],rt[1],0),R.push(Fe[0],Fe[1],0),w.push(i[0],i[1],i[2]|0,this.totalDistance-ke,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),w.push(i[0],i[1],i[2]|0,this.totalDistance-ke,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,R,i,this.normal,this.thickness,this.totalDistance-ke);if(A.push(r+0,r+1,r+2),u){D_(a,u)&&ii.IH(u,a,ii.Fv(u,ii.$X(u,a,i))),Ld(Xh,u,a);const[Fe,rt]=O_(Dd,ii.Ue(),Is,Xh,this.thickness);let mt=ii.AK(Dd,this.normal)<0?-1:1,er=q;!er&&this.join==="miter"&&Fe>this.miterLimit&&(er=!0),er?(R.push(this.normal[0],this.normal[1],0),R.push(rt[0],rt[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*mt,a[2]|0),this.complex.indexes.push(this.currentIndex),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*mt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push(...this.lastFlip!==-mt?[r,r+2,r+3]:[r+2,r+1,r+3]),A.push(r+2,r+3,r+4),Yh(s0,Xh),ii.JG(this.normal,s0),R.push(this.normal[0],this.normal[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*mt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(w,R,a,rt,Fe,this.totalDistance),A.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),mt=-1,ii.JG(this.normal,rt),E+=2),this.lastFlip=mt}else{if(Yh(this.normal,Is),U){const Fe=ii.Ue(),rt=ii.Ue();ii.lu(rt,Is,this.normal),ii.IH(Fe,Is,this.normal),R.push(rt[0],rt[1],0),R.push(Fe[0],Fe[1],0),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),w.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(w,R,a,this.normal,this.thickness,this.totalDistance);A.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),E+=2}return E}segment(t,r,i,a,u){let h=0;const m=t.indices,g=t.positions,E=t.normals,A=this.cap==="square",w=this.join==="bevel",R=zi([a[0],a[1]]),U=zi([i[0],i[1]]);Ld(Is,R,U);let q=0;if(this.dash&&(q=this.lineSegmentDistance(R,U),this.totalDistance+=q),this.normal||(this.normal=ii.Ue(),Yh(this.normal,Is)),!this.started)if(this.started=!0,A){const ce=ii.Ue(),Se=ii.Ue();ii.IH(ce,this.normal,Is),ii.IH(Se,this.normal,Is),E.push(Se[0],Se[1],0),E.push(ce[0],ce[1],0),g.push(i[0],i[1],i[2]|0,this.totalDistance-q,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),g.push(i[0],i[1],i[2]|0,this.totalDistance-q,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,i,this.normal,this.thickness,this.totalDistance-q);if(m.push(r+0,r+1,r+2),u){const ce=zi([u[0],u[1]]);D_(R,ce)&&ii.IH(ce,R,ii.Fv(ce,ii.$X(ce,R,U))),Ld(Xh,ce,R);const[Se,ke]=O_(Dd,ii.Ue(),Is,Xh,this.thickness);let Fe=ii.AK(Dd,this.normal)<0?-1:1,rt=w;!rt&&this.join==="miter"&&Se>this.miterLimit&&(rt=!0),rt?(E.push(this.normal[0],this.normal[1],0),E.push(ke[0],ke[1],0),g.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Fe,a[2]|0),this.complex.indexes.push(this.currentIndex),g.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Fe,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,m.push(...this.lastFlip!==-Fe?[r,r+2,r+3]:[r+2,r+1,r+3]),m.push(r+2,r+3,r+4),Yh(s0,Xh),ii.JG(this.normal,s0),E.push(this.normal[0],this.normal[1],0),g.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Fe,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h+=3):(this.extrusions(g,E,a,ke,Se,this.totalDistance),m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),Fe=-1,ii.JG(this.normal,ke),h+=2),this.lastFlip=Fe}else{if(Yh(this.normal,Is),A){const ce=ii.Ue(),Se=ii.Ue();ii.lu(Se,Is,this.normal),ii.IH(ce,Is,this.normal),E.push(Se[0],Se[1],0),E.push(ce[0],ce[1],0),g.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),g.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,a,this.normal,this.thickness,this.totalDistance);m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),h+=2}return h}extrusions(t,r,i,a,u,h){r.push(a[0],a[1],0),r.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,h,-u,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,h,u,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(t,r){const i=r[0]-t[0],a=r[1]-t[1];return Math.sqrt(i*i+a*a)}}var Go=N(77160);function OT(e){const t=e[0][0],r=e[0][e[0].length-1];t[0]===r[0]&&t[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));const i=e[0].length,a=Ac().flatten(e),{vertices:u,dimensions:h}=a,m=[],g=[];for(let A=0;A<u.length/h;A++)h===2?m.push(u[A*2],u[A*2+1],1):m.push(u[A*3],u[A*3+1],1);const E=Ac()(a.vertices,a.holes,a.dimensions);g.push(...E);for(let A=0;A<i;A++){const w=a.vertices.slice(A*h,(A+1)*h);let R=a.vertices.slice((A+1)*h,(A+2)*h);R.length===0&&(R=a.vertices.slice(0,h));const U=m.length/3;m.push(w[0],w[1],1,R[0],R[1],1,w[0],w[1],0,R[0],R[1],0),g.push(...[0,2,1,2,3,1].map(q=>q+U))}return{positions:m,index:g}}function DT(e){const t=Ac().flatten(e),r=Ac()(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:r}}function E1(e,t=!1){const r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));const a=e[0].length,u=Ac().flatten(e),{vertices:h,dimensions:m}=u,g=[],E=[],A=[];for(let R=0;R<h.length/m;R++)g.push(h[R*m],h[R*m+1],1,-1,-1),A.push(0,0,1);const w=Ac()(u.vertices,u.holes,u.dimensions);E.push(...w);for(let R=0;R<a;R++){const U=u.vertices.slice(R*m,(R+1)*m);let q=u.vertices.slice((R+1)*m,(R+2)*m);q.length===0&&(q=u.vertices.slice(0,m));const ce=g.length/5;g.push(U[0],U[1],1,0,0,q[0],q[1],1,.1,0,U[0],U[1],0,0,.8,q[0],q[1],0,.1,.8);const Se=LT([q[0],q[1],1],[U[0],U[1],0],[U[0],U[1],1],t);A.push(...Se,...Se,...Se,...Se),E.push(...[1,2,0,3,2,1].map(ke=>ke+ce))}return{positions:g,index:E,normals:A}}function LT(e,t,r,i=!1){const a=Go.Ue(),u=Go.Ue(),h=Go.Ue();i&&(e=Au(e),t=Au(t),r=Au(r));const m=Go.al(...e),g=Go.al(...t),E=Go.al(...r);Go.lu(a,E,g),Go.lu(u,m,g),Go.kC(h,a,u);const A=Go.Ue();return Go.Fv(A,h),A}let Nm=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),km=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Um(e,t=0){const r=Math.PI*2/e,i=[];for(let u=0;u<e;u++)i.push(r*u+t*Math.PI/12);return i.map(u=>{const h=Math.sin(u+Math.PI/4),m=Math.cos(u+Math.PI/4);return[h,m,0]})}function L_(){return Um(30)}function b1(){return Um(4)}function S1(){return Um(3)}function A1(){return Um(6,1)}function T1(){return Um(5)}const Fd={[km.CIRCLE]:L_,[km.HEXAGON]:A1,[km.TRIANGLE]:S1,[km.SQUARE]:b1,[km.PENTAGON]:T1,[Nm.CYLINDER]:L_,[Nm.HEXAGONCOLUMN]:A1,[Nm.TRIANGLECOLUMN]:S1,[Nm.SQUARECOLUMN]:b1,[Nm.PENTAGONCOLUMN]:T1},u0={};function Wp(e){const t=Ko(e.coordinates);return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function C1(e){const t=Ko(e.coordinates),r=x1(t);return{vertices:[...r,...r,...r,...r],indices:[0,1,2,2,3,0],size:r.length}}function F_(e){const{shape:t}=e,{positions:r,index:i,normals:a}=VT(t,!1);return{vertices:r,indices:i,normals:a,size:5}}function FT(e){const t=Ko(e.coordinates);return{vertices:[...t],indices:[0],size:t.length}}function B_(e){const{coordinates:t,originCoordinates:r,version:i}=e,a=new PT({dash:!0,join:"bevel"});if(i==="GAODE2.x"){let h=t;Array.isArray(h[0][0])||(h=[t]);let m=r;Array.isArray(m[0][0])||(m=[r]);for(let g=0;g<h.length;g++){const E=h[g],A=m[g];a.extrude_gaode2(E,A)}}else{let h=t;h[0]&&!Array.isArray(h[0][0])&&(h=[t]),h.forEach(m=>{a.extrude(m)})}const u=a.complex;return{vertices:u.positions,indices:u.indices,normals:u.normals,indexes:u.indexes,size:6}}function JO(e){const t=e.coordinates.flat(),r=1,i=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-r,2*i,1,2*i,-i,1,i,-i,1,i,-i,1,-r,-i,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function BT(e){const{coordinates:t,originCoordinates:r}=e,i=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:a,totalDistance:u}=NT(t,r);return a.map(h=>{i.push(h[0],h[1],h[2],h[3],0,u)}),{vertices:i,indices:[],normals:[],size:6,count:a.length}}function e4(e){const{coordinates:t}=e,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],size:4,count:0};const{results:i}=kT(t);return i.map(a=>{r.push(a[0],a[1],a[2],a[3])}),{vertices:r,indices:[],size:4,count:i.length}}function w1(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function Bd(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function NT(e,t){let r=e,i=t||e;Array.isArray(r)&&Array.isArray(r[0])&&Array.isArray(r[0][0])&&(r=t.flat(),i=t.flat());let a=0;if(r.length<2)return{results:r,totalDistance:0};{const u=[],h=Bd(r[0],a);u.push(h);for(let g=1;g<r.length-1;g++){const E=w1(zi(i[g-1]),zi(i[g]));a+=E;const A=Bd(r[g],a);u.push(A),u.push(A)}const m=w1(zi(i[i.length-2]),zi(i[i.length-1]));return a+=m,u.push(Bd(r[r.length-1],a)),{results:u,totalDistance:a}}}function kT(e){if(e.length<2)return{results:e};{const t=[],r=Bd(e[0]);t.push(r);for(let i=1;i<e.length-1;i++){const a=Bd(e[i]);t.push(a),t.push(a)}return t.push(Bd(e[e.length-1])),{results:t}}}function l0(e){const{coordinates:t}=e,r=Ac().flatten(t),{vertices:i,dimensions:a,holes:u}=r;return{indices:Ac()(i,u,a),vertices:i,size:a}}function UT(e){const{coordinates:t}=e,r=Ac().flatten(t),{vertices:i,dimensions:a,holes:u}=r;return{indices:Ac()(i,u,a),vertices:zT(i),size:a+4}}function zT(e){const t=[],{center:r,radius:i}=Tu(e);for(let a=0;a<e.length;a+=2){const u=e[a],h=e[a+1];t.push(u,h,0,...r,i)}return t}function N_(e){const t=e.coordinates,{positions:r,index:i,normals:a}=E1(t,!0);return{vertices:r,indices:i,normals:a,size:5}}function R1(e){const{shape:t}=e,{positions:r,index:i}=jT(t);return{vertices:r,indices:i,size:3}}function c0(e){const t=e.coordinates;return{vertices:[...t[0],0,0,0,...t[1],0,1,0,...t[2],0,1,1,...t[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function k_(e,t){const{segmentNumber:r=30}=t,i=e.coordinates,a=[],u=[];for(let h=0;h<r;h++)a.push(h,1,h,i[0][0],i[0][1],i[1][0],i[1][1],h,-1,h,i[0][0],i[0][1],i[1][0],i[1][1]),h!==r-1&&u.push(...[0,1,2,1,3,2].map(m=>h*2+m));return{vertices:a,indices:u,size:7}}function M1(e){const t=e.coordinates;t.length===2&&t.push(0);const r=f0(-1,1),i=f0(1,1),a=f0(-1,-1),u=f0(1,-1);return{vertices:[...t,...r,...t,...a,...t,...u,...t,...i],indices:[0,1,2,3,0,2],size:5}}function VT(e,t=!1){if(u0&&u0[e])return u0[e];const r=Fd[e]?Fd[e]():Fd.cylinder(),i=E1([r],t);return u0[e]=i,i}function t4(e,t,r=3,i=!1){const a=new Float32Array(e.length/r*3);let u,h,m;const g=vec3.create(),E=vec3.create(),A=vec3.create();for(let w=0,R=t.length;w<R;w+=3){u=t[w+0]*3,h=t[w+1]*3,m=t[w+2]*3;let U=[e[u],e[u+1]],q=[e[h],e[h+1]],ce=[e[m],e[m+1]];i&&(U=lngLatToMeters(U),q=lngLatToMeters(q),ce=lngLatToMeters(ce));const[Se,ke]=U,Fe=vec3.fromValues(Se,ke,e[u+2]),[rt,mt]=q,er=vec3.fromValues(rt,mt,e[h+2]),[cr,kt]=ce,dr=vec3.fromValues(cr,kt,e[m+2]);vec3.sub(g,dr,er),vec3.sub(E,Fe,er),vec3.cross(A,g,E),a[u]+=g[0],a[u+1]+=g[1],a[u+2]+=g[2],a[h]+=g[0],a[h+1]+=g[1],a[h+2]+=g[2],a[m]+=g[0],a[m+1]+=g[1],a[m+2]+=g[2]}return ZT(a),a}function ZT(e){for(let t=0,r=e.length;t<r;t+=3){const i=vec3.fromValues(e[t],e[t+1],e[t+2]),a=vec3.create();vec3.normalize(a,i),e.set(a,t)}}function r4(e){const t=e[0][0],r=e[0][e[0].length-1];return t[0]===r[0]&&t[1]===r[1]}function jT(e){const t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Fd[e]?Fd[e]():Fd.circle();return t.indexOf(e)===-1?DT([r]):OT([r])}function f0(e,t){const r=(e+1)/2,i=(t+1)/2;return[r,i]}function n4(){const e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),{positionsArr:t,indicesArr:r,normalArr:i}=e;return{vertices:t,indices:r,size:5,normals:i}}function i4(){const e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),{positionsArr:t,indicesArr:r,normalArr:i}=e;return{vertices:t,indices:r,size:5,normals:i}}const HT=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }
   
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,WT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`;class GT extends Io{constructor(...t){super(...t),(0,P.Z)(this,"cityCenter",void 0),(0,P.Z)(this,"cityMinSize",void 0)}getCommonUniformsInfo(){const{opacity:t=1,baseColor:r="rgb(16,16,16)",brightColor:i="rgb(255,176,38)",windowColor:a="rgb(30,60,89)",time:u=0,sweep:h={enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}}=this.layer.getLayerConfig(),m={u_baseColor:ai(r),u_brightColor:ai(i),u_windowColor:ai(a),u_circleSweepColor:[...ai(h.sweepColor).slice(0,3),1],u_cityCenter:h.sweepCenter||this.cityCenter,u_circleSweep:h.enable?1:0,u_cityMinSize:this.cityMinSize*h.sweepRadius,u_circleSweepSpeed:h.sweepSpeed,u_opacity:t,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||u};return this.getUniformsBufferInfo(m)}calCityGeo(){const[t,r,i,a]=this.layer.getSource().extent;if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(i+t)/2,(a+r)/2]);const u=this.mapService.lngLatToCoord([i,a]),h=this.mapService.lngLatToCoord([t,r]);this.cityMinSize=Math.sqrt(Math.pow(u[0]-h[0],2)+Math.pow(u[1]-h[1],2))/4}else{const u=i-t,h=a-r;this.cityCenter=[(i+t)/2,(a+r)/2],this.cityMinSize=Math.sqrt(Math.pow(u,2)+Math.pow(h,2))/4}}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.calCityGeo(),t.initUniformsBuffer(),t.startModelAnimate(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return[yield t.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:WT,fragmentShader:HT,triangulation:N_,depth:{enable:!0},inject:t.getInject(),cull:{enable:!0,face:F.BACK}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=10}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_Uv",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}class XT extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","CityBuildingLayer")}buildModels(){var t=this;return(0,Yt.Z)(function*(){t.layerModel=new GT(t),yield t.initLayerModels()})()}setLight(t){this.updateLayerConfig({time:t})}getModelType(){return"citybuilding"}}function I1(e,t){return{type:e.type,field:"value",items:e.positions.map((r,i)=>({[t]:i>=e.colors.length?null:e.colors[i],value:r}))}}const YT=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,qT=`layout(location = 0) in vec3 a_Position;\r
layout(location = 1) in vec4 a_Color;\r
layout(location = 10) in vec3 a_Pos;\r
\r
layout(std140) uniform commonUniforms {\r
    vec2 u_radius;\r
    float u_opacity;\r
    float u_coverage;\r
    float u_angle;\r
};\r
\r
\r
out vec4 v_color;\r
\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
  v_color.a *= u_opacity;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`;class KT extends Io{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:i}=this.layer.getLayerConfig(),a={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:i||0};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:qT,fragmentShader:YT,triangulation:R1,primitive:F.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Kt.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:t=>{const r=t.version==="GAODE2.x"?t.originCoordinates:t.coordinates;return[r[0],r[1],0]}}})}}const $T=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,QT=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  setPickingColor(a_PickingColor);
}
`;class JT extends Io{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:i}=this.layer.getLayerConfig(),a={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:i||0};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:QT,fragmentShader:$T,triangulation:F_,primitive:F.TRIANGLES,depth:{enable:!0}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{shaderLocation:Ln.SIZE,name:"a_Size",buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Kt.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:t=>{const r=t.version==="GAODE2.x"?t.originCoordinates:t.coordinates;return[r[0],r[1],0]}}})}}function e3(e,t){const r=[],i=[],a=[],u=e+1,h=t+1,m=e/2,g=t/2;for(let E=0;E<h;E++){const A=E-g;for(let w=0;w<u;w++){const R=w-m;i.push(R/m,-A/g,0),a.push(w/e),a.push(1-E/t)}}for(let E=0;E<t;E++)for(let A=0;A<e;A++){const w=A+u*E,R=A+u*(E+1),U=A+1+u*(E+1),q=A+1+u*E;r.push(w,R,q),r.push(R,U,q)}return{vertices:i,indices:r,uvs:a}}const t3=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,r3=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,n3=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,i3=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,o3=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,a3=`layout(location = 0) in vec3 a_Position;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_Dir;


layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"
#pragma include "picking"

void main(){
    vec3 picking_color_placeholder = u_PickingColor;

    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,{isEqual:s3}=Yn;class P1 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"colorTexture",void 0),(0,P.Z)(this,"heatmapFramerBuffer",void 0),(0,P.Z)(this,"heatmapTexture",void 0),(0,P.Z)(this,"intensityModel",void 0),(0,P.Z)(this,"colorModel",void 0),(0,P.Z)(this,"shapeType",void 0),(0,P.Z)(this,"preRampColors",void 0),(0,P.Z)(this,"colorModelUniformBuffer",[]),(0,P.Z)(this,"heat3DModelUniformBuffer",[])}prerender(){const{clear:t,useFramebuffer:r}=this.rendererService;r(this.heatmapFramerBuffer,()=>{t({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()})}render(t){const{rampColors:r}=this.layer.getLayerConfig();s3(this.preRampColors,r)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(t):this.draw3DHeatMap(t)}getUninforms(){throw new Error("Method not implemented.")}initModels(){var t=this;return(0,Yt.Z)(function*(){var r;const{createFramebuffer:i,getViewportSize:a,createTexture2D:u}=t.rendererService,h=t.styleAttributeService.getLayerStyleAttribute("shape"),m=(h==null||(r=h.scale)===null||r===void 0?void 0:r.field)||"heatmap";t.shapeType=m,t.intensityModel=yield t.buildHeatMapIntensity(),t.colorModel=m==="heatmap"?t.buildHeatmap():t.build3dHeatMap();const{width:g,height:E}=a();return t.heatmapTexture=u({width:Math.floor(g/4),height:Math.floor(E/4),wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE,min:F.LINEAR,mag:F.LINEAR,usage:qe.RENDER_TARGET}),t.heatmapFramerBuffer=i({color:t.heatmapTexture,depth:!0,width:Math.floor(g/4),height:Math.floor(E/4)}),t.updateColorTexture(),[t.intensityModel,t.colorModel]})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Kt.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=1}=t;return[r]}}})}buildHeatMapIntensity(){var t=this;return(0,Yt.Z)(function*(){return t.uniformBuffers=[t.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],t.layer.triangulation=M1,yield t.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:a3,fragmentShader:o3,triangulation:M1,depth:{enable:!1},cull:{enable:!0,face:Al(t.mapService.version)}})})()}buildHeatmap(){this.shaderModuleService.registerModule("heatmapColor",{vs:i3,fs:n3}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("heatmapColor"),{createAttribute:a,createElements:u,createBuffer:h,createModel:m}=this.rendererService;return m({vs:t,fs:r,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:a({shaderLocation:Ln.POSITION,buffer:h({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:F.FLOAT}),size:3}),a_Uv:a({shaderLocation:Ln.UV,buffer:h({data:[0,1,1,1,0,0,1,0],type:F.FLOAT}),size:2})},uniforms:(0,lt.Z)({},i),depth:{enable:!1},elements:u({data:[0,2,1,2,3,1],type:F.UNSIGNED_INT,count:6})})}drawIntensityMode(){var t;const{intensity:r=10,radius:i=5}=this.layer.getLayerConfig(),a={u_radius:i,u_intensity:r};this.uniformBuffers[0].subData({offset:0,data:[i,r]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:a,blend:{enable:!0,func:{srcRGB:F.ONE,srcAlpha:1,dstRGB:F.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(t){var r;const{opacity:i=1}=this.layer.getLayerConfig(),a={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},u=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[i]}),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:a,textures:u,blend:this.getBlend(),stencil:this.getStencil(t)})}draw3DHeatMap(t){var r;const{opacity:i=1}=this.layer.getLayerConfig(),a=no.create();no.invert(a,this.cameraService.getViewProjectionMatrixUncentered());const u={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[...a]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...u.u_ViewProjectionMatrixUncentered,...u.u_InverseViewProjectionMatrix,i]});const h=[this.heatmapTexture,this.colorTexture];(r=this.colorModel)===null||r===void 0||r.draw({uniforms:u,textures:h,blend:{enable:!0,func:{srcRGB:F.SRC_ALPHA,srcAlpha:1,dstRGB:F.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}build3dHeatMap(){const{getViewportSize:t}=this.rendererService,{width:r,height:i}=t(),a=e3(r/4,i/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:r3,fs:t3}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];const{vs:u,fs:h,uniforms:m}=this.shaderModuleService.getModule("heatmap3dColor"),{createAttribute:g,createElements:E,createBuffer:A,createModel:w}=this.rendererService;return w({vs:u,fs:h,attributes:{a_Position:g({shaderLocation:Ln.POSITION,buffer:A({data:a.vertices,type:F.FLOAT}),size:3}),a_Uv:g({shaderLocation:Ln.UV,buffer:A({data:a.uvs,type:F.FLOAT}),size:2})},primitive:F.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:(0,lt.Z)({},m),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:F.SRC_ALPHA,srcAlpha:1,dstRGB:F.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:E({data:a.indices,type:F.UNSIGNED_INT,count:a.indices.length})})}updateColorTexture(){const{createTexture2D:t}=this.rendererService;this.texture&&this.texture.destroy();const{rampColors:r}=this.layer.getLayerConfig(),i=au(r);this.colorTexture=t({data:i.data,usage:qe.SAMPLED,width:i.width,height:i.height,wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE,min:F.NEAREST,mag:F.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=r}}const u3=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,l3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 10) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`;class c3 extends Io{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:i}=this.layer.getLayerConfig(),a={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:i||0};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:l3,fragmentShader:u3,triangulation:R1,depth:{enable:!1},primitive:F.TRIANGLES})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Kt.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:t=>{const r=t.version==="GAODE2.x"?t.originCoordinates:t.coordinates;return[r[0],r[1],0]}}})}}var f3={heatmap:P1,heatmap3d:P1,grid:KT,grid3d:JT,hexagon:c3};class h3 extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","HeatMapLayer")}buildModels(){var t=this;return(0,Yt.Z)(function*(){const r=t.getModelType();t.layerModel=new f3[r](t),yield t.initLayerModels()})()}prerender(){this.getModelType()==="heatmap"&&this.layerModel&&this.layerModel.prerender()}renderModels(t={}){return this.getModelType()==="heatmap"?(this.layerModel&&this.layerModel.render(t),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(i=>i.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t)})),this.hooks.afterRender.call(),this)}updateModelData(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}getModelType(){var t;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),{shape3d:i}=this.getLayerConfig(),u=this.getSource().data.type,h=(r==null||(t=r.scale)===null||t===void 0?void 0:t.field)||"heatmap";return h==="heatmap"||h==="heatmap3d"?"heatmap":u==="hexagon"?(i==null?void 0:i.indexOf(h))===-1?"hexagon":"grid3d":u==="grid"?(i==null?void 0:i.indexOf(h))===-1?"grid":"grid3d":"heatmap"}getLegend(t){if(this.getModelType()==="heatmap"){if(t!=="color")return{type:void 0,field:void 0,items:[]};const r=this.getLayerConfig().rampColors;return I1(r,t)}else return super.getLegend(t)}}const p3=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,m3=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`;class v3 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0)}getCommonUniformsInfo(){const{opacity:t,brightness:r,contrast:i,saturation:a,gamma:u}=this.layer.getLayerConfig(),h={u_opacity:Kr(t,1),u_brightness:Kr(r,1),u_contrast:Kr(i,1),u_saturation:Kr(a,1),u_gamma:Kr(u,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(h)}initModels(){var t=this;return(0,Yt.Z)(function*(){return yield t.loadTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}loadTexture(){var t=this;return(0,Yt.Z)(function*(){const{createTexture2D:r}=t.rendererService;t.texture=r({height:1,width:1});const a=yield t.layer.getSource().data.images;t.texture=r({data:a[0],width:a[0].width,height:a[0].height,mag:F.LINEAR,min:F.LINEAR})})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:m3,fragmentShader:p3,triangulation:c0,primitive:F.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_Uv",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}var _3={image:v3};class O1 extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","ImageLayer")}buildModels(){var t=this;return(0,Yt.Z)(function*(){const r=t.getModelType();t.layerModel=new _3[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{image:{}}[t]}getModelType(){return"image"}}const g3=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,y3=`#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9



  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  //\u8BA1\u7B97dashArray\u548CdistanceRatio \u8F93\u51FA\u5230\u7247\u5143
  vec2 s = source;
  vec2 t = target;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,x3={solid:0,dash:1};class E3 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:F.NEAREST,min:F.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5],forward:h=!0,lineTexture:m=!1,iconStep:g=100,segmentNumber:E=30}=this.layer.getLayerConfig(),{animateOption:A}=this.layer.getLayerConfig();let w=u;a!=="dash"&&(w=[0,0]),w.length===2&&w.push(0,0);let R=0,U=[0,0,0,0],q=[0,0,0,0];if(t&&r&&(U=ai(t),q=ai(r),R=1),this.rendererService.getDirty()){var ce;(ce=this.texture)===null||ce===void 0||ce.bind()}const Se={u_animate:this.animateOption2Array(A),u_dash_array:w,u_sourceColor:U,u_targetColor:q,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:E,u_lineDir:h?1:-1,u_icon_step:g,u_line_texture:m?1:0,u_textureBlend:i==="normal"?0:1,u_blur:.9,u_line_type:x3[a||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:R};return this.getUniformsBufferInfo(Se)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:g3,vert:y3,type:""}}buildModels(){var t=this;return(0,Yt.Z)(function*(){t.initUniformsBuffer();const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:i,vert:a,type:u}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc2d"+u,vertexShader:a,fragmentShader:i,inject:t.getInject(),triangulation:k_,depth:{enable:!1},styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Kt.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}const b3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

// varying vec2 v_normal;
in vec4 v_dash_array;
in vec4 v_color;
in vec4 v_line_data;
in float v_segmentIndex;
in vec2 v_iconMapUV;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,S3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,A3={solid:0,dash:1};class D1 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:F.NEAREST,min:F.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5],lineTexture:h=!1,iconStep:m=100,segmentNumber:g=30,globalArcHeight:E=10}=this.layer.getLayerConfig(),{animateOption:A}=this.layer.getLayerConfig();u.length===2&&u.push(0,0);let w=0,R=[0,0,0,0],U=[0,0,0,0];if(t&&r&&(R=ai(t),U=ai(r),w=1),this.rendererService.getDirty()){var q;(q=this.texture)===null||q===void 0||q.bind()}const ce={u_animate:this.animateOption2Array(A),u_dash_array:u,u_sourceColor:R,u_targetColor:U,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:g1,u_global_height:E,segmentNumber:g,u_line_type:A3[a]||0,u_icon_step:m,u_line_texture:h?1:0,u_textureBlend:i==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:w};return this.getUniformsBufferInfo(ce)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:b3,vert:S3,type:""}}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:i,vert:a,type:u}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc3d"+u,vertexShader:a,fragmentShader:i,inject:t.getInject(),triangulation:k_,styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Kt.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}const L1={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},yl=1/2;function T3(e,t){const{width:r=2,height:i=1}=t;return{vertices:[0,yl*e,1*e*r,-(i+yl)*e,1*e*r,(i-yl)*e,0,yl*e,1*e*r,-(i+yl)*e,1*e*r,(i-yl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function C3(e,t){const{width:r=2,height:i=3}=t;return{vertices:[0,0,1*e*r,1*i,1*e*r,-1*i,0,0,1*e*r,1*i,1*e*r,-1*i],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function w3(e,t){const{width:r=2,height:i=2}=t;return{vertices:[0,i/2,e*r*1,i/2,e*r*1,-i/2,0,-i/2,0,i/2,e*r*1,i/2,e*r*1,-i/2,0,-i/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function R3(e,t){const{width:r=2,height:i=3}=t;return{vertices:[0,0,1*r*e,.5*i,2*r*e,0,1*r*e,-.5*i,0,0,1*r*e,.5*i,2*r*e,0,1*r*e,-.5*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function M3(e,t){const{width:r=2,height:i=3}=t;return{vertices:[0,0,2*e*r,1*i,1.5*e*r,0,2*e*r,-1*i,0,0,2*e*r,1*i,1.5*e*r,0,2*e*r,-1*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function I3(e,t){const{width:r=2,height:i=2}=t,a=L_(),u=Ac().flatten([a]),h=Ac()(u.vertices,u.holes,u.dimensions),m=a.map(g=>[g[0]*r*e,g[1]*i]).flat();return{vertices:[...m,...m],dimensions:2,indices:h.map(g=>g+a.length),outLineIndices:h,normals:[...a.map(g=>[g[1]*i,g[0]*r*e,1]).flat(),...new Array(a.length*3).fill(0)]}}function P3(e,t=0,r){const i=typeof r.source=="object"?r.source.type:r.source,a=typeof r.target=="object"?r.target.type:r.target,{width:u=i?L1[i]:0}=typeof r.source=="object"?r.source:{},{width:h=a?L1[a]:0}=typeof r.target=="object"?r.target:{};return{vertices:[0,yl,1*u,...e,1,yl,-1*h,...e,1,-yl,-1*h,...e,0,-yl,1*u,...e,0,yl,1*u,...e,1,yl,-1*h,...e,1,-yl,-1*h,...e,0,-yl,1*u,...e],outLineIndices:[0,1,2,0,2,3].map(m=>m+t),indices:[4,5,6,4,6,7].map(m=>m+t),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function F1(e,t){const r=typeof e=="object"?e.type:e,i=t==="source"?1:-1,a=typeof e=="object"?e:{};switch(r){case"circle":return I3(i,a);case"triangle":return C3(i,a);case"diamond":return R3(i,a);case"rect":return w3(i,a);case"classic":return M3(i,a);case"halfTriangle":return T3(i,a);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function O3(e){const t=e.coordinates.flat(),r=1,i=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-r,2*i,1,2*i,-i,1,i,-i,1,i,-i,1,-r,-i,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function D3(e,t){return t?L3(e,t):O3(e)}function L3(e,t){const r=e.coordinates.flat(),{target:i="classic",source:a="circle"}=t,u=B1(F1(a,"source"),r,0,0),h=P3(r,u.vertices.length/7,t),m=B1(F1(i,"target"),r,1,u.vertices.length/7+h.vertices.length/7);return{vertices:[...u.vertices,...h.vertices,...m.vertices],indices:[...u.outLineIndices,...h.outLineIndices,...m.outLineIndices,...u.indices,...h.indices,...m.indices],normals:[...u.normals,...h.normals,...m.normals],size:7}}function B1(e,t,r=1,i=0){const a=[],{vertices:u,indices:h,dimensions:m,outLineIndices:g}=e;for(let E=0;E<u.length;E+=m)a.push(r,u[E+1],u[E],...t);return(0,lt.Z)((0,lt.Z)({},e),{},{vertices:a,indices:h.map(E=>E+i),outLineIndices:g.map(E=>E+i)})}const F3=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,B3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7
   
  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`;class N3 extends Io{getCommonUniformsInfo(){const{gapWidth:t=2,strokeWidth:r=1,strokeOpacity:i=1}=this.layer.getLayerConfig(),a={u_gap_width:t,u_stroke_width:r,u_stroke_opacity:i};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return[yield t.layer.buildLayerModel({moduleName:"flow_line",vertexShader:B3,fragmentShader:F3,inject:t.getInject(),triangulation:D3,styleOption:t.layer.getLayerConfig().symbol,primitive:F.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Kt.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u)=>u}})}}const k3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_line_data;
in vec2 v_iconMapUV;
in vec4 v_dash_array;
in float v_distance_ratio;
in vec4 v_color;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,U3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
  mix(source, target, segmentRatio),
  sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }
  else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,z3={solid:0,dash:1};class V3 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:F.NEAREST,min:F.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5],lineTexture:h=!1,iconStep:m=100,segmentNumber:g=30}=this.layer.getLayerConfig(),{animateOption:E}=this.layer.getLayerConfig();if(u.length===2&&u.push(0,0),this.rendererService.getDirty()){var A;(A=this.texture)===null||A===void 0||A.bind()}let w=0,R=[0,0,0,0],U=[0,0,0,0];t&&r&&(R=ai(t),U=ai(r),w=1);let q=this.layer.getLayerAnimateTime();isNaN(q)&&(q=0);const ce={u_animate:this.animateOption2Array(E),u_dash_array:u,u_sourceColor:R,u_targetColor:U,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:g,u_line_type:z3[a]||0,u_icon_step:m,u_line_texture:h?1:0,u_textureBlend:i==="normal"?0:1,u_time:q,u_linearColor:w};return this.getUniformsBufferInfo(ce)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig();return[yield t.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:U3,fragmentShader:k3,triangulation:k_,styleOption:{segmentNumber:r},inject:t.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Kt.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}let s4=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),N1=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),Z3=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),U_=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),u4=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});const j3=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,H3=`
#define Animate 0.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in vec3 a_DistanceAndIndexAndMiter;
layout(location = 13) in vec4 a_Normal_Total_Distance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};


out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`;class k1 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"textureEventFlag",!1),(0,P.Z)(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,P.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:F.NEAREST,min:F.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5,0,0],lineTexture:h=!1,iconStep:m=100,vertexHeightScale:g=20,strokeWidth:E=0,raisingHeight:A=0,heightfixed:w=!1,linearDir:R=N1.VERTICAL,blur:U=[1,1,1,0]}=this.layer.getLayerConfig();let q=u;if(a!=="dash"&&(q=[0,0,0,0]),q.length===2&&q.push(0,0),this.rendererService.getDirty()&&this.texture){var ce;(ce=this.texture)===null||ce===void 0||ce.bind()}const{animateOption:Se}=this.layer.getLayerConfig();let ke=0,Fe=[0,0,0,0],rt=[0,0,0,0];t&&r&&(Fe=ai(t),rt=ai(r),ke=1);const mt={u_animate:this.animateOption2Array(Se),u_dash_array:q,u_blur:U,u_sourceColor:Fe,u_targetColor:rt,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:m,u_heightfixed:Number(w),u_vertexScale:g,u_raisingHeight:Number(A),u_strokeWidth:E,u_textureBlend:i===Z3.NORMAL?0:1,u_line_texture:h?1:0,u_linearDir:R===N1.VERTICAL?1:0,u_linearColor:ke,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(mt)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),t.textureEventFlag||(t.textureEventFlag=!0,t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture)),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{depth:r=!1}=t.layer.getLayerConfig(),{frag:i,vert:a,type:u}=t.getShaders();return t.layer.triangulation=B_,[yield t.layer.buildLayerModel({moduleName:"line"+u,vertexShader:a,fragmentShader:i,triangulation:B_,inject:t.getInject(),depth:{enable:r}})]})()}getShaders(){return{frag:j3,vert:H3,type:""}}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Kt.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:10,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u,h)=>h===void 0?[i[3],10,i[4]]:[i[3],h,i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:Kt.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:4,update:(t,r,i,a,u)=>[...u,i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}const W3=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,G3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color; 
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_SizeDistanceAndTotalDistance.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`;class X3 extends Io{getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,lineType:i="solid",dashArray:a=[10,5,0,0],vertexHeightScale:u=20}=this.layer.getLayerConfig();let h=a;i!=="dash"&&(h=[0,0,0,0]),h.length===2&&h.push(0,0);let m=0,g=[0,0,0,0],E=[0,0,0,0];t&&r&&(g=ai(t),E=ai(r),m=1);const A={u_sourceColor:g,u_targetColor:E,u_dash_array:h,u_vertexScale:u,u_linearColor:m};return this.getUniformsBufferInfo(A)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}getShaders(){return{frag:W3,vert:G3,type:"lineSimpleNormal"}}buildModels(){var t=this;return(0,Yt.Z)(function*(){t.initUniformsBuffer();const{frag:r,vert:i,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,triangulation:BT,inject:t.getInject(),primitive:F.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Kt.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:Ln.SIZE,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:4,update:(t,r,i)=>{const{size:a=1}=t,u=Array.isArray(a)?[a[0],a[1]]:[a,0];return[u[0],u[1],i[3],i[5]]}}})}}const Y3=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
in vec2 v_iconMapUV;
in float v_blur;
in float v_radio;
in vec4 v_color;
in vec4 v_dataset;

out vec4 outputColor;
#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,q3=`#define Animate 0.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in float a_Miter;
layout(location = 11) in float a_Total_Distance;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_iconMapUV;
layout(location = 15) in float a_Distance;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out float v_radio;
out vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
// \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      if(u_heightfixed > 0.0) {
        wallHeight *= mapboxZoomScale;
      }
      
    } else {
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        wallHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`;class K3 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:F.NEAREST,min:F.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",heightfixed:a=!1,lineTexture:u=!1,iconStep:h=100,iconStepCount:m=1}=this.layer.getLayerConfig(),{animateOption:g}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var E;(E=this.texture)===null||E===void 0||E.bind()}let A=0,w=[0,0,0,0],R=[0,0,0,0];t&&r&&(w=ai(t),R=ai(r),A=1);const U={u_animate:this.animateOption2Array(g),u_sourceColor:w,u_targetColor:R,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:h,u_heightfixed:Number(a),u_linearColor:A,u_line_texture:u?1:0,u_textureBlend:i==="normal"?0:1,u_iconStepCount:m,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(U)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Yt.Z)(function*(){return[yield t.layer.buildLayerModel({moduleName:"lineWall",vertexShader:q3,fragmentShader:Y3,triangulation:B_,inject:t.getInject(),depth:{enable:!1},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Kt.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:1,update:(t,r,i)=>[i[3]]}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Kt.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:1,update:(t,r,i)=>[i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Kt.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:1,update:(t,r,i)=>[i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}var $3={arc:E3,arc3d:D1,greatcircle:V3,wall:K3,line:k1,simple:X3,flowline:N3,earthArc3d:D1};class z_ extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","LineLayer"),(0,P.Z)(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,P.Z)(this,"arrowInsertCount",0),(0,P.Z)(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var t=this;return(0,Yt.Z)(function*(){const r=t.getModelType();t.layerModel=new $3[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[t]}getModelType(){var t;if(this.layerType)return this.layerType;const r=this.styleAttributeService.getLayerStyleAttribute("shape");return(r==null||(t=r.scale)===null||t===void 0?void 0:t.field)||"line"}processData(t){if(this.getModelType()!=="simple")return t;const r=[];return t.map(i=>{if(Array.isArray(i.coordinates)&&Array.isArray(i.coordinates[0])&&Array.isArray(i.coordinates[0][0])){const a=(0,lt.Z)({},i);i.coordinates.map(u=>{r.push((0,lt.Z)((0,lt.Z)({},a),{},{coordinates:u}))})}else r.push(i)}),r}}const Q3=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,J3=`
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function U1(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class eC extends Io{getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:t,strokeOpacity:r=1,strokeWidth:i=0,stroke:a="#fff"}=this.layer.getLayerConfig(),u={u_stroke_color:ai(a),u_additive:t==="additive"?1:0,u_stroke_opacity:r,u_stroke_width:i};return this.getUniformsBufferInfo(u)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.layer.triangulation=U1,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:J3,fragmentShader:Q3,inject:t.getInject(),triangulation:U1,depth:{enable:!1},primitive:F.POINTS})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const tC=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,rC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;


layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,{isNumber:nC}=Yn;class iC extends Io{constructor(...t){super(...t),(0,P.Z)(this,"raiseCount",0),(0,P.Z)(this,"raiseRepeat",0)}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},opacity:r=1,sourceColor:i,targetColor:a,pickLight:u=!1,heightfixed:h=!0,opacityLinear:m={enable:!1,dir:"up"},lightEnable:g=!0}=this.layer.getLayerConfig();let E=0,A=[0,0,0,0],w=[0,0,0,0];if(i&&a&&(A=ai(i),w=ai(a),E=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:q=.01}=t;this.raiseCount+=q,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const R={u_sourceColor:A,u_targetColor:w,u_linearColor:E,u_pickLight:Number(u),u_heightfixed:Number(h),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:nC(r)?r:1,u_opacitylinear:Number(m.enable),u_opacitylinear_dir:m.dir==="up"?1:0,u_lightEnable:Number(g)};return this.getUniformsBufferInfo(R)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{animateOption:{repeat:r=1}}=t.layer.getLayerConfig();return t.raiseRepeat=r,[yield t.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:rC,fragmentShader:tC,triangulation:F_,depth:{enable:!0},inject:t.getInject(),cull:{enable:!0,face:Al(t.mapService.version)},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let i=[];return Array.isArray(r)&&(i=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(i=[r,r,r]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Kt.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:t=>{const r=Ko(t.coordinates);return x1([r[0],r[1]])}}})}}const oC=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,aC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}`;class sC extends Io{getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:i,blur:a=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const u={u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_stroke_width:r,u_blur:a};return this.getUniformsBufferInfo(u)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.layer.triangulation=C1,[yield t.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:aC,fragmentShader:oC,triangulation:C1,inject:t.getInject(),depth:{enable:!0},blend:t.getBlend()})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Kt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ln.EXTRUDE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a)=>{const[u,h,m]=i,g=Go.al(0,0,1),E=Go.al(u,0,m),A=u>=0?Go.EU(g,E):Math.PI*2-Go.EU(g,E),w=Math.PI*2-Math.asin(h/100),R=no.create();no.rotateY(R,R,A),no.rotateX(R,R,w);const U=Go.al(1,1,0);Go.fF(U,U,R),Go.Fv(U,U);const q=Go.al(-1,1,0);Go.fF(q,q,R),Go.Fv(q,q);const ce=Go.al(-1,-1,0);Go.fF(ce,ce,R),Go.Fv(ce,ce);const Se=Go.al(1,-1,0);Go.fF(Se,Se,R),Go.Fv(Se,Se);const ke=[...U,...q,...ce,...Se],Fe=a%4*3;return[ke[Fe],ke[Fe+1],ke[Fe+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Kt.Attribute,descriptor:{name:"a_Shape",shaderLocation:Ln.SHAPE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{shape:r=2}=t;return[this.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}const uC=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,lC=`#define pi 3.1415926535

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`;class z1 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"raiseCount",0),(0,P.Z)(this,"raiseRepeat",0)}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},sourceColor:r,targetColor:i,pickLight:a=!1,heightfixed:u=!1,opacityLinear:h={enable:!1,dir:"up"},lightEnable:m=!0}=this.layer.getLayerConfig();let g=0,E=[0,0,0,0],A=[0,0,0,0];if(r&&i&&(E=ai(r),A=ai(i),g=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:U=.01}=t;this.raiseCount+=U,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const w={u_pickLight:Number(a),u_heightfixed:Number(u),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:g,u_sourceColor:E,u_targetColor:A,u_opacitylinear:Number(h.enable),u_opacitylinear_dir:h.dir==="up"?1:0,u_lightEnable:Number(m)};return this.getUniformsBufferInfo(w)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{depth:r=!0,animateOption:{repeat:i=1}}=t.layer.getLayerConfig();return t.raiseRepeat=i,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:lC,fragmentShader:uC,triangulation:F_,inject:t.getInject(),cull:{enable:!0,face:Al(t.mapService.version)},depth:{enable:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let i=[];return Array.isArray(r)&&(i=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(i=[r,r,r]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Kt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ln.EXTRUDE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:t=>{const r=Ko(t.coordinates);return[r[0],r[1],0]}}})}}const cC=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,fC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;   
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class V1 extends Io{getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:i,blur:a=0,raisingHeight:u=0,heightfixed:h=!1,unit:m="pixel"}=this.layer.getLayerConfig();let g=this.getAnimateUniforms().u_time;isNaN(g)&&(g=-1);const E={u_blur_height_fixed:[a,Number(u),Number(h)],u_stroke_width:r,u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_size_unit:U_[m],u_time:g,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(E)}getAnimateUniforms(){const{animateOption:t={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Wp)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{frag:r,vert:i,type:a}=t.getShaders();return t.layer.triangulation=Wp,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,inject:t.getInject(),triangulation:Wp,depth:{enable:!1}})]})()}getShaders(){return{frag:cC,vert:fC,type:"pointFill"}}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){const t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Kt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ln.EXTRUDE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:(r,i,a,u)=>{const h=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],m=u%4*3;return[h[m],h[m+1],h[m+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:r=>{const{size:i=5}=r;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Kt.Attribute,descriptor:{name:"a_Shape",shaderLocation:Ln.SHAPE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:r=>{const{shape:i=2}=r;return[t.indexOf(i)]}}})}}const hC=`in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,pC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class dC extends Io{constructor(...t){super(...t),(0,P.Z)(this,"meter2coord",1),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"isMeter",!1),(0,P.Z)(this,"radian",0),(0,P.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=r({data:this.iconService.getCanvas(),mag:F.LINEAR,min:F.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1,unit:i="pixel"}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var a;(a=this.texture)===null||a===void 0||a.bind()}const u={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(r),u_raisingHeight:Number(t),u_size_unit:U_[i]};return this.getUniformsBufferInfo(u)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Wp)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:pC,fragmentShader:hC,triangulation:Wp,depth:{enable:!1},inject:t.getInject(),cull:{enable:!0,face:Al(t.mapService.version)}})]})()}clearModels(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_Uv",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:i}=t,{x:a,y:u}=r[i]||{x:-64,y:-64};return[a,u]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Kt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ln.EXTRUDE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a)=>{const u=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],h=a%4*3;return[u[h],u[h+1],u[h+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const mC=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,vC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;class Z1 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=r({data:this.iconService.getCanvas(),mag:F.LINEAR,min:F.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}getUninforms(){if(this.rendererService.getDirty()){var t;(t=this.texture)===null||t===void 0||t.bind()}const r=this.getCommonUniformsInfo(),i=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},r.uniformsOption),i.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1}=this.layer.getLayerConfig(),i={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(t),u_heightfixed:Number(r),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(i)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointImage",vertexShader:vC,fragmentShader:mC,triangulation:FT,inject:t.getInject(),depth:{enable:!1},primitive:F.POINTS})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_Uv",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:i}=t,{x:a,y:u}=r[i]||{x:-64,y:-64};return[a,u]}}})}}const _C=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,gC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function j1(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class H1 extends Io{getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const t={u_size_scale:.5};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.layer.triangulation=j1,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:gC,fragmentShader:_C,triangulation:j1,inject:t.getInject(),depth:{enable:!1},primitive:F.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const yC=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,xC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
  offset = project_pixel(offset);
  
  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`;class EC extends Io{getCommonUniformsInfo(){const{blend:t,speed:r=1,unit:i="pixel"}=this.layer.getLayerConfig(),a={u_additive:t==="additive"?1:0,u_size_unit:U_[i],u_speed:r,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(a)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Wp)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:xC,fragmentShader:yC,triangulation:Wp,inject:t.getInject(),depth:{enable:!1}})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Kt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Ln.EXTRUDE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a)=>{const u=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],h=a%4*3;return[u[h],u[h+1],u[h+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{shaderLocation:Ln.SIZE,name:"a_Size",buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}class bC{constructor(t,r,i){(0,P.Z)(this,"boxCells",[]),(0,P.Z)(this,"xCellCount",void 0),(0,P.Z)(this,"yCellCount",void 0),(0,P.Z)(this,"boxKeys",void 0),(0,P.Z)(this,"bboxes",void 0),(0,P.Z)(this,"width",void 0),(0,P.Z)(this,"height",void 0),(0,P.Z)(this,"xScale",void 0),(0,P.Z)(this,"yScale",void 0),(0,P.Z)(this,"boxUid",void 0);const a=this.boxCells;this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(r/i);for(let u=0;u<this.xCellCount*this.yCellCount;u++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0}insert(t,r,i,a,u){this.forEachCell(r,i,a,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u)}query(t,r,i,a,u){return this.queryHitTest(t,r,i,a,!1,u)}hitTest(t,r,i,a,u){return this.queryHitTest(t,r,i,a,!0,u)}insertBoxCell(t,r,i,a,u,h){this.boxCells[u].push(h)}queryHitTest(t,r,i,a,u,h){if(i<0||t>this.width||a<0||r>this.height)return u?!1:[];const m=[];if(t<=0&&r<=0&&this.width<=i&&this.height<=a){if(u)return!0;for(let E=0;E<this.boxKeys.length;E++)m.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return h?m.filter(h):m}const g={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,r,i,a,this.queryCell,m,g,h),u?m.length>0:m}queryCell(t,r,i,a,u,h,m,g){const E=m.seenUids,A=this.boxCells[u];if(A!==null){const w=this.bboxes;for(const R of A)if(!E.box[R]){E.box[R]=!0;const U=R*4;if(t<=w[U+2]&&r<=w[U+3]&&i>=w[U+0]&&a>=w[U+1]&&(!g||g(this.boxKeys[R]))){if(m.hitTest)return h.push(!0),!0;h.push({key:this.boxKeys[R],x1:w[U],y1:w[U+1],x2:w[U+2],y2:w[U+3]})}}}return!1}forEachCell(t,r,i,a,u,h,m,g){const E=this.convertToXCellCoord(t),A=this.convertToYCellCoord(r),w=this.convertToXCellCoord(i),R=this.convertToYCellCoord(a);for(let U=E;U<=w;U++)for(let q=A;q<=R;q++){const ce=this.xCellCount*q+U;if(u.call(this,t,r,i,a,ce,h,m,g))return}}convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}var SC=bC;class AC{constructor(t,r){(0,P.Z)(this,"width",void 0),(0,P.Z)(this,"height",void 0),(0,P.Z)(this,"grid",void 0),(0,P.Z)(this,"viewportPadding",100),(0,P.Z)(this,"screenRightBoundary",void 0),(0,P.Z)(this,"screenBottomBoundary",void 0),(0,P.Z)(this,"gridRightBoundary",void 0),(0,P.Z)(this,"gridBottomBoundary",void 0),this.width=t,this.height=r,this.viewportPadding=Math.max(t,r),this.grid=new SC(t+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}placeCollisionBox(t){const r=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(r,i,a,u)||this.grid.hitTest(r,i,a,u)?{box:[]}:{box:[r,i,a,u]}}insertCollisionBox(t,r){const i={featureIndex:r};this.grid.insert(i,t[0],t[1],t[2],t[3])}project(t,r,i){const a=o.al(r,i,0,1),u=o.Ue(),h=no.fromValues(...t);return o.fF(u,a,h),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(t,r,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&r<this.gridBottomBoundary}}function W1(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:t,verticalAlign:r}}function G1(e,t,r,i,a){if(!a)return;const u=e[i],h=u.glyph;if(h){const m=t[h].advance*u.scale,g=(e[i].x+m)*a;for(let E=r;E<=i;E++)e[E].x-=g}}function X1(e,t,r,i,a,u,h){const m=(t-r)*a,g=(-i*h+.5)*u;for(const E of e)E.x+=m,E.y+=g}function TC(e,t,r,i,a,u,h){let g=0,E=-8,A=0;const w=e.positionedGlyphs,R=u==="right"?1:u==="left"?0:.5,U=w.length;r.forEach(ke=>{if(ke.split("").forEach(Fe=>{const rt=t[Fe],mt=0;rt&&(w.push({glyph:Fe,x:g,y:E+mt,vertical:!1,scale:1,metrics:rt}),g+=rt.advance+h)}),w.length!==U){const Fe=g-h;A=Math.max(Fe,A),G1(w,t,U,w.length-1,R)}g=0,E-=i+5});const{horizontalAlign:q,verticalAlign:ce}=W1(a);X1(w,R,q,ce,A,i,r.length);const Se=E- -8;e.top+=-ce*Se,e.bottom=e.top-Se,e.left+=-q*A,e.right=e.left+A}function CC(e,t,r,i,a,u,h){let g=0,E=-8,A=0;const w=e.positionedGlyphs,R=u==="right"?1:u==="left"?0:.5,U=w.length;r.forEach(ke=>{const Fe=t[ke],rt=0;if(Fe&&(w.push({glyph:ke,x:Fe.advance/2,y:E+rt,vertical:!1,scale:1,metrics:Fe}),g+=Fe.advance+h),w.length!==U){const mt=g-h;A=Math.max(mt,A),G1(w,t,U,w.length-1,R)}g=0,E-=i+5});const{horizontalAlign:q,verticalAlign:ce}=W1(a);X1(w,R,q,ce,A,i,r.length);const Se=E- -8;e.top+=-ce*Se,e.bottom=e.top-Se,e.left+=-q*A,e.right=e.left+A}function wC(e,t,r,i,a,u,h=[0,0],m){const g=e.split(`
`),E=[],A={positionedGlyphs:E,top:h[1],bottom:h[1],left:h[0],right:h[0],lineCount:g.length,text:e};return m?CC(A,t,g,r,i,a,u):TC(A,t,g,r,i,a,u),E.length?A:!1}function RC(e,t=[0,0],r){const{positionedGlyphs:i=[]}=e,a=[];for(const u of i){const h=u.metrics,m=4,g=h.advance*u.scale/2,E=r?[u.x+g,u.y]:[0,0],A=r?[0,0]:[u.x+g+t[0],u.y+t[1]],w=(0-m)*u.scale-g+A[0],R=(0-m)*u.scale+A[1],U=w+h.width*u.scale,q=R+h.height*u.scale,ce={x:w,y:R},Se={x:U,y:R},ke={x:w,y:q},Fe={x:U,y:q};a.push({tl:ce,tr:Se,bl:ke,br:Fe,tex:h,glyphOffset:E})}return a}const Y1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,q1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_textOffsets;
layout(location = 14) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:zm}=Yn;function K1(e){const t=this,r=e.id,i=[],a=[];if(!t.glyphInfoMap||!t.glyphInfoMap[r])return{vertices:[],indices:[],size:7};const u=t.glyphInfoMap[r].centroid,h=u.length===2?[u[0],u[1],0]:u;return t.glyphInfoMap[r].glyphQuads.forEach((m,g)=>{i.push(...h,m.tex.x,m.tex.y+m.tex.height,m.tl.x,m.tl.y,...h,m.tex.x+m.tex.width,m.tex.y+m.tex.height,m.tr.x,m.tr.y,...h,m.tex.x+m.tex.width,m.tex.y,m.br.x,m.br.y,...h,m.tex.x,m.tex.y,m.bl.x,m.bl.y),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:i,indices:a,size:7}}class $1 extends Io{constructor(...t){var r;super(...t),r=this,(0,P.Z)(this,"glyphInfo",void 0),(0,P.Z)(this,"glyphInfoMap",{}),(0,P.Z)(this,"rawEncodeData",void 0),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"currentZoom",-1),(0,P.Z)(this,"extent",void 0),(0,P.Z)(this,"textureHeight",0),(0,P.Z)(this,"textCount",0),(0,P.Z)(this,"preTextStyle",{}),(0,P.Z)(this,"mapping",(0,Yt.Z)(function*(){r.initGlyph(),r.updateTexture(),yield r.reBuildModel()}))}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:t="#fff",strokeWidth:r=0,halo:i=.5,gamma:a=2,raisingHeight:u=0}=this.layer.getLayerConfig(),h=this.getFontServiceMapping(),m=this.getFontServiceCanvas();h&&Object.keys(h).length!==this.textCount&&m&&(this.updateTexture(),this.textCount=Object.keys(h).length),this.preTextStyle=this.getTextStyle();const g={u_stroke_color:ai(t),u_sdf_map_size:[(m==null?void 0:m.width)||1,(m==null?void 0:m.height)||1],u_raisingHeight:Number(u),u_stroke_width:r,u_gamma_scale:a,u_halo_blur:i};return this.getUniformsBufferInfo(g)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.bindEvent(),t.extent=t.textExtent(),t.rawEncodeData=t.layer.getEncodedData(),t.preTextStyle=t.getTextStyle(),t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{textAllowOverlap:r=!1}=t.layer.getLayerConfig();return t.initGlyph(),t.updateTexture(),r||t.filterGlyphs(),[yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:q1,fragmentShader:Y1,inject:t.getInject(),triangulation:K1.bind(t),depth:{enable:!1}})]})()}needUpdate(){var t=this;return(0,Yt.Z)(function*(){const{textAllowOverlap:r=!1,textAnchor:i="center",textOffset:a,padding:u,fontFamily:h,fontWeight:m}=t.getTextStyle();if(!zm(u,t.preTextStyle.padding)||!zm(a,t.preTextStyle.textOffset)||!zm(i,t.preTextStyle.textAnchor)||!zm(h,t.preTextStyle.fontFamily)||!zm(m,t.preTextStyle.fontWeight))return yield t.mapping(),!0;if(r)return!1;const g=t.mapService.getZoom(),E=t.mapService.getBounds(),A=kc(t.extent,E);return Math.abs(t.currentZoom-g)>.5||!A||r!==t.preTextStyle.textAllowOverlap?(yield t.reBuildModel(),!0):!1})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Kt.Attribute,descriptor:{shaderLocation:10,name:"a_textOffsets",buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Kt.Attribute,descriptor:{name:"a_tex",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=12}=t;return Array.isArray(r)?[r[0]]:[r]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){const t=this.mapService.getBounds();return Ki(t,.5)}initTextFont(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),i=this.rawEncodeData,a=[];i.forEach(u=>{let{shape:h=""}=u;h=h.toString();for(const m of h)a.indexOf(m)===-1&&a.push(m)}),this.fontService.setFontOptions({characterSet:a,fontWeight:t,fontFamily:r,iconfont:!1})}initIconFontTex(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),i=this.rawEncodeData,a=[];i.forEach(u=>{let{shape:h=""}=u;h=`${h}`,a.indexOf(h)===-1&&a.push(h)}),this.fontService.setFontOptions({characterSet:a,fontWeight:t,fontFamily:r,iconfont:!0})}getTextStyle(){const{fontWeight:t="400",fontFamily:r="sans-serif",textAllowOverlap:i=!1,padding:a=[0,0],textAnchor:u="center",textOffset:h=[0,0],opacity:m=1,strokeOpacity:g=1,strokeWidth:E=0,stroke:A="#000"}=this.layer.getLayerConfig();return{fontWeight:t,fontFamily:r,textAllowOverlap:i,padding:a,textAnchor:u,textOffset:h,opacity:m,strokeOpacity:g,strokeWidth:E,stroke:A}}generateGlyphLayout(t){const r=this.getFontServiceMapping(),{spacing:i=2,textAnchor:a="center",textOffset:u}=this.layer.getLayerConfig(),h=this.rawEncodeData;this.glyphInfo=h.map(m=>{const{shape:g="",id:E,size:A=1}=m,w=m.textOffset?m.textOffset:u||[0,0],R=m.textAnchor?m.textAnchor:a||"center",U=wC(g.toString(),r,A,R,"left",i,w,t),q=RC(U,w,!1);return m.shaping=U,m.glyphQuads=q,m.centroid=Ko(m.coordinates),m.originCentroid=m.version==="GAODE2.x"?Ko(m.originCoordinates):m.originCentroid=m.centroid,this.glyphInfoMap[E]={shaping:U,glyphQuads:q,centroid:Ko(m.coordinates)},m})}getFontServiceMapping(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${r}_${t}`)}getFontServiceCanvas(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${r}_${t}`)}filterGlyphs(){const{padding:t=[0,0],textAllowOverlap:r=!1}=this.layer.getLayerConfig();if(r)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:i,height:a}=this.rendererService.getViewportSize(),u=new AC(i,a);this.glyphInfo.filter(m=>{const{shaping:g,id:E=0}=m,A=m.version==="GAODE2.x"?m.originCentroid:m.centroid,R=m.size/16,U=this.mapService.lngLatToContainer(A),{box:q}=u.placeCollisionBox({x1:g.left*R-t[0],x2:g.right*R+t[0],y1:g.top*R-t[1],y2:g.bottom*R+t[1],anchorPointX:U.x,anchorPointY:U.y});return q&&q.length?(u.insertCollisionBox(q,E),!0):!1}).forEach(m=>{this.glyphInfoMap[m.id]=m})}initGlyph(){const{iconfont:t=!1}=this.layer.getLayerConfig();t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}updateTexture(){const{createTexture2D:t}=this.rendererService,r=this.getFontServiceCanvas();this.textureHeight=r.height,this.texture&&this.texture.destroy(),this.texture=t({data:r,mag:F.LINEAR,min:F.LINEAR,width:r.width,height:r.height}),this.textures=[this.texture]}reBuildModel(){var t=this;return(0,Yt.Z)(function*(){t.filterGlyphs();const r=yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:q1,fragmentShader:Y1,triangulation:K1.bind(t),inject:t.getInject(),depth:{enable:!1}});t.layer.models=[r]})()}}var MC={fillImage:dC,fill:V1,radar:EC,image:Z1,normal:H1,simplePoint:eC,extrude:z1,text:$1,earthFill:sC,earthExtrude:iC};class h0 extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","PointLayer"),(0,P.Z)(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,P.Z)(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,P.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var t=this;return(0,Yt.Z)(function*(){const r=t.getModelType();t.layerModel&&t.layerModel.clearModels(),t.layerModel=new MC[r](t),yield t.initLayerModels()})()}rebuildModels(){var t=this;return(0,Yt.Z)(function*(){yield t.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:t,values:r}=this.shapeOption,{shape2d:i}=this.getLayerConfig(),a=this.iconService.getIconMap();if(t&&(i==null?void 0:i.indexOf(t))!==-1)return"fill";if(r==="text")return"text";if(r&&r instanceof Array){for(const u of r)if(typeof u=="string"&&a.hasOwnProperty(u))return"image"}}return"normal"}getDefaultConfig(){const t=this.getModelType();return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[t]}getModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:i,billboard:a=!0}=this.getLayerConfig(),u=this.iconService.getIconMap(),h=t.find(m=>m.hasOwnProperty("shape"));if(h){const m=h.shape;return m==="dot"?"normal":m==="simple"?"simplePoint":m==="radar"?"radar":this.layerType==="fillImage"||a===!1?"fillImage":(r==null?void 0:r.indexOf(m))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(i==null?void 0:i.indexOf(m))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":u.hasOwnProperty(m)?"image":"text"}else return this.getModelTypeWillEmptyData()}}function IC(e){return V_.apply(this,arguments)}function V_(){return V_=(0,Yt.Z)(function*(e){if(window.createImageBitmap){const t=yield fetch(e);return yield createImageBitmap(yield t.blob())}else{const t=new window.Image;return new Promise(r=>{t.onload=()=>r(t),t.src=e,t.crossOrigin="Anonymous"})}}),V_.apply(this,arguments)}const PC=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,OC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,DC=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,LC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;
   
  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,FC=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,BC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`;class NC extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:t,heightfixed:r=!1,raisingHeight:i=0,topsurface:a=!0,sidesurface:u=!0,sourceColor:h,targetColor:m}=this.layer.getLayerConfig();let g=0,E=[1,1,1,1],A=[1,1,1,1];h&&m&&(E=ai(h),A=ai(m),g=1);const w={u_sourceColor:E,u_targetColor:A,u_linearColor:g,u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(r),u_raisingHeight:Number(i)};return t&&this.texture&&(w.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(w)}initModels(){var t=this;return(0,Yt.Z)(function*(){return yield t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{frag:r,vert:i,type:a}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,depth:{enable:!0},inject:t.getInject(),triangulation:N_})]})()}getShaders(){const{pickLight:t,mapTexture:r}=this.layer.getLayerConfig();return r?{frag:DC,vert:LC,type:"polygonExtrudeTexture"}:t?{frag:FC,vert:BC,type:"polygonExtrudePickLight"}:{frag:PC,vert:OC,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.textures=[]}registerBuiltinAttributes(){const t=this.layer.getSource().extent;let r=t;const i=this.layer.coordCenter||this.layer.getSource().center;let a=r[2]-r[0],u=r[3]-r[1];if(this.mapService.version==="GAODE2.x"){const[h,m]=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],i),[g,E]=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],i);a=g-h,u=E-m,r=[h,m,g,E]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Kt.Attribute,descriptor:{name:"a_uvs",shaderLocation:Ln.UV,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(h,m,g)=>{const E=g[0],A=g[1];return[(E-r[0])/a,(A-r[1])/u,g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(h,m,g,E,A)=>A}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:h=>{const{size:m=10}=h;return Array.isArray(m)?[m[0]]:[m]}}})}loadTexture(){var t=this;return(0,Yt.Z)(function*(){const{mapTexture:r}=t.layer.getLayerConfig(),{createTexture2D:i}=t.rendererService;if(t.texture=i({height:1,width:1}),r){const a=yield IC(r);t.texture=i({data:a,width:a.width,height:a.height,wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE,min:F.LINEAR,mag:F.LINEAR})}})()}}const kC=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,UC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos);
   float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class zC extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const t={};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{frag:r,vert:i,type:a}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,inject:t.getInject(),triangulation:N_,depth:{enable:!0}})]})()}getShaders(){return{frag:kC,vert:UC,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Kt.Attribute,descriptor:{name:"a_Normal",shaderLocation:Ln.NORMAL,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Kt.Attribute,descriptor:{name:"a_Size",shaderLocation:Ln.SIZE,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:1,update:t=>{const{size:r=10}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const VC=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,ZC=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,jC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 15) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,HC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};


out vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`;class WC extends Io{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,opacityLinear:r={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),i={u_raisingHeight:Number(t),u_opacitylinear:Number(r.enable),u_dir:r.dir==="in"?1:0};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){const{frag:r,vert:i,triangulation:a,type:u}=t.getModelParams();return t.initUniformsBuffer(),t.layer.triangulation=a,[yield t.layer.buildLayerModel({moduleName:u,vertexShader:i,fragmentShader:r,inject:t.getInject(),triangulation:a,primitive:F.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){const{opacityLinear:t={enable:!1,dir:"in"}}=this.layer.getLayerConfig();t.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Kt.Attribute,descriptor:{name:"a_linear",shaderLocation:Ln.LINEAR,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:3,update:(r,i,a)=>[a[3],a[4],a[5]]}})}getModelParams(){const{opacityLinear:t={enable:!1}}=this.layer.getLayerConfig();return t.enable?{frag:ZC,vert:jC,type:"polygonLinear",triangulation:UT}:{frag:VC,vert:HC,type:"polygonFill",triangulation:l0}}}const GC=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,XC=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};


out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`;class YC extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture1",void 0),(0,P.Z)(this,"texture2",void 0),(0,P.Z)(this,"texture3",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{watercolor:t="#6D99A8",watercolor2:r="#0F121C"}=this.layer.getLayerConfig(),i={u_watercolor:ai(t),u_watercolor2:ai(r),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(i)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:XC,fragmentShader:GC,inject:t.getInject(),triangulation:l0,primitive:F.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t,r,i;(t=this.texture1)===null||t===void 0||t.destroy(),(r=this.texture2)===null||r===void 0||r.destroy(),(i=this.texture3)===null||i===void 0||i.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,i,a,u]=t,h=a-r,m=u-i;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Kt.Attribute,descriptor:{name:"a_uv",shaderLocation:Ln.UV,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:2,update:(g,E,A,w)=>{const R=g.version==="GAODE2.x"?g.originCoordinates[0][w]:A,[U,q]=R;return[(U-r)/h,(q-i)/m]}}})}loadTexture(){const{createTexture2D:t}=this.rendererService,r={height:0,width:0};this.texture1=t(r),this.texture2=t(r),this.texture3=t(r),i(u=>{this.texture1=a(u[0]),this.texture2=a(u[1]),this.texture3=a(u[2]),this.layerService.reRender()});function i(u){let h=0;const m=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(E=>{const A=new Image;A.crossOrigin="",A.src=E,m.push(A),A.onload=()=>{h++,h===3&&u(m)}})}function a(u){return t({data:u,width:u.width,height:u.height,wrapS:F.MIRRORED_REPEAT,wrapT:F.MIRRORED_REPEAT,min:F.LINEAR,mag:F.LINEAR})}}}const qC=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,KC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 14) in vec2 a_uv;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;


#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`;class $C extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{speed:t=.5}=this.layer.getLayerConfig(),r={u_speed:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:KC,fragmentShader:qC,triangulation:l0,inject:t.getInject(),primitive:F.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,i,a,u]=t,h=a-r,m=u-i;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Kt.Attribute,descriptor:{name:"a_uv",shaderLocation:Ln.UV,buffer:{usage:F.STATIC_DRAW,data:[],type:F.FLOAT},size:2,update:(g,E,A,w)=>{const R=g.version==="GAODE2.x"?g.originCoordinates[0][w]:A,[U,q]=R;return[(U-r)/h,(q-i)/m]}}})}loadTexture(){const{waterTexture:t}=this.layer.getLayerConfig(),{createTexture2D:r}=this.rendererService;this.texture=r({height:1,width:1});const i=new Image;i.crossOrigin="",t?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),i.src=t):i.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=()=>{this.texture=r({data:i,width:i.width,height:i.height,wrapS:F.MIRRORED_REPEAT,wrapT:F.MIRRORED_REPEAT,min:F.LINEAR,mag:F.LINEAR}),this.layerService.reRender()}}}var QC={fill:WC,line:k1,extrude:NC,text:$1,point_fill:V1,point_image:Z1,point_normal:H1,point_extrude:z1,water:$C,ocean:YC,extrusion:zC};class p0 extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","PolygonLayer"),(0,P.Z)(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var t=this;return(0,Yt.Z)(function*(){const r=t.getModelType();t.layerModel=new QC[r](t),yield t.initLayerModels()})()}getModelType(){var t;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),i=r==null||(t=r.scale)===null||t===void 0?void 0:t.field;return i==="fill"||!i?"fill":i==="extrude"?"extrude":i==="extrusion"?"extrusion":i==="water"?"water":i==="ocean"?"ocean":i==="line"?"line":this.getPointModelType()}getPointModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:i}=this.getLayerConfig(),a=this.iconService.getIconMap(),u=t.find(h=>h.hasOwnProperty("shape"));if(u){const h=u.shape;return h==="dot"?"point_normal":(r==null?void 0:r.indexOf(h))!==-1?"point_fill":(i==null?void 0:i.indexOf(h))!==-1?"point_extrude":a.hasOwnProperty(h)?"point_image":"text"}else return"fill"}}const JC=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,ew=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`;class Q1 extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"colorTexture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,clampLow:r=!0,clampHigh:i=!0,noDataValue:a=-9999999,domain:u,rampColors:h}=this.layer.getLayerConfig(),m=u||xu(h);this.colorTexture=this.layer.textureService.getColorTexture(h,m);const g={u_domain:m,u_opacity:t||1,u_noDataValue:a,u_clampLow:r?1:0,u_clampHigh:(typeof i!="undefined"?i:r)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(g)}getRasterData(t){return(0,Yt.Z)(function*(){if(Array.isArray(t.data))return{data:t.data,width:t.width,height:t.height};{const{rasterData:r,width:i,height:a}=yield t.data;return{data:Array.from(r),width:i,height:a}}})()}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:i,queryVerdorInfo:a}=t.rendererService,u=r.data.dataArray[0],{data:h,width:m,height:g}=yield t.getRasterData(u);return t.texture=i({data:new Float32Array(h),width:m,height:g,format:a()==="WebGL1"?F.LUMINANCE:F.RED,type:F.FLOAT,alignment:1}),[yield t.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:ew,fragmentShader:JC,triangulation:c0,primitive:F.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var t,r;(t=this.texture)===null||t===void 0||t.destroy(),(r=this.colorTexture)===null||r===void 0||r.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{shaderLocation:Ln.UV,name:"a_Uv",buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}const tw=["data"],rw=["rasterData"],nw=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,iw=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`;class ow extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0),(0,P.Z)(this,"dataOption",{})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,noDataValue:r=0}=this.layer.getLayerConfig(),{rMinMax:i=[0,255],gMinMax:a=[0,255],bMinMax:u=[0,255]}=this.dataOption,h={u_rminmax:i,u_gminmax:a,u_bminmax:u,u_opacity:t||1,u_noDataValue:r,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(h)}getRasterData(t){var r=this;return(0,Yt.Z)(function*(){if(Array.isArray(t.data)){const{data:h}=t,m=(0,Ot.Z)(t,tw);return r.dataOption=m,(0,lt.Z)({data:h},m)}const i=yield t.data,{rasterData:a}=i,u=(0,Ot.Z)(i,rw);return r.dataOption=u,Array.isArray(a)?(0,lt.Z)({data:a},u):(0,lt.Z)({data:Array.from(a)},u)})()}initModels(){var t=this;return(0,Yt.Z)(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:i}=t.rendererService,a=r.data.dataArray[0],{data:u,width:h,height:m}=yield t.getRasterData(a);return t.texture=i({data:new Float32Array(u),width:h,height:m,format:F.RGB,type:F.FLOAT}),[yield t.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:iw,fragmentShader:nw,triangulation:c0,primitive:F.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_Uv",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}const aw=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,sw=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
   vec4 u_unpack;
   vec2 u_domain;
   float u_opacity;
   float u_noDataValue;
   float u_clampLow;
   float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`;class uw extends Io{constructor(...t){super(...t),(0,P.Z)(this,"texture",void 0)}getCommonUniformsInfo(){const{opacity:t,clampLow:r=!0,clampHigh:i=!0,noDataValue:a=-9999999,domain:u,rampColors:h,colorTexture:m,rScaler:g=6553.6,gScaler:E=25.6,bScaler:A=.1,offset:w=1e4}=this.layer.getLayerConfig(),R=u||xu(h);let U=m;m?this.layer.textureService.setColorTexture(m,h,R):U=this.layer.textureService.getColorTexture(h,R);const q={u_unpack:[g,E,A,w],u_domain:R,u_opacity:t||1,u_noDataValue:a,u_clampLow:r,u_clampHigh:typeof i!="undefined"?i:r,u_texture:this.texture,u_colorTexture:U};return this.textures=[this.texture,U],this.getUniformsBufferInfo(q)}initModels(){var t=this;return(0,Yt.Z)(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:i}=t.rendererService,a=yield r.data.images;return t.texture=i({data:a[0],width:a[0].width,height:a[0].height,min:F.LINEAR,mag:F.LINEAR}),[yield t.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:sw,fragmentShader:aw,triangulation:c0,primitive:F.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Kt.Attribute,descriptor:{name:"a_Uv",shaderLocation:Ln.UV,buffer:{usage:F.DYNAMIC_DRAW,data:[],type:F.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}var lw={raster:Q1,rasterRgb:ow,raster3d:Q1,rasterTerrainRgb:uw};class d0 extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","RasterLayer")}buildModels(){var t=this;return(0,Yt.Z)(function*(){const r=t.getModelType();t.layerModel=new lw[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[t]}getModelType(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}getLegend(t){if(t!=="color")return{type:void 0,field:void 0,items:[]};const r=this.getLayerConfig().rampColors;return I1(r,t)}}class cw{constructor({rendererService:t,layerService:r,parent:i}){(0,P.Z)(this,"tileResource",new Map),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"parent",void 0),(0,P.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=r,this.parent=i}get tiles(){return this.layerTiles}hasTile(t){return this.layerTiles.some(r=>r.key===t)}addTile(t){this.layerTiles.push(t)}getTile(t){return this.layerTiles.find(r=>r.key===t)}getVisibleTileBylngLat(t){return this.layerTiles.find(r=>r.isLoaded&&r.visible&&r.lnglatInBounds(t))}removeTile(t){const r=this.layerTiles.findIndex(a=>a.key===t),i=this.layerTiles.splice(r,1);i[0]&&i[0].destroy()}updateTileVisible(t){const r=this.getTile(t.key);if(t.isVisible)if(t.parent){const i=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(i)}else r==null||r.updateVisible(!0);else if(t.parent){const i=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(!i)}else r==null||r.updateVisible(!1)}isParentLoaded(t){const r=t.parent;if(!r)return!0;const i=this.getTile(r==null?void 0:r.key);return!!(i!=null&&i.isLoaded)}isChildrenLoaded(t){const r=t==null?void 0:t.children;return r.length===0?!0:r.every(i=>{const a=this.getTile(i==null?void 0:i.key);return a?(a==null?void 0:a.isLoaded)===!0:!0})}render(){var t=this;return(0,Yt.Z)(function*(){const i=t.getRenderLayers().map(function(){var a=(0,Yt.Z)(function*(u){yield t.layerService.renderTileLayer(u)});return function(u){return a.apply(this,arguments)}}());yield Promise.all(i)})()}getRenderLayers(){const t=this.layerTiles.filter(i=>i.visible&&i.isLoaded),r=[];return t.map(i=>r.push(...i.getLayers())),r}getLayers(){const t=this.layerTiles.filter(i=>i.isLoaded),r=[];return t.map(i=>r.push(...i.getLayers())),r}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(t=>t.destroy()),this.tileResource.clear()}}var fw=N(32676);function hw(e,t,r){r===void 0&&(r={});var i=Vo(e),a=Vo(t),u=fw.union(i.coordinates,a.coordinates);return u.length===0?null:u.length===1?Pt(u[0],r.properties):dn(u,r.properties)}var pw=hw;class dw{getCombineFeature(t){let r=null;const i=t[0];return t.map(a=>{const u=Pt(a.coordinates);r===null?r=u:r=pw(r,u)}),i&&(r.properties=(0,lt.Z)({},i)),r}}const Vm="select",Zm="active";class mw{constructor({layerService:t,tileLayerService:r,parent:i}){(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"tileLayerService",void 0),(0,P.Z)(this,"tileSourceService",void 0),(0,P.Z)(this,"parent",void 0),(0,P.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=r,this.parent=i,this.tileSourceService=new dw}pickRender(t){const r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r){const i=r.getMainLayer();i==null||i.layerPickService.pickRender(t)}}pick(t,r){var i=this;return(0,Yt.Z)(function*(){const u=i.parent.getContainer().pickingService;if(t.type==="RasterLayer"){const h=i.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(h&&h.getMainLayer()!==void 0){const m=h.getMainLayer();return m.layerPickService.pickRasterLayer(m,r,i.parent)}return!1}return i.pickRender(r),u.pickFromPickingFBO(t,r)})()}selectFeature(t){const[r,i,a]=t,u=this.color2PickId(r,i,a);this.tilePickID.set(Vm,u),this.updateHighLight(r,i,a,Vm)}highlightPickedFeature(t){const[r,i,a]=t,u=this.color2PickId(r,i,a);this.tilePickID.set(Zm,u),this.updateHighLight(r,i,a,Zm)}updateHighLight(t,r,i,a){this.tileLayerService.tiles.map(u=>{const h=u.getMainLayer();switch(a){case Vm:h==null||h.hooks.beforeSelect.call([t,r,i]);break;case Zm:h==null||h.hooks.beforeHighlight.call([t,r,i]);break}})}setPickState(){const t=this.tilePickID.get(Vm),r=this.tilePickID.get(Zm);if(t){const[i,a,u]=this.pickId2Color(t);this.updateHighLight(i,a,u,Vm);return}if(r){const[i,a,u]=this.pickId2Color(r);this.updateHighLight(i,a,u,Zm);return}}color2PickId(t,r,i){return ys(new Uint8Array([t,r,i]))}pickId2Color(t){return Fs(t)}getFeatureById(t){const r=this.tileLayerService.getTiles().filter(a=>a.visible),i=[];return r.forEach(a=>{i.push(...a.getFeatureById(t))}),i}pickRasterLayer(){return!1}}function vw(e){return e==="PolygonLayer"?p0:e==="LineLayer"?z_:h0}function _w(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}class Gp extends jg.EventEmitter{constructor(t,r){super(),(0,P.Z)(this,"x",void 0),(0,P.Z)(this,"y",void 0),(0,P.Z)(this,"z",void 0),(0,P.Z)(this,"key",void 0),(0,P.Z)(this,"parent",void 0),(0,P.Z)(this,"sourceTile",void 0),(0,P.Z)(this,"visible",!0),(0,P.Z)(this,"layers",[]),(0,P.Z)(this,"isLoaded",!1),(0,P.Z)(this,"tileMaskLayers",[]),(0,P.Z)(this,"tileMask",void 0),this.parent=r,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...t){}lnglatInBounds(t){const[r,i,a,u]=this.sourceTile.bounds,{lng:h,lat:m}=t;return h>=r&&h<=a&&m>=i&&m<=u}getLayerOptions(){var t;const r=this.parent.getLayerConfig();return(0,lt.Z)((0,lt.Z)({},r),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:_w(this.parent.type),mask:r.mask||((t=r.maskLayers)===null||t===void 0?void 0:t.length)!==0&&r.enableMask})}getMaskLayer(){const{maskLayers:t}=this.parent.getLayerConfig(),r=[];return t==null||t.forEach(i=>{if(!i.tileLayer)return r.push(i),i;const u=i.tileLayer.getTile(this.sourceTile.key),h=u==null?void 0:u.getLayers()[0];h&&r.push(h)}),r}addTileMask(){var t=this;return(0,Yt.Z)(function*(){const r=new p0({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[t.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),i=Zh(t.parent.container);r.setContainer(i),yield r.init(),t.tileMask=r;const a=t.getMainLayer();return a!==void 0&&(a.tileMask=r),r})()}addMask(t,r){var i=this;return(0,Yt.Z)(function*(){const a=Zh(i.parent.container);r.setContainer(a),yield r.init(),t.addMask(r),i.tileMaskLayers.push(r)})()}addLayer(t){var r=this;return(0,Yt.Z)(function*(){t.isTileLayer=!0;const i=Zh(r.parent.container);t.setContainer(i),r.layers.push(t),yield t.init()})()}updateVisible(t){this.visible=t,this.updateOptions("visible",t)}updateOptions(t,r){this.layers.forEach(i=>{i.updateLayerConfig({[t]:r})})}getMainLayer(){return this.layers[0]}getFeatures(t){return[]}getFeatureById(t){return[]}destroy(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(r=>r.destroy())}}class gw extends Gp{initTileLayer(){var t=this;return(0,Yt.Z)(function*(){const r=t.getSourceOption(),i=r.data.features[0].properties,a=new z_().source(r.data,r.options).size(1).shape("line").color("red"),u=new h0({minZoom:t.z-1,maxZoom:t.z+1,textAllowOverlap:!0}).source([i],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(t.key).style({stroke:"#fff",strokeWidth:2});yield t.addLayer(a),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}class yw extends Gp{initTileLayer(){var t=this;return(0,Yt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new O1((0,lt.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(h=>{var m,g;const E=h;u[E]((m=r[E])===null||m===void 0?void 0:m.field,(g=r[E])===null||g===void 0?void 0:g.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const xw=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,Ew=`layout(location = 0) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`;class bw extends Io{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,lt.Z)((0,lt.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,color:r="#000"}=this.layer.getLayerConfig(),i={u_color:ai(r),u_opacity:t||1};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return(0,Yt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Yt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"mask",vertexShader:Ew,fragmentShader:xw,triangulation:l0,depth:{enable:!1},pick:!1})]})()}clearModels(t=!0){t&&this.layerService.clear()}registerBuiltinAttributes(){return""}}var Sw={fill:bw};class J1 extends Gh{constructor(...t){super(...t),(0,P.Z)(this,"type","MaskLayer")}buildModels(){var t=this;return(0,Yt.Z)(function*(){const r=t.getModelType();t.layerModel=new Sw[r](t),yield t.initLayerModels()})()}getModelType(){return"fill"}}class Aw extends Gp{initTileLayer(){var t=this;return(0,Yt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new J1((0,lt.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(h=>{var m,g;const E=h;u[E]((m=r[E])===null||m===void 0?void 0:m.field,(g=r[E])===null||g===void 0?void 0:g.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getFeatures(t){return t?this.sourceTile.data.getTileData(t):[]}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r,featureId:i}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}}const Tw=["rasterData"];class Cw extends Gp{initTileLayer(){var t=this;return(0,Yt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new d0((0,lt.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(h=>{var m,g;const E=h;u[E]((m=r[E])===null||m===void 0?void 0:m.field,(g=r[E])===null||g===void 0?void 0:g.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:i}=r,a=(0,Ot.Z)(r,Tw);return{data:i,options:{parser:(0,lt.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},a),transforms:t.transforms}}}}class ww extends Gp{initTileLayer(){var t=this;return(0,Yt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new d0((0,lt.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(h=>{var m,g;const E=h;u[E]((m=r[E])===null||m===void 0?void 0:m.field,(g=r[E])===null||g===void 0?void 0:g.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const Rw=["rasterData"],Mw={positions:[0,1],colors:["#000","#fff"]};class Iw extends Gp{constructor(...t){super(...t),(0,P.Z)(this,"colorTexture",void 0)}initTileLayer(){var t=this;return(0,Yt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),{rampColors:u,domain:h}=t.getLayerOptions();t.colorTexture=t.parent.textureService.getColorTexture(u,h);const m=new d0((0,lt.Z)((0,lt.Z)({},i),{},{colorTexture:t.colorTexture})).source(a.data,a.options);r&&Object.keys(r).forEach(g=>{var E,A;const w=g;m[w]((E=r[w])===null||E===void 0?void 0:E.field,(A=r[w])===null||A===void 0?void 0:A.values)}),yield t.addLayer(m),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:i}=r,a=(0,Ot.Z)(r,Rw);return{data:i,options:{parser:(0,lt.Z)({type:"raster",extent:this.sourceTile.bounds},a),transforms:t.transforms}}}styleUpdate(...t){const{rampColors:r=Mw,domain:i}=t;this.colorTexture=this.parent.textureService.getColorTexture(r,i||xu(r)),this.layers.forEach(a=>a.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(t=>t.destroy())}}class m0 extends Gp{initTileLayer(){var t=this;return(0,Yt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=vw(t.parent.type),u=t.getSourceOption();if(!u){t.isLoaded=!0,t.emit("loaded");return}const h=new a((0,lt.Z)({},i)).source(u.data,u.options);Object.keys(r).forEach(m=>{var g,E;const A=m;h[A]((g=r[A])===null||g===void 0?void 0:g.field,(E=r[A])===null||E===void 0?void 0:E.values)}),yield t.addLayer(h),i.tileMask&&(yield t.addTileMask()),t.setLayerMinMaxZoom(h),t.isLoaded=!0,t.emit("loaded")})()}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r="defaultLayer",featureId:i="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}setLayerMinMaxZoom(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(t){return this.sourceTile.data.getTileData(t)}getFeatureById(t){const r=this.getMainLayer();return r?r.getSource().data.dataArray.filter(a=>a._id===t):[]}}function Pw(e){switch(e.type){case"PolygonLayer":return m0;case"LineLayer":return m0;case"PointLayer":return m0;case"TileDebugLayer":return gw;case"MaskLayer":return Aw;case"RasterLayer":const{dataType:r}=e.getSource().parser;switch(r){case ds.RGB:case ds.CUSTOMRGB:return Cw;case ds.ARRAYBUFFER:case ds.CUSTOMARRAYBUFFER:return Iw;case ds.TERRAINRGB:case ds.CUSTOMTERRAINRGB:return ww;default:return yw}default:return m0}}const Ow=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],{debounce:Dw}=Yn;class Lw{constructor(t){(0,P.Z)(this,"parent",void 0),(0,P.Z)(this,"tileLayerService",void 0),(0,P.Z)(this,"mapService",void 0),(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"rendererService",void 0),(0,P.Z)(this,"pickingService",void 0),(0,P.Z)(this,"tilePickService",void 0),(0,P.Z)(this,"tilesetManager",void 0),(0,P.Z)(this,"initedTileset",!1),(0,P.Z)(this,"lastViewStates",void 0),(0,P.Z)(this,"mapchange",()=>{var i;if(this.parent.isVisible()===!1)return;const{latLonBounds:a,zoom:u}=this.getCurrentView();if(this.mapService.version==="GAODE1.x"){const{visible:h}=this.parent.getLayerConfig();u<2&&h?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):u>=2&&!h&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===u&&this.lastViewStates.latLonBounds.toString()===a.toString()||(this.lastViewStates={zoom:u,latLonBounds:a},(i=this.tilesetManager)===null||i===void 0||i.throttleUpdate(u,a))}),(0,P.Z)(this,"viewchange",Dw(this.mapchange,24)),this.parent=t;const r=this.parent.getContainer();this.rendererService=r.rendererService,this.layerService=r.layerService,this.mapService=r.mapService,this.pickingService=r.pickingService,this.tileLayerService=new cw({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new mw({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}initTileSetManager(){var t;const r=this.parent.getSource();if(this.tilesetManager=r.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()===!1)return;const{latLonBounds:i,zoom:a}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}getCurrentView(){const t=this.mapService.getBounds(),r=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:r,zoom:i}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",t=>{}),this.tilesetManager.on("tile-unload",t=>{this.tileUnLoad(t)}),this.tilesetManager.on("tile-error",(t,r)=>{this.tileError(t)}),this.tilesetManager.on("tile-update",()=>{this.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(t){return this.tileLayerService.getTile(t)}tileLoaded(t){}tileError(t){console.warn("error:",t)}destroy(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}reload(){var t;this.tilesetManager.clear();const{latLonBounds:r,zoom:i}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(i,r)}tileUnLoad(t){this.tileLayerService.removeTile(t.key)}tileUpdate(){var t=this;return(0,Yt.Z)(function*(){if(!t.tilesetManager)return;const r=t.parent.getMinZoom(),i=t.parent.getMaxZoom(),a=t.tilesetManager.tiles.filter(u=>u.isLoaded).filter(u=>u.isVisibleChange).filter(u=>u.data).filter(u=>u.z>=r&&u.z<i);yield Promise.all(a.map(function(){var u=(0,Yt.Z)(function*(h){if(t.tileLayerService.hasTile(h.key))t.tileLayerService.updateTileVisible(h),t.tilePickService.setPickState(),t.layerService.reRender();else{const m=Pw(t.parent),g=new m(h,t.parent);yield g.initTileLayer(),t.tilePickService.setPickState(),g.getLayers().length!==0&&(t.tileLayerService.addTile(g),t.tileLayerService.updateTileVisible(h),t.layerService.reRender())}});return function(h){return u.apply(this,arguments)}}())),t.tilesetManager.isLoaded&&t.parent.emit("tiles-loaded",t.tilesetManager.currentTiles)})()}setPickState(t){}pickRender(t){this.tilePickService.pickRender(t)}selectFeature(t){this.tilePickService.selectFeature(t)}highlightPickedFeature(t){this.tilePickService.highlightPickedFeature(t)}proxy(t){Ow.forEach(r=>{const i=t[r].bind(t);t[r]=(...a)=>(i(...a),this.getLayers().map(u=>{u[r](...a)}),r==="style"&&this.getTiles().forEach(u=>u.styleUpdate(...a)),t)})}}class d4 extends null{constructor(...t){super(...t),_defineProperty(this,"isMoving",!1),_defineProperty(this,"maskLayer",void 0),_defineProperty(this,"move",r=>{switch(r.stopPropagation(),r.type){case"touchcancel":case"touchend":case"mouseup":{var i;this.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(a=>{document.removeEventListener(a,this.move)}),(i=this.scene)===null||i===void 0||i.render();break}case"mousedown":case"touchstart":this.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(a=>{document.addEventListener(a,this.move)});case"mousemove":case"touchmove":{if(this.isMoving)if(this.controlOption.orientation==="vertical"){let a;if("pageX"in r?a=r.pageX:r.touches&&r.touches.length&&r.touches[0].pageX?a=r.touches[0].pageX:r.changedTouches&&r.changedTouches.length&&(a=r.changedTouches[0].pageX),!a)break;const u=this.getContainerDOMRect(),h=this.getContainerSize(),m=h[0],g=(u==null?void 0:u.left)||0,E=a-g+window.scrollX-document.documentElement.clientLeft,A=m-Math.min(Math.max(0,m-E),m),w=A/m;this.setOptions({ratio:w}),this.emit("moving",{size:[A,h[1]],ratio:[w,0]})}else{let a;if("pageY"in r?a=r.pageY:r.touches&&r.touches.length&&r.touches[0].pageY?a=r.touches[0].pageY:r.changedTouches&&r.changedTouches.length&&(a=r.changedTouches[0].pageY),!a)break;const u=this.getContainerDOMRect(),h=this.getContainerSize(),m=h[1],g=(u==null?void 0:u.top)||0,E=a-g+window.scrollY-document.documentElement.clientTop,A=m-Math.min(Math.max(0,m-E),m),w=A/m;this.setOptions({ratio:w}),this.emit("moving",{size:[h[0],A],ratio:[0,w]})}break}default:break}}),_defineProperty(this,"getMaskLayer",()=>(console.log(this.getMaskGeoData()),new PolygonLayer({visible:!1}).source(this.getMaskGeoData()).shape("fill").color("red").style({opacity:.1}))),_defineProperty(this,"updateMask",()=>{var r;if(!this.mapsService)return;const i=this.getMaskGeoData();(r=this.maskLayer)===null||r===void 0||r.setData(i)})}getDefault(){return _objectSpread(_objectSpread({},super.getDefault()),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}onAdd(){const t=DOM.create("div","l7-control-swipe");DOM.create("button","l7-control-swipe__button",t);const{orientation:r="vertical",ratio:i=.5}=this.controlOption;return r==="horizontal"?(t.style.top=i*100+"%",t.style.left=""):(t.style.left=i*100+"%",t.style.top=""),t.classList.add(r),t}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd();const{className:r,style:i,layers:a,rightLayers:u}=this.controlOption;r&&this.setClassName(r),i&&this.setStyle(i),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.registerEvent();const h=createLayerContainer(t);return this.maskLayer.setContainer(h),this.scene.addLayer(this.maskLayer),this.addMaskToLayers(a,!1),this.addMaskToLayers(u,!0),this.emit("add",this),this}onRemove(){if(this.maskLayer){var t;const{layers:r,rightLayers:i}=this.controlOption;this.removeMaskFromLayers(r),this.removeMaskFromLayers(i),(t=this.layerService)===null||t===void 0||t.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}show(){var t;const r=this.container;DOM.removeClass(r,"l7-control-swipe_hide");const{layers:i,rightLayers:a}=this.controlOption;i.forEach(u=>u.enableMask()),a.forEach(u=>u.enableMask()),(t=this.scene)===null||t===void 0||t.render(),this.isShow=!0,this.emit("show",this)}hide(){var t;const r=this.container;DOM.addClass(r,"l7-control-swipe_hide");const{layers:i,rightLayers:a}=this.controlOption;i.forEach(u=>u.disableMask()),a.forEach(u=>u.disableMask()),(t=this.scene)===null||t===void 0||t.render(),this.isShow=!1,this.emit("hide",this)}setOptions(t){const r=_objectSpread(_objectSpread({},this.controlOption),t);if(t.className&&this.setClassName(t.className),t.style&&this.setStyle(t.style),(t.orientation||t.ratio!==void 0)&&this.setOrientationAndRatio(r.orientation,r.ratio),t.layers){const i=t.layers,a=this.controlOption.layers;this.setLayers(i,a,!1)}if(t.rightLayers){const i=t.rightLayers,a=this.controlOption.rightLayers;this.setLayers(i,a,!0)}this.controlOption=r,this.updateMask()}registerEvent(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}unRegisterEvent(){var t;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),(t=this.mapsService)===null||t===void 0||t.off("camerachange",this.updateMask)}setOrientationAndRatio(t="vertical",r=.5){this.container.classList.remove("horizontal","vertical"),this.container.classList.add(t),t==="horizontal"?(this.container.style.top=r*100+"%",this.container.style.left=""):(this.container.style.left=r*100+"%",this.container.style.top="")}setLayers(t,r,i=!1){const a=t.filter(h=>r.includes(h)===!1),u=r.filter(h=>t.includes(h)===!1);this.addMaskToLayers(a,i),this.removeMaskFromLayers(u)}addMaskToLayers(t,r){t.forEach(i=>{i.updateLayerConfig({maskInside:!r}),i.addMask(this.maskLayer)})}removeMaskFromLayers(t){t.forEach(r=>{r.updateLayerConfig({maskInside:!0}),r.removeMask(this.maskLayer)})}getMaskGeoData(){const{ratio:t=.5,orientation:r="vertical"}=this.controlOption,i=r==="vertical",[a,u]=this.getBounds(),[h,m]=a,[g,E]=u;let A;if(i){const R=h+(g-h)*t;A=[[h,E],[R,E],[R,m],a,[h,E]]}else{const R=this.getContainerSize(),q=this.mapsService.containerToLngLat([R[0],R[1]*t]).lat;A=[[h,E],u,[g,q],[h,q],[h,E]]}return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[A]}}]}}getContainerDOMRect(){var t;return(t=this.mapsService.getContainer())===null||t===void 0?void 0:t.getBoundingClientRect()}getContainerSize(){return this.mapsService.getSize()}getBounds(){return this.mapsService.getBounds()}addLayer(t,r=!1){const i=Array.isArray(t)?t:[t];if(r){const a=this.controlOption.rightLayers.concat(...i);this.setOptions({rightLayers:a})}else{const a=this.controlOption.layers.concat(...i);this.setOptions({layers:a})}}removeLayer(t){const r=Array.isArray(t)?t:[t],i=this.controlOption.layers.filter(u=>r.includes(u)),a=this.controlOption.rightLayers.filter(u=>r.includes(u));this.setOptions({layers:i,rightLayers:a})}removeLayers(){this.setOptions({layers:[],rightLayers:[]})}}class Fw extends ih{constructor(...t){super(...t),(0,P.Z)(this,"disabled",void 0),(0,P.Z)(this,"zoomInButton",void 0),(0,P.Z)(this,"zoomOutButton",void 0),(0,P.Z)(this,"zoomNumDiv",void 0),(0,P.Z)(this,"zoomIn",()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}),(0,P.Z)(this,"zoomOut",()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}),(0,P.Z)(this,"updateDisabled",()=>{const r=this.mapsService;this.zoomInButton.removeAttribute("disabled"),this.zoomOutButton.removeAttribute("disabled"),(this.disabled||r.getZoom()<=r.getMinZoom())&&this.zoomOutButton.setAttribute("disabled","true"),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(r.getZoom()))),(this.disabled||r.getZoom()>=r.getMaxZoom())&&this.zoomInButton.setAttribute("disabled","true")})}getDefault(t){return(0,lt.Z)((0,lt.Z)({},super.getDefault(t)),{},{position:Ye.BOTTOMRIGHT,name:"zoom",zoomInText:oh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:oh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}onAdd(){const t=Mi("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}onRemove(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(t){sl(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}createButton(t,r,i,a,u){const h=Mi("button",i,a);return typeof t=="string"?h.innerHTML=t:h.append(t),h.title=r,u&&h.addEventListener("click",u),h}}class ex extends Zv.EventEmitter{get lngLat(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}}set lngLat(t){this.popupOption.lngLat=t}constructor(t){super(),(0,P.Z)(this,"popupOption",void 0),(0,P.Z)(this,"mapsService",void 0),(0,P.Z)(this,"sceneService",void 0),(0,P.Z)(this,"layerService",void 0),(0,P.Z)(this,"scene",void 0),(0,P.Z)(this,"closeButton",void 0),(0,P.Z)(this,"container",void 0),(0,P.Z)(this,"content",void 0),(0,P.Z)(this,"contentTitle",void 0),(0,P.Z)(this,"contentPanel",void 0),(0,P.Z)(this,"tip",void 0),(0,P.Z)(this,"isShow",!0),(0,P.Z)(this,"onMouseMove",i=>{var a;const u=this.mapsService.getMapContainer(),{left:h=0,top:m=0}=(a=u==null?void 0:u.getBoundingClientRect())!==null&&a!==void 0?a:{};this.setPopupPosition(i.clientX-h,i.clientY-m)}),(0,P.Z)(this,"updateLngLatPosition",()=>{if(!this.mapsService||this.popupOption.followCursor)return;const{lng:i,lat:a}=this.lngLat,{x:u,y:h}=this.mapsService.lngLatToContainer([i,a]);this.setPopupPosition(u,h)}),(0,P.Z)(this,"updateLngLatPositionWhenZoom",i=>{if(!this.mapsService||this.popupOption.followCursor)return;const a=i.map,u=a.getSize();u.x=u.x/2,u.y=u.y/2;const h=i.center,m=i.zoom,g=a.DE(this.lngLat,m,h);g.x=Math.round(g.x),g.y=Math.round(g.y),this.setPopupPosition(g.x,g.y,!0)}),(0,P.Z)(this,"onKeyDown",i=>{i.keyCode===27&&this.remove()}),(0,P.Z)(this,"onCloseButtonClick",i=>{i.stopPropagation&&i.stopPropagation(),this.hide()}),(0,P.Z)(this,"updatePosition",(i,a=!0)=>{const u=!!this.lngLat,{className:h,style:m,maxWidth:g,anchor:E,stopPropagation:A}=this.popupOption;if(!this.mapsService||!u||!this.content)return;const w=this.mapsService.getMarkerContainer();if(!this.container&&w&&(this.container=Mi("div",`l7-popup ${h!=null?h:""} ${this.isShow?"":"l7-popup-hide"}`,w),m&&this.container.setAttribute("style",m),this.tip=Mi("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(R=>{this.container.addEventListener(R,U=>{U.stopPropagation()})}),this.container.style.whiteSpace="nowrap"),a?this.updateLngLatPositionWhenZoom(i):this.updateLngLatPosition(),cf(this.container,`${ui[E]}`),To(this.container,E,"popup"),g){const{width:R}=this.container.getBoundingClientRect();R>parseFloat(g)&&(this.container.style.width=g)}else this.container.style.removeProperty("width")}),(0,P.Z)(this,"updateWhenZoom",i=>{this.updatePosition(i,!0)}),(0,P.Z)(this,"update",()=>{this.updatePosition(null,!1)}),this.popupOption=(0,lt.Z)((0,lt.Z)({},this.getDefault(t!=null?t:{})),t);const{lngLat:r}=this.popupOption;r&&(this.lngLat=r)}getIsShow(){return this.isShow}addTo(t){this.mapsService=t.mapService,this.sceneService=t.sceneService,this.layerService=t.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();const{html:r,text:i,title:a}=this.popupOption;return r?this.setHTML(r):i&&this.setText(i),a&&this.setTitle(a),this.emit("open"),this}remove(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&oa(this.content),this.container&&(oa(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}getOptions(){return this.popupOption}setOptions(t){this.show();const{className:r}=this.popupOption;if(this.popupOption=(0,lt.Z)((0,lt.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","lngLat","offsets"])&&(this.container&&(oa(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["className"])){var i;r&&this.container.classList.remove(r!=null?r:""),this.container.classList.add((i=t.className)!==null&&i!==void 0?i:"")}if(this.checkUpdateOption(t,["style"])){var a;al(this.container,(a=t.style)!==null&&a!==void 0?a:"")}return this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}open(){return this.addTo(this.scene),this}close(){return this.remove(),this}show(){if(!this.isShow)return this.container&&Es(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}hide(){if(this.isShow)return this.container&&Ta(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}setHTML(t){return this.popupOption.html=t,this.setDOMContent(t)}setText(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}setTitle(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Mi("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),sl(this.contentTitle),Fc(this.contentTitle,t)):this.contentTitle&&(oa(this.contentTitle),this.contentTitle=void 0)}panToPopup(){const{lng:t,lat:r}=this.lngLat;return this.popupOption.autoPan&&this.mapsService.panTo([t,r]),this}setLngLat(t){return this.setLnglat(t)}setLnglat(t){return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(()=>{this.panToPopup()},0),this}getLnglat(){return this.lngLat}setMaxWidth(t){return this.popupOption.maxWidth=t,this.update(),this}isOpen(){return!!this.mapsService}getDefault(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Jn.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}setDOMContent(t){return this.show(),this.createContent(),Fc(this.contentPanel,t),this.update(),this}updateCloseOnClick(t){const r=this.mapsService;r&&(r==null||r.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(()=>{r==null||r.on("click",this.onCloseButtonClick)}))}updateCloseOnEsc(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}updateFollowCursor(t){var r;const i=(r=this.mapsService)===null||r===void 0?void 0:r.getContainer();i&&(i==null||i.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(i==null||i.addEventListener("mousemove",this.onMouseMove)))}createContent(){if(this.content&&oa(this.content),this.contentTitle=void 0,this.content=Mi("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){const t=oh("l7-icon-guanbi");Ta(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",()=>{this.hide()}),t.addEventListener("pointerup",r=>{r.stopPropagation()}),t.addEventListener("pointerdown",r=>{r.stopPropagation()}),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=Mi("div","l7-popup-content__panel",this.content)}setPopupPosition(t,r,i=!1){if(this.container){const{offsets:a}=this.popupOption;this.container.style.left=t+a[0]+"px",this.container.style.top=r-a[1]+"px",i?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}checkUpdateOption(t,r){return r.some(i=>i in t)}}const{get:Bw}=Yn;class m4 extends null{constructor(...t){super(...t),_defineProperty(this,"layerClickCountByFrame",0),_defineProperty(this,"layerConfigMap",new WeakMap),_defineProperty(this,"displayFeatureInfo",void 0),_defineProperty(this,"onLayerClick",(r,i)=>{requestAnimationFrame(()=>{if(this.popupOption.closeOnClick&&this.layerClickCountByFrame++,this.isShow&&this.isSameFeature(r,i.featureId))this.hide();else{const{title:a,content:u}=this.getLayerInfoFrag(r,i);this.setDOMContent(u),this.setLnglat(i.lngLat),this.setTitle(a),this.setDisplayFeatureInfo({layer:r,featureId:i.featureId}),this.show()}})}),_defineProperty(this,"onSceneClick",()=>{this.layerClickCountByFrame=0,requestAnimationFrame(()=>{this.layerClickCountByFrame||this.hide()})}),_defineProperty(this,"onLayerHide",()=>{this.hide(),this.setDisplayFeatureInfo(void 0)}),_defineProperty(this,"updateCloseOnClick",()=>{})}get layerConfigItems(){var t;const{config:r,items:i}=this.popupOption;return(t=r!=null?r:i)!==null&&t!==void 0?t:[]}addTo(t){return super.addTo(t),this.bindLayerEvent(),this.hide(),this}remove(){return super.remove(),this.unbindLayerEvent(),this}setOptions(t){this.unbindLayerEvent();const r=_objectSpread({},t),i=r.trigger||this.popupOption.trigger,a=r.items||this.popupOption.items,u=(a==null?void 0:a.length)===0;r.followCursor=i==="hover"&&!u;const h=this.isShow;return super.setOptions(r),this.bindLayerEvent(),(u||!h)&&this.hide(),this}getDefault(t){const r=t.trigger!=="click";return _objectSpread(_objectSpread({},super.getDefault(t)),{},{trigger:"hover",followCursor:r,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}bindLayerEvent(){const{trigger:t,closeOnClick:r}=this.popupOption;this.layerConfigItems.forEach(i=>{var a;const u=this.getLayerByConfig(i);if(!u)return;const h=_objectSpread({},i);if(t==="hover"){const A=this.onLayerMouseMove.bind(this,u),w=this.onLayerMouseOut.bind(this,u);h.onMouseMove=A,h.onMouseOut=w,u==null||u.on("mousemove",A),u==null||u.on("mouseout",w)}else{var m;const A=this.onLayerClick.bind(this,u);h.onClick=A,u==null||u.on("click",A);const w=(m=this.mapsService)===null||m===void 0?void 0:m.getMapContainer();w&&r&&w.addEventListener("click",this.onSceneClick)}const g=u==null||(a=u.getSource)===null||a===void 0?void 0:a.call(u),E=this.onSourceUpdate.bind(this);g==null||g.on("update",E),h.onSourceUpdate=E,this.layerConfigMap.set(u,h)})}unbindLayerEvent(){this.layerConfigItems.forEach(t=>{var r;const i=this.getLayerByConfig(t),a=i&&this.layerConfigMap.get(i);if(!a)return;const{onMouseMove:u,onMouseOut:h,onClick:m,onSourceUpdate:g}=a;if(u&&i.off("mousemove",u),h&&i.off("mouseout",h),m&&i.off("click",m),g){var E;i==null||(E=i.getSource())===null||E===void 0||E.off("update",g)}const A=(r=this.mapsService)===null||r===void 0?void 0:r.getMapContainer();A&&A.removeEventListener("click",this.onSceneClick)})}onLayerMouseMove(t,r){if(!this.isSameFeature(t,r.featureId)){const{title:i,content:a}=this.getLayerInfoFrag(t,r);this.setDOMContent(a),this.setTitle(i),this.setDisplayFeatureInfo({layer:t,featureId:r.featureId}),this.show()}}onLayerMouseOut(t,r){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}onSourceUpdate(){this.hide(),this.setDisplayFeatureInfo(void 0)}getLayerInfoFrag(t,r){const i=this.layerConfigMap.get(t);let a;const u=document.createDocumentFragment();if(i){let h=r.feature;h.type==="Feature"&&"properties"in h&&"geometry"in h&&(h=h.properties);const{title:m,fields:g,customContent:E}=i;if(m){a=document.createDocumentFragment();const A=m instanceof Function?m(h):m;DOM.appendElementType(a,A)}if(E){const A=E instanceof Function?E(h):E;DOM.appendElementType(u,A)}else g!=null&&g.length&&(g==null||g.forEach(A=>{var w,R;const{field:U,formatField:q,formatValue:ce,getValue:Se}=typeof A=="string"?{field:A}:A,ke=DOM.create("div","l7-layer-popup__row"),Fe=Se?Se(r.feature):Bw(h,U),rt=(w=q instanceof Function?q(U,h):q)!==null&&w!==void 0?w:U;let mt=(R=ce instanceof Function?ce(Fe,h):ce)!==null&&R!==void 0?R:Fe;const er=DOM.create("span","l7-layer-popup__key",ke);DOM.appendElementType(er,rt),DOM.appendElementType(er,document.createTextNode("\uFF1A"));const cr=DOM.create("span","l7-layer-popup__value",ke);Array.isArray(mt)&&mt.every(kt=>!(kt instanceof Object))&&(mt=mt.map(kt=>String(kt)).join(",")),DOM.appendElementType(cr,mt),u.appendChild(ke)}))}return{title:a,content:u}}getLayerByConfig(t){const r=t.layer;if(r instanceof Object)return r;if(typeof r=="string")return this.layerService.getLayer(r)||this.layerService.getLayerByName(r)}isSameFeature(t,r){const i=this.displayFeatureInfo;return i&&t===i.layer&&r===i.featureId}setDisplayFeatureInfo(t){const r=this.displayFeatureInfo;r&&r.layer.off("hide",this.onLayerHide),t&&t.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=t}}function Nw(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(t||(t=document),!!t)){var a=t.head||t.getElementsByTagName("head")[0];if(!a){a=t.createElement("head");var u=t.body||t.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(a,u):t.documentElement.appendChild(a)}var h=t.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(t.createTextNode(e)),a.appendChild(h),h}}Nw(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}
.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}
.l7-control-container .l7-column {
  flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  align-items: flex-start;
}
.l7-popper.l7-popper-end {
  align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: flex;
  flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);var kw=N(81550),Uw=N.n(kw),zw=class{constructor(e,t){const{buffer:r,offset:i,stride:a,normalized:u,size:h,divisor:m}=t;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:a||0,normalized:u||!1,divisor:m||0},h&&(this.attribute.size=h)}get(){return this.attribute}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},Vw={[F.POINTS]:"points",[F.LINES]:"lines",[F.LINE_LOOP]:"line loop",[F.LINE_STRIP]:"line strip",[F.TRIANGLES]:"triangles",[F.TRIANGLE_FAN]:"triangle fan",[F.TRIANGLE_STRIP]:"triangle strip"},tx={[F.STATIC_DRAW]:"static",[F.DYNAMIC_DRAW]:"dynamic",[F.STREAM_DRAW]:"stream"},Z_={[F.BYTE]:"int8",[F.INT]:"int32",[F.UNSIGNED_BYTE]:"uint8",[F.UNSIGNED_SHORT]:"uint16",[F.UNSIGNED_INT]:"uint32",[F.FLOAT]:"float"},Zw={[F.ALPHA]:"alpha",[F.LUMINANCE]:"luminance",[F.LUMINANCE_ALPHA]:"luminance alpha",[F.RGB]:"rgb",[F.RGBA]:"rgba",[F.RGBA4]:"rgba4",[F.RGB5_A1]:"rgb5 a1",[F.RGB565]:"rgb565",[F.DEPTH_COMPONENT]:"depth",[F.DEPTH_STENCIL]:"depth stencil"},jw={[F.DONT_CARE]:"dont care",[F.NICEST]:"nice",[F.FASTEST]:"fast"},rx={[F.NEAREST]:"nearest",[F.LINEAR]:"linear",[F.LINEAR_MIPMAP_LINEAR]:"mipmap",[F.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[F.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[F.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},nx={[F.REPEAT]:"repeat",[F.CLAMP_TO_EDGE]:"clamp",[F.MIRRORED_REPEAT]:"mirror"},Hw={[F.NONE]:"none",[F.BROWSER_DEFAULT_WEBGL]:"browser"},Ww={[F.NEVER]:"never",[F.ALWAYS]:"always",[F.LESS]:"less",[F.LEQUAL]:"lequal",[F.GREATER]:"greater",[F.GEQUAL]:"gequal",[F.EQUAL]:"equal",[F.NOTEQUAL]:"notequal"},ix={[F.FUNC_ADD]:"add",[F.MIN_EXT]:"min",[F.MAX_EXT]:"max",[F.FUNC_SUBTRACT]:"subtract",[F.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},v0={[F.ZERO]:"zero",[F.ONE]:"one",[F.SRC_COLOR]:"src color",[F.ONE_MINUS_SRC_COLOR]:"one minus src color",[F.SRC_ALPHA]:"src alpha",[F.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[F.DST_COLOR]:"dst color",[F.ONE_MINUS_DST_COLOR]:"one minus dst color",[F.DST_ALPHA]:"dst alpha",[F.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[F.CONSTANT_COLOR]:"constant color",[F.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[F.CONSTANT_ALPHA]:"constant alpha",[F.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[F.SRC_ALPHA_SATURATE]:"src alpha saturate"},Gw={[F.NEVER]:"never",[F.ALWAYS]:"always",[F.LESS]:"less",[F.LEQUAL]:"lequal",[F.GREATER]:"greater",[F.GEQUAL]:"gequal",[F.EQUAL]:"equal",[F.NOTEQUAL]:"notequal"},Nd={[F.ZERO]:"zero",[F.KEEP]:"keep",[F.REPLACE]:"replace",[F.INVERT]:"invert",[F.INCR]:"increment",[F.DECR]:"decrement",[F.INCR_WRAP]:"increment wrap",[F.DECR_WRAP]:"decrement wrap"},Xw={[F.FRONT]:"front",[F.BACK]:"back"},Yw=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:i,type:a}=t;this.buffer=e.buffer({data:r,usage:tx[i||F.STATIC_DRAW],type:Z_[a||F.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){this.buffer.subdata(e,t)}},qw=class{constructor(e,t){const{data:r,usage:i,type:a,count:u}=t;this.elements=e.elements({data:r,usage:tx[i||F.STATIC_DRAW],type:Z_[a||F.UNSIGNED_BYTE],count:u})}get(){return this.elements}subData({data:e}){this.elements.subdata(e)}destroy(){}},Kw=class{constructor(e,t){const{width:r,height:i,color:a,colors:u}=t,h={width:r,height:i};Array.isArray(u)&&(h.colors=u.map(m=>m.get())),a&&typeof a!="boolean"&&(h.color=a.get()),this.framebuffer=e.framebuffer(h)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:e,height:t}){this.framebuffer.resize(e,t)}},Tc=N(95147),kd=N(25897),$w=N(81957),pn=N(97582),ox=N(54146),Be;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(Be||(Be={}));var to;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"})(to||(to={}));var Ai;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Ai||(Ai={}));var jm;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(jm||(jm={}));var xl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(xl||(xl={}));var Bi;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Bi||(Bi={}));var Ws;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(Ws||(Ws={}));var $u;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})($u||($u={}));var Ha;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(Ha||(Ha={}));var Ps;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Ps||(Ps={}));var ns;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(ns||(ns={}));var zo;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(zo||(zo={}));var tf;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(tf||(tf={}));var Xp;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Xp||(Xp={}));var ax;(function(e){e.LOADED="loaded"})(ax||(ax={}));var Oi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Oi||(Oi={}));var mu;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(mu||(mu={}));var Gs;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(Gs||(Gs={}));var Pa;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(Pa||(Pa={}));function v4(e,t,r,i){var a=Oi.TEXTURE_2D,u=1,h=mu.SAMPLED;return{dimension:a,format:e,width:t,height:r,depthOrArrayLayers:u,mipLevelCount:i,usage:h}}var Oa;(function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"})(Oa||(Oa={}));var Cf;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(Cf||(Cf={}));var Ud;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Ud||(Ud={}));var _0;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(_0||(_0={}));var lr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(lr||(lr={}));var _n;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(_n||(_n={}));function _4(e){return e}var an;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(an||(an={}));function kn(e,t,r){return e<<16|t<<8|r}var st;(function(e){e[e.ALPHA=kn(lr.U8,_n.A,an.None)]="ALPHA",e[e.U8_LUMINANCE=kn(lr.U8,_n.A,an.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=kn(lr.F16,_n.A,an.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=kn(lr.F32,_n.A,an.Luminance)]="F32_LUMINANCE",e[e.F16_R=kn(lr.F16,_n.R,an.None)]="F16_R",e[e.F16_RG=kn(lr.F16,_n.RG,an.None)]="F16_RG",e[e.F16_RGB=kn(lr.F16,_n.RGB,an.None)]="F16_RGB",e[e.F16_RGBA=kn(lr.F16,_n.RGBA,an.None)]="F16_RGBA",e[e.F32_R=kn(lr.F32,_n.R,an.None)]="F32_R",e[e.F32_RG=kn(lr.F32,_n.RG,an.None)]="F32_RG",e[e.F32_RGB=kn(lr.F32,_n.RGB,an.None)]="F32_RGB",e[e.F32_RGBA=kn(lr.F32,_n.RGBA,an.None)]="F32_RGBA",e[e.U8_R=kn(lr.U8,_n.R,an.None)]="U8_R",e[e.U8_R_NORM=kn(lr.U8,_n.R,an.Normalized)]="U8_R_NORM",e[e.U8_RG=kn(lr.U8,_n.RG,an.None)]="U8_RG",e[e.U8_RG_NORM=kn(lr.U8,_n.RG,an.Normalized)]="U8_RG_NORM",e[e.U8_RGB=kn(lr.U8,_n.RGB,an.None)]="U8_RGB",e[e.U8_RGB_NORM=kn(lr.U8,_n.RGB,an.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=kn(lr.U8,_n.RGB,an.sRGB|an.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=kn(lr.U8,_n.RGBA,an.None)]="U8_RGBA",e[e.U8_RGBA_NORM=kn(lr.U8,_n.RGBA,an.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=kn(lr.U8,_n.RGBA,an.sRGB|an.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=kn(lr.U16,_n.R,an.None)]="U16_R",e[e.U16_R_NORM=kn(lr.U16,_n.R,an.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=kn(lr.U16,_n.RG,an.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=kn(lr.U16,_n.RGBA,an.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=kn(lr.U16,_n.RGBA,an.None)]="U16_RGBA",e[e.U16_RGB=kn(lr.U16,_n.RGB,an.None)]="U16_RGB",e[e.U16_RG=kn(lr.U16,_n.RG,an.None)]="U16_RG",e[e.U32_R=kn(lr.U32,_n.R,an.None)]="U32_R",e[e.U32_RG=kn(lr.U32,_n.RG,an.None)]="U32_RG",e[e.U32_RGB=kn(lr.U32,_n.RGB,an.None)]="U32_RGB",e[e.U32_RGBA=kn(lr.U32,_n.RGBA,an.None)]="U32_RGBA",e[e.S8_R=kn(lr.S8,_n.R,an.None)]="S8_R",e[e.S8_R_NORM=kn(lr.S8,_n.R,an.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=kn(lr.S8,_n.RG,an.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=kn(lr.S8,_n.RGB,an.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=kn(lr.S8,_n.RGBA,an.Normalized)]="S8_RGBA_NORM",e[e.S16_R=kn(lr.S16,_n.R,an.None)]="S16_R",e[e.S16_RG=kn(lr.S16,_n.RG,an.None)]="S16_RG",e[e.S16_RG_NORM=kn(lr.S16,_n.RG,an.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=kn(lr.S16,_n.RGB,an.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=kn(lr.S16,_n.RGBA,an.None)]="S16_RGBA",e[e.S16_RGBA_NORM=kn(lr.S16,_n.RGBA,an.Normalized)]="S16_RGBA_NORM",e[e.S32_R=kn(lr.S32,_n.R,an.None)]="S32_R",e[e.S32_RG=kn(lr.S32,_n.RG,an.None)]="S32_RG",e[e.S32_RGB=kn(lr.S32,_n.RGB,an.None)]="S32_RGB",e[e.S32_RGBA=kn(lr.S32,_n.RGBA,an.None)]="S32_RGBA",e[e.U16_RGBA_5551=kn(lr.U16_PACKED_5551,_n.RGBA,an.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=kn(lr.U16_PACKED_565,_n.RGB,an.Normalized)]="U16_RGB_565",e[e.BC1=kn(lr.BC1,_n.RGBA,an.Normalized)]="BC1",e[e.BC1_SRGB=kn(lr.BC1,_n.RGBA,an.Normalized|an.sRGB)]="BC1_SRGB",e[e.BC2=kn(lr.BC2,_n.RGBA,an.Normalized)]="BC2",e[e.BC2_SRGB=kn(lr.BC2,_n.RGBA,an.Normalized|an.sRGB)]="BC2_SRGB",e[e.BC3=kn(lr.BC3,_n.RGBA,an.Normalized)]="BC3",e[e.BC3_SRGB=kn(lr.BC3,_n.RGBA,an.Normalized|an.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=kn(lr.BC4_UNORM,_n.R,an.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=kn(lr.BC4_SNORM,_n.R,an.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=kn(lr.BC5_UNORM,_n.RG,an.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=kn(lr.BC5_SNORM,_n.RG,an.Normalized)]="BC5_SNORM",e[e.D24=kn(lr.D24,_n.R,an.Depth)]="D24",e[e.D24_S8=kn(lr.D24S8,_n.RG,an.Depth|an.Stencil)]="D24_S8",e[e.D32F=kn(lr.D32F,_n.R,an.Depth)]="D32F",e[e.D32F_S8=kn(lr.D32FS8,_n.RG,an.Depth|an.Stencil)]="D32F_S8",e[e.U8_RGB_RT=kn(lr.U8,_n.RGB,an.RenderTarget|an.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=kn(lr.U8,_n.RGBA,an.RenderTarget|an.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=kn(lr.U8,_n.RGBA,an.RenderTarget|an.Normalized|an.sRGB)]="U8_RGBA_RT_SRGB"})(st||(st={}));function g0(e){return e>>>8&255}function wf(e){return e>>>16&255}function zd(e){return e&255}function sx(e){switch(e){case lr.F32:case lr.U32:case lr.S32:return 4;case lr.U16:case lr.S16:case lr.F16:return 2;case lr.U8:case lr.S8:return 1;default:throw new Error("whoops")}}function ux(e){return sx(wf(e))}function g4(e){return g0(e)}function Qw(e){var t=sx(wf(e)),r=g0(e);return t*r}function y4(e,t){return e&4294967040|t}function x4(e,t){return e&4294902015|t<<8}function lx(e){var t=zd(e);if(t&an.Depth)return Oa.Depth;if(t&an.Normalized)return Oa.Float;var r=wf(e);if(r===lr.F16||r===lr.F32)return Oa.Float;if(r===lr.U8||r===lr.U16||r===lr.U32)return Oa.Uint;if(r===lr.S8||r===lr.S16||r===lr.S32)return Oa.Sint;throw new Error("whoops")}function vi(e,t){if(t===void 0&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function Yp(e){if(e!=null)return e;throw new Error("Missing object")}function cx(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function fx(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function hx(e){var t=e.r,r=e.g,i=e.b,a=e.a;return{r:t,g:r,b:i,a}}function Hm(e,t,r,i){return i===void 0&&(i=1),{r:e,g:t,b:r,a:i}}var y0=Hm(0,0,0,0),E4=Hm(0,0,0,1),Jw=Hm(1,1,1,0),b4=Hm(1,1,1,1),Vd=!0;function S4(e,t){t===void 0&&(t=Vd),t&&(e[10]=-e[10],e[14]=-e[14])}function A4(e,t){t===void 0&&(t=Vd),t&&(e[10]=-e[10],e[14]=-e[14]+1)}function eR(e,t){if(t===void 0&&(t=Vd),t)switch(e){case Ai.LESS:return Ai.GREATER;case Ai.LEQUAL:return Ai.GEQUAL;case Ai.GEQUAL:return Ai.LEQUAL;case Ai.GREATER:return Ai.LESS;default:return e}else return e}function T4(e,t){return t===void 0&&(t=Vd),t?1-e:e}function C4(e,t){return t===void 0&&(t=Vd),t?-e:e}function w4(e,t,r,i){if(i===void 0&&(i=Vd),r=eR(r,i),r===Ai.LESS)return e<t;if(r===Ai.LEQUAL)return e<=t;if(r===Ai.GREATER)return e>t;if(r===Ai.GEQUAL)return e>=t;throw new Error("whoops")}function x0(e){return!!(e&&!(e&e-1))}function qh(e,t){return e!=null?e:t}function tR(e){return e===void 0?null:e}function R4(e,t,r){e.length=t,e.fill(r)}function E0(e,t){var r=t-1;return e+r&~r}function M4(e,t){return((e+t-1)/t|0)*t}function rR(e,t,r){for(var i=0,a=e.length;i<a;){var u=i+(a-i>>>1),h=r(t,e[u]);h<0?a=u:i=u+1}return i}function I4(e,t,r){var i=rR(e,t,r);e.splice(i,0,t)}function P4(e,t,r){return r?e|=t:e&=~t,e}function nR(e,t){for(var r=new Array(e),i=0;i<e;i++)r[i]=t();return r}function iR(e,t){t===void 0&&(t=1);var r=e.split(`
`);return r.map(function(i,a){return"".concat(oR(""+(t+a),4," "),"  ").concat(i)}).join(`
`)}function oR(e,t,r){for(r===void 0&&(r="0");e.length<t;)e="".concat(r).concat(e);return e}function O4(e,t){for(var r=[],i=e;i<e+t;i++)r.push(i);return r}function px(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function b0(e,t){return e===void 0&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function dx(e,t){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),px(e.rgbBlendState,t.rgbBlendState),px(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function j_(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;r<t.length;r++)e[r]=dx(e[r],t[r])}function aR(e,t){t.attachmentsState!==void 0&&j_(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&fx(e.blendConstant,t.blendConstant),e.depthCompare=qh(t.depthCompare,e.depthCompare),e.depthWrite=qh(t.depthWrite,e.depthWrite),e.stencilWrite=qh(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&b0(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&b0(e.stencilBack,t.stencilBack),e.cullMode=qh(t.cullMode,e.cullMode),e.frontFace=qh(t.frontFace,e.frontFace),e.polygonOffset=qh(t.polygonOffset,e.polygonOffset),e.polygonOffsetFactor=qh(t.polygonOffsetFactor,e.polygonOffsetFactor),e.polygonOffsetUnits=qh(t.polygonOffsetUnits,e.polygonOffsetUnits)}function Zd(e){var t=Object.assign({},e);return t.attachmentsState=[],j_(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&hx(t.blendConstant),t.stencilFront=b0(void 0,e.stencilFront),t.stencilBack=b0(void 0,e.stencilBack),t}function sR(e,t){t.channelWriteMask!==void 0&&(e.channelWriteMask=t.channelWriteMask),t.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=t.rgbBlendMode),t.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=t.alphaBlendMode),t.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),t.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),t.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),t.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}var mx={blendMode:Ws.ADD,blendSrcFactor:Bi.ONE,blendDstFactor:Bi.ZERO},qp={attachmentsState:[{channelWriteMask:Gs.ALL,rgbBlendState:mx,alphaBlendState:mx}],blendConstant:hx(y0),depthWrite:!0,depthCompare:Ai.LEQUAL,stencilWrite:!1,stencilFront:{compare:Ai.ALWAYS,passOp:Pa.KEEP,depthFailOp:Pa.KEEP,failOp:Pa.KEEP},stencilBack:{compare:Ai.ALWAYS,passOp:Pa.KEEP,depthFailOp:Pa.KEEP,failOp:Pa.KEEP},cullMode:xl.NONE,frontFace:jm.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};function uR(e,t){e===void 0&&(e=null),t===void 0&&(t=qp);var r=Zd(t);return e!==null&&aR(r,e),r}var D4=uR({depthCompare:Ai.ALWAYS,depthWrite:!1},qp);function L4(e,t){return e.attachmentsState===void 0&&(e.attachmentsState=[],j_(e.attachmentsState,qp.attachmentsState)),sR(e.attachmentsState[0],t),e}var vx={texture:null,sampler:null,formatKind:Oa.Float,dimension:Oi.TEXTURE_2D};function Kh(e,t,r){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1;return!0}function jd(e,t){for(var r=Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function lR(e,t){return e.texture===t.texture&&e.binding===t.binding}function _x(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function cR(e,t){return e===null?t===null:t===null?!1:e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison}function fR(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],!(e.samplerBindings.length!==t.samplerBindings.length||!Kh(e.samplerBindings,t.samplerBindings,cR)||!Kh(e.uniformBufferBindings,t.uniformBufferBindings,_x)||!Kh(e.storageBufferBindings,t.storageBufferBindings,_x)||!Kh(e.storageTextureBindings,t.storageTextureBindings,lR))}function gx(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function hR(e,t){return!(!gx(e.rgbBlendState,t.rgbBlendState)||!gx(e.alphaBlendState,t.alphaBlendState)||e.channelWriteMask!==t.channelWriteMask)}function S0(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function pR(e,t){return!Kh(e.attachmentsState,t.attachmentsState,hR)||e.blendConstant&&t.blendConstant&&!cx(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!S0(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!S0(e.stencilBack,t.stencilBack)?!1:e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilWrite===t.stencilWrite&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset&&e.polygonOffsetFactor===t.polygonOffsetFactor&&e.polygonOffsetUnits===t.polygonOffsetUnits}function yx(e,t){return e.id===t.id}function dR(e,t){return e===t}function mR(e,t){return!(e.topology!==t.topology||e.inputLayout!==t.inputLayout||e.sampleCount!==t.sampleCount||e.megaStateDescriptor&&t.megaStateDescriptor&&!pR(e.megaStateDescriptor,t.megaStateDescriptor)||!yx(e.program,t.program)||!Kh(e.colorAttachmentFormats,t.colorAttachmentFormats,dR)||e.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function vR(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function _R(e,t){return(0,Tc.Z)(e)?(0,Tc.Z)(t):(0,Tc.Z)(t)?!1:e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&Kh(e.attributes,t.attributes,vR)}function gR(e,t){return!(e.indexBufferFormat!==t.indexBufferFormat||!Kh(e.vertexBufferDescriptors,t.vertexBufferDescriptors,_R)||!yx(e.program,t.program))}function F4(e,t){return e.addressModeU===t.addressModeU&&e.addressModeV===t.addressModeV&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipmapFilter===t.mipmapFilter&&e.lodMinClamp===t.lodMinClamp&&e.lodMaxClamp===t.lodMaxClamp&&e.maxAnisotropy===t.maxAnisotropy&&e.compareFunction===t.compareFunction}function yR(e){var t=e.sampler,r=e.texture,i=e.dimension,a=e.formatKind,u=e.comparison;return{sampler:t,texture:r,dimension:i,formatKind:a,comparison:u}}function xx(e){var t=e.buffer,r=e.size,i=e.binding,a=e.offset;return{binding:i,buffer:t,offset:a,size:r}}function xR(e){var t=e.binding,r=e.texture;return{binding:t,texture:r}}function ER(e){var t=e.samplerBindings&&jd(e.samplerBindings,yR),r=e.uniformBufferBindings&&jd(e.uniformBufferBindings,xx),i=e.storageBufferBindings&&jd(e.storageBufferBindings,xx),a=e.storageTextureBindings&&jd(e.storageTextureBindings,xR);return{samplerBindings:t,uniformBufferBindings:r,storageBufferBindings:i,storageTextureBindings:a,pipeline:e.pipeline}}function bR(e){var t=e.inputLayout,r=e.program,i=e.topology,a=e.megaStateDescriptor&&Zd(e.megaStateDescriptor),u=e.colorAttachmentFormats.slice(),h=e.depthStencilAttachmentFormat,m=e.sampleCount;return{inputLayout:t,megaStateDescriptor:a,program:r,topology:i,colorAttachmentFormats:u,depthStencilAttachmentFormat:h,sampleCount:m}}function SR(e){var t=e.shaderLocation,r=e.format,i=e.offset,a=e.divisor;return{shaderLocation:t,format:r,offset:i,divisor:a}}function AR(e){if((0,Tc.Z)(e))return e;var t=e.arrayStride,r=e.stepMode,i=jd(e.attributes,SR);return{arrayStride:t,stepMode:r,attributes:i}}function TR(e){var t=jd(e.vertexBufferDescriptors,AR),r=e.indexBufferFormat,i=e.program;return{vertexBufferDescriptors:t,indexBufferFormat:r,program:i}}var Zi,CR=/([^[]*)(\[[0-9]+\])?/;function wR(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var t=e.match(CR);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}}function Qu(){var e=null;return function(t,r,i){var a=e!==i;return a&&(t.uniform1i(r,i),e=i),a}}function Da(e,t,r,i){var a=null,u=null;return function(h,m,g){var E=t(g,r),A=E.length,w=!1;if(a===null)a=new Float32Array(A),u=A,w=!0;else{vi(u===A,"Uniform length cannot change.");for(var R=0;R<A;++R)if(E[R]!==a[R]){w=!0;break}}return w&&(i(h,e,m,E),a.set(E)),w}}function Fu(e,t,r,i){e[t](r,i)}function sh(e,t,r,i){e[t](r,!1,i)}var RR={},MR={},IR={},Ex=[0];function H_(e,t,r,i){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(Ex[0]=e,e=Ex);var a=e.length;if(e instanceof r)return e;var u=i[a];u||(u=new r(a),i[a]=u);for(var h=0;h<a;h++)u[h]=e[h];return u}function jl(e,t){return H_(e,t,Float32Array,RR)}function $h(e,t){return H_(e,t,Int32Array,MR)}function A0(e,t){return H_(e,t,Uint32Array,IR)}var PR=(Zi={},Zi[Be.FLOAT]=Da.bind(null,"uniform1fv",jl,1,Fu),Zi[Be.FLOAT_VEC2]=Da.bind(null,"uniform2fv",jl,2,Fu),Zi[Be.FLOAT_VEC3]=Da.bind(null,"uniform3fv",jl,3,Fu),Zi[Be.FLOAT_VEC4]=Da.bind(null,"uniform4fv",jl,4,Fu),Zi[Be.INT]=Da.bind(null,"uniform1iv",$h,1,Fu),Zi[Be.INT_VEC2]=Da.bind(null,"uniform2iv",$h,2,Fu),Zi[Be.INT_VEC3]=Da.bind(null,"uniform3iv",$h,3,Fu),Zi[Be.INT_VEC4]=Da.bind(null,"uniform4iv",$h,4,Fu),Zi[Be.BOOL]=Da.bind(null,"uniform1iv",$h,1,Fu),Zi[Be.BOOL_VEC2]=Da.bind(null,"uniform2iv",$h,2,Fu),Zi[Be.BOOL_VEC3]=Da.bind(null,"uniform3iv",$h,3,Fu),Zi[Be.BOOL_VEC4]=Da.bind(null,"uniform4iv",$h,4,Fu),Zi[Be.FLOAT_MAT2]=Da.bind(null,"uniformMatrix2fv",jl,4,sh),Zi[Be.FLOAT_MAT3]=Da.bind(null,"uniformMatrix3fv",jl,9,sh),Zi[Be.FLOAT_MAT4]=Da.bind(null,"uniformMatrix4fv",jl,16,sh),Zi[Be.UNSIGNED_INT]=Da.bind(null,"uniform1uiv",A0,1,Fu),Zi[Be.UNSIGNED_INT_VEC2]=Da.bind(null,"uniform2uiv",A0,2,Fu),Zi[Be.UNSIGNED_INT_VEC3]=Da.bind(null,"uniform3uiv",A0,3,Fu),Zi[Be.UNSIGNED_INT_VEC4]=Da.bind(null,"uniform4uiv",A0,4,Fu),Zi[Be.FLOAT_MAT2x3]=Da.bind(null,"uniformMatrix2x3fv",jl,6,sh),Zi[Be.FLOAT_MAT2x4]=Da.bind(null,"uniformMatrix2x4fv",jl,8,sh),Zi[Be.FLOAT_MAT3x2]=Da.bind(null,"uniformMatrix3x2fv",jl,6,sh),Zi[Be.FLOAT_MAT3x4]=Da.bind(null,"uniformMatrix3x4fv",jl,12,sh),Zi[Be.FLOAT_MAT4x2]=Da.bind(null,"uniformMatrix4x2fv",jl,8,sh),Zi[Be.FLOAT_MAT4x3]=Da.bind(null,"uniformMatrix4x3fv",jl,12,sh),Zi[Be.SAMPLER_2D]=Qu,Zi[Be.SAMPLER_CUBE]=Qu,Zi[Be.SAMPLER_3D]=Qu,Zi[Be.SAMPLER_2D_SHADOW]=Qu,Zi[Be.SAMPLER_2D_ARRAY]=Qu,Zi[Be.SAMPLER_2D_ARRAY_SHADOW]=Qu,Zi[Be.SAMPLER_CUBE_SHADOW]=Qu,Zi[Be.INT_SAMPLER_2D]=Qu,Zi[Be.INT_SAMPLER_3D]=Qu,Zi[Be.INT_SAMPLER_CUBE]=Qu,Zi[Be.INT_SAMPLER_2D_ARRAY]=Qu,Zi[Be.UNSIGNED_INT_SAMPLER_2D]=Qu,Zi[Be.UNSIGNED_INT_SAMPLER_3D]=Qu,Zi[Be.UNSIGNED_INT_SAMPLER_CUBE]=Qu,Zi[Be.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Qu,Zi);function bx(e,t,r){var i=PR[r.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(r.type));return i().bind(null,e,t)}var OR={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function DR(e){return Object.prototype.toString.call(e)in OR}function Wm(e,t){return"#define ".concat(e," ").concat(t)}function LR(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(r,i,a){var u=Number(a);return t[i]=isNaN(u)?a:u,""}),t}function FR(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(i,a,u){var h=Number(a);return r.push({location:isNaN(h)?t[a]:h,name:u}),""}),r}function B4(e){var t=[],r=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(i,a,u){var h=[];return u.trim().replace(`\r
`,`
`).split(`
`).forEach(function(m){var g=__read(m.trim().split(/\s+/),2),E=g[0],A=g[1];h.push({type:E.trim(),name:A.replace(";","").trim()})}),r.push({type:a.trim(),uniforms:h}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(i,a){return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(u){var h=u.trim().split(" "),m=h[0]||"",g=h[1]||"",E=g.indexOf("[")>-1;if(g=g.replace(";","").replace("[","").trim(),!m.startsWith("#")){if(m){var A=r.find(function(U){return m===U.type});if(A)if(E)for(var w=function(U){A.uniforms.forEach(function(q){t.push("".concat(g,"[").concat(U,"].").concat(q.name))})},R=0;R<5;R++)w(R);else A.uniforms.forEach(function(U){t.push("".concat(g,".").concat(U.name))})}g&&t.push(g)}}),""}),t}function Sx(e){if(e===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(t!==null){var r=parseInt(t[1],10);if(!Number.isNaN(r))return r}return null}function Ax(e){var t="",r=e;return[r,t]}function Qh(e,t,r,i,a){var u;i===void 0&&(i=null),a===void 0&&(a=!0);var h=e.glslVersion==="#version 100",m=t==="frag"&&((u=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||u===void 0?void 0:u.length)>1,g=r.replace(`\r
`,`
`).split(`
`).map(function(cr){return cr.replace(/[/][/].*$/,"")}).filter(function(cr){var kt=!cr||/^\s+$/.test(cr);return!kt}),E="";i!==null&&(E=Object.keys(i).map(function(cr){return Wm(cr,i[cr])}).join(`
`));var A=g.find(function(cr){return cr.startsWith("precision")})||"precision mediump float;",w=a?g.filter(function(cr){return!cr.startsWith("precision")}).join(`
`):g.join(`
`),R="";if(e.viewportOrigin===Cf.UPPER_LEFT&&(R+="".concat(Wm("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Ud.ZERO&&(R+="".concat(Wm("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var U=0,q=0,ce=0;w=w.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(cr,kt,dr,Pn){var _i=dr?"".concat(dr,", "):"";return"layout(".concat(_i,"set = ").concat(U,", binding = ").concat(q++,") uniform ").concat(Pn)}),U++,q=0,vi(e.separateSamplerTextures),w=w.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(cr,kt,dr,Pn,_i){var En=Sx(dr);En===null&&(En=q++);var fi=(0,pn.CR)(Ax(Pn),2),Gi=fi[0],ou=fi[1];return t==="frag"?`
layout(set = `.concat(U,", binding = ").concat(En*2+0,") uniform texture").concat(Gi," T_").concat(_i,`;
layout(set = `).concat(U,", binding = ").concat(En*2+1,") uniform sampler").concat(ou," S_").concat(_i,";").trim():""}),w=w.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(cr,kt){return"layout(location = ".concat(ce++,") ").concat(kt)}),R+="".concat(Wm("gl_VertexID","gl_VertexIndex"),`
`),R+="".concat(Wm("gl_InstanceID","gl_InstanceIndex"),`
`),A=A.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var Se=0;w=w.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(cr,kt,dr,Pn,_i){var En=Sx(dr);return En===null&&(En=Se++),"uniform sampler".concat(Pn," ").concat(_i,"; // BINDING=").concat(En)})}if(w=w.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){return"SAMPLER_".concat(kt,"(P_").concat(dr,")")}),w=w.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){return"PP_SAMPLER_".concat(kt,"(P_").concat(dr,")")}),w=w.replace(/\bPU_TEXTURE\((.*?)\)/g,function(cr,kt){return"TEXTURE(P_".concat(kt,")")}),e.separateSamplerTextures)w=w.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){var Pn=(0,pn.CR)(Ax(kt),2),_i=Pn[0],En=Pn[1];return"texture".concat(_i," T_P_").concat(dr,", sampler").concat(En," S_P_").concat(dr)}),w=w.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){return"T_".concat(dr,", S_").concat(dr)}),w=w.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){return"sampler".concat(kt,"(T_").concat(dr,", S_").concat(dr,")")}),w=w.replace(/\bTEXTURE\((.*?)\)/g,function(cr,kt){return"T_".concat(kt)});else{var ke=[];w=w.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){return"sampler".concat(kt," P_").concat(dr)}),w=w.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){return dr}),w=w.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(cr,kt,dr){return ke.push([dr,kt]),dr}),h&&ke.forEach(function(cr){var kt=(0,pn.CR)(cr,2),dr=kt[0],Pn=kt[1];w=w.replace(new RegExp("texture\\(".concat(dr),"g"),function(){return"texture".concat(Pn,"(").concat(dr)})}),w=w.replace(/\bTEXTURE\((.*?)\)/g,function(cr,kt){return kt})}var Fe="".concat(h?"":e.glslVersion,`
`).concat(h&&m?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(h&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(a?A:"",`
`).concat(R||"").concat(E?E+`
`:"",`
`).concat(w,`
`).trim();if(e.explicitBindingLocations&&t==="frag"&&(Fe=Fe.replace(/^\b(out)\b/g,function(cr,kt){return"layout(location = 0) ".concat(kt)})),h){if(t==="frag"&&(Fe=Fe.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(cr,kt,dr){return"varying ".concat(kt," ").concat(dr,`;
`)})),t==="vert"&&(Fe=Fe.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(cr,kt,dr){return"varying ".concat(kt," ").concat(dr,`;
`)}),Fe=Fe.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(cr,kt,dr){return"attribute ".concat(kt," ").concat(dr,`;
`)})),Fe=Fe.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(cr,kt){return kt.trim().replace(/^.*$/gm,function(dr){var Pn=dr.trim();return Pn.startsWith("#")?Pn:dr?"uniform ".concat(Pn):""})}),t==="frag")if(m){var rt=[];Fe=Fe.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(cr,kt){return rt.push(kt),"vec4 ".concat(kt,`;
`)});var mt=Fe.lastIndexOf("}");Fe=Fe.substring(0,mt)+`
    `.concat(rt.map(function(cr,kt){return"gl_FragData[".concat(kt,"] = ").concat(cr,`;
    `)}).join(`
`))+Fe.substring(mt)}else{var er;if(Fe=Fe.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(cr,kt,dr){return er=dr,"".concat(kt," ").concat(dr,`;
`)}),er){var mt=Fe.lastIndexOf("}");Fe=Fe.substring(0,mt)+`
  gl_FragColor = vec4(`.concat(er,`);
`)+Fe.substring(mt)}}Fe=Fe.replace(/^\s*layout\((.*)\)/gm,"")}return Fe}function N4(e,t,r,i){i===void 0&&(i=null);var a=Qh(e,"vert",t,i),u=Qh(e,"frag",r,i);return{vert:t,frag:r,preprocessedVert:a,preprocessedFrag:u}}var Cc=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this)||this;return u.id=i,u.device=a,u.device.resourceCreationTracker!==null&&u.device.resourceCreationTracker.trackResourceCreated(u),u}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(ox.Z),BR=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;h.type=to.Bindings;var m=u.uniformBufferBindings,g=u.samplerBindings;return h.uniformBufferBindings=m||[],h.samplerBindings=g||[],h.bindingLayouts=h.createBindingLayouts(),h}return t.prototype.createBindingLayouts=function(){var r=0,i=0,a=[],u=this.uniformBufferBindings.length,h=this.samplerBindings.length;return a.push({firstUniformBuffer:r,numUniformBuffers:u,firstSampler:i,numSamplers:h}),r+=u,i+=h,{numUniformBuffers:r,numSamplers:i,bindingLayoutTables:a}},t}(Cc);function Rn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function Tx(e){var t=wf(e);switch(t){case lr.BC1:case lr.BC2:case lr.BC3:case lr.BC4_UNORM:case lr.BC4_SNORM:case lr.BC5_UNORM:case lr.BC5_SNORM:return!0;default:return!1}}function Cx(e){var t=zd(e);if(t&an.Normalized)return!1;var r=wf(e);return r===lr.S8||r===lr.S16||r===lr.S32||r===lr.U8||r===lr.U16||r===lr.U32}function NR(e){switch(e){case tf.STATIC:return Be.STATIC_DRAW;case tf.DYNAMIC:return Be.DYNAMIC_DRAW}}function Rx(e){if(e&zo.INDEX)return Be.ELEMENT_ARRAY_BUFFER;if(e&zo.VERTEX)return Be.ARRAY_BUFFER;if(e&zo.UNIFORM)return Be.UNIFORM_BUFFER}function kR(e){switch(e){case ns.TRIANGLES:return Be.TRIANGLES;case ns.POINTS:return Be.POINTS;case ns.TRIANGLE_STRIP:return Be.TRIANGLE_STRIP;case ns.LINES:return Be.LINES;case ns.LINE_STRIP:return Be.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function UR(e){switch(e){case lr.U8:return Be.UNSIGNED_BYTE;case lr.U16:return Be.UNSIGNED_SHORT;case lr.U32:return Be.UNSIGNED_INT;case lr.S8:return Be.BYTE;case lr.S16:return Be.SHORT;case lr.S32:return Be.INT;case lr.F16:return Be.HALF_FLOAT;case lr.F32:return Be.FLOAT;default:throw new Error("whoops")}}function zR(e){switch(e){case _n.R:return 1;case _n.RG:return 2;case _n.RGB:return 3;case _n.RGBA:return 4;default:return 1}}function VR(e){var t=wf(e),r=g0(e),i=zd(e),a=UR(t),u=zR(r),h=!!(i&an.Normalized);return{size:u,type:a,normalized:h}}function ZR(e){switch(e){case st.U8_R:return Be.UNSIGNED_BYTE;case st.U16_R:return Be.UNSIGNED_SHORT;case st.U32_R:return Be.UNSIGNED_INT;default:throw new Error("whoops")}}function Gm(e){switch(e){case $u.CLAMP_TO_EDGE:return Be.CLAMP_TO_EDGE;case $u.REPEAT:return Be.REPEAT;case $u.MIRRORED_REPEAT:return Be.MIRRORED_REPEAT;default:throw new Error("whoops")}}function T0(e,t){if(t===Ps.LINEAR&&e===Ha.BILINEAR)return Be.LINEAR_MIPMAP_LINEAR;if(t===Ps.LINEAR&&e===Ha.POINT)return Be.NEAREST_MIPMAP_LINEAR;if(t===Ps.NEAREST&&e===Ha.BILINEAR)return Be.LINEAR_MIPMAP_NEAREST;if(t===Ps.NEAREST&&e===Ha.POINT)return Be.NEAREST_MIPMAP_NEAREST;if(t===Ps.NO_MIP&&e===Ha.BILINEAR)return Be.LINEAR;if(t===Ps.NO_MIP&&e===Ha.POINT)return Be.NEAREST;throw new Error("Unknown texture filter mode")}function Hd(e,t){t===void 0&&(t=0);var r=e;return r.gl_buffer_pages[t/r.pageByteSize|0]}function Wd(e){var t=e;return t.gl_texture}function W_(e){var t=e;return t.gl_sampler}function Xm(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function Mx(e,t){for(var r=[];;){var i=t.exec(e);if(!i)break;r.push(i)}return r}function Jh(e){return e.blendMode==Ws.ADD&&e.blendSrcFactor==Bi.ONE&&e.blendDstFactor===Bi.ZERO}function jR(e){switch(e){case _0.OcclusionConservative:return Be.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function HR(e){if(e===Oi.TEXTURE_2D)return Be.TEXTURE_2D;if(e===Oi.TEXTURE_2D_ARRAY)return Be.TEXTURE_2D_ARRAY;if(e===Oi.TEXTURE_CUBE_MAP)return Be.TEXTURE_CUBE_MAP;if(e===Oi.TEXTURE_3D)return Be.TEXTURE_3D;throw new Error("whoops")}function G_(e,t,r,i){return!(e%r!==0||t%i!==0)}var WR=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;h.type=to.Buffer;var m=u.viewOrSize,g=u.usage,E=u.hint,A=E===void 0?tf.STATIC:E,w=a.uniformBufferMaxPageByteSize,R=a.gl,U=g&zo.UNIFORM;U||(Rn(R)?R.bindVertexArray(null):a.OES_vertex_array_object.bindVertexArrayOES(null));var q=(0,kd.Z)(m)?E0(m,4):E0(m.byteLength,4);h.gl_buffer_pages=[];var ce;if(U){for(var Se=q;Se>0;)h.gl_buffer_pages.push(h.createBufferPage(Math.min(Se,w),g,A)),Se-=w;ce=w}else h.gl_buffer_pages.push(h.createBufferPage(q,g,A)),ce=q;return h.pageByteSize=ce,h.byteSize=q,h.usage=g,h.gl_target=Rx(g),(0,kd.Z)(m)||h.setSubData(0,new Uint8Array(m.buffer)),U||(Rn(R)?R.bindVertexArray(h.device.currentBoundVAO):a.OES_vertex_array_object.bindVertexArrayOES(h.device.currentBoundVAO)),h}return t.prototype.setSubData=function(r,i,a,u){a===void 0&&(a=0),u===void 0&&(u=i.byteLength-a);for(var h=this.device.gl,m=this.pageByteSize,g=r+u,E=r,A=r%m;E<g;){var w=Rn(h)?h.COPY_WRITE_BUFFER:this.gl_target,R=Hd(this,E);if(R.ubo)return;h.bindBuffer(w,R),Rn(h)?h.bufferSubData(w,A,i,a,Math.min(g-E,m)):h.bufferSubData(w,A,i),E+=m,A=0,a+=m,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var r=0;r<this.gl_buffer_pages.length;r++)this.gl_buffer_pages[r].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[r]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(r,i,a){var u=this.device.gl,h=i&zo.UNIFORM;if(!Rn(u)&&h)return{ubo:!0};var m=this.device.ensureResourceExists(u.createBuffer()),g=Rx(i),E=NR(a);return u.bindBuffer(g,m),u.bufferData(g,r,E),m},t}(Cc),GR=function(e){(0,pn.ZT)(t,e);function t(r){var i,a,u,h,m=r.id,g=r.device,E=r.descriptor,A,w=e.call(this,{id:m,device:g})||this;w.type=to.InputLayout;var R=E.vertexBufferDescriptors,U=E.indexBufferFormat,q=E.program;vi(U===st.U16_R||U===st.U32_R||U===null);var ce=U!==null?ZR(U):null,Se=U!==null?ux(U):null,ke=w.device.gl,Fe=w.device.ensureResourceExists(Rn(ke)?ke.createVertexArray():g.OES_vertex_array_object.createVertexArrayOES());Rn(ke)?ke.bindVertexArray(Fe):g.OES_vertex_array_object.bindVertexArrayOES(Fe),ke.bindBuffer(ke.ARRAY_BUFFER,Hd(w.device.fallbackVertexBuffer));try{for(var rt=(0,pn.XA)(E.vertexBufferDescriptors),mt=rt.next();!mt.done;mt=rt.next()){var er=mt.value,cr=er.stepMode,kt=er.attributes;try{for(var dr=(u=void 0,(0,pn.XA)(kt)),Pn=dr.next();!Pn.done;Pn=dr.next()){var _i=Pn.value,En=_i.shaderLocation,fi=_i.format,Gi=_i.divisor,ou=Gi===void 0?1:Gi,Bu=Rn(ke)?En:(A=q.attributes[En])===null||A===void 0?void 0:A.location,bl=VR(fi);if(_i.vertexFormat=bl,!(0,Tc.Z)(Bu)){Cx(fi);var ep=bl.size,tp=bl.type,Hl=bl.normalized;ke.vertexAttribPointer(Bu,ep,tp,Hl,0,0),cr===Xp.INSTANCE&&(Rn(ke)?ke.vertexAttribDivisor(Bu,ou):g.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Bu,ou)),ke.enableVertexAttribArray(Bu)}}}catch(lv){u={error:lv}}finally{try{Pn&&!Pn.done&&(h=dr.return)&&h.call(dr)}finally{if(u)throw u.error}}}}catch(lv){i={error:lv}}finally{try{mt&&!mt.done&&(a=rt.return)&&a.call(rt)}finally{if(i)throw i.error}}return Rn(ke)?ke.bindVertexArray(null):g.OES_vertex_array_object.bindVertexArrayOES(null),w.vertexBufferDescriptors=R,w.vao=Fe,w.indexBufferFormat=U,w.indexBufferType=ce,w.indexBufferCompByteSize=Se,w.program=q,w}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Rn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(Cc),X_=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=r.fake,m=e.call(this,{id:i,device:a})||this;m.type=to.Texture,u=(0,pn.pi)({dimension:Oi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},u);var g=m.device.gl,E,A,w=m.clampmipLevelCount(u);if(m.immutable=u.usage===mu.RENDER_TARGET,m.pixelStore=u.pixelStore,m.format=u.format,m.dimension=u.dimension,m.formatKind=lx(u.format),m.width=u.width,m.height=u.height,m.depthOrArrayLayers=u.depthOrArrayLayers,m.mipmaps=w>=1,!h){A=m.device.ensureResourceExists(g.createTexture());var R=m.device.translateTextureType(u.format),U=m.device.translateTextureInternalFormat(u.format);if(m.device.setActiveTexture(g.TEXTURE0),m.device.currentTextures[0]=null,m.preprocessImage(),u.dimension===Oi.TEXTURE_2D){if(E=Be.TEXTURE_2D,g.bindTexture(E,A),m.immutable)if(Rn(g))g.texStorage2D(E,w,U,u.width,u.height);else{var q=(U===Be.DEPTH_COMPONENT||m.isNPOT(),0);(m.format===st.D32F||m.format===st.D24_S8)&&!Rn(g)&&!a.WEBGL_depth_texture||(g.texImage2D(E,q,U,u.width,u.height,0,U,R,null),m.mipmaps&&(m.mipmaps=!1,g.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_MIN_FILTER,Be.LINEAR),g.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_S,Be.CLAMP_TO_EDGE),g.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_T,Be.CLAMP_TO_EDGE)))}vi(u.depthOrArrayLayers===1)}else if(u.dimension===Oi.TEXTURE_2D_ARRAY)E=Be.TEXTURE_2D_ARRAY,g.bindTexture(E,A),m.immutable&&Rn(g)&&g.texStorage3D(E,w,U,u.width,u.height,u.depthOrArrayLayers);else if(u.dimension===Oi.TEXTURE_3D)E=Be.TEXTURE_3D,g.bindTexture(E,A),m.immutable&&Rn(g)&&g.texStorage3D(E,w,U,u.width,u.height,u.depthOrArrayLayers);else if(u.dimension===Oi.TEXTURE_CUBE_MAP)E=Be.TEXTURE_CUBE_MAP,g.bindTexture(E,A),m.immutable&&Rn(g)&&g.texStorage2D(E,w,U,u.width,u.height),vi(u.depthOrArrayLayers===6);else throw new Error("whoops")}return m.gl_texture=A,m.gl_target=E,m.mipLevelCount=w,m}return t.prototype.setImageData=function(r,i){i===void 0&&(i=0);var a=this.device.gl;Tx(this.format);var u=this.gl_target===Be.TEXTURE_3D||this.gl_target===Be.TEXTURE_2D_ARRAY,h=this.gl_target===Be.TEXTURE_CUBE_MAP,m=DR(r[0]);this.device.setActiveTexture(a.TEXTURE0),this.device.currentTextures[0]=null;var g=r[0],E,A;m?(E=this.width,A=this.height):(E=g.width,A=g.height,this.width=E,this.height=A),a.bindTexture(this.gl_target,this.gl_texture);var w=this.device.translateTextureFormat(this.format),R=Rn(a)?this.device.translateInternalTextureFormat(this.format):w,U=this.device.translateTextureType(this.format);this.preprocessImage();for(var q=0;q<this.depthOrArrayLayers;q++){var ce=r[q],Se=this.gl_target;h&&(Se=Be.TEXTURE_CUBE_MAP_POSITIVE_X+q%6),this.immutable?a.texSubImage2D(Se,i,0,0,E,A,w,U,ce):Rn(a)?u?a.texImage3D(Se,i,R,E,A,this.depthOrArrayLayers,0,w,U,ce):a.texImage2D(Se,i,R,E,A,0,w,U,ce):m?a.texImage2D(Se,i,w,E,A,0,w,U,ce):a.texImage2D(Se,i,w,w,U,ce)}this.mipmaps&&this.generateMipmap(u)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Wd(this))},t.prototype.clampmipLevelCount=function(r){if(r.dimension===Oi.TEXTURE_2D_ARRAY&&r.depthOrArrayLayers>1){var i=wf(r.format);if(i===lr.BC1)for(var a=r.width,u=r.height,h=0;h<r.mipLevelCount;h++){if(a<=2||u<=2)return h-1;a=Math.max(a/2|0,1),u=Math.max(u/2|0,1)}}return r.mipLevelCount},t.prototype.preprocessImage=function(){var r=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&r.pixelStorei(Be.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&r.pixelStorei(Be.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&r.pixelStorei(Be.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(r){r===void 0&&(r=!1);var i=this.device.gl;return!Rn(i)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(i.bindTexture(this.gl_target,this.gl_texture),r?(i.texParameteri(this.gl_target,Be.TEXTURE_BASE_LEVEL,0),i.texParameteri(this.gl_target,Be.TEXTURE_MAX_LEVEL,Math.log2(this.width)),i.texParameteri(this.gl_target,Be.TEXTURE_MIN_FILTER,Be.LINEAR_MIPMAP_LINEAR),i.texParameteri(this.gl_target,Be.TEXTURE_MAG_FILTER,Be.LINEAR)):i.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_MIN_FILTER,Be.NEAREST_MIPMAP_LINEAR),i.generateMipmap(this.gl_target),i.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var r=this.device.gl;return Rn(r)?!1:!x0(this.width)||!x0(this.height)},t}(Cc),XR=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;h.type=to.RenderTarget,h.gl_renderbuffer=null,h.texture=null;var m=h.device.gl,g=u.format,E=u.width,A=u.height,w=u.sampleCount,R=w===void 0?1:w,U=u.texture,q=!1;if((g===st.D32F||g===st.D24_S8)&&U&&!Rn(m)&&!a.WEBGL_depth_texture&&(U.destroy(),h.texture=null,q=!0),!q&&U)h.texture=U;else{h.gl_renderbuffer=h.device.ensureResourceExists(m.createRenderbuffer()),m.bindRenderbuffer(m.RENDERBUFFER,h.gl_renderbuffer);var ce=h.device.translateTextureInternalFormat(g,!0);Rn(m)&&R>1?m.renderbufferStorageMultisample(Be.RENDERBUFFER,R,ce,E,A):m.renderbufferStorage(Be.RENDERBUFFER,ce,E,A)}return h.format=g,h.width=E,h.height=A,h.sampleCount=R,h}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(Cc),El;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(El||(El={}));var YR=function(e){(0,pn.ZT)(t,e);function t(r,i){var a=r.id,u=r.device,h=r.descriptor,m=e.call(this,{id:a,device:u})||this;m.rawVertexGLSL=i,m.type=to.Program,m.uniformSetters={},m.attributes=[];var g=m.device.gl;return m.descriptor=h,m.gl_program=m.device.ensureResourceExists(g.createProgram()),m.gl_shader_vert=null,m.gl_shader_frag=null,m.compileState=El.NeedsCompile,m.tryCompileProgram(),m}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){vi(this.compileState===El.NeedsCompile);var r=this.descriptor,i=r.vertex,a=r.fragment,u=this.device.gl;i!=null&&i.glsl&&(a!=null&&a.glsl)&&(this.gl_shader_vert=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,u.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(a.postprocess?a.postprocess(a.glsl):a.glsl,u.FRAGMENT_SHADER),u.attachShader(this.gl_program,this.gl_shader_vert),u.attachShader(this.gl_program,this.gl_shader_frag),u.linkProgram(this.gl_program),this.compileState=El.Compiling,Rn(u)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var r,i=this.device.gl,a=i.getProgramParameter(this.gl_program,i.ACTIVE_ATTRIBUTES),u=LR(this.descriptor.vertex.glsl),h=FR(this.rawVertexGLSL,u),m=function(A){var w=i.getActiveAttrib(g.gl_program,A),R=w.name,U=w.type,q=w.size,ce=i.getAttribLocation(g.gl_program,R),Se=(r=h.find(function(ke){return ke.name===R}))===null||r===void 0?void 0:r.location;ce>=0&&!(0,Tc.Z)(Se)&&(g.attributes[Se]={name:R,location:ce,type:U,size:q})},g=this,E=0;E<a;E++)m(E)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var r=this.device.gl,i=r.getProgramParameter(this.gl_program,r.ACTIVE_UNIFORMS),a=0;a<i;a++){var u=r.getActiveUniform(this.gl_program,a),h=wR(u.name).name,m=r.getUniformLocation(this.gl_program,h);if(this.uniformSetters[h]=bx(r,m,u),u&&u.size>1)for(var g=0;g<u.size;g++)m=r.getUniformLocation(this.gl_program,"".concat(h,"[").concat(g,"]")),this.uniformSetters["".concat(h,"[").concat(g,"]")]=bx(r,m,u)}},t.prototype.compileShader=function(r,i){var a=this.device.gl,u=this.device.ensureResourceExists(a.createShader(i));return a.shaderSource(u,r),a.compileShader(u),u},t.prototype.setUniformsLegacy=function(r){r===void 0&&(r={});var i=this.device.gl;if(!Rn(i)){var a=!1;for(var u in r){a||(i.useProgram(this.gl_program),a=!0);var h=r[u],m=this.uniformSetters[u];if(m){var g=h;g instanceof X_&&(g=g.textureIndex),m(g)}}}return this},t}(Cc),qR=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;h.type=to.QueryPool;var m=h.device.gl;if(Rn(m)){var g=u.elemCount,E=u.type;h.gl_query=nR(g,function(){return h.device.ensureResourceExists(m.createQuery())}),h.gl_query_type=jR(E)}return h}return t.prototype.queryResultOcclusion=function(r){var i=this.device.gl;if(Rn(i)){var a=this.gl_query[r];return i.getQueryParameter(a,i.QUERY_RESULT_AVAILABLE)?!!i.getQueryParameter(a,i.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var r=this.device.gl;if(Rn(r))for(var i=0;i<this.gl_query.length;i++)r.deleteQuery(this.gl_query[i])},t}(Cc),KR=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this,{id:i,device:a})||this;return u.type=to.Readback,u.gl_pbo=null,u.gl_sync=null,u}return t.prototype.clientWaitAsync=function(r,i,a){i===void 0&&(i=0),a===void 0&&(a=10);var u=this.device.gl;return new Promise(function(h,m){function g(){var E=u.clientWaitSync(r,i,0);if(E==u.WAIT_FAILED){m();return}if(E==u.TIMEOUT_EXPIRED){setTimeout(g,(0,$w.Z)(a,0,u.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}h()}g()})},t.prototype.getBufferSubDataAsync=function(r,i,a,u,h,m){return(0,pn.mG)(this,void 0,void 0,function(){var g;return(0,pn.Jh)(this,function(E){switch(E.label){case 0:return g=this.device.gl,Rn(g)?(this.gl_sync=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0),g.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return E.sent(),g.bindBuffer(r,i),g.getBufferSubData(r,a,u,h,m),g.bindBuffer(r,null),[2,u];case 2:return[2]}})})},t.prototype.readTexture=function(r,i,a,u,h,m,g,E){return g===void 0&&(g=0),E===void 0&&(E=m.byteLength||0),(0,pn.mG)(this,void 0,void 0,function(){var A,w,R,U,q;return(0,pn.Jh)(this,function(ce){return A=this.device.gl,w=r,R=this.device.translateTextureFormat(w.format),U=this.device.translateTextureType(w.format),q=Qw(w.format),Rn(A)?(this.gl_pbo=this.device.ensureResourceExists(A.createBuffer()),A.bindBuffer(A.PIXEL_PACK_BUFFER,this.gl_pbo),A.bufferData(A.PIXEL_PACK_BUFFER,E,A.STREAM_READ),A.bindBuffer(A.PIXEL_PACK_BUFFER,null),A.bindFramebuffer(Be.READ_FRAMEBUFFER,this.device.readbackFramebuffer),A.framebufferTexture2D(Be.READ_FRAMEBUFFER,Be.COLOR_ATTACHMENT0,Be.TEXTURE_2D,w.gl_texture,0),A.bindBuffer(A.PIXEL_PACK_BUFFER,this.gl_pbo),A.readPixels(i,a,u,h,R,U,g*q),A.bindBuffer(A.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(A.PIXEL_PACK_BUFFER,this.gl_pbo,0,m,g,0)]):[2,this.readTextureSync(r,i,a,u,h,m,g,E)]})})},t.prototype.readTextureSync=function(r,i,a,u,h,m,g,E){E===void 0&&(E=m.byteLength||0);var A=this.device.gl,w=r,R=this.device.translateTextureType(w.format);return A.bindFramebuffer(Be.FRAMEBUFFER,this.device.readbackFramebuffer),A.framebufferTexture2D(Be.FRAMEBUFFER,Be.COLOR_ATTACHMENT0,Be.TEXTURE_2D,w.gl_texture,0),A.pixelStorei(A.PACK_ALIGNMENT,4),A.readPixels(i,a,u,h,A.RGBA,R,m),m},t.prototype.readBuffer=function(r,i,a,u,h){return(0,pn.mG)(this,void 0,void 0,function(){var m;return(0,pn.Jh)(this,function(g){return m=this.device.gl,Rn(m)?[2,this.getBufferSubDataAsync(m.ARRAY_BUFFER,Hd(r,i),i,a,u,h)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),Rn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(Cc),$R=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h,m,g=e.call(this,{id:i,device:a})||this;return g.type=to.RenderPipeline,g.drawMode=kR((h=u.topology)!==null&&h!==void 0?h:ns.TRIANGLES),g.program=u.program,g.inputLayout=u.inputLayout,g.megaState=(0,pn.pi)((0,pn.pi)({},Zd(qp)),u.megaStateDescriptor),g.colorAttachmentFormats=u.colorAttachmentFormats.slice(),g.depthStencilAttachmentFormat=u.depthStencilAttachmentFormat,g.sampleCount=(m=u.sampleCount)!==null&&m!==void 0?m:1,g}return t}(Cc),QR=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;return h.type=to.ComputePipeline,h.descriptor=u,h}return t}(Cc),JR=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},e.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},e.prototype.checkForLeaks=function(){var t,r;try{for(var i=(0,pn.XA)(this.liveObjects.values()),a=i.next();!a.done;a=i.next()){var u=a.value;console.warn("Object leaked:",u,"Creation stack:",this.creationStacks.get(u))}}catch(h){t={error:h}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.setResourceLeakCheck=function(t,r){r?this.liveObjects.add(t):this.liveObjects.delete(t)},e}(),eM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h,m,g=e.call(this,{id:i,device:a})||this;g.type=to.Sampler;var E=g.device.gl;if(Rn(E)){var A=g.device.ensureResourceExists(E.createSampler());E.samplerParameteri(A,Be.TEXTURE_WRAP_S,Gm(u.addressModeU)),E.samplerParameteri(A,Be.TEXTURE_WRAP_T,Gm(u.addressModeV)),E.samplerParameteri(A,Be.TEXTURE_WRAP_R,Gm((h=u.addressModeW)!==null&&h!==void 0?h:u.addressModeU)),E.samplerParameteri(A,Be.TEXTURE_MIN_FILTER,T0(u.minFilter,u.mipmapFilter)),E.samplerParameteri(A,Be.TEXTURE_MAG_FILTER,T0(u.magFilter,Ps.NO_MIP)),u.lodMinClamp!==void 0&&E.samplerParameterf(A,Be.TEXTURE_MIN_LOD,u.lodMinClamp),u.lodMaxClamp!==void 0&&E.samplerParameterf(A,Be.TEXTURE_MAX_LOD,u.lodMaxClamp),u.compareFunction!==void 0&&(E.samplerParameteri(A,E.TEXTURE_COMPARE_MODE,E.COMPARE_REF_TO_TEXTURE),E.samplerParameteri(A,E.TEXTURE_COMPARE_FUNC,u.compareFunction));var w=(m=u.maxAnisotropy)!==null&&m!==void 0?m:1;w>1&&g.device.EXT_texture_filter_anisotropic!==null&&(vi(u.minFilter===Ha.BILINEAR&&u.magFilter===Ha.BILINEAR&&u.mipmapFilter===Ps.LINEAR),E.samplerParameterf(A,g.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w)),g.gl_sampler=A}else g.descriptor=u;return g}return t.prototype.setTextureParameters=function(r,i,a){var u,h=this.device.gl,m=this.descriptor;this.isNPOT(i,a)?h.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_MIN_FILTER,Be.LINEAR):h.texParameteri(r,Be.TEXTURE_MIN_FILTER,T0(m.minFilter,m.mipmapFilter)),h.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_S,Gm(m.addressModeU)),h.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_T,Gm(m.addressModeV)),h.texParameteri(r,Be.TEXTURE_MAG_FILTER,T0(m.magFilter,Ps.NO_MIP));var g=(u=m.maxAnisotropy)!==null&&u!==void 0?u:1;g>1&&this.device.EXT_texture_filter_anisotropic!==null&&(vi(m.minFilter===Ha.BILINEAR&&m.magFilter===Ha.BILINEAR&&m.mipmapFilter===Ps.LINEAR),h.texParameteri(r,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Rn(this.device.gl)&&this.device.gl.deleteSampler(W_(this))},t.prototype.isNPOT=function(r,i){return!x0(r)||!x0(i)},t}(Cc),tM=function(){function e(){}return e.prototype.dispatchWorkgroups=function(t,r,i){},e.prototype.dispatchWorkgroupsIndirect=function(t,r){},e.prototype.setPipeline=function(t){},e.prototype.setBindings=function(t){},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e}(),rM=function(e){(0,pn.ZT)(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type=to.RenderBundle,r.commands=[],r}return t.prototype.push=function(r){this.commands.push(r)},t.prototype.replay=function(){this.commands.forEach(function(r){return r()})},t}(Cc),Ix=65536,nM=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,iM=function(){function e(t,r){r===void 0&&(r={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Zd(qp),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Cf.LOWER_LEFT,this.clipSpaceNearZ=Ud.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=Yp(t.getContextAttributes()),Rn(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),Rn(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new X_({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Oi.TEXTURE_2D,mipLevelCount:1,usage:mu.RENDER_TARGET,format:this.contextAttributes.alpha===!1?st.U8_RGB_RT:st.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Oa.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Oi.TEXTURE_2D,Oa.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Oi.TEXTURE_2D,Oa.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:zo.VERTEX,hint:tf.STATIC}),Rn(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Oi.TEXTURE_2D_ARRAY,Oa.Float),this.fallbackTexture3D=this.createFallbackTexture(Oi.TEXTURE_3D,Oa.Float),this.fallbackTextureCube=this.createFallbackTexture(Oi.TEXTURE_CUBE_MAP,Oa.Float)),this.currentMegaState.depthCompare=Ai.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=Gs.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),r.shaderDebug&&(this.shaderDebug=!0),r.trackResources&&(this.resourceCreationTracker=new JR)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(t,r){var i=t===Oi.TEXTURE_CUBE_MAP?6:1,a=r===Oa.Depth?st.D32F:st.U8_RGBA_NORM,u=this.createTexture({dimension:t,format:a,usage:mu.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1});return r===Oa.Float&&u.setImageData([new Uint8Array(4*i)]),Wd(u)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(Be.MAX_VERTEX_ATTRIBS),Rn(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(Be.MAX_UNIFORM_BLOCK_SIZE),Ix),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var r=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=r?(0,pn.ev)([],(0,pn.CR)(r),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=Ix;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(i,a){return i-a})},e.prototype.configureSwapChain=function(t,r,i){var a=this.scTexture;a.width=t,a.height=r,this.scPlatformFramebuffer=tR(i)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(t,r){switch(r===void 0&&(r=!1),t){case st.ALPHA:return Be.ALPHA;case st.U8_LUMINANCE:case st.F16_LUMINANCE:case st.F32_LUMINANCE:return Be.LUMINANCE;case st.F16_R:return Be.R16F;case st.F16_RG:return Be.RG16F;case st.F16_RGB:return Be.RGB16F;case st.F16_RGBA:return Be.RGBA16F;case st.F32_R:return Be.R32F;case st.F32_RG:return Be.RG32F;case st.F32_RGB:return Be.RGB32F;case st.F32_RGBA:return Rn(this.gl)?Be.RGBA32F:r?this.WEBGL_color_buffer_float.RGBA32F_EXT:Be.RGBA;case st.U8_R_NORM:return Be.R8;case st.U8_RG_NORM:return Be.RG8;case st.U8_RGB_NORM:case st.U8_RGB_RT:return Be.RGB8;case st.U8_RGB_SRGB:return Be.SRGB8;case st.U8_RGBA_NORM:case st.U8_RGBA_RT:return Rn(this.gl)?Be.RGBA8:r?Be.RGBA4:Be.RGBA;case st.U8_RGBA:return Be.RGBA;case st.U8_RGBA_SRGB:case st.U8_RGBA_RT_SRGB:return Be.SRGB8_ALPHA8;case st.U16_R:return Be.R16UI;case st.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case st.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case st.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case st.U16_RGBA_5551:return Be.RGB5_A1;case st.U16_RGB_565:return Be.RGB565;case st.U32_R:return Be.R32UI;case st.S8_RGBA_NORM:return Be.RGBA8_SNORM;case st.S8_RG_NORM:return Be.RG8_SNORM;case st.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case st.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case st.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case st.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case st.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case st.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case st.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case st.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case st.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case st.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case st.D32F_S8:return Rn(this.gl)?Be.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?Be.DEPTH_STENCIL:Be.DEPTH_COMPONENT16;case st.D24_S8:return Rn(this.gl)?Be.DEPTH24_STENCIL8:this.WEBGL_depth_texture?Be.DEPTH_STENCIL:Be.DEPTH_COMPONENT16;case st.D32F:return Rn(this.gl)?Be.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?Be.DEPTH_COMPONENT:Be.DEPTH_COMPONENT16;case st.D24:return Rn(this.gl)?Be.DEPTH_COMPONENT24:this.WEBGL_depth_texture?Be.DEPTH_COMPONENT:Be.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(t){var r=wf(t);switch(r){case lr.U8:return Be.UNSIGNED_BYTE;case lr.U16:return Be.UNSIGNED_SHORT;case lr.U32:return Be.UNSIGNED_INT;case lr.S8:return Be.BYTE;case lr.F16:return Be.HALF_FLOAT;case lr.F32:return Be.FLOAT;case lr.U16_PACKED_5551:return Be.UNSIGNED_SHORT_5_5_5_1;case lr.D32F:return Rn(this.gl)?Be.FLOAT:this.WEBGL_depth_texture?Be.UNSIGNED_INT:Be.UNSIGNED_BYTE;case lr.D24:return Rn(this.gl)?Be.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Be.UNSIGNED_SHORT:Be.UNSIGNED_BYTE;case lr.D24S8:return Rn(this.gl)?Be.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Be.UNSIGNED_INT_24_8_WEBGL:Be.UNSIGNED_BYTE;case lr.D32FS8:return Be.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(t){switch(t){case st.F32_R:return Be.R32F;case st.F32_RG:return Be.RG32F;case st.F32_RGB:return Be.RGB32F;case st.F32_RGBA:return Be.RGBA32F;case st.F16_R:return Be.R16F;case st.F16_RG:return Be.RG16F;case st.F16_RGB:return Be.RGB16F;case st.F16_RGBA:return Be.RGBA16F}return this.translateTextureFormat(t)},e.prototype.translateTextureFormat=function(t){if(Tx(t)||t===st.F32_LUMINANCE||t===st.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var r=Rn(this.gl)||!Rn(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case st.D24_S8:case st.D32F_S8:return r?Be.DEPTH_STENCIL:Be.RGBA;case st.D24:case st.D32F:return r?Be.DEPTH_COMPONENT:Be.RGBA}var i=Cx(t),a=g0(t);switch(a){case _n.A:return Be.ALPHA;case _n.R:return i?Be.RED_INTEGER:Be.RED;case _n.RG:return i?Be.RG_INTEGER:Be.RG;case _n.RGB:return i?Be.RGB_INTEGER:Be.RGB;case _n.RGBA:return Be.RGBA}},e.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},e.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(Rn(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},e.prototype.programCompiled=function(t){vi(t.compileState!==El.NeedsCompile),t.compileState===El.Compiling&&(t.compileState=El.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},e.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},e.prototype.ensureResourceExists=function(t){if(t===null){var r=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(r))}else return t},e.prototype.createBuffer=function(t){return new WR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new X_({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new eM({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){return new XR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTargetFromTexture=function(t){var r=t,i=r.format,a=r.width,u=r.height,h=r.mipLevelCount;return vi(h===1),this.createRenderTarget({format:i,width:a,height:u,sampleCount:1,texture:t})},e.prototype.createProgram=function(t){var r,i,a,u=(r=t.vertex)===null||r===void 0?void 0:r.glsl;return!((i=t.vertex)===null||i===void 0)&&i.glsl&&(t.vertex.glsl=Qh(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((a=t.fragment)===null||a===void 0)&&a.glsl&&(t.fragment.glsl=Qh(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,u)},e.prototype.createProgramSimple=function(t,r){var i=new YR({id:this.getNextUniqueId(),device:this,descriptor:t},r);return i},e.prototype.createBindings=function(t){return new BR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new GR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new $R({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePass=function(){return new tM},e.prototype.createComputePipeline=function(t){return new QR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createReadback=function(){return new KR({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(t,r){return new qR({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.formatRenderPassDescriptor=function(t){var r,i,a,u,h,m,g=t.colorAttachment;t.depthClearValue=(r=t.depthClearValue)!==null&&r!==void 0?r:"load",t.stencilClearValue=(i=t.stencilClearValue)!==null&&i!==void 0?i:"load";for(var E=0;E<g.length;E++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[E]=(a=t.colorAttachmentLevel[E])!==null&&a!==void 0?a:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[E]=(u=t.colorResolveToLevel[E])!==null&&u!==void 0?u:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[E]=(h=t.colorClearColor[E])!==null&&h!==void 0?h:"load",t.colorStore||(t.colorStore=[]),t.colorStore[E]=(m=t.colorStore[E])!==null&&m!==void 0?m:!1},e.prototype.createRenderBundle=function(){return new rM({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(t){t.forEach(function(r){r.replay()})},e.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var r=t.colorAttachment,i=t.colorAttachmentLevel,a=t.colorClearColor,u=t.colorResolveTo,h=t.colorResolveToLevel,m=t.depthStencilAttachment,g=t.depthClearValue,E=t.stencilClearValue,A=t.depthStencilResolveTo,w=u&&u.length===1&&u[0]===this.scTexture;this.setRenderPassParametersBegin(r.length,w);for(var R=0;R<r.length;R++)this.setRenderPassParametersColor(R,r[R],i[R],u[R],h[R],w);this.setRenderPassParametersDepthStencil(m,A,w),this.validateCurrentAttachments();for(var R=0;R<r.length;R++){var U=a[R];U!=="load"&&this.setRenderPassParametersClearColor(R,U.r,U.g,U.b,U.a)}return this.setRenderPassParametersClearDepthStencil(g,E),this},e.prototype.submitPass=function(t){vi(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(t,r,i,a,u,h){var m=this.gl,g=t,E=a;if(vi(E.mipLevelCount===1),vi(g.mipLevelCount===1),Rn(m))g===this.scTexture?m.bindFramebuffer(m.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(m.bindFramebuffer(m.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(m.DRAW_FRAMEBUFFER,m.COLOR_ATTACHMENT0,g,0)),m.bindFramebuffer(m.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(m.READ_FRAMEBUFFER,m.COLOR_ATTACHMENT0,E,0),m.blitFramebuffer(u,h,u+E.width,h+E.height,r,i,r+E.width,i+E.height,m.COLOR_BUFFER_BIT,m.LINEAR),m.bindFramebuffer(m.READ_FRAMEBUFFER,null),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,null);else if(g===this.scTexture){var A=this.createRenderTargetFromTexture(a);this.submitBlitRenderPass(A,g)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(t,r,i){switch(t){case st.BC1_SRGB:case st.BC2_SRGB:case st.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?G_(r,i,4,4):!1;case st.BC1:case st.BC2:case st.BC3:return this.WEBGL_compressed_texture_s3tc!==null?G_(r,i,4,4):!1;case st.BC4_UNORM:case st.BC4_SNORM:case st.BC5_UNORM:case st.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?G_(r,i,4,4):!1;case st.U16_R_NORM:case st.U16_RG_NORM:case st.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case st.F32_R:case st.F32_RG:case st.F32_RGB:case st.F32_RGBA:return this.OES_texture_float_linear!==null;case st.F16_R:case st.F16_RG:case st.F16_RGB:case st.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(t){var r=this.gl;if(t.compileState===El.NeedsCompile)throw new Error("whoops");if(t.compileState===El.Compiling){var i=void 0;return this.KHR_parallel_shader_compile!==null?i=r.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):i=!0,i&&this.programCompiled(t),i}return t.compileState===El.NeedsBind||t.compileState===El.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===to.Buffer)for(var i=t.gl_buffer_pages,a=0;a<i.length;a++)Xm(i[a],"".concat(r," Page ").concat(a));else if(t.type===to.Texture)Xm(Wd(t),r);else if(t.type===to.Sampler)Xm(W_(t),r);else if(t.type===to.RenderTarget){var u=t.gl_renderbuffer;u!==null&&Xm(u,r)}else t.type===to.InputLayout&&Xm(t.vao,r)},e.prototype.setResourceLeakCheck=function(t,r){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,r)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e.prototype.programPatched=function(t,r){vi(this.shaderDebug)},e.prototype.getBufferData=function(t,r,i){i===void 0&&(i=0);var a=this.gl;Rn(a)&&(a.bindBuffer(a.COPY_READ_BUFFER,Hd(t,i*4)),a.getBufferSubData(a.COPY_READ_BUFFER,i*4,r))},e.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].drawCallCount+=t},e.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].bufferUploadCount+=t},e.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].textureBindCount+=t},e.prototype.debugGroupStatisticsTriangles=function(t){for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].triangleCount+=t},e.prototype.reportShaderError=function(t,r){var i=this.gl,a=i.getShaderParameter(t,i.COMPILE_STATUS);if(!a){console.error(iR(r));var u=i.getExtension("WEBGL_debug_shaders");u&&console.error(u.getTranslatedShaderSource(t)),console.error(i.getShaderInfoLog(t))}return a},e.prototype.checkProgramCompilationForErrors=function(t){var r=this.gl,i=t.gl_program;if(!r.getProgramParameter(i,r.LINK_STATUS)){var a=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,a.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,a.fragment.glsl))return;console.error(r.getProgramInfoLog(t.gl_program))}},e.prototype.bindFramebufferAttachment=function(t,r,i,a){var u=this.gl;if((0,Tc.Z)(i))u.framebufferRenderbuffer(t,r,u.RENDERBUFFER,null);else if(i.type===to.RenderTarget)i.gl_renderbuffer!==null?u.framebufferRenderbuffer(t,r,u.RENDERBUFFER,i.gl_renderbuffer):i.texture!==null&&u.framebufferTexture2D(t,r,Be.TEXTURE_2D,Wd(i.texture),a);else if(i.type===to.Texture){var h=Wd(i);i.dimension===Oi.TEXTURE_2D?u.framebufferTexture2D(t,r,Be.TEXTURE_2D,h,a):Rn(u)&&(i.dimension,Oi.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(t,r){var i=this.gl,a=(0,Tc.Z)(r)?an.Depth|an.Stencil:zd(r.format),u=!!(a&an.Depth),h=!!(a&an.Stencil);if(u&&h){var m=Rn(this.gl)||!Rn(this.gl)&&!!this.WEBGL_depth_texture;m?this.bindFramebufferAttachment(t,i.DEPTH_STENCIL_ATTACHMENT,r,0):this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,r,0)}else u?(this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,null,0)):h&&(this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var t=-1,r=-1,i=-1,a=0;a<this.currentColorAttachments.length;a++){var u=this.currentColorAttachments[a];u!==null&&(t===-1?(t=u.sampleCount,r=u.width,i=u.height):(vi(t===u.sampleCount),vi(r===u.width),vi(i===u.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(vi(t===this.currentDepthStencilAttachment.sampleCount),vi(r===this.currentDepthStencilAttachment.width),vi(i===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},e.prototype.setRenderPassParametersBegin=function(t,r){r===void 0&&(r=!1);var i=this.gl;if(!r&&(Rn(i)?i.bindFramebuffer(Be.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||i.bindFramebuffer(Be.FRAMEBUFFER,this.renderPassDrawFramebuffer),Rn(i)?i.drawBuffers([Be.COLOR_ATTACHMENT0,Be.COLOR_ATTACHMENT1,Be.COLOR_ATTACHMENT2,Be.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([Be.COLOR_ATTACHMENT0_WEBGL,Be.COLOR_ATTACHMENT1_WEBGL,Be.COLOR_ATTACHMENT2_WEBGL,Be.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass))for(var a=t;a<this.currentColorAttachments.length;a++){var u=Rn(i)?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,h=Rn(i)?Be.COLOR_ATTACHMENT0:Be.COLOR_ATTACHMENT0_WEBGL;i.framebufferRenderbuffer(u,h+a,Be.RENDERBUFFER,null),i.framebufferTexture2D(u,h+a,Be.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},e.prototype.setRenderPassParametersColor=function(t,r,i,a,u,h){h===void 0&&(h=!1);var m=this.gl,g=Rn(m);(this.currentColorAttachments[t]!==r||this.currentColorAttachmentLevels[t]!==i)&&(this.currentColorAttachments[t]=r,this.currentColorAttachmentLevels[t]=i,!h&&(g||!g&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(g?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,(g?Be.COLOR_ATTACHMENT0:Be.COLOR_ATTACHMENT0_WEBGL)+t,r,i),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==a||this.currentColorResolveToLevels[t]!==u)&&(this.currentColorResolveTos[t]=a,this.currentColorResolveToLevels[t]=u,a!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(t,r,i){i===void 0&&(i=!1);var a=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,!i&&!this.inBlitRenderPass&&this.bindFramebufferDepthStencilAttachment(Rn(a)?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==r&&(this.currentDepthStencilResolveTo=r,r&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(t,r,i,a,u){var h=this.gl;if(this.OES_draw_buffers_indexed!==null){var m=this.currentMegaState.attachmentsState[t];m&&m.channelWriteMask!==Gs.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),m.channelWriteMask=Gs.ALL)}else{var m=this.currentMegaState.attachmentsState[0];m&&m.channelWriteMask!==Gs.ALL&&(h.colorMask(!0,!0,!0,!0),m.channelWriteMask=Gs.ALL)}this.setScissorRectEnabled(!1),Rn(h)?h.clearBufferfv(h.COLOR,t,[r,i,a,u]):(h.clearColor(r,i,a,u),h.clear(h.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(t,r){t===void 0&&(t="load"),r===void 0&&(r="load");var i=this.gl;t!=="load"&&(vi(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(i.depthMask(!0),this.currentMegaState.depthWrite=!0),Rn(i)?i.clearBufferfv(i.DEPTH,0,[t]):(i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT))),r!=="load"&&(vi(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(i.enable(i.STENCIL_TEST),i.stencilMask(255),this.currentMegaState.stencilWrite=!0),Rn(i)?i.clearBufferiv(i.STENCIL,0,[r]):(i.clearStencil(r),i.clear(i.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(t){var r=this,i;if(this.renderBundle){this.renderBundle.push(function(){return r.setBindings(t)});return}var a=this.gl,u=t,h=u.uniformBufferBindings,m=u.samplerBindings,g=u.bindingLayouts;vi(0<g.bindingLayoutTables.length);var E=g.bindingLayoutTables[0];vi(h.length>=E.numUniformBuffers),vi(m.length>=E.numSamplers);for(var A=0;A<h.length;A++){var w=h[A];if(w.size!==0){var R=E.firstUniformBuffer+A,U=w.buffer,q=w.offset||0,ce=w.size||U.byteSize;if(U!==this.currentUniformBuffers[R]||q!==this.currentUniformBufferByteOffsets[R]||ce!==this.currentUniformBufferByteSizes[R]){var Se=q%U.pageByteSize,ke=U.gl_buffer_pages[q/U.pageByteSize|0];vi(Se+ce<=U.pageByteSize),Rn(a)&&a.bindBufferRange(a.UNIFORM_BUFFER,R,ke,Se,ce),this.currentUniformBuffers[R]=U,this.currentUniformBufferByteOffsets[R]=q,this.currentUniformBufferByteSizes[R]=ce}}}for(var A=0;A<E.numSamplers;A++){var w=m[A],Fe=E.firstSampler+A,rt=w!==null&&w.sampler!==null?W_(w.sampler):null,mt=w!==null&&w.texture!==null?Wd(w.texture):null;if(this.currentSamplers[Fe]!==rt&&(Rn(a)&&a.bindSampler(Fe,rt),this.currentSamplers[Fe]=rt),this.currentTextures[Fe]!==mt){if(this.setActiveTexture(a.TEXTURE0+Fe),mt!==null){var er=Yp(w).texture,cr=er.gl_target,kt=er.width,dr=er.height;w.texture.textureIndex=Fe,a.bindTexture(cr,mt),Rn(a)||(i=w.sampler)===null||i===void 0||i.setTextureParameters(cr,kt,dr),this.debugGroupStatisticsTextureBind()}else{var Pn=(0,pn.pi)((0,pn.pi)({},w),vx),_i=Pn.dimension,En=Pn.formatKind,cr=HR(_i);a.bindTexture(cr,this.getFallbackTexture((0,pn.pi)({gl_target:cr,formatKind:En},Pn)))}this.currentTextures[Fe]=mt}}},e.prototype.setViewport=function(t,r,i,a){var u=this.gl;u.viewport(t,r,i,a)},e.prototype.setScissorRect=function(t,r,i,a){var u=this.gl;this.setScissorRectEnabled(!0),u.scissor(t,r,i,a)},e.prototype.applyAttachmentStateIndexed=function(t,r,i){var a=this.gl,u=this.OES_draw_buffers_indexed;r.channelWriteMask!==i.channelWriteMask&&(u.colorMaskiOES(t,!!(i.channelWriteMask&Gs.RED),!!(i.channelWriteMask&Gs.GREEN),!!(i.channelWriteMask&Gs.BLUE),!!(i.channelWriteMask&Gs.ALPHA)),r.channelWriteMask=i.channelWriteMask);var h=r.rgbBlendState.blendMode!==i.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==i.alphaBlendState.blendMode,m=r.rgbBlendState.blendSrcFactor!==i.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==i.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==i.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==i.alphaBlendState.blendDstFactor;(m||h)&&(Jh(r.rgbBlendState)&&Jh(r.alphaBlendState)?u.enableiOES(t,a.BLEND):Jh(i.rgbBlendState)&&Jh(i.alphaBlendState)&&u.disableiOES(t,a.BLEND)),h&&(u.blendEquationSeparateiOES(t,i.rgbBlendState.blendMode,i.alphaBlendState.blendMode),r.rgbBlendState.blendMode=i.rgbBlendState.blendMode,r.alphaBlendState.blendMode=i.alphaBlendState.blendMode),m&&(u.blendFuncSeparateiOES(t,i.rgbBlendState.blendSrcFactor,i.rgbBlendState.blendDstFactor,i.alphaBlendState.blendSrcFactor,i.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=i.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=i.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=i.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=i.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(t,r){var i=this.gl;t.channelWriteMask!==r.channelWriteMask&&(i.colorMask(!!(r.channelWriteMask&Gs.RED),!!(r.channelWriteMask&Gs.GREEN),!!(r.channelWriteMask&Gs.BLUE),!!(r.channelWriteMask&Gs.ALPHA)),t.channelWriteMask=r.channelWriteMask);var a=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,u=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(u||a)&&(Jh(t.rgbBlendState)&&Jh(t.alphaBlendState)?i.enable(i.BLEND):Jh(r.rgbBlendState)&&Jh(r.alphaBlendState)&&i.disable(i.BLEND)),a&&(i.blendEquationSeparate(r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),u&&(i.blendFuncSeparate(r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(t){var r=this.gl,i=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var a=0;a<t.attachmentsState.length;a++)this.applyAttachmentStateIndexed(a,i.attachmentsState[0],t.attachmentsState[0]);else vi(t.attachmentsState.length===1),this.applyAttachmentState(i.attachmentsState[0],t.attachmentsState[0]);cx(i.blendConstant,t.blendConstant)||(r.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),fx(i.blendConstant,t.blendConstant)),i.depthCompare!==t.depthCompare&&(r.depthFunc(t.depthCompare),i.depthCompare=t.depthCompare),!!i.depthWrite!=!!t.depthWrite&&(r.depthMask(t.depthWrite),i.depthWrite=t.depthWrite),!!i.stencilWrite!=!!t.stencilWrite&&(r.stencilMask(t.stencilWrite?255:0),i.stencilWrite=t.stencilWrite);var u=!1;if(!S0(i.stencilFront,t.stencilFront)){u=!0;var h=t.stencilFront,m=h.passOp,g=h.failOp,E=h.depthFailOp,A=h.compare;(i.stencilFront.passOp!==m||i.stencilFront.failOp!==g||i.stencilFront.depthFailOp!==E)&&(r.stencilOpSeparate(r.FRONT,g,E,m),i.stencilFront.passOp=m,i.stencilFront.failOp=g,i.stencilFront.depthFailOp=E),i.stencilFront.compare!==A&&(this.setStencilReference(0),i.stencilFront.compare=A)}if(!S0(i.stencilBack,t.stencilBack)){u=!0;var w=t.stencilBack,m=w.passOp,g=w.failOp,E=w.depthFailOp,A=w.compare;(i.stencilBack.passOp!==m||i.stencilBack.failOp!==g||i.stencilBack.depthFailOp!==E)&&(r.stencilOpSeparate(r.BACK,g,E,m),i.stencilBack.passOp=m,i.stencilBack.failOp=g,i.stencilBack.depthFailOp=E),i.stencilBack.compare!==A&&(this.setStencilReference(0),i.stencilBack.compare=A)}(i.stencilFront.mask!==t.stencilFront.mask||i.stencilBack.mask!==t.stencilBack.mask)&&(u=!0,i.stencilFront.mask=t.stencilFront.mask,i.stencilBack.mask=t.stencilBack.mask),u&&this.applyStencil(),i.cullMode!==t.cullMode&&(i.cullMode===xl.NONE?r.enable(r.CULL_FACE):t.cullMode===xl.NONE&&r.disable(r.CULL_FACE),t.cullMode===xl.BACK?r.cullFace(r.BACK):t.cullMode===xl.FRONT?r.cullFace(r.FRONT):t.cullMode===xl.FRONT_AND_BACK&&r.cullFace(r.FRONT_AND_BACK),i.cullMode=t.cullMode),i.frontFace!==t.frontFace&&(r.frontFace(t.frontFace),i.frontFace=t.frontFace),i.polygonOffset!==t.polygonOffset&&(t.polygonOffset?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),i.polygonOffset=t.polygonOffset),(i.polygonOffsetFactor!==t.polygonOffsetFactor||i.polygonOffsetUnits!==t.polygonOffsetUnits)&&(r.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),i.polygonOffsetFactor=t.polygonOffsetFactor,i.polygonOffsetUnits=t.polygonOffsetUnits)},e.prototype.validatePipelineFormats=function(t){for(var r=0;r<this.currentColorAttachments.length;r++)var i=this.currentColorAttachments[r];this.currentDepthStencilAttachment&&vi(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&vi(this.currentSampleCount===t.sampleCount)},e.prototype.setPipeline=function(t){var r=this;if(this.renderBundle){this.renderBundle.push(function(){return r.setPipeline(t)});return}this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var i=this.currentPipeline.program;if(this.useProgram(i),i.compileState===El.NeedsBind){var a=this.gl,u=i.gl_program,h=i.descriptor,m=Mx(h.vertex.glsl,nM);if(Rn(a))for(var g=0;g<m.length;g++){var E=(0,pn.CR)(m[g],2),A=E[1],w=a.getUniformBlockIndex(u,A);w!==-1&&w!==4294967295&&a.uniformBlockBinding(u,w,g)}for(var R=Mx(h.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),g=0;g<R.length;g++){var U=(0,pn.CR)(R[g],3),q=U[1],ce=U[2],Se=a.getUniformLocation(u,q);a.uniform1i(Se,parseInt(ce))}i.compileState=El.ReadyToUse}},e.prototype.setVertexInput=function(t,r,i){var a,u,h=this,m;if(this.renderBundle){this.renderBundle.push(function(){return h.setVertexInput(t,r,i)});return}if(t!==null){vi(this.currentPipeline.inputLayout===t);var g=t;this.bindVAO(g.vao);for(var E=this.gl,A=0;A<g.vertexBufferDescriptors.length;A++){var w=g.vertexBufferDescriptors[A],R=w.arrayStride,U=w.attributes;try{for(var q=(a=void 0,(0,pn.XA)(U)),ce=q.next();!ce.done;ce=q.next()){var Se=ce.value,ke=Se.shaderLocation,Fe=Se.offset,rt=Rn(E)?ke:(m=g.program.attributes[ke])===null||m===void 0?void 0:m.location;if(!(0,Tc.Z)(rt)){var mt=r[A];if(mt===null)continue;var er=Se.vertexFormat;E.bindBuffer(E.ARRAY_BUFFER,Hd(mt.buffer));var cr=(mt.offset||0)+Fe;E.vertexAttribPointer(rt,er.size,er.type,er.normalized,R,cr)}}}catch(dr){a={error:dr}}finally{try{ce&&!ce.done&&(u=q.return)&&u.call(q)}finally{if(a)throw a.error}}}if(vi(i!==null==(g.indexBufferFormat!==null)),i!==null){var kt=i.buffer;vi(kt.usage===zo.INDEX),E.bindBuffer(E.ELEMENT_ARRAY_BUFFER,Hd(kt)),this.currentIndexBufferByteOffset=i.offset||0}else this.currentIndexBufferByteOffset=null}else vi(this.currentPipeline.inputLayout===null),vi(i===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},e.prototype.draw=function(t,r,i,a){var u,h=this;if(this.renderBundle){this.renderBundle.push(function(){return h.draw(t,r,i,a)});return}var m=this.gl,g=this.currentPipeline;if(r){var E=[g.drawMode,i||0,t,r];Rn(m)?m.drawArraysInstanced.apply(m,(0,pn.ev)([],(0,pn.CR)(E),!1)):(u=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(u,(0,pn.ev)([],(0,pn.CR)(E),!1))}else m.drawArrays(g.drawMode,i,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndexed=function(t,r,i,a,u){var h,m=this;if(this.renderBundle){this.renderBundle.push(function(){return m.drawIndexed(t,r,i,a,u)});return}var g=this.gl,E=this.currentPipeline,A=Yp(E.inputLayout),w=Yp(this.currentIndexBufferByteOffset)+i*A.indexBufferCompByteSize;if(r){var R=[E.drawMode,t,A.indexBufferType,w,r];Rn(g)?g.drawElementsInstanced.apply(g,(0,pn.ev)([],(0,pn.CR)(R),!1)):(h=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(h,(0,pn.ev)([],(0,pn.CR)(R),!1))}else g.drawElements(E.drawMode,t,A.indexBufferType,w);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndirect=function(t,r){},e.prototype.drawIndexedIndirect=function(t,r){},e.prototype.beginOcclusionQuery=function(t){var r=this.gl;if(Rn(r)){var i=this.currentRenderPassDescriptor.occlusionQueryPool;r.beginQuery(i.gl_query_type,i.gl_query[t])}},e.prototype.endOcclusionQuery=function(){var t=this.gl;if(Rn(t)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(r.gl_query_type)}},e.prototype.pipelineQueryReady=function(t){var r=t;return this.queryProgramReady(r.program)},e.prototype.pipelineForceReady=function(t){},e.prototype.endPass=function(){for(var t=this.gl,r=Rn(t),i=this.currentColorResolveTos.length===1&&this.currentColorResolveTos[0]===this.scTexture,a=!1,u=0;u<this.currentColorAttachments.length;u++){var h=this.currentColorAttachments[u];if(h!==null){var m=this.currentColorResolveTos[u],g=!1;m!==null&&(vi(h.width===m.width&&h.height===m.height),this.setScissorRectEnabled(!1),i||(r&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&r&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,h,this.currentColorAttachmentLevels[u])),g=!0,i||(m===this.scTexture?t.bindFramebuffer(r?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(r?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(r?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,m.gl_texture,this.currentColorResolveToLevels[u]))),i||(r?(t.blitFramebuffer(0,0,h.width,h.height,0,0,m.width,m.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(h,m)),a=!0),this.currentRenderPassDescriptor.colorStore[u]||!i&&!g&&(t.bindFramebuffer(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,t.COLOR_ATTACHMENT0,h,this.currentColorAttachmentLevels[u])),i||t.bindFramebuffer(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var E=this.currentDepthStencilAttachment;if(E){var A=this.currentDepthStencilResolveTo,g=!1;A&&(vi(E.width===A.width&&E.height===A.height),this.setScissorRectEnabled(!1),i||(t.bindFramebuffer(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(r?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,E),this.bindFramebufferDepthStencilAttachment(r?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,A))),g=!0,i||(r&&t.blitFramebuffer(0,0,E.width,E.height,0,0,A.width,A.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(r?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,null)),a=!0),!i&&!this.currentRenderPassDescriptor.depthStencilStore&&(g||(t.bindFramebuffer(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,E),g=!0),r&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),!i&&g&&t.bindFramebuffer(r?Be.READ_FRAMEBUFFER:Be.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}!i&&!a&&t.bindFramebuffer(r?Be.DRAW_FRAMEBUFFER:Be.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var r=this.gl;t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),this.currentScissorEnabled=t}},e.prototype.applyStencil=function(){(0,Tc.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(Be.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(Be.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(t){var r=t.gl_target,i=t.formatKind;if(r===Be.TEXTURE_2D)return i===Oa.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Be.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Be.TEXTURE_3D)return this.fallbackTexture3D;if(r===Be.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(t,r){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:zo.VERTEX|zo.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Xp.VERTEX,attributes:[{format:st.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ns.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[st.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Zd(qp)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var i=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var a=this.createRenderPass({colorAttachment:[t],colorResolveTo:[r],colorClearColor:[Jw]}),u=this.getCanvas(),h=u.width,m=u.height;a.setPipeline(this.blitRenderPipeline),a.setBindings(this.blitBindings),a.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),a.setViewport(0,0,h,m),this.gl.disable(this.gl.BLEND),a.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=i,this.inBlitRenderPass=!1},e}(),oM=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,pn.mG)(this,void 0,void 0,function(){var r,i,a,u,h,m,g,E,A,w,R,U,q;return(0,pn.Jh)(this,function(ce){return r=this.pluginOptions,i=r.targets,a=r.xrCompatible,u=r.antialias,h=u===void 0?!1:u,m=r.preserveDrawingBuffer,g=m===void 0?!1:m,E=r.premultipliedAlpha,A=E===void 0?!0:E,w=r.shaderDebug,R=r.trackResources,U={antialias:h,preserveDrawingBuffer:g,stencil:!0,premultipliedAlpha:A,xrCompatible:a},this.handleContextEvents(t),i.includes("webgl2")&&(q=t.getContext("webgl2",U)||t.getContext("experimental-webgl2",U)),!q&&i.includes("webgl1")&&(q=t.getContext("webgl",U)||t.getContext("experimental-webgl",U)),[2,new iM(q,{shaderDebug:w,trackResources:R})]})})},e.prototype.handleContextEvents=function(t){var r=this.pluginOptions,i=r.onContextLost,a=r.onContextRestored,u=r.onContextCreationError;u&&t.addEventListener("webglcontextcreationerror",u,!1),i&&t.addEventListener("webglcontextlost",i,!1),a&&t.addEventListener("webglcontextrestored",a,!1)},e}();let La;const Px=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&Px.decode();let Ym=null;function C0(){return(Ym===null||Ym.byteLength===0)&&(Ym=new Uint8Array(La.memory.buffer)),Ym}function w0(e,t){return e=e>>>0,Px.decode(C0().subarray(e,e+t))}const uh=new Array(128).fill(void 0);uh.push(void 0,null,!0,!1);let qm=uh.length;function aM(e){qm===uh.length&&uh.push(uh.length+1);const t=qm;return qm=uh[t],uh[t]=e,t}function R0(e){return uh[e]}function sM(e){e<132||(uh[e]=qm,qm=e)}function uM(e){const t=R0(e);return sM(e),t}let Gd=0;const M0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},lM=typeof M0.encodeInto=="function"?function(e,t){return M0.encodeInto(e,t)}:function(e,t){const r=M0.encode(e);return t.set(r),{read:e.length,written:r.length}};function I0(e,t,r){if(r===void 0){const m=M0.encode(e),g=t(m.length,1)>>>0;return C0().subarray(g,g+m.length).set(m),Gd=m.length,g}let i=e.length,a=t(i,1)>>>0;const u=C0();let h=0;for(;h<i;h++){const m=e.charCodeAt(h);if(m>127)break;u[a+h]=m}if(h!==i){h!==0&&(e=e.slice(h)),a=r(a,i,i=h+e.length*3,1)>>>0;const m=C0().subarray(a+h,a+i),g=lM(e,m);h+=g.written}return Gd=h,a}let Km=null;function P0(){return(Km===null||Km.byteLength===0)&&(Km=new Int32Array(La.memory.buffer)),Km}function cM(e,t,r){let i,a;try{const m=La.__wbindgen_add_to_stack_pointer(-16),g=I0(e,La.__wbindgen_malloc,La.__wbindgen_realloc),E=Gd,A=I0(t,La.__wbindgen_malloc,La.__wbindgen_realloc),w=Gd;La.glsl_compile(m,g,E,A,w,r);var u=P0()[m/4+0],h=P0()[m/4+1];return i=u,a=h,w0(u,h)}finally{La.__wbindgen_add_to_stack_pointer(16),La.__wbindgen_free(i,a,1)}}class $m{static __wrap(t){t=t>>>0;const r=Object.create($m.prototype);return r.__wbg_ptr=t,r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();La.__wbg_wgslcomposer_free(t)}constructor(){const t=La.wgslcomposer_new();return $m.__wrap(t)}load_composable(t){const r=I0(t,La.__wbindgen_malloc,La.__wbindgen_realloc),i=Gd;La.wgslcomposer_load_composable(this.__wbg_ptr,r,i)}wgsl_compile(t){let r,i;try{const h=La.__wbindgen_add_to_stack_pointer(-16),m=I0(t,La.__wbindgen_malloc,La.__wbindgen_realloc),g=Gd;La.wgslcomposer_wgsl_compile(h,this.__wbg_ptr,m,g);var a=P0()[h/4+0],u=P0()[h/4+1];return r=a,i=u,w0(a,u)}finally{La.__wbindgen_add_to_stack_pointer(16),La.__wbindgen_free(r,i,1)}}}function fM(e,t){return og(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const r=yield e.arrayBuffer();return yield WebAssembly.instantiate(r,t)}else{const r=yield WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}})}function hM(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,r){const i=w0(t,r);return aM(i)},e.wbg.__wbindgen_object_drop_ref=function(t){uM(t)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(R0(t))},e.wbg.__wbg_log_576ca876af0d4a77=function(t,r){console.log(R0(t),R0(r))},e.wbg.__wbindgen_throw=function(t,r){throw new Error(w0(t,r))},e}function pM(e,t){return La=e.exports,Ox.__wbindgen_wasm_module=t,Km=null,Ym=null,La}function Ox(e){return og(this,null,function*(){if(La!==void 0)return La;const t=hM();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:i}=yield fM(yield e,t);return pM(r,i)})}var Os;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(Os||(Os={}));var Y_;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(Y_||(Y_={}));function dM(e){var t=0;return e&mu.SAMPLED&&(t|=Os.TEXTURE_BINDING|Os.COPY_DST|Os.COPY_SRC),e&mu.STORAGE&&(t|=Os.TEXTURE_BINDING|Os.STORAGE_BINDING|Os.COPY_SRC|Os.COPY_DST),e&mu.RENDER_TARGET&&(t|=Os.RENDER_ATTACHMENT|Os.TEXTURE_BINDING|Os.COPY_SRC|Os.COPY_DST),t}function q_(e){if(e===st.U8_R_NORM)return"r8unorm";if(e===st.S8_R_NORM)return"r8snorm";if(e===st.U8_RG_NORM)return"rg8unorm";if(e===st.S8_RG_NORM)return"rg8snorm";if(e===st.U32_R)return"r32uint";if(e===st.S32_R)return"r32sint";if(e===st.F32_R)return"r32float";if(e===st.U16_RG)return"rg16uint";if(e===st.S16_RG)return"rg16sint";if(e===st.F16_RG)return"rg16float";if(e===st.U8_RGBA_RT)return"bgra8unorm";if(e===st.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===st.U8_RGBA_NORM)return"rgba8unorm";if(e===st.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===st.S8_RGBA_NORM)return"rgba8snorm";if(e===st.U32_RG)return"rg32uint";if(e===st.S32_RG)return"rg32sint";if(e===st.F32_RG)return"rg32float";if(e===st.U16_RGBA)return"rgba16uint";if(e===st.S16_RGBA)return"rgba16sint";if(e===st.F16_RGBA)return"rgba16float";if(e===st.F32_RGBA)return"rgba32float";if(e===st.U32_RGBA)return"rgba32uint";if(e===st.S32_RGBA)return"rgba32sint";if(e===st.D24)return"depth24plus";if(e===st.D24_S8)return"depth24plus-stencil8";if(e===st.D32F)return"depth32float";if(e===st.D32F_S8)return"depth32float-stencil8";if(e===st.BC1)return"bc1-rgba-unorm";if(e===st.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===st.BC2)return"bc2-rgba-unorm";if(e===st.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===st.BC3)return"bc3-rgba-unorm";if(e===st.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===st.BC4_SNORM)return"bc4-r-snorm";if(e===st.BC4_UNORM)return"bc4-r-unorm";if(e===st.BC5_SNORM)return"bc5-rg-snorm";if(e===st.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function mM(e){if(e===Oi.TEXTURE_2D)return"2d";if(e===Oi.TEXTURE_CUBE_MAP)return"2d";if(e===Oi.TEXTURE_2D_ARRAY)return"2d";if(e===Oi.TEXTURE_3D)return"3d";throw new Error("whoops")}function vM(e){if(e===Oi.TEXTURE_2D)return"2d";if(e===Oi.TEXTURE_CUBE_MAP)return"cube";if(e===Oi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Oi.TEXTURE_3D)return"3d";throw new Error("whoops")}function _M(e){var t=0;return e&zo.INDEX&&(t|=GPUBufferUsage.INDEX),e&zo.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&zo.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&zo.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&zo.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&zo.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|=GPUBufferUsage.COPY_DST,t}function K_(e){if(e===$u.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===$u.REPEAT)return"repeat";if(e===$u.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function Dx(e){if(e===Ha.BILINEAR)return"linear";if(e===Ha.POINT)return"nearest";throw new Error("whoops")}function gM(e){if(e===Ps.LINEAR)return"linear";if(e===Ps.NEAREST)return"nearest";if(e===Ps.NO_MIP)return"nearest";throw new Error("whoops")}function Xd(e){var t=e;return t.gpuBuffer}function yM(e){var t=e;return t.gpuSampler}function xM(e){var t=e;return t.querySet}function EM(e){if(e===_0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function bM(e){switch(e){case ns.TRIANGLES:return"triangle-list";case ns.POINTS:return"point-list";case ns.TRIANGLE_STRIP:return"triangle-strip";case ns.LINES:return"line-list";case ns.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function SM(e){if(e===xl.NONE)return"none";if(e===xl.FRONT)return"front";if(e===xl.BACK)return"back";throw new Error("whoops")}function AM(e){if(e===jm.CCW)return"ccw";if(e===jm.CW)return"cw";throw new Error("whoops")}function TM(e,t){return{topology:bM(e),cullMode:SM(t.cullMode),frontFace:AM(t.frontFace)}}function Lx(e){if(e===Bi.ZERO)return"zero";if(e===Bi.ONE)return"one";if(e===Bi.SRC)return"src";if(e===Bi.ONE_MINUS_SRC)return"one-minus-src";if(e===Bi.DST)return"dst";if(e===Bi.ONE_MINUS_DST)return"one-minus-dst";if(e===Bi.SRC_ALPHA)return"src-alpha";if(e===Bi.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Bi.DST_ALPHA)return"dst-alpha";if(e===Bi.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Bi.CONST)return"constant";if(e===Bi.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Bi.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function CM(e){if(e===Ws.ADD)return"add";if(e===Ws.SUBSTRACT)return"subtract";if(e===Ws.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===Ws.MIN)return"min";if(e===Ws.MAX)return"max";throw new Error("whoops")}function Fx(e){return{operation:CM(e.blendMode),srcFactor:Lx(e.blendSrcFactor),dstFactor:Lx(e.blendDstFactor)}}function Bx(e){return e.blendMode===Ws.ADD&&e.blendSrcFactor===Bi.ONE&&e.blendDstFactor===Bi.ZERO}function wM(e){if(!(Bx(e.rgbBlendState)&&Bx(e.alphaBlendState)))return{color:Fx(e.rgbBlendState),alpha:Fx(e.alphaBlendState)}}function RM(e,t){return{format:q_(t),blend:wM(e),writeMask:e.channelWriteMask}}function MM(e,t){return t.attachmentsState.map(function(r,i){return RM(r,e[i])})}function O0(e){if(e===Ai.NEVER)return"never";if(e===Ai.LESS)return"less";if(e===Ai.EQUAL)return"equal";if(e===Ai.LEQUAL)return"less-equal";if(e===Ai.GREATER)return"greater";if(e===Ai.NOTEQUAL)return"not-equal";if(e===Ai.GEQUAL)return"greater-equal";if(e===Ai.ALWAYS)return"always";throw new Error("whoops")}function Yd(e){if(e===Pa.KEEP)return"keep";if(e===Pa.REPLACE)return"replace";if(e===Pa.ZERO)return"zero";if(e===Pa.DECREMENT_CLAMP)return"decrement-clamp";if(e===Pa.DECREMENT_WRAP)return"decrement-wrap";if(e===Pa.INCREMENT_CLAMP)return"increment-clamp";if(e===Pa.INCREMENT_WRAP)return"increment-wrap";if(e===Pa.INVERT)return"invert";throw new Error("whoops")}function IM(e,t){if(!(0,Tc.Z)(e))return{format:q_(e),depthWriteEnabled:!!t.depthWrite,depthCompare:O0(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:O0(t.stencilFront.compare),passOp:Yd(t.stencilFront.passOp),failOp:Yd(t.stencilFront.failOp),depthFailOp:Yd(t.stencilFront.depthFailOp)},stencilBack:{compare:O0(t.stencilBack.compare),passOp:Yd(t.stencilBack.passOp),failOp:Yd(t.stencilBack.failOp),depthFailOp:Yd(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function PM(e){if(e!==null){if(e===st.U16_R)return"uint16";if(e===st.U32_R)return"uint32";throw new Error("whoops")}}function OM(e){if(e===Xp.VERTEX)return"vertex";if(e===Xp.INSTANCE)return"instance";throw new Error("whoops")}function DM(e){if(e===st.U8_R)return"uint8x2";if(e===st.U8_RG)return"uint8x2";if(e===st.U8_RGB)return"uint8x4";if(e===st.U8_RGBA)return"uint8x4";if(e===st.U8_RG_NORM)return"unorm8x2";if(e===st.U8_RGBA_NORM)return"unorm8x4";if(e===st.S8_RGB_NORM)return"snorm8x4";if(e===st.S8_RGBA_NORM)return"snorm8x4";if(e===st.U16_RG_NORM)return"unorm16x2";if(e===st.U16_RGBA_NORM)return"unorm16x4";if(e===st.S16_RG_NORM)return"snorm16x2";if(e===st.S16_RGBA_NORM)return"snorm16x4";if(e===st.S16_RG)return"uint16x2";if(e===st.F16_RG)return"float16x2";if(e===st.F16_RGBA)return"float16x4";if(e===st.F32_R)return"float32";if(e===st.F32_RG)return"float32x2";if(e===st.F32_RGB)return"float32x3";if(e===st.F32_RGBA)return"float32x4";throw"whoops"}function LM(e){var t=wf(e);switch(t){case lr.BC1:case lr.BC2:case lr.BC3:case lr.BC4_SNORM:case lr.BC4_UNORM:case lr.BC5_SNORM:case lr.BC5_UNORM:return!0;default:return!1}}function FM(e){var t=wf(e);switch(t){case lr.BC1:case lr.BC2:case lr.BC3:case lr.BC4_SNORM:case lr.BC4_UNORM:case lr.BC5_SNORM:case lr.BC5_UNORM:return 4;default:return 1}}function Nx(e,t,r,i){switch(r===void 0&&(r=!1),e){case st.S8_R:case st.S8_R_NORM:case st.S8_RG_NORM:case st.S8_RGB_NORM:case st.S8_RGBA_NORM:{var a=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return i&&a.set(new Int8Array(i)),a}case st.U8_R:case st.U8_R_NORM:case st.U8_RG:case st.U8_RG_NORM:case st.U8_RGB:case st.U8_RGB_NORM:case st.U8_RGB_SRGB:case st.U8_RGBA:case st.U8_RGBA_NORM:case st.U8_RGBA_SRGB:{var u=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&u.set(new Uint8Array(i)),u}case st.S16_R:case st.S16_RG:case st.S16_RG_NORM:case st.S16_RGB_NORM:case st.S16_RGBA:case st.S16_RGBA_NORM:{var h=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return i&&h.set(new Int16Array(i)),h}case st.U16_R:case st.U16_RGB:case st.U16_RGBA_5551:case st.U16_RGBA_NORM:case st.U16_RG_NORM:case st.U16_R_NORM:{var m=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return i&&m.set(new Uint16Array(i)),m}case st.S32_R:{var g=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return i&&g.set(new Int32Array(i)),g}case st.U32_R:case st.U32_RG:{var E=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return i&&E.set(new Uint32Array(i)),E}case st.F32_R:case st.F32_RG:case st.F32_RGB:case st.F32_RGBA:{var A=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return i&&A.set(new Float32Array(i)),A}}var w=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&w.set(new Uint8Array(i)),w}function BM(e){var t=(e&32768)>>15,r=(e&31744)>>10,i=e&1023;return r===0?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):r==31?i?NaN:(t?-1:1)*(1/0):(t?-1:1)*Math.pow(2,r-15)*(1+i/Math.pow(2,10))}function kx(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var rf=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this)||this;return u.id=i,u.device=a,u}return t.prototype.destroy=function(){},t}(ox.Z),NM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h,m,g=e.call(this,{id:i,device:a})||this;g.type=to.Bindings;var E=u.pipeline;vi(!!E);var A=u.uniformBufferBindings,w=u.storageBufferBindings,R=u.samplerBindings,U=u.storageTextureBindings;g.numUniformBuffers=(A==null?void 0:A.length)||0;var q=[[],[],[],[]],ce=0;if(A&&A.length)for(var Se=0;Se<A.length;Se++){var ke=u.uniformBufferBindings[Se],Fe=ke.binding,rt=ke.size,mt=ke.offset,er=ke.buffer,cr={buffer:Xd(er),offset:mt!=null?mt:0,size:rt};q[0].push({binding:Fe!=null?Fe:ce++,resource:cr})}if(R&&R.length){ce=0;for(var Se=0;Se<R.length;Se++){var kt=(0,pn.pi)((0,pn.pi)({},R[Se]),vx),Fe=u.samplerBindings[Se],dr=Fe.texture!==null?Fe.texture:g.device.getFallbackTexture(kt);kt.dimension=dr.dimension,kt.formatKind=lx(dr.format);var Pn=dr.gpuTextureView;if(q[1].push({binding:(h=Fe.textureBinding)!==null&&h!==void 0?h:ce++,resource:Pn}),Fe.samplerBinding!==-1){var _i=Fe.sampler!==null?Fe.sampler:g.device.getFallbackSampler(kt),En=yM(_i);q[1].push({binding:(m=Fe.samplerBinding)!==null&&m!==void 0?m:ce++,resource:En})}}}if(w&&w.length){ce=0;for(var Se=0;Se<w.length;Se++){var fi=u.storageBufferBindings[Se],Fe=fi.binding,rt=fi.size,mt=fi.offset,er=fi.buffer,cr={buffer:Xd(er),offset:mt!=null?mt:0,size:rt};q[2].push({binding:Fe!=null?Fe:ce++,resource:cr})}}if(U&&U.length){ce=0;for(var Se=0;Se<U.length;Se++){var Gi=u.storageTextureBindings[Se],Fe=Gi.binding,dr=Gi.texture,Pn=dr.gpuTextureView;q[3].push({binding:Fe!=null?Fe:ce++,resource:Pn})}}var ou=q.findLastIndex(function(Bu){return!!Bu.length});return g.gpuBindGroup=q.map(function(Bu,bl){return bl<=ou&&g.device.device.createBindGroup({layout:E.getBindGroupLayout(bl),entries:Bu})}),g}return t}(rf),kM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;h.type=to.Buffer;var m=u.usage,g=u.viewOrSize,E=!!(m&zo.MAP_READ);h.usage=_M(m),E&&(h.usage=zo.MAP_READ|zo.COPY_DST);var A=!(0,kd.Z)(g);if(h.view=(0,kd.Z)(g)?null:g,h.size=(0,kd.Z)(g)?E0(g,4):E0(g.byteLength,4),(0,kd.Z)(g))h.gpuBuffer=h.device.device.createBuffer({usage:h.usage,size:h.size,mappedAtCreation:E?A:!1});else{h.gpuBuffer=h.device.device.createBuffer({usage:h.usage,size:h.size,mappedAtCreation:!0});var w=g&&g.constructor||Float32Array;new w(h.gpuBuffer.getMappedRange()).set(g),h.gpuBuffer.unmap()}return h}return t.prototype.setSubData=function(r,i,a,u){a===void 0&&(a=0),u===void 0&&(u=0);var h=this.gpuBuffer;u=u||i.byteLength,u=Math.min(u,this.size-r);var m=i.byteOffset+a,g=m+u,E=u+3&-4;if(E!==u){var A=new Uint8Array(i.buffer.slice(m,g));i=new Uint8Array(E),i.set(A),a=0,m=0,g=E,u=E}for(var w=1024*1024*15,R=0;g-(m+R)>w;)this.device.device.queue.writeBuffer(h,r+R,i.buffer,m+R,w),R+=w;this.device.device.queue.writeBuffer(h,r+R,i.buffer,m+R,u-R)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(rf),Ux=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(t,r,i){this.gpuComputePassEncoder.dispatchWorkgroups(t,r,i)},e.prototype.dispatchWorkgroupsIndirect=function(t,r){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,r)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(t){vi(this.gpuComputePassEncoder===null),this.frameCommandEncoder=t,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(t){var r=t,i=Yp(r.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(i)},e.prototype.setBindings=function(t){var r=this,i=t;i.gpuBindGroup.forEach(function(a,u){a&&r.gpuComputePassEncoder.setBindGroup(u,i.gpuBindGroup[u])})},e.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},e}(),UM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;h.type=to.ComputePipeline,h.gpuComputePipeline=null,h.descriptor=u;var m=u.program,g=m.computeStage;if(g===null)return h;var E={layout:"auto",compute:(0,pn.pi)({},g)};return h.gpuComputePipeline=h.device.device.createComputePipeline(E),h.name!==void 0&&(h.gpuComputePipeline.label=h.name),h}return t.prototype.getBindGroupLayout=function(r){return this.gpuComputePipeline.getBindGroupLayout(r)},t}(rf),zM=function(e){(0,pn.ZT)(t,e);function t(r){var i,a,u,h,m=r.id,g=r.device,E=r.descriptor,A=e.call(this,{id:m,device:g})||this;A.type=to.InputLayout;var w=[];try{for(var R=(0,pn.XA)(E.vertexBufferDescriptors),U=R.next();!U.done;U=R.next()){var q=U.value,ce=q.arrayStride,Se=q.stepMode,ke=q.attributes;w.push({arrayStride:ce,stepMode:OM(Se),attributes:[]});try{for(var Fe=(u=void 0,(0,pn.XA)(ke)),rt=Fe.next();!rt.done;rt=Fe.next()){var mt=rt.value,er=mt.shaderLocation,cr=mt.format,kt=mt.offset;w[w.length-1].attributes.push({shaderLocation:er,format:DM(cr),offset:kt})}}catch(dr){u={error:dr}}finally{try{rt&&!rt.done&&(h=Fe.return)&&h.call(Fe)}finally{if(u)throw u.error}}}}catch(dr){i={error:dr}}finally{try{U&&!U.done&&(a=R.return)&&a.call(R)}finally{if(i)throw i.error}}return A.indexFormat=PM(E.indexBufferFormat),A.buffers=w,A}return t}(rf),zx=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;return h.type=to.Program,h.vertexStage=null,h.fragmentStage=null,h.computeStage=null,h.descriptor=u,u.vertex&&(h.vertexStage=h.createShaderStage(u.vertex,"vertex")),u.fragment&&(h.fragmentStage=h.createShaderStage(u.fragment,"fragment")),u.compute&&(h.computeStage=h.createShaderStage(u.compute,"compute")),h}return t.prototype.setUniformsLegacy=function(r){},t.prototype.createShaderStage=function(r,i){var a,u,h=r.glsl,m=r.wgsl,g=r.entryPoint,E=r.postprocess,A=!1,w=m;if(!w)try{w=this.device.glsl_compile(h,i,A)}catch(ke){throw console.error(ke,h),new Error("whoops")}var R=function(ke){if(!w.includes(ke))return"continue";w=w.replace("var T_".concat(ke,": texture_2d<f32>;"),"var T_".concat(ke,": texture_depth_2d;")),w=w.replace(new RegExp("textureSample\\(T_".concat(ke,"(.*)\\);$"),"gm"),function(Fe,rt){return"vec4<f32>(textureSample(T_".concat(ke).concat(rt,"), 0.0, 0.0, 0.0);")})};try{for(var U=(0,pn.XA)(["u_TextureFramebufferDepth"]),q=U.next();!q.done;q=U.next()){var ce=q.value;R(ce)}}catch(ke){a={error:ke}}finally{try{q&&!q.done&&(u=U.return)&&u.call(U)}finally{if(a)throw a.error}}E&&(w=E(w));var Se=this.device.device.createShaderModule({code:w});return{module:Se,entryPoint:g||"main"}},t}(rf),VM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;h.type=to.QueryPool;var m=u.elemCount,g=u.type;return h.querySet=h.device.device.createQuerySet({type:EM(g),count:m}),h.resolveBuffer=h.device.device.createBuffer({size:m*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),h.cpuBuffer=h.device.device.createBuffer({size:m*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),h.results=null,h}return t.prototype.queryResultOcclusion=function(r){return this.results===null?null:this.results[r]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(rf),ZM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this,{id:i,device:a})||this;return u.type=to.Readback,u}return t.prototype.readTexture=function(r,i,a,u,h,m,g,E){return g===void 0&&(g=0),(0,pn.mG)(this,void 0,void 0,function(){var A,w,R,U,q,ce,Se,ke;return(0,pn.Jh)(this,function(Fe){return A=r,w=0,R=kx(A.gpuTextureformat),U=Math.ceil(u/R.width)*R.length,q=Math.ceil(U/256)*256,ce=q*h,Se=this.device.createBuffer({usage:zo.STORAGE|zo.MAP_READ|zo.COPY_DST,hint:tf.STATIC,viewOrSize:ce}),ke=this.device.device.createCommandEncoder(),ke.copyTextureToBuffer({texture:A.gpuTexture,mipLevel:0,origin:{x:i,y:a,z:Math.max(w,0)}},{buffer:Se.gpuBuffer,offset:0,bytesPerRow:q},{width:u,height:h,depthOrArrayLayers:1}),this.device.device.queue.submit([ke.finish()]),[2,this.readBuffer(Se,0,m.byteLength===ce?m:null,g,ce,A.format,!0,!1,U,q,h)]})})},t.prototype.readTextureSync=function(r,i,a,u,h,m,g,E){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(r,i,a,u,h,m,g,E,A,w,R){var U=this;i===void 0&&(i=0),a===void 0&&(a=null),h===void 0&&(h=0),m===void 0&&(m=st.U8_RGB),g===void 0&&(g=!1),A===void 0&&(A=0),w===void 0&&(w=0),R===void 0&&(R=0);var q=r,ce=h||q.size,Se=a||q.view,ke=Se&&Se.constructor&&Se.constructor.BYTES_PER_ELEMENT||ux(m),Fe=q;if(!(q.usage&zo.MAP_READ&&q.usage&zo.COPY_DST)){var rt=this.device.device.createCommandEncoder();Fe=this.device.createBuffer({usage:zo.STORAGE|zo.MAP_READ|zo.COPY_DST,hint:tf.STATIC,viewOrSize:ce}),rt.copyBufferToBuffer(q.gpuBuffer,i,Fe.gpuBuffer,0,ce),this.device.device.queue.submit([rt.finish()])}return new Promise(function(mt,er){Fe.gpuBuffer.mapAsync(Y_.READ,i,ce).then(function(){var cr=Fe.gpuBuffer.getMappedRange(i,ce),kt=Se;if(g)kt===null?kt=Nx(m,ce,!0,cr):kt=Nx(m,kt.buffer,void 0,cr);else if(kt===null)switch(ke){case 1:kt=new Uint8Array(ce),kt.set(new Uint8Array(cr));break;case 2:kt=U.getHalfFloatAsFloatRGBAArrayBuffer(ce/2,cr);break;case 4:kt=new Float32Array(ce/4),kt.set(new Float32Array(cr));break}else switch(ke){case 1:kt=new Uint8Array(kt.buffer),kt.set(new Uint8Array(cr));break;case 2:kt=U.getHalfFloatAsFloatRGBAArrayBuffer(ce/2,cr,Se);break;case 4:var dr=Se&&Se.constructor||Float32Array;kt=new dr(kt.buffer),kt.set(new dr(cr));break}if(A!==w){ke===1&&!g&&(A*=2,w*=2);for(var Pn=new Uint8Array(kt.buffer),_i=A,En=0,fi=1;fi<R;++fi){En=fi*w;for(var Gi=0;Gi<A;++Gi)Pn[_i++]=Pn[En++]}ke!==0&&!g?kt=new Float32Array(Pn.buffer,0,_i/4):kt=new Uint8Array(Pn.buffer,0,_i)}Fe.gpuBuffer.unmap(),mt(kt)},function(cr){return er(cr)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(r,i,a){a||(a=new Float32Array(r));for(var u=new Uint16Array(i);r--;)a[r]=BM(u[r]);return a},t}(rf),Vx=function(){function e(t){this.device=t,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var t;return((t=this.renderBundle)===null||t===void 0?void 0:t.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(t,r){return vi(r<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:r,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(t){var r,i,a,u,h,m;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var g=t.colorAttachment.length;this.gfxColorAttachment.length=g,this.gfxColorResolveTo.length=g;for(var E=0;E<t.colorAttachment.length;E++){var A=t.colorAttachment[E],w=t.colorResolveTo[E];if(A===null&&w!==null&&(A=w,w=null),this.gfxColorAttachment[E]=A,this.gfxColorResolveTo[E]=w,this.gfxColorAttachmentLevel[E]=((r=t.colorAttachmentLevel)===null||r===void 0?void 0:r[E])||0,this.gfxColorResolveToLevel[E]=((i=t.colorResolveToLevel)===null||i===void 0?void 0:i[E])||0,A!==null){this.gpuColorAttachments[E]===void 0&&(this.gpuColorAttachments[E]={});var R=this.gpuColorAttachments[E];R.view=this.getTextureView(A,((a=this.gfxColorAttachmentLevel)===null||a===void 0?void 0:a[E])||0);var U=(h=(u=t.colorClearColor)===null||u===void 0?void 0:u[E])!==null&&h!==void 0?h:"load";U==="load"?R.loadOp="load":(R.loadOp="clear",R.clearValue=U),R.storeOp=!((m=t.colorStore)===null||m===void 0)&&m[E]?"store":"discard",R.resolveTarget=void 0,w!==null&&(A.sampleCount>1?R.resolveTarget=this.getTextureView(w,this.gfxColorResolveToLevel[E]):R.storeOp="store")}else{this.gpuColorAttachments.length=E,this.gfxColorAttachment.length=E,this.gfxColorResolveTo.length=E;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var q=t.depthStencilAttachment,R=this.gpuDepthStencilAttachment;R.view=q.gpuTextureView;var ce=!!(zd(q.format)&an.Depth);ce?(t.depthClearValue==="load"?R.depthLoadOp="load":(R.depthLoadOp="clear",R.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?R.depthStoreOp="store":R.depthStoreOp="discard"):(R.depthLoadOp=void 0,R.depthStoreOp=void 0);var Se=!!(zd(q.format)&an.Stencil);Se?(t.stencilClearValue==="load"?R.stencilLoadOp="load":(R.stencilLoadOp="clear",R.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?R.stencilStoreOp="store":R.stencilStoreOp="discard"):(R.stencilLoadOp=void 0,R.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,Tc.Z)(t.occlusionQueryPool)?void 0:xM(t.occlusionQueryPool)},e.prototype.beginRenderPass=function(t,r){vi(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.frameCommandEncoder=t,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(t,r){var i=this.device.swapChainHeight;return i-t-r},e.prototype.setViewport=function(t,r,i,a,u,h){u===void 0&&(u=0),h===void 0&&(h=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(r,a),i,a,u,h)},e.prototype.setScissorRect=function(t,r,i,a){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(r,a),i,a)},e.prototype.setPipeline=function(t){var r=t,i=Yp(r.gpuRenderPipeline);this.getEncoder().setPipeline(i)},e.prototype.setVertexInput=function(t,r,i){if(t!==null){var a=this.getEncoder(),u=t;i!==null&&a.setIndexBuffer(Xd(i.buffer),Yp(u.indexFormat),i.offset);for(var h=0;h<r.length;h++){var m=r[h];m!==null&&a.setVertexBuffer(h,Xd(m.buffer),m.offset)}}},e.prototype.setBindings=function(t){var r=t,i=this.getEncoder();r.gpuBindGroup.forEach(function(a,u){a&&i.setBindGroup(u,r.gpuBindGroup[u])})},e.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},e.prototype.draw=function(t,r,i,a){this.getEncoder().draw(t,r,i,a)},e.prototype.drawIndexed=function(t,r,i,a,u){this.getEncoder().drawIndexed(t,r,i,a,u)},e.prototype.drawIndirect=function(t,r){this.getEncoder().drawIndirect(Xd(t),r)},e.prototype.drawIndexedIndirect=function(t,r){this.getEncoder().drawIndexedIndirect(Xd(t),r)},e.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(t){this.gpuRenderPassEncoder.executeBundles(t.map(function(r){return r.renderBundle}))},e.prototype.finish=function(){var t;(t=this.gpuRenderPassEncoder)===null||t===void 0||t.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var i=this.gfxColorAttachment[r],a=this.gfxColorResolveTo[r];i!==null&&a!==null&&i.sampleCount===1&&this.copyAttachment(a,this.gfxColorAttachmentLevel[r],i,this.gfxColorResolveToLevel[r])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(t,r,i,a){vi(i.sampleCount===1);var u={texture:i.gpuTexture,mipLevel:a},h={texture:t.gpuTexture,mipLevel:r};vi(i.width>>>a===t.width>>>r),vi(i.height>>>a===t.height>>>r),vi(!!(i.usage&Os.COPY_SRC)),vi(!!(t.usage&Os.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(u,h,[t.width,t.height,1])},e}(),jM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=e.call(this,{id:i,device:a})||this;return h.type=to.RenderPipeline,h.isCreatingAsync=!1,h.gpuRenderPipeline=null,h.descriptor=u,h.device.createRenderPipelineInternal(h,!1),h}return t.prototype.getBindGroupLayout=function(r){return this.gpuRenderPipeline.getBindGroupLayout(r)},t}(rf),HM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h,m,g=e.call(this,{id:i,device:a})||this;g.type=to.Sampler;var E=u.lodMinClamp,A=u.mipmapFilter===Ps.NO_MIP?u.lodMinClamp:u.lodMaxClamp,w=(h=u.maxAnisotropy)!==null&&h!==void 0?h:1;return w>1&&vi(u.minFilter===Ha.BILINEAR&&u.magFilter===Ha.BILINEAR&&u.mipmapFilter===Ps.LINEAR),g.gpuSampler=g.device.device.createSampler({addressModeU:K_(u.addressModeU),addressModeV:K_(u.addressModeV),addressModeW:K_((m=u.addressModeW)!==null&&m!==void 0?m:u.addressModeU),lodMinClamp:E,lodMaxClamp:A,minFilter:Dx(u.minFilter),magFilter:Dx(u.magFilter),mipmapFilter:gM(u.mipmapFilter),compare:u.compareFunction!==void 0?O0(u.compareFunction):void 0,maxAnisotropy:w}),g}return t}(rf),D0=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,h=r.skipCreate,m=r.sampleCount,g=e.call(this,{id:i,device:a})||this;g.type=to.Texture,g.flipY=!1;var E=u.format,A=u.dimension,w=u.width,R=u.height,U=u.depthOrArrayLayers,q=u.mipLevelCount,ce=u.usage,Se=u.pixelStore;return g.flipY=!!(Se!=null&&Se.unpackFlipY),g.device.createTextureShared({format:E,dimension:A!=null?A:Oi.TEXTURE_2D,width:w,height:R,depthOrArrayLayers:U!=null?U:1,mipLevelCount:q!=null?q:1,usage:ce,sampleCount:m!=null?m:1},g,h),g}return t.prototype.textureFromImageBitmapOrCanvas=function(r,i,a){for(var u=i[0].width,h=i[0].height,m={size:{width:u,height:h,depthOrArrayLayers:a},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},g=r.createTexture(m),E=0;E<i.length;E++)r.queue.copyExternalImageToTexture({source:i[E],flipY:this.flipY},{texture:g,origin:[0,0,E]},[u,h]);return[g,u,h]},t.prototype.isImageBitmapOrCanvases=function(r){var i=r[0];return i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof OffscreenCanvas},t.prototype.isVideo=function(r){var i=r[0];return i instanceof HTMLVideoElement},t.prototype.setImageData=function(r,i){var a,u=this,h=this.device.device,m,g,E;if(this.isImageBitmapOrCanvases(r))a=(0,pn.CR)(this.textureFromImageBitmapOrCanvas(h,r,this.depthOrArrayLayers),3),m=a[0],g=a[1],E=a[2];else if(this.isVideo(r))m=h.importExternalTexture({source:r[0]});else{var A=kx(this.gpuTextureformat),w=Math.ceil(this.width/A.width)*A.length;r.forEach(function(R){h.queue.writeTexture({texture:u.gpuTexture},R,{bytesPerRow:w},{width:u.width,height:u.height})})}this.width=g,this.height=E,m&&(this.gpuTexture=m),this.gpuTextureView=this.gpuTexture.createView({dimension:vM(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(rf),WM=function(e){(0,pn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this,{id:i,device:a})||this;return u.type=to.RenderBundle,u.renderBundleEncoder=u.device.device.createRenderBundleEncoder({colorFormats:[u.device.swapChainFormat]}),u}return t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(rf),GM=function(){function e(t,r,i,a,u,h){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Os.RENDER_ATTACHMENT|Os.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Cf.UPPER_LEFT,this.clipSpaceNearZ=Ud.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=r,this.canvas=i,this.canvasContext=a,this.glsl_compile=u,this.WGSLComposer=h,this.fallbackTexture2D=this.createFallbackTexture(Oi.TEXTURE_2D,Oa.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Oi.TEXTURE_2D,Oa.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Oi.TEXTURE_2D_ARRAY,Oa.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Oi.TEXTURE_3D,Oa.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Oi.TEXTURE_CUBE_MAP,Oa.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:$u.REPEAT,addressModeV:$u.REPEAT,minFilter:Ha.POINT,magFilter:Ha.POINT,mipmapFilter:Ps.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:$u.REPEAT,addressModeV:$u.REPEAT,minFilter:Ha.POINT,magFilter:Ha.POINT,mipmapFilter:Ps.NEAREST,compareFunction:Ai.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(m){console.error(m.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(t,r){this.swapChainWidth===t&&this.swapChainHeight===r||(this.swapChainWidth=t,this.swapChainHeight=r)},e.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),r=t.createView(),i=new D0({id:0,device:this,descriptor:{format:st.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Oi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return i.depthOrArrayLayers=1,i.sampleCount=1,i.gpuTexture=t,i.gpuTextureView=r,i.name="Onscreen",this.setResourceName(i,"Onscreen Texture"),i},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){vi(this.frameCommandEncoderPool.length===0)},e.prototype.endFrame=function(){vi(this.frameCommandEncoderPool.every(function(t){return t!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(t){return t.finish()})),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(t){return new kM({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new D0({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new HM({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){var r=new D0({id:this.getNextUniqueId(),device:this,descriptor:(0,pn.pi)((0,pn.pi)({},t),{dimension:Oi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:mu.RENDER_TARGET}),sampleCount:t.sampleCount});return r.depthOrArrayLayers=1,r.type=to.RenderTarget,r},e.prototype.createRenderTargetFromTexture=function(t){var r=t,i=r.format,a=r.width,u=r.height,h=r.depthOrArrayLayers,m=r.sampleCount,g=r.mipLevelCount,E=r.gpuTexture,A=r.gpuTextureView,w=r.usage;vi(!!(w&Os.RENDER_ATTACHMENT));var R=new D0({id:this.getNextUniqueId(),device:this,descriptor:{format:i,width:a,height:u,depthOrArrayLayers:h,dimension:Oi.TEXTURE_2D,mipLevelCount:g,usage:w},skipCreate:!0});return R.depthOrArrayLayers=h,R.sampleCount=m,R.gpuTexture=E,R.gpuTextureView=A,R},e.prototype.createProgram=function(t){var r,i;return!((r=t.vertex)===null||r===void 0)&&r.glsl&&(t.vertex.glsl=Qh(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((i=t.fragment)===null||i===void 0)&&i.glsl&&(t.fragment.glsl=Qh(this.queryVendorInfo(),"frag",t.fragment.glsl)),new zx({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createProgramSimple=function(t){return new zx({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTextureShared=function(t,r,i){var a={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},u=t.mipLevelCount,h=q_(t.format),m=mM(t.dimension),g=dM(t.usage);if(r.gpuTextureformat=h,r.dimension=t.dimension,r.format=t.format,r.width=t.width,r.height=t.height,r.depthOrArrayLayers=t.depthOrArrayLayers,r.mipLevelCount=u,r.usage=g,r.sampleCount=t.sampleCount,!i){var E=this.device.createTexture({size:a,mipLevelCount:u,format:h,dimension:m,sampleCount:t.sampleCount,usage:g}),A=E.createView();r.gpuTexture=E,r.gpuTextureView=A}},e.prototype.getFallbackSampler=function(t){var r=t.formatKind;return r===Oa.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(t){var r=t.dimension,i=t.formatKind;if(r===Oi.TEXTURE_2D)return i===Oa.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Oi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Oi.TEXTURE_3D)return this.fallbackTexture3D;if(r===Oi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(t,r){var i=t===Oi.TEXTURE_CUBE_MAP?6:1,a=r===Oa.Float?st.U8_RGBA_NORM:st.D24;return this.createTexture({dimension:t,format:a,usage:mu.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1})},e.prototype.createBindings=function(t){return new NM({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new zM({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePipeline=function(t){return new UM({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new jM({id:this.getNextUniqueId(),device:this,descriptor:(0,pn.pi)({},t)})},e.prototype.createQueryPool=function(t,r){return new VM({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.createRenderPipelineInternal=function(t,r){var i;if(t.gpuRenderPipeline===null){var a=t.descriptor,u=a.program,h=u.vertexStage,m=u.fragmentStage;if(!(h===null||m===null)){var g=a.megaStateDescriptor||{},E=g.stencilBack,A=g.stencilFront,w=(0,pn._T)(g,["stencilBack","stencilFront"]),R=Zd(qp);a.megaStateDescriptor=(0,pn.pi)((0,pn.pi)((0,pn.pi)({},R),{stencilBack:(0,pn.pi)((0,pn.pi)({},R.stencilBack),E),stencilFront:(0,pn.pi)((0,pn.pi)({},R.stencilFront),A)}),w);var U=a.megaStateDescriptor.attachmentsState[0];a.colorAttachmentFormats.forEach(function(mt,er){a.megaStateDescriptor.attachmentsState[er]||(a.megaStateDescriptor.attachmentsState[er]=dx(void 0,U))});var q=TM((i=a.topology)!==null&&i!==void 0?i:ns.TRIANGLES,a.megaStateDescriptor),ce=MM(a.colorAttachmentFormats,a.megaStateDescriptor),Se=IM(a.depthStencilAttachmentFormat,a.megaStateDescriptor),ke=void 0;a.inputLayout!==null&&(ke=a.inputLayout.buffers);var Fe=a.sampleCount,rt={layout:"auto",vertex:(0,pn.pi)((0,pn.pi)({},h),{buffers:ke}),primitive:q,depthStencil:Se,multisample:{count:Fe},fragment:(0,pn.pi)((0,pn.pi)({},m),{targets:ce})};t.gpuRenderPipeline=this.device.createRenderPipeline(rt)}}},e.prototype.createReadback=function(){return new ZM({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new WM({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(t){var r=this.renderPassPool.pop();r===void 0&&(r=new Vx(this));var i=this.frameCommandEncoderPool.pop();return i===void 0&&(i=this.device.createCommandEncoder()),r.beginRenderPass(i,t),r},e.prototype.createComputePass=function(){var t=this.computePassPool.pop();t===void 0&&(t=new Ux);var r=this.frameCommandEncoderPool.pop();return r===void 0&&(r=this.device.createCommandEncoder()),t.beginComputePass(r),t},e.prototype.submitPass=function(t){var r=t;r instanceof Vx?(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.renderPassPool.push(r)):r instanceof Ux&&(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.computePassPool.push(r))},e.prototype.copySubTexture2D=function(t,r,i,a,u,h,m){var g=this.device.createCommandEncoder(),E=t,A=a,w={texture:A.gpuTexture,origin:[u,h,0],mipLevel:0,aspect:"all"},R={texture:E.gpuTexture,origin:[r,i,0],mipLevel:0,aspect:"all"};vi(!!(A.usage&Os.COPY_SRC)),vi(!!(E.usage&Os.COPY_DST)),g.copyTextureToTexture(w,R,[A.width,A.height,m||1]),this.device.queue.submit([g.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(t,r,i){if(LM(t)){if(!this.featureTextureCompressionBC)return!1;var a=FM(t);return r%a!==0||i%a!==0?!1:this.featureTextureCompressionBC}switch(t){case st.U16_RGBA_NORM:return!1;case st.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){var r=t;return r.descriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===to.Buffer){var i=t;i.gpuBuffer.label=r}else if(t.type===to.Texture){var i=t;i.gpuTexture.label=r,i.gpuTextureView.label=r}else if(t.type===to.RenderTarget){var i=t;i.gpuTexture.label=r,i.gpuTextureView.label=r}else if(t.type===to.Sampler){var i=t;i.gpuSampler.label=r}else if(t.type===to.RenderPipeline){var i=t;i.gpuRenderPipeline!==null&&(i.gpuRenderPipeline.label=r)}},e.prototype.setResourceLeakCheck=function(t,r){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(t){},e.prototype.pipelineQueryReady=function(t){var r=t;return r.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(t){var r=t;this.createRenderPipelineInternal(r,!1)},e}(),XM=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,pn.mG)(this,void 0,void 0,function(){var r,i,a,u,h,m,g,E;return(0,pn.Jh)(this,function(A){switch(A.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];r=null,A.label=1;case 1:return A.trys.push([1,3,,4]),i=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:i})];case 2:return r=A.sent(),[3,4];case 3:return a=A.sent(),console.log(a),[3,4];case 4:return r===null?[2,null]:(u=["depth32float-stencil8","texture-compression-bc","float32-filterable"],h=u.filter(function(w){return r.features.has(w)}),[4,r.requestDevice({requiredFeatures:h})]);case 5:if(m=A.sent(),m&&(g=this.pluginOptions.onContextLost,m.lost.then(function(){g&&g()})),m===null)return[2,null];if(E=t.getContext("webgpu"),!E)return[2,null];A.label=6;case 6:return A.trys.push([6,8,,9]),[4,Ox(this.pluginOptions.shaderCompilerPath)];case 7:return A.sent(),[3,9];case 8:return A.sent(),[3,9];case 9:return[2,new GM(r,m,t,E,cM,$m&&new $m)]}})})},e}(),YM=Object.defineProperty,qM=Object.defineProperties,KM=Object.getOwnPropertyDescriptors,Zx=Object.getOwnPropertySymbols,$M=Object.prototype.hasOwnProperty,QM=Object.prototype.propertyIsEnumerable,jx=(e,t,r)=>t in e?YM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Qm=(e,t)=>{for(var r in t||(t={}))$M.call(t,r)&&jx(e,r,t[r]);if(Zx)for(var r of Zx(t))QM.call(t,r)&&jx(e,r,t[r]);return e},JM=(e,t)=>qM(e,KM(t)),{isPlainObject:eI,isTypedArray:tI}=Yn,rI=class{constructor(e,t){this.destroyed=!1,this.uniforms={},this.reGl=e;const{vs:r,fs:i,attributes:a,uniforms:u,primitive:h,count:m,elements:g,depth:E,cull:A,instances:w}=t,R={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Cf.LOWER_LEFT,clipSpaceNearZ:Ud.NEGATIVE_ONE,supportMRT:!1},U={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(Fe=>{U[Fe]=e.prop(Fe)}));const q={};Object.keys(a).forEach(Fe=>{q[Fe]=a[Fe].get()});const ce=No(Qh(R,"frag",i,null,!1)),Se=No(Qh(R,"vert",r,null,!1)),ke={attributes:q,frag:ce,uniforms:U,vert:Se,colorMask:e.prop("colorMask"),lineWidth:1,blend:{enable:e.prop("blend.enable"),func:e.prop("blend.func"),equation:e.prop("blend.equation"),color:e.prop("blend.color")},stencil:{enable:e.prop("stencil.enable"),mask:e.prop("stencil.mask"),func:e.prop("stencil.func"),opFront:e.prop("stencil.opFront"),opBack:e.prop("stencil.opBack")},primitive:Vw[h===void 0?F.TRIANGLES:h]};w&&(ke.instances=w),m?ke.count=m:g&&(ke.elements=g.get()),this.initDepthDrawParams({depth:E},ke),this.initCullDrawParams({cull:A},ke),this.drawCommand=e(ke),this.drawParams=ke}updateAttributesAndElements(e,t){const r={};Object.keys(e).forEach(i=>{r[i]=e[i].get()}),this.drawParams.attributes=r,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(e){const t={};Object.keys(e).forEach(r=>{t[r]=e[r].get()}),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}addUniforms(e){this.uniforms=Qm(Qm({},this.uniforms),this.extractUniforms(e))}draw(e,t){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;const r=Qm(Qm({},this.uniforms),this.extractUniforms(e.uniforms||{})),i={};Object.keys(r).forEach(a=>{const u=typeof r[a];u==="boolean"||u==="number"||Array.isArray(r[a])||r[a].BYTES_PER_ELEMENT?i[a]=r[a]:i[a]=r[a].get()}),i.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),i.stencil=this.getStencilDrawParams(e),i.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(i)}destroy(){var e,t;(t=(e=this.drawParams)==null?void 0:e.elements)==null||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(r=>{r==null||r.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:e},t){e&&(t.depth={enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:Ww[e.func||F.LESS],range:e.range||[0,1]})}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:i,color:a=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:v0[r&&r.srcRGB||F.SRC_ALPHA],srcAlpha:v0[r&&r.srcAlpha||F.SRC_ALPHA],dstRGB:v0[r&&r.dstRGB||F.ONE_MINUS_SRC_ALPHA],dstAlpha:v0[r&&r.dstAlpha||F.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ix[i&&i.rgb||F.FUNC_ADD],alpha:ix[i&&i.alpha||F.FUNC_ADD]},color:a}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=-1,func:i={cmp:F.ALWAYS,ref:0,mask:-1},opFront:a={fail:F.KEEP,zfail:F.KEEP,zpass:F.KEEP},opBack:u={fail:F.KEEP,zfail:F.KEEP,zpass:F.KEEP}}=e||{};return{enable:!!t,mask:r,func:JM(Qm({},i),{cmp:Gw[i.cmp]}),opFront:{fail:Nd[a.fail],zfail:Nd[a.zfail],zpass:Nd[a.zpass]},opBack:{fail:Nd[u.fail],zfail:Nd[u.zfail],zpass:Nd[u.zpass]}}}getColorMaskDrawParams({stencil:e},t){return e!=null&&e.enable&&e.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:e},t){if(e){const{enable:r,face:i=F.BACK}=e;t.cull={enable:!!r,face:Xw[i]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||tI(t)||t===""||"resize"in t){r[`${i&&i+"."}${e}`]=t;return}eI(t)&&Object.keys(t).forEach(a=>{this.extractUniformsRecursively(a,t[a],r,`${i&&i+"."}${e}`)}),Array.isArray(t)&&t.forEach((a,u)=>{Object.keys(a).forEach(h=>{this.extractUniformsRecursively(h,a[h],r,`${i&&i+"."}${e}[${u}]`)})})}},nI=class{constructor(e,t){this.isDestroy=!1;const{data:r,type:i=F.UNSIGNED_BYTE,width:a,height:u,flipY:h=!1,format:m=F.RGBA,mipmap:g=!1,wrapS:E=F.CLAMP_TO_EDGE,wrapT:A=F.CLAMP_TO_EDGE,aniso:w=0,alignment:R=1,premultiplyAlpha:U=!1,mag:q=F.NEAREST,min:ce=F.NEAREST,colorSpace:Se=F.BROWSER_DEFAULT_WEBGL,x:ke=0,y:Fe=0,copy:rt=!1}=t;this.width=a,this.height=u;const mt={width:a,height:u,type:Z_[i],format:Zw[m],wrapS:nx[E],wrapT:nx[A],mag:rx[q],min:rx[ce],alignment:R,flipY:h,colorSpace:Hw[Se],premultiplyAlpha:U,aniso:w,x:ke,y:Fe,copy:rt};r&&(mt.data=r),typeof g=="number"?mt.mipmap=jw[g]:typeof g=="boolean"&&(mt.mipmap=g),this.texture=e.texture(mt)}get(){return this.texture}update(e={}){this.texture(e)}bind(){this.texture._texture.bind()}resize({width:e,height:t}){this.texture.resize(e,t),this.width=e,this.height=t}getSize(){return[this.width,this.height]}destroy(){var e;this.isDestroy||(e=this.texture)==null||e.destroy(),this.isDestroy=!0}},$_=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),iI=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=e=>new rI(this.gl,e),this.createAttribute=e=>new zw(this.gl,e),this.createBuffer=e=>new Yw(this.gl,e),this.createElements=e=>new qw(this.gl,e),this.createTexture2D=e=>new nI(this.gl,e),this.createFramebuffer=e=>new Kw(this.gl,e),this.useFramebuffer=(e,t)=>{this.gl({framebuffer:e?e.get():null})(t)},this.useFramebufferAsync=(e,t)=>$_(this,null,function*(){this.gl({framebuffer:e?e.get():null})(t)}),this.clear=e=>{var t;const{color:r,depth:i,stencil:a,framebuffer:u=null}=e,h={color:r,depth:i,stencil:a};h.framebuffer=u===null?u:u.get(),(t=this.gl)==null||t.clear(h)},this.viewport=({x:e,y:t,width:r,height:i})=>{this.gl._gl.viewport(e,t,r,i),this.width=r,this.height=i,this.gl._refresh()},this.readPixels=e=>{const{framebuffer:t,x:r,y:i,width:a,height:u}=e,h={x:r,y:i,width:a,height:u};return t&&(h.framebuffer=t.get()),this.gl.read(h)},this.readPixelsAsync=e=>$_(this,null,function*(){return this.readPixels(e)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var e,t,r;this.canvas=null,(r=(t=(e=this.gl)==null?void 0:e._gl)==null?void 0:t.getExtension("WEBGL_lose_context"))==null||r.loseContext(),this.gl.destroy(),this.gl=null}}init(e,t,r){return $_(this,null,function*(){this.canvas=e,r?this.gl=r:this.gl=yield new Promise((i,a)=>{Uw()({canvas:this.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,stencil:t.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(u,h)=>{(u||!h)&&a(u),i(h)}})}),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const e=this.getGLContext();e.disable(e.CULL_FACE)}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}},oI=class{constructor(e,t){const{buffer:r,offset:i,stride:a,normalized:u,size:h,divisor:m,shaderLocation:g}=t;this.buffer=r,this.attribute={shaderLocation:g,buffer:r.get(),offset:i||0,stride:a||0,normalized:u||!1,divisor:m||0},h&&(this.attribute.size=h)}get(){return this.buffer}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},L0={[F.FLOAT]:Float32Array,[F.UNSIGNED_BYTE]:Uint8Array,[F.SHORT]:Int16Array,[F.UNSIGNED_SHORT]:Uint16Array,[F.INT]:Int32Array,[F.UNSIGNED_INT]:Uint32Array},aI={[F.POINTS]:ns.POINTS,[F.LINES]:ns.LINES,[F.LINE_LOOP]:ns.LINES,[F.LINE_STRIP]:ns.LINE_STRIP,[F.TRIANGLES]:ns.TRIANGLES,[F.TRIANGLE_FAN]:ns.TRIANGLES,[F.TRIANGLE_STRIP]:ns.TRIANGLE_STRIP},sI={[1]:st.F32_R,[2]:st.F32_RG,[3]:st.F32_RGB,[4]:st.F32_RGBA},uI={[F.STATIC_DRAW]:tf.STATIC,[F.DYNAMIC_DRAW]:tf.DYNAMIC,[F.STREAM_DRAW]:tf.DYNAMIC},Hx={[F.REPEAT]:$u.REPEAT,[F.CLAMP_TO_EDGE]:$u.CLAMP_TO_EDGE,[F.MIRRORED_REPEAT]:$u.MIRRORED_REPEAT},lI={[F.NEVER]:Ai.NEVER,[F.ALWAYS]:Ai.ALWAYS,[F.LESS]:Ai.LESS,[F.LEQUAL]:Ai.LEQUAL,[F.GREATER]:Ai.GREATER,[F.GEQUAL]:Ai.GEQUAL,[F.EQUAL]:Ai.EQUAL,[F.NOTEQUAL]:Ai.NOTEQUAL},cI={[F.FRONT]:xl.FRONT,[F.BACK]:xl.BACK},Wx={[F.FUNC_ADD]:Ws.ADD,[F.MIN_EXT]:Ws.MIN,[F.MAX_EXT]:Ws.MAX,[F.FUNC_SUBTRACT]:Ws.SUBSTRACT,[F.FUNC_REVERSE_SUBTRACT]:Ws.REVERSE_SUBSTRACT},F0={[F.ZERO]:Bi.ZERO,[F.ONE]:Bi.ONE,[F.SRC_COLOR]:Bi.SRC,[F.ONE_MINUS_SRC_COLOR]:Bi.ONE_MINUS_SRC,[F.SRC_ALPHA]:Bi.SRC_ALPHA,[F.ONE_MINUS_SRC_ALPHA]:Bi.ONE_MINUS_SRC_ALPHA,[F.DST_COLOR]:Bi.DST,[F.ONE_MINUS_DST_COLOR]:Bi.ONE_MINUS_DST,[F.DST_ALPHA]:Bi.DST_ALPHA,[F.ONE_MINUS_DST_ALPHA]:Bi.ONE_MINUS_DST_ALPHA,[F.CONSTANT_COLOR]:Bi.CONST,[F.ONE_MINUS_CONSTANT_COLOR]:Bi.ONE_MINUS_CONSTANT,[F.CONSTANT_ALPHA]:Bi.CONST,[F.ONE_MINUS_CONSTANT_ALPHA]:Bi.ONE_MINUS_CONSTANT,[F.SRC_ALPHA_SATURATE]:Bi.SRC_ALPHA_SATURATE},qd={[F.REPLACE]:Pa.REPLACE,[F.KEEP]:Pa.KEEP,[F.ZERO]:Pa.ZERO,[F.INVERT]:Pa.INVERT,[F.INCR]:Pa.INCREMENT_CLAMP,[F.DECR]:Pa.DECREMENT_CLAMP,[F.INCR_WRAP]:Pa.INCREMENT_WRAP,[F.DECR_WRAP]:Pa.DECREMENT_WRAP},fI={[F.ALWAYS]:Ai.ALWAYS,[F.EQUAL]:Ai.EQUAL,[F.GEQUAL]:Ai.GEQUAL,[F.GREATER]:Ai.GREATER,[F.LEQUAL]:Ai.LEQUAL,[F.LESS]:Ai.LESS,[F.NEVER]:Ai.NEVER,[F.NOTEQUAL]:Ai.NOTEQUAL},hI={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function B0(e){return Object.prototype.toString.call(e)in hI}function pI(e,t){const r=e.length,i=Math.ceil(r/3),a=r+i,u=new Float32Array(a);for(let h=0;h<a;h+=4)u[h]=e[h/4*3],u[h+1]=e[h/4*3+1],u[h+2]=e[h/4*3+2],u[h+3]=t;return u}var dI=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:i,type:a,isUBO:u,label:h}=t;let m;B0(r)?m=r:m=new L0[this.type||F.FLOAT](r),this.type=a,this.size=m.byteLength,this.buffer=e.createBuffer({viewOrSize:m,usage:u?zo.UNIFORM:zo.VERTEX,hint:uI[i||F.STATIC_DRAW]}),h&&e.setResourceName(this.buffer,h)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){let r;B0(e)?r=e:r=new L0[this.type||F.FLOAT](e),this.buffer.setSubData(t,new Uint8Array(r.buffer))}};function xo(e,t=0){return e+=t,e+=e<<10,e+=e>>>6,e>>>0}function Gx(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function Xx(){return 0}var mI=class{constructor(){this.keys=[],this.values=[]}},N0=class{constructor(e,t){this.keyEqualFunc=e,this.keyHashFunc=t,this.buckets=new Map}findBucketIndex(e,t){for(let r=0;r<e.keys.length;r++)if(this.keyEqualFunc(t,e.keys[r]))return r;return-1}findBucket(e){const t=this.keyHashFunc(e);return this.buckets.get(t)}get(e){const t=this.findBucket(e);if(t===void 0)return null;const r=this.findBucketIndex(t,e);return r<0?null:t.values[r]}add(e,t){const r=this.keyHashFunc(e);this.buckets.get(r)===void 0&&this.buckets.set(r,new mI);const i=this.buckets.get(r);i.keys.push(e),i.values.push(t)}delete(e){const t=this.findBucket(e);if(t===void 0)return;const r=this.findBucketIndex(t,e);r!==-1&&(t.keys.splice(r,1),t.values.splice(r,1))}clear(){this.buckets.clear()}size(){let e=0;for(const t of this.buckets.values())e+=t.values.length;return e}*values(){for(const e of this.buckets.values())for(let t=e.values.length-1;t>=0;t--)yield e.values[t]}};function Yx(e,t){return e=xo(e,t.blendMode),e=xo(e,t.blendSrcFactor),e=xo(e,t.blendDstFactor),e}function vI(e,t){return e=Yx(e,t.rgbBlendState),e=Yx(e,t.alphaBlendState),e=xo(e,t.channelWriteMask),e}function _I(e,t){return e=xo(e,t.r<<24|t.g<<16|t.b<<8|t.a),e}function gI(e,t){var r,i,a,u,h,m,g,E;for(let A=0;A<t.attachmentsState.length;A++)e=vI(e,t.attachmentsState[A]);return e=_I(e,t.blendConstant||y0),e=xo(e,t.depthCompare),e=xo(e,t.depthWrite?1:0),e=xo(e,(r=t.stencilFront)==null?void 0:r.compare),e=xo(e,(i=t.stencilFront)==null?void 0:i.passOp),e=xo(e,(a=t.stencilFront)==null?void 0:a.failOp),e=xo(e,(u=t.stencilFront)==null?void 0:u.depthFailOp),e=xo(e,(h=t.stencilBack)==null?void 0:h.compare),e=xo(e,(m=t.stencilBack)==null?void 0:m.passOp),e=xo(e,(g=t.stencilBack)==null?void 0:g.failOp),e=xo(e,(E=t.stencilBack)==null?void 0:E.depthFailOp),e=xo(e,t.stencilWrite?1:0),e=xo(e,t.cullMode),e=xo(e,t.frontFace?1:0),e=xo(e,t.polygonOffset?1:0),e}function yI(e){let t=0;t=xo(t,e.program.id),e.inputLayout!==null&&(t=xo(t,e.inputLayout.id)),t=gI(t,e.megaStateDescriptor);for(let r=0;r<e.colorAttachmentFormats.length;r++)t=xo(t,e.colorAttachmentFormats[r]||0);return t=xo(t,e.depthStencilAttachmentFormat||0),Gx(t)}function xI(e){let t=0;if(e.samplerBindings)for(let r=0;r<e.samplerBindings.length;r++){const i=e.samplerBindings[r];i!==null&&i.texture!==null&&(t=xo(t,i.texture.id))}if(e.uniformBufferBindings)for(let r=0;r<e.uniformBufferBindings.length;r++){const i=e.uniformBufferBindings[r];i!==null&&i.buffer!==null&&(t=xo(t,i.buffer.id),t=xo(t,i.binding),t=xo(t,i.offset),t=xo(t,i.size))}if(e.storageBufferBindings)for(let r=0;r<e.storageBufferBindings.length;r++){const i=e.storageBufferBindings[r];i!==null&&i.buffer!==null&&(t=xo(t,i.buffer.id),t=xo(t,i.binding),t=xo(t,i.offset),t=xo(t,i.size))}if(e.storageTextureBindings)for(let r=0;r<e.storageTextureBindings.length;r++){const i=e.storageTextureBindings[r];i!==null&&i.texture!==null&&(t=xo(t,i.texture.id),t=xo(t,i.binding))}return Gx(t)}function EI(e,t){var r,i,a,u;return((r=e.vertex)==null?void 0:r.glsl)===((i=t.vertex)==null?void 0:i.glsl)&&((a=e.fragment)==null?void 0:a.glsl)===((u=t.fragment)==null?void 0:u.glsl)}function bI(e){var t,r;return{vertex:{glsl:(t=e.vertex)==null?void 0:t.glsl},fragment:{glsl:(r=e.fragment)==null?void 0:r.glsl}}}var SI=class{constructor(e){this.device=e,this.bindingsCache=new N0(fR,xI),this.renderPipelinesCache=new N0(mR,yI),this.inputLayoutsCache=new N0(gR,Xx),this.programCache=new N0(EI,Xx)}createBindings(e){var t;let r=this.bindingsCache.get(e);if(r===null){const i=ER(e);i.uniformBufferBindings=(t=i.uniformBufferBindings)==null?void 0:t.filter(({size:a})=>a&&a>0),r=this.device.createBindings(i),this.bindingsCache.add(i,r)}return r}createRenderPipeline(e){let t=this.renderPipelinesCache.get(e);if(t===null){const r=bR(e);r.colorAttachmentFormats=r.colorAttachmentFormats.filter(i=>i),t=this.device.createRenderPipeline(r),this.renderPipelinesCache.add(r,t)}return t}createInputLayout(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter(r=>!!r);let t=this.inputLayoutsCache.get(e);if(t===null){const r=TR(e);t=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,t)}return t}createProgram(e){let t=this.programCache.get(e);if(t===null){const r=bI(e);t=this.device.createProgram(e),this.programCache.add(r,t)}return t}destroy(){for(const e of this.bindingsCache.values())e.destroy();for(const e of this.renderPipelinesCache.values())e.destroy();for(const e of this.inputLayoutsCache.values())e.destroy();for(const e of this.programCache.values())e.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}},AI=class{constructor(e,t){const{data:r,type:i,count:a=0}=t;let u;B0(r)?u=r:u=new L0[this.type||F.UNSIGNED_INT](r),this.type=i,this.count=a,this.indexBuffer=e.createBuffer({viewOrSize:u,usage:zo.INDEX})}get(){return this.indexBuffer}subData({data:e}){let t;B0(e)?t=e:t=new L0[this.type||F.UNSIGNED_INT](e),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}destroy(){this.indexBuffer.destroy()}};function qx(e){return!!(e&&e.texture)}var Kx=class{constructor(e,t){this.device=e,this.options=t,this.isDestroy=!1;const{wrapS:r=F.CLAMP_TO_EDGE,wrapT:i=F.CLAMP_TO_EDGE,aniso:a,mag:u=F.NEAREST,min:h=F.NEAREST}=t;this.createTexture(t),this.sampler=e.createSampler({addressModeU:Hx[r],addressModeV:Hx[i],minFilter:h===F.NEAREST?Ha.POINT:Ha.BILINEAR,magFilter:u===F.NEAREST?Ha.POINT:Ha.BILINEAR,mipmapFilter:Ps.NO_MIP,maxAnisotropy:a})}createTexture(e){const{type:t=F.UNSIGNED_BYTE,width:r,height:i,flipY:a=!1,format:u=F.RGBA,alignment:h=1,usage:m=qe.SAMPLED,unorm:g=!1,label:E}=e;let{data:A}=e;this.width=r,this.height=i;let w=st.U8_RGBA_RT;if(t===F.UNSIGNED_BYTE&&u===F.RGBA)w=g?st.U8_RGBA_NORM:st.U8_RGBA_RT;else if(t===F.UNSIGNED_BYTE&&u===F.LUMINANCE)w=st.U8_LUMINANCE;else if(t===F.FLOAT&&u===F.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(A&&(A=pI(A,0)),w=st.F32_RGBA):w=st.F32_RGB;else if(t===F.FLOAT&&u===F.RGBA)w=st.F32_RGBA;else if(t===F.FLOAT&&u===F.RED)w=st.F32_R;else throw new Error(`create texture error, type: ${t}, format: ${u}`);this.texture=this.device.createTexture({format:w,width:r,height:i,usage:m===qe.SAMPLED?mu.SAMPLED:mu.RENDER_TARGET,pixelStore:{unpackFlipY:a,packAlignment:h},mipLevelCount:1}),E&&this.device.setResourceName(this.texture,E),A&&this.texture.setImageData([A])}get(){return this.texture}update(e){const{data:t}=e;this.texture.setImageData([t])}bind(){}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&this.destroy(),this.options.width=e,this.options.height=t,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var e;!this.isDestroy&&!this.texture.destroyed&&((e=this.texture)==null||e.destroy()),this.isDestroy=!0}},$x=class{constructor(e,t){this.device=e,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(e=!1){const{width:t,height:r,color:i}=this.options;i&&(qx(i)?(e&&i.resize({width:t,height:r}),this.colorTexture=i.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i.width,this.height=i.height):t&&r&&(this.colorTexture=this.device.createTexture({format:st.U8_RGBA_RT,usage:mu.RENDER_TARGET,width:t,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=t,this.height=r))}createDepthRenderTarget(e=!1){const{width:t,height:r,depth:i}=this.options;i&&(qx(i)?(e&&i.resize({width:t,height:r}),this.depthTexture=i.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i.width,this.height=i.height):t&&r&&(this.depthTexture=this.device.createTexture({format:st.D24_S8,usage:mu.RENDER_TARGET,width:t,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=t,this.height=r))}get(){return this.colorRenderTarget}destroy(){var e,t;(e=this.colorRenderTarget)==null||e.destroy(),(t=this.depthRenderTarget)==null||t.destroy()}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=e,this.options.height=t,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}},TI=Object.defineProperty,CI=Object.defineProperties,wI=Object.getOwnPropertyDescriptors,Qx=Object.getOwnPropertySymbols,RI=Object.prototype.hasOwnProperty,MI=Object.prototype.propertyIsEnumerable,Jx=(e,t,r)=>t in e?TI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Kp=(e,t)=>{for(var r in t||(t={}))RI.call(t,r)&&Jx(e,r,t[r]);if(Qx)for(var r of Qx(t))MI.call(t,r)&&Jx(e,r,t[r]);return e},II=(e,t)=>CI(e,wI(t)),{isPlainObject:PI,isTypedArray:OI}=Yn,DI=class{constructor(e,t,r){this.device=e,this.options=t,this.service=r,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:i,fs:a,attributes:u,uniforms:h,count:m,elements:g,diagnosticDerivativeUniformityEnabled:E}=t;this.options=t;const A=E?"":this.service.viewportOrigin===Cf.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:i},fragment:{glsl:a,postprocess:q=>A+q}}),h&&(this.uniforms=this.extractUniforms(h));const w=[];let R=0;Object.keys(u).forEach(q=>{const ce=u[q],Se=ce.get();this.vertexBuffers.push(Se.get());const{offset:ke=0,stride:Fe=0,size:rt=1,divisor:mt=0,shaderLocation:er=0}=ce.attribute;w.push({arrayStride:Fe||rt*4,stepMode:Xp.VERTEX,attributes:[{format:sI[rt],shaderLocation:er,offset:ke,divisor:mt}]}),R=Se.size/rt}),m||(this.options.count=R),g&&(this.indexBuffer=g.get());const U=e.createInputLayout({vertexBufferDescriptors:w,indexBufferFormat:g?st.U32_R:null,program:this.program});this.inputLayout=U,this.pipeline=this.createPipeline(t)}createPipeline(e,t){const{primitive:r=F.TRIANGLES,depth:i,cull:a,blend:u,stencil:h}=e,m=this.initDepthDrawParams({depth:i}),g=!!(m&&m.enable),E=this.initCullDrawParams({cull:a}),A=!!(E&&E.enable),w=this.getBlendDrawParams({blend:u}),R=!!(w&&w.enable),U=this.getStencilDrawParams({stencil:h}),q=!!(U&&U.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:aI[r],colorAttachmentFormats:[st.U8_RGBA_RT],depthStencilAttachmentFormat:st.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:Gs.ALL,rgbBlendState:{blendMode:Ws.ADD,blendSrcFactor:Bi.ONE,blendDstFactor:Bi.ZERO},alphaBlendState:{blendMode:Ws.ADD,blendSrcFactor:Bi.ONE,blendDstFactor:Bi.ZERO}}:{channelWriteMask:q&&U.opFront.zpass===Pa.REPLACE?Gs.NONE:Gs.ALL,rgbBlendState:{blendMode:R&&w.equation.rgb||Ws.ADD,blendSrcFactor:R&&w.func.srcRGB||Bi.SRC_ALPHA,blendDstFactor:R&&w.func.dstRGB||Bi.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:R&&w.equation.alpha||Ws.ADD,blendSrcFactor:R&&w.func.srcAlpha||Bi.ONE,blendDstFactor:R&&w.func.dstAlpha||Bi.ONE}}],blendConstant:R?y0:void 0,depthWrite:g,depthCompare:g&&m.func||Ai.LESS,cullMode:A&&E.face||xl.NONE,stencilWrite:q,stencilFront:{compare:q?U.func.cmp:Ai.ALWAYS,passOp:U.opFront.zpass,failOp:U.opFront.fail,depthFailOp:U.opFront.zfail,mask:U.opFront.mask},stencilBack:{compare:q?U.func.cmp:Ai.ALWAYS,passOp:U.opBack.zpass,failOp:U.opBack.fail,depthFailOp:U.opBack.zfail,mask:U.opBack.mask}}})}updateAttributesAndElements(){}updateAttributes(){}addUniforms(e){this.uniforms=Kp(Kp({},this.uniforms),this.extractUniforms(e))}draw(e,t){const r=Kp(Kp({},this.options),e),{count:i=0,instances:a,elements:u,uniforms:h={},uniformBuffers:m,textures:g}=r;this.uniforms=Kp(Kp({},this.uniforms),this.extractUniforms(h));const{renderPass:E,currentFramebuffer:A,width:w,height:R,renderCache:U}=this.service;this.pipeline=this.createPipeline(r,t);const q=this.service.device,ce=q.swapChainHeight;if(q.swapChainHeight=(A==null?void 0:A.height)||R,E.setViewport(0,0,(A==null?void 0:A.width)||w,(A==null?void 0:A.height)||R),q.swapChainHeight=ce,E.setPipeline(this.pipeline),E.setStencilReference(1),E.setVertexInput(this.inputLayout,this.vertexBuffers.map(Se=>({buffer:Se})),u?{buffer:this.indexBuffer,offset:0}:null),m&&(this.bindings=U.createBindings({pipeline:this.pipeline,uniformBufferBindings:m.map((Se,ke)=>{const Fe=Se;return{binding:ke,buffer:Fe.get(),size:Fe.size}}),samplerBindings:g==null?void 0:g.map(Se=>({texture:Se.texture,sampler:Se.sampler}))})),this.bindings&&(E.setBindings(this.bindings),Object.keys(this.uniforms).forEach(Se=>{const ke=this.uniforms[Se];ke instanceof Kx?this.uniforms[Se]=ke.get():ke instanceof $x&&(this.uniforms[Se]=ke.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),u){const Se=u.count;Se===0?E.draw(i,a):E.drawIndexed(Se,a)}else E.draw(i,a)}destroy(){var e,t,r;(e=this.vertexBuffers)==null||e.forEach(i=>i.destroy()),(t=this.indexBuffer)==null||t.destroy(),(r=this.bindings)==null||r.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:e}){if(e)return{enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:lI[e.func||F.LESS],range:e.range||[0,1]}}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:i,color:a=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:F0[r&&r.srcRGB||F.SRC_ALPHA],srcAlpha:F0[r&&r.srcAlpha||F.SRC_ALPHA],dstRGB:F0[r&&r.dstRGB||F.ONE_MINUS_SRC_ALPHA],dstAlpha:F0[r&&r.dstAlpha||F.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Wx[i&&i.rgb||F.FUNC_ADD],alpha:Wx[i&&i.alpha||F.FUNC_ADD]},color:a}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=4294967295,func:i={cmp:F.ALWAYS,ref:0,mask:4294967295},opFront:a={fail:F.KEEP,zfail:F.KEEP,zpass:F.KEEP},opBack:u={fail:F.KEEP,zfail:F.KEEP,zpass:F.KEEP}}=e||{};return{enable:!!t,mask:r,func:II(Kp({},i),{cmp:fI[i.cmp]}),opFront:{fail:qd[a.fail],zfail:qd[a.zfail],zpass:qd[a.zpass],mask:i.mask},opBack:{fail:qd[u.fail],zfail:qd[u.zfail],zpass:qd[u.zpass],mask:i.mask}}}initCullDrawParams({cull:e}){if(e){const{enable:t,face:r=F.BACK}=e;return{enable:!!t,face:cI[r]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||OI(t)||t===""||"resize"in t){r[`${i&&i+"."}${e}`]=t;return}PI(t)&&Object.keys(t).forEach(a=>{this.extractUniformsRecursively(a,t[a],r,`${i&&i+"."}${e}`)}),Array.isArray(t)&&t.forEach((a,u)=>{Object.keys(a).forEach(h=>{this.extractUniformsRecursively(h,a[h],r,`${i&&i+"."}${e}[${u}]`)})})}};function LI(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var Q_=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),{isUndefined:k0}=Yn,FI=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=e=>new DI(this.device,e,this),this.createAttribute=e=>new oI(this.device,e),this.createBuffer=e=>new dI(this.device,e),this.createElements=e=>new AI(this.device,e),this.createTexture2D=e=>new Kx(this.device,e),this.createFramebuffer=e=>new $x(this.device,e),this.useFramebuffer=(e,t)=>{this.currentFramebuffer=e,this.beginFrame(),t(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(e,t)=>Q_(this,null,function*(){this.currentFramebuffer=e,this.preRenderPass=this.renderPass,this.beginFrame(),yield t(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=e=>{const{color:t,depth:r,stencil:i,framebuffer:a=null}=e;if(a)a.clearOptions={color:t,depth:r,stencil:i};else{const u=this.queryVerdorInfo();if(u==="WebGL1"){const h=this.getGLContext();k0(i)?k0(r)||(h.clearDepth(r),h.clear(h.DEPTH_BUFFER_BIT)):(h.clearStencil(i),h.clear(h.STENCIL_BUFFER_BIT))}else if(u==="WebGL2"){const h=this.getGLContext();k0(i)?k0(r)||h.clearBufferfv(h.DEPTH,0,[r]):h.clearBufferiv(h.STENCIL,0,[i])}}},this.viewport=({width:e,height:t})=>{this.swapChain.configureSwapChain(e,t),this.createMainColorDepthRT(e,t),this.width=e,this.height=t},this.readPixels=e=>{const{framebuffer:t,x:r,y:i,width:a,height:u}=e,h=this.device.createReadback(),m=t.colorTexture,g=h.readTextureSync(m,r,this.viewportOrigin===Cf.LOWER_LEFT?i:this.height-i,a,u,new Uint8Array(a*u*4));return h.destroy(),g},this.readPixelsAsync=e=>Q_(this,null,function*(){const{framebuffer:t,x:r,y:i,width:a,height:u}=e,h=this.device.createReadback(),m=t.colorTexture,g=yield h.readTexture(m,r,this.viewportOrigin===Cf.LOWER_LEFT?i:this.height-i,a,u,new Uint8Array(a*u*4));if(this.viewportOrigin!==Cf.LOWER_LEFT)for(let E=0;E<g.length;E+=4){const A=g[E];g[E]=g[E+2],g[E+2]=A}return h.destroy(),g}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var e;this.canvas=null,(e=this.uniformBuffers)==null||e.forEach(t=>{t.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(e,t){return Q_(this,null,function*(){const{enableWebGPU:r,shaderCompilerPath:i,antialias:a}=t;this.canvas=e;const h=yield(r?new XM({shaderCompilerPath:i}):new oM({targets:["webgl2","webgl1"],antialias:a,onContextLost(g){console.warn("context lost",g)},onContextCreationError(g){console.warn("context creation error",g)},onContextRestored(g){console.warn("context restored",g)}})).createSwapChain(e);h.configureSwapChain(e.width,e.height),this.device=h.getDevice(),this.swapChain=h,this.renderCache=new SI(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const m=this.device.gl;this.extensionObject={OES_texture_float:!LI(m)&&this.device.OES_texture_float},this.createMainColorDepthRT(e.width,e.height)})}createMainColorDepthRT(e,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:st.U8_RGBA_RT,width:e,height:t,usage:mu.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:st.D24_S8,width:e,height:t,usage:mu.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:e,swapChain:t,mainColorRT:r,mainDepthRT:i}=this,a=e?e.colorRenderTarget:r,u=e?null:t.getOnscreenTexture(),h=e?e.depthRenderTarget:i,{color:m=[0,0,0,0],depth:g=1,stencil:E=0}=(e==null?void 0:e.clearOptions)||{},A=a?Hm(m[0]*255,m[1]*255,m[2]*255,m[3]):y0,w=h?g:void 0,R=h?E:void 0,U=this.device.createRenderPass({colorAttachment:[a],colorResolveTo:[u],colorClearColor:[A],colorStore:[!0],depthStencilAttachment:h,depthClearValue:w,stencilClearValue:R});this.renderPass=U}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}},BI=N(52388),J_=["selectstart","selecting","selectend"],NI=class extends BI.EventEmitter{constructor(e,t={}){super(),this.isEnable=!1,this.onDragStart=r=>{this.box.style.display="block",this.startEvent=this.endEvent=r,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=r=>{this.endEvent=r,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=r=>{this.endEvent=r,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=e,this.options=t}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:e}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const t=Mi("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:e,y:t}=this.startEvent,{x:r,y:i}=this.endEvent,a=Math.min(e,r),u=Math.min(t,i),h=Math.abs(e-r),m=Math.abs(t-i);this.box.style.top=`${u}px`,this.box.style.left=`${a}px`,this.box.style.width=`${h}px`,this.box.style.height=`${m}px`}getLngLatBox(){const{lngLat:{lng:e,lat:t}}=this.startEvent,{lngLat:{lng:r,lat:i}}=this.endEvent;return xh([[e,t],[r,i]])}},kI=Object.defineProperty,UI=Object.defineProperties,zI=Object.getOwnPropertyDescriptors,eE=Object.getOwnPropertySymbols,VI=Object.prototype.hasOwnProperty,ZI=Object.prototype.propertyIsEnumerable,tE=(e,t,r)=>t in e?kI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,jI=(e,t)=>{for(var r in t||(t={}))VI.call(t,r)&&tE(e,r,t[r]);if(eE)for(var r of eE(t))ZI.call(t,r)&&tE(e,r,t[r]);return e},HI=(e,t)=>UI(e,zI(t)),Jm=(e,t,r)=>new Promise((i,a)=>{var u=g=>{try{m(r.next(g))}catch(E){a(E)}},h=g=>{try{m(r.throw(g))}catch(E){a(E)}},m=g=>g.done?i(g.value):Promise.resolve(g.value).then(u,h);m((r=r.apply(e,t)).next())}),WI=class{constructor(e){const{id:t,map:r,canvas:i,renderer:a="regl"}=e,u=Iv();this.container=u,r.setContainer(u,t,i),a==="regl"?u.rendererService=new iI:u.rendererService=new FI,this.sceneService=u.sceneService,this.mapService=u.mapService,this.iconService=u.iconService,this.fontService=u.fontService,this.controlService=u.controlService,this.layerService=u.layerService,this.debugService=u.debugService,this.debugService.setEnable(e.debug),this.markerService=u.markerService,this.interactionService=u.interactionService,this.popupService=u.popupService,this.boxSelect=new NI(this,{}),this.initComponent(t),this.sceneService.init(e),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(e){return Jm(this,null,function*(){return this.sceneService.exportPng(e)})}exportMap(e){return Jm(this,null,function*(){return this.sceneService.exportPng(e)})}registerRenderService(e){this.sceneService.loaded?new e(this).init():this.on("loaded",()=>{new e(this).init()})}setBgColor(e){this.mapService.setBgColor(e)}addLayer(e){this.loaded?this.preAddLayer(e):this.once("loaded",()=>{this.preAddLayer(e)})}preAddLayer(e){const t=Zh(this.container);if(e.setContainer(t),this.sceneService.addLayer(e),e.inited){this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",()=>{this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)})}initMask(e){const{mask:t,maskfence:r,maskColor:i="#000",maskOpacity:a=0}=e.getLayerConfig();return!t||!r?void 0:new J1().source(r).shape("fill").style({color:i,opacity:a})}addMask(e,t){if(!e)return;const r=this.getLayer(t);if(r){const i=Zh(this.container);e.setContainer(i),r.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(e){return this.layerService.getLayer(e)}getLayerByName(e){return this.layerService.getLayerByName(e)}removeLayer(e,t){return Jm(this,null,function*(){yield this.layerService.remove(e,t)})}removeAllLayer(){return Jm(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(e){this.layerService.setEnableRender(e)}addIconFont(e,t){this.fontService.addIconFont(e,t)}addIconFonts(e){e.forEach(([t,r])=>{this.fontService.addIconFont(t,r)})}addFontFace(e,t){this.fontService.once("fontloaded",r=>{this.emit("fontloaded",r)}),this.fontService.addFontFace(e,t)}addImage(e,t){return Jm(this,null,function*(){yield this.iconService.addImage(e,t)})}hasImage(e){return this.iconService.hasImage(e)}removeImage(e){this.iconService.removeImage(e)}addIconFontGlyphs(e,t){this.fontService.addIconGlyphs(t)}addControl(e){this.controlService.addControl(e,this.container)}removeControl(e){this.controlService.removeControl(e)}getControlByName(e){return this.controlService.getControlByName(e)}addMarker(e){this.markerService.addMarker(e)}addMarkerLayer(e){this.markerService.addMarkerLayer(e)}removeMarkerLayer(e){this.markerService.removeMarkerLayer(e)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(e){this.popupService.addPopup(e)}removePopup(e){this.popupService.removePopup(e)}on(e,t){var r;J_.includes(e)?(r=this.boxSelect)==null||r.on(e,t):jh.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}once(e,t){var r;J_.includes(e)?(r=this.boxSelect)==null||r.once(e,t):jh.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}emit(e,t){jh.indexOf(e)===-1?this.mapService.on(e,t):this.sceneService.emit(e,t)}off(e,t){var r;J_.includes(e)?(r=this.boxSelect)==null||r.off(e,t):jh.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}getZoom(){return this.mapService.getZoom()}getCenter(e){return this.mapService.getCenter(e)}setCenter(e,t){return this.mapService.setCenter(e,t)}getPitch(){return this.mapService.getPitch()}setPitch(e){return this.mapService.setPitch(e)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(e){this.mapService.setRotation(e)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(e){this.mapService.panTo(e)}panBy(e,t){this.mapService.panBy(e,t)}getContainer(){return this.mapService.getContainer()}setZoom(e){this.mapService.setZoom(e)}fitBounds(e,t){const{fitBoundsOptions:r,animate:i}=this.sceneService.getSceneConfig();this.mapService.fitBounds(e,t||HI(jI({},r),{animate:i}))}setZoomAndCenter(e,t){this.mapService.setZoomAndCenter(e,t)}setMapStyle(e){this.mapService.setMapStyle(e)}setMapStatus(e){this.mapService.setMapStatus(e)}pixelToLngLat(e){return this.mapService.pixelToLngLat(e)}lngLatToPixel(e){return this.mapService.lngLatToPixel(e)}containerToLngLat(e){return this.mapService.containerToLngLat(e)}lngLatToContainer(e){return this.mapService.lngLatToContainer(e)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(e){this.container.postProcessingPass.name=new e}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(e=!0){this.boxSelect.enable(),e&&this.boxSelect.once("selectend",()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(e,t){Ze.REGISTERED_PROTOCOLS[e]=t}static removeProtocol(e){delete Ze.REGISTERED_PROTOCOLS[e]}getProtocol(e){return Ze.REGISTERED_PROTOCOLS[e]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(e){this.controlService.init({container:_h(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:e,logoPosition:t}=this.sceneService.getSceneConfig();e&&this.addControl(new Zg({position:t}))}initTileLayer(e){e.getSource().isTile&&(e.tileLayer=new Lw(e))}},k4="2.21.10";function ev(e){"@babel/helpers - typeof";return ev=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ev(e)}function rE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function U4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rE(Object(r),!0).forEach(function(i){GI(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rE(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function GI(e,t,r){return t=XI(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XI(e){var t=YI(e,"string");return ev(t)==="symbol"?t:String(t)}function YI(e,t){if(ev(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(ev(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function z4(e,t){return QI(e)||$I(e,t)||KI(e,t)||qI()}function qI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KI(e,t){if(e){if(typeof e=="string")return nE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nE(e,t)}}function nE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function $I(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function QI(e){if(Array.isArray(e))return e}var V4=null,Z4=null;class JI{constructor(t){(0,P.Z)(this,"configService",void 0),(0,P.Z)(this,"config",void 0),this.config=t}setContainer(t,r,i){this.configService=t.globalConfigService,t.mapConfig=(0,lt.Z)((0,lt.Z)({},this.config),{},{id:r,canvas:i}),t.mapService=new(this.getServiceConstructor())(t)}getServiceConstructor(){throw new Error("Method not implemented.")}}var eP=N(6158),tv=N.n(eP),tP=N(57443);class rP{constructor(t){(0,P.Z)(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const r=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}project(t){const r=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[r,i]}unproject(t){const r=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[r,i]}}const nP={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},iE={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},iP=12;class oP{constructor(t){(0,P.Z)(this,"version","DEFAUlTMAP"),(0,P.Z)(this,"map",void 0),(0,P.Z)(this,"simpleMapCoord",new rP),(0,P.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,P.Z)(this,"config",void 0),(0,P.Z)(this,"configService",void 0),(0,P.Z)(this,"coordinateSystemService",void 0),(0,P.Z)(this,"eventEmitter",void 0),(0,P.Z)(this,"markerContainer",void 0),(0,P.Z)(this,"cameraChangedCallback",void 0),(0,P.Z)(this,"$mapContainer",void 0),(0,P.Z)(this,"handleCameraChanged",r=>{const{lat:i,lng:a}=this.map.getCenter();this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:this.map.getBearing(),center:[a,i],viewportHeight:this.map.transform.height,pitch:this.map.getPitch(),viewportWidth:this.map.transform.width,zoom:this.map.getZoom(),cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new tP.EventEmitter}setBgColor(t){this.bgColor=t}addMarkerContainer(){const t=this.map.getCanvasContainer();this.markerContainer=Mi("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}on(t,r){Gn.indexOf(t)!==-1?this.eventEmitter.on(t,r):this.map.on(iE[t]||t,r)}off(t,r){this.map.off(iE[t]||t,r),this.eventEmitter.off(t,r)}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();const t=this.map.transform;return[t.width,t.height]}getType(){return"default"}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){this.map.setCenter(t)}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getBearing()}getBounds(){return this.map.getBounds().toArray()}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}setRotation(t){this.map.setBearing(t)}zoomIn(t,r){this.map.zoomIn(t,r)}zoomOut(t,r){this.map.zoomOut(t,r)}setPitch(t){return this.map.setPitch(t)}panTo(t){this.map.panTo(t)}panBy(t=0,r=0){this.map.panBy([t,r])}fitBounds(t,r){this.map.fitBounds(t,r)}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}setZoomAndCenter(t,r){this.map.flyTo({zoom:t,center:r})}setMapStyle(t){this.map.setStyle(this.getMapStyleValue(t))}meterToCoord(t,r){return 1}pixelToLngLat(t){return this.map.unproject(t)}lngLatToPixel(t){return this.map.project(t)}containerToLngLat(t){return this.map.unproject(t)}lngLatToContainer(t){return this.map.project(t)}getMapStyle(){try{var t;const r=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(r)?r==null?void 0:r.replace(/\/\w+$/,"").replace(/sprites/,"styles"):r}catch(r){return""}}getMapStyleConfig(){return nP}getMapStyleValue(t){var r;return(r=this.getMapStyleConfig()[t])!==null&&r!==void 0?r:t}destroy(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,...r){this.eventEmitter.once(t,...r)}getMapContainer(){return this.$mapContainer}exportMap(t){const r=this.map.getCanvas();return t==="jpg"?r==null?void 0:r.toDataURL("image/jpeg"):r==null?void 0:r.toDataURL("image/png")}onCameraChanged(t){this.cameraChangedCallback=t}creatMapContainer(t){let r=t;return typeof t=="string"&&(r=document.getElementById(t)),r}updateView(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>iP&&t?this.coordinateSystemService.setCoordinateSystem(me.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(me.LNGLAT)}}var oE=N(15671),aE=N(43144),aP=N(82963),sP=N(61120),uP=N(60136),U0=N(97326),wc=N(97685);function rv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function z0(e,t){var r=o.fF([],t,e);return o.bA(r,r,1/r[3]),r}function j4(e,t){var r=e%t;return r<0?t+r:r}function H4(e,t,r){return r*t+(1-r)*e}function $p(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var nf=Math.PI,sE=nf/4,lh=nf/180,uE=180/nf,eg=512,tg=4003e4,lP=1.5;function lE(e){return Math.pow(2,e)}function cP(e){return Math.log2(e)}function V0(e,t){var r=(0,wc.Z)(e,2),i=r[0],a=r[1];$p(Number.isFinite(i)&&Number.isFinite(t)),$p(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),t*=eg;var u=i*lh,h=a*lh,m=t*(u+nf)/(2*nf),g=t*(nf-Math.log(Math.tan(sE+h*.5)))/(2*nf);return[m,g]}function rg(e,t){var r=(0,wc.Z)(e,2),i=r[0],a=r[1];t*=eg;var u=i/t*(2*nf)-nf,h=2*(Math.atan(Math.exp(nf-a/t*(2*nf)))-sE);return[u*uE,h*uE]}function W4(e){var t=e.latitude;assert(Number.isFinite(t));var r=Math.cos(t*lh);return cP(tg*r)-9}function cE(e){var t=e.latitude,r=e.longitude,i=e.zoom,a=e.scale,u=e.highPrecision,h=u===void 0?!1:u;a=a!==void 0?a:lE(i),$p(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(a));var m={},g=eg*a,E=Math.cos(t*lh),A=g/360,w=A/E,R=g/tg/E;if(m.pixelsPerMeter=[R,-R,R],m.metersPerPixel=[1/R,-1/R,1/R],m.pixelsPerDegree=[A,-w,R],m.degreesPerPixel=[1/A,-1/w,1/R],h){var U=lh*Math.tan(t*lh)/E,q=A*U/2,ce=g/tg*U,Se=ce/w*R;m.pixelsPerDegree2=[0,-q,ce],m.pixelsPerMeter2=[Se,0,Se]}return m}function G4(e,t){var r=_slicedToArray(e,3),i=r[0],a=r[1],u=r[2],h=_slicedToArray(t,3),m=h[0],g=h[1],E=h[2],A=1,w=cE({longitude:i,latitude:a,scale:A,highPrecision:!0}),R=w.pixelsPerMeter,U=w.pixelsPerMeter2,q=V0(e,A);q[0]+=m*(R[0]+U[0]*g),q[1]+=g*(R[1]+U[1]*g);var ce=rg(q,A),Se=(u||0)+(E||0);return Number.isFinite(u)||Number.isFinite(E)?[ce[0],ce[1],Se]:ce}function fP(e){var t=e.height,r=e.pitch,i=e.bearing,a=e.altitude,u=e.center,h=u===void 0?null:u,m=e.flipY,g=m===void 0?!1:m,E=rv();return no.translate(E,E,[0,0,-a]),no.scale(E,E,[1,1,1/t]),no.rotateX(E,E,-r*lh),no.rotateZ(E,E,i*lh),g&&no.scale(E,E,[1,-1,1]),h&&no.translate(E,E,Go.tk([],h)),E}function hP(e){var t=e.width,r=e.height,i=e.altitude,a=i===void 0?lP:i,u=e.pitch,h=u===void 0?0:u,m=e.nearZMultiplier,g=m===void 0?1:m,E=e.farZMultiplier,A=E===void 0?1:E,w=h*lh,R=Math.atan(.5/a),U=Math.sin(R)*a/Math.sin(Math.PI/2-w-R),q=Math.cos(Math.PI/2-w)*U+a;return{fov:2*Math.atan(r/2/a),aspect:t/r,focalDistance:a,near:g,far:q*A}}function pP(e){var t=e.width,r=e.height,i=e.pitch,a=e.altitude,u=e.nearZMultiplier,h=e.farZMultiplier,m=hP({width:t,height:r,altitude:a,pitch:i,nearZMultiplier:u,farZMultiplier:h}),g=m.fov,E=m.aspect,A=m.near,w=m.far,R=no.perspective([],g,E,A,w);return R}function dP(e,t){var r=(0,wc.Z)(e,3),i=r[0],a=r[1],u=r[2],h=u===void 0?0:u;return $p(Number.isFinite(i)&&Number.isFinite(a)&&Number.isFinite(h)),z0(t,[i,a,h,1])}function fE(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,wc.Z)(e,3),a=i[0],u=i[1],h=i[2];if($p(Number.isFinite(a)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(h)){var m=z0(t,[a,u,h,1]);return m}var g=z0(t,[a,u,0,1]),E=z0(t,[a,u,1,1]),A=g[2],w=E[2],R=A===w?0:((r||0)-A)/(w-A);return ii.t7([],g,E,R)}var hE=rv(),mP=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width,i=t.height,a=t.viewMatrix,u=a===void 0?hE:a,h=t.projectionMatrix,m=h===void 0?hE:h;(0,oE.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=m;var g=rv();no.multiply(g,g,this.projectionMatrix),no.multiply(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var E=rv();no.scale(E,E,[this.width/2,-this.height/2,1]),no.translate(E,E,[1,-1,0]),no.multiply(E,E,this.viewProjectionMatrix);var A=no.invert(rv(),E);if(!A)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=A,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,aE.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&no.equals(r.projectionMatrix,this.projectionMatrix)&&no.equals(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.topLeft,u=a===void 0?!0:a,h=this.projectPosition(r),m=dP(h,this.pixelProjectionMatrix),g=(0,wc.Z)(m,2),E=g[0],A=g[1],w=u?A:this.height-A;return r.length===2?[E,w]:[E,w,m[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.topLeft,u=a===void 0?!0:a,h=i.targetZ,m=(0,wc.Z)(r,3),g=m[0],E=m[1],A=m[2],w=u?E:this.height-E,R=h&&h*this.pixelsPerMeter,U=fE([g,w,A],this.pixelUnprojectionMatrix,R),q=this.unprojectPosition(U),ce=(0,wc.Z)(q,3),Se=ce[0],ke=ce[1],Fe=ce[2];return Number.isFinite(A)?[Se,ke,Fe]:Number.isFinite(h)?[Se,ke,h]:[Se,ke]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),a=(0,wc.Z)(i,2),u=a[0],h=a[1],m=(r[2]||0)*this.pixelsPerMeter;return[u,h,m]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),a=(0,wc.Z)(i,2),u=a[0],h=a[1],m=(r[2]||0)/this.pixelsPerMeter;return[u,h,m]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function vP(e){var t=e.width,r=e.height,i=e.bounds,a=e.minExtent,u=a===void 0?0:a,h=e.maxZoom,m=h===void 0?24:h,g=e.padding,E=g===void 0?0:g,A=e.offset,w=A===void 0?[0,0]:A,R=(0,wc.Z)(i,2),U=(0,wc.Z)(R[0],2),q=U[0],ce=U[1],Se=(0,wc.Z)(R[1],2),ke=Se[0],Fe=Se[1];if(Number.isFinite(E)){var rt=E;E={top:rt,bottom:rt,left:rt,right:rt}}else $p(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var mt=new pE({width:t,height:r,longitude:0,latitude:0,zoom:0}),er=mt.project([q,Fe]),cr=mt.project([ke,ce]),kt=[Math.max(Math.abs(cr[0]-er[0]),u),Math.max(Math.abs(cr[1]-er[1]),u)],dr=[t-E.left-E.right-Math.abs(w[0])*2,r-E.top-E.bottom-Math.abs(w[1])*2];$p(dr[0]>0&&dr[1]>0);var Pn=dr[0]/kt[0],_i=dr[1]/kt[1],En=(E.right-E.left)/2/Pn,fi=(E.bottom-E.top)/2/_i,Gi=[(cr[0]+er[0])/2+En,(cr[1]+er[1])/2+fi],ou=mt.unproject(Gi),Bu=mt.zoom+Math.log2(Math.abs(Math.min(Pn,_i)));return{longitude:ou[0],latitude:ou[1],zoom:Math.min(Bu,m)}}var pE=function(e){(0,uP.Z)(t,e);function t(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=i.width,u=i.height,h=i.latitude,m=h===void 0?0:h,g=i.longitude,E=g===void 0?0:g,A=i.zoom,w=A===void 0?0:A,R=i.pitch,U=R===void 0?0:R,q=i.bearing,ce=q===void 0?0:q,Se=i.altitude,ke=Se===void 0?1.5:Se,Fe=i.nearZMultiplier,rt=i.farZMultiplier;(0,oE.Z)(this,t),a=a||1,u=u||1;var mt=lE(w);ke=Math.max(.75,ke);var er=V0([E,m],mt);er[2]=0;var cr=pP({width:a,height:u,pitch:U,bearing:ce,altitude:ke,nearZMultiplier:Fe||1/u,farZMultiplier:rt||1.01}),kt=fP({height:u,center:er,pitch:U,bearing:ce,altitude:ke,flipY:!0});return r=(0,aP.Z)(this,(0,sP.Z)(t).call(this,{width:a,height:u,viewMatrix:kt,projectionMatrix:cr})),r.latitude=m,r.longitude=E,r.zoom=w,r.pitch=U,r.bearing=ce,r.altitude=ke,r.scale=mt,r.center=er,r.pixelsPerMeter=cE((0,U0.Z)((0,U0.Z)(r))).pixelsPerMeter[2],Object.freeze((0,U0.Z)((0,U0.Z)(r))),r}return(0,aE.Z)(t,[{key:"projectFlat",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return V0(i,a)}},{key:"unprojectFlat",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return rg(i,a)}},{key:"getMapCenterByLngLatPosition",value:function(i){var a=i.lngLat,u=i.pos,h=fE(u,this.pixelUnprojectionMatrix),m=V0(a,this.scale),g=ii.IH([],m,ii.tk([],h)),E=ii.IH([],this.center,g);return rg(E,this.scale)}},{key:"getLocationAtPoint",value:function(i){var a=i.lngLat,u=i.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:u})}},{key:"fitBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,h=this.height,m=vP(Object.assign({width:u,height:h,bounds:i},a)),g=m.longitude,E=m.latitude,A=m.zoom;return new t({width:u,height:h,longitude:g,latitude:E,zoom:A})}}]),t}(mP);class _P{constructor(){(0,P.Z)(this,"viewport",void 0)}syncWithMapCamera(t){const{center:r,zoom:i,pitch:a,bearing:u,viewportHeight:h,viewportWidth:m}=t;this.viewport=new pE({width:m,height:h,longitude:r&&r[0],latitude:r&&r[1],zoom:i,pitch:a,bearing:u})}getZoom(){return this.viewport.zoom}getZoomScale(){return Math.pow(2,this.getZoom())}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(t,r){return this.viewport.projectFlat(t,r)}}const gP=["id","attributionControl","style","token","rotation","mapInstance"];function yP(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(t||(t=document),!!t)){var a=t.head||t.getElementsByTagName("head")[0];if(!a){a=t.createElement("head");var u=t.body||t.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(a,u):t.documentElement.appendChild(a)}var h=t.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(t.createTextNode(e)),a.appendChild(h),h}}yP(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=tv();let xP=0;const dE="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg";class EP extends oP{constructor(...t){super(...t),(0,P.Z)(this,"version","MAPBOX"),(0,P.Z)(this,"viewport",void 0)}getType(){return"mapbox"}lngLatToCoord(t,r={x:0,y:0,z:0}){const{x:i,y:a}=this.lngLatToMercator(t,0);return[i-r.x,a-r.y]}lngLatToMercator(t,r){const{x:i=0,y:a=0,z:u=0}=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r);return{x:i,y:a,z:u}}getModelMatrix(t,r,i,a=[1,1,1],u={x:0,y:0,z:0}){const h=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r),m=h.meterInMercatorCoordinateUnits(),g=no.create();return no.translate(g,g,Go.al(h.x-u.x,h.y-u.y,h.z||0-u.z)),no.scale(g,g,Go.al(m*a[0],-m*a[1],m*a[2])),no.rotateX(g,g,i[0]),no.rotateY(g,g,i[1]),no.rotateZ(g,g,i[2]),g}init(){var t=this;return(0,Yt.Z)(function*(){const r=t.config,{id:i="map",attributionControl:a=!1,style:u="light",token:h=dE,rotation:m=0,mapInstance:g}=r,E=(0,Ot.Z)(r,gP);t.viewport=new _P,!g&&!window.mapboxgl&&console.error(t.configService.getSceneWarninfo("SDK")),h===dE&&u!=="blank"&&!window.mapboxgl.accessToken&&!g&&console.warn(t.configService.getSceneWarninfo("MapToken")),!g&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=h),g?(t.map=g,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(i),t.map=new window.mapboxgl.Map((0,lt.Z)({container:t.$mapContainer,style:t.getMapStyleValue(u),attributionControl:a,bearing:m},E))),t.map.on("load",()=>{t.handleCameraChanged()}),t.map.on("move",t.handleCameraChanged),t.handleCameraChanged()})()}destroy(){var t;(t=this.$mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,...r){this.eventEmitter.once(t,...r)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){var t;return(t=this.getMapContainer())===null||t===void 0?void 0:t.querySelector(".mapboxgl-canvas-container")}meterToCoord(t,r){const i=new(tv()).LngLat(t[0],t[1]),a=new(tv()).LngLat(r[0],r[1]),u=i.distanceTo(a),h=tv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),m=tv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),{x:g,y:E}=h,{x:A,y:w}=m;return Math.sqrt(Math.pow(g-A,2)+Math.pow(E-w,2))*4194304*2/u}exportMap(t){const r=this.map.getCanvas();return t==="jpg"?r==null?void 0:r.toDataURL("image/jpeg"):r==null?void 0:r.toDataURL("image/png")}creatMapContainer(t){let r=t;typeof t=="string"&&(r=document.getElementById(t));const i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+xP++,r.appendChild(i),i}}function bP(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(t||(t=document),!!t)){var a=t.head||t.getElementsByTagName("head")[0];if(!a){a=t.createElement("head");var u=t.body||t.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(a,u):t.documentElement.appendChild(a)}var h=t.createElement("style");return h.type="text/css",h.styleSheet?h.styleSheet.cssText=e:h.appendChild(t.createTextNode(e)),a.appendChild(h),h}}bP(`.mapboxgl-ctrl-logo {
  display: none !important;
}
`);class SP extends JI{getServiceConstructor(){return EP}}function nv(e){"@babel/helpers - typeof";return nv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nv(e)}function mE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function vE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mE(Object(r),!0).forEach(function(i){AP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mE(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function AP(e,t,r){return t=TP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TP(e){var t=CP(e,"string");return nv(t)==="symbol"?t:String(t)}function CP(e,t){if(nv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(nv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wP(e,t){return PP(e)||IP(e,t)||MP(e,t)||RP()}function RP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MP(e,t){if(e){if(typeof e=="string")return _E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _E(e,t)}}function _E(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function IP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function PP(e){if(Array.isArray(e))return e}var OP=Oe.memo(function(e){var t=e.style,r=e.className,i=e.map,a=e.option,u=e.onSceneLoaded,h=(0,Oe.createRef)(),m=(0,Oe.useState)(),g=wP(m,2),E=g[0],A=g[1];return(0,Oe.useEffect)(function(){var w=new WI(vE(vE({id:h.current},a),{},{map:new SP(i)}));return w.on("loaded",function(){A(w),u&&u(w)}),function(){w.destroy()}},[]),(0,Oe.useEffect)(function(){E&&i.style&&E.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,Oe.useEffect)(function(){E&&i.zoom&&E.setZoom(i.zoom)},[i.zoom]),(0,Oe.useEffect)(function(){E&&i.center&&E.setCenter(i.center)},[JSON.stringify(i.center)]),(0,Oe.useEffect)(function(){E&&i.pitch!==void 0&&E.setPitch(i.pitch||0)},[i.pitch]),(0,Oe.useEffect)(function(){E&&i.rotation&&E.setRotation(i.rotation)},[i.rotation]),Oe.createElement(Qe.Provider,{value:E},(0,Oe.createElement)("div",{ref:h,style:t,className:r},E&&e.children))}),DP=OP;function iv(e){"@babel/helpers - typeof";return iv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iv(e)}function gE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function X4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gE(Object(r),!0).forEach(function(i){LP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gE(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function LP(e,t,r){return t=FP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FP(e){var t=BP(e,"string");return iv(t)==="symbol"?t:String(t)}function BP(e,t){if(iv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(iv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Y4(e,t){return zP(e)||UP(e,t)||kP(e,t)||NP()}function NP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kP(e,t){if(e){if(typeof e=="string")return yE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yE(e,t)}}function yE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function UP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function zP(e){if(Array.isArray(e))return e}var q4=null,K4=null;function ov(e){"@babel/helpers - typeof";return ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ov(e)}function xE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function $4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xE(Object(r),!0).forEach(function(i){VP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xE(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function VP(e,t,r){return t=ZP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZP(e){var t=jP(e,"string");return ov(t)==="symbol"?t:String(t)}function jP(e,t){if(ov(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(ov(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Q4(e,t){return XP(e)||GP(e,t)||WP(e,t)||HP()}function HP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function WP(e,t){if(e){if(typeof e=="string")return EE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return EE(e,t)}}function EE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function GP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function XP(e){if(Array.isArray(e))return e}var J4=null,eD=null;function av(e){"@babel/helpers - typeof";return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},av(e)}function bE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function tD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bE(Object(r),!0).forEach(function(i){YP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bE(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function YP(e,t,r){return t=qP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qP(e){var t=KP(e,"string");return av(t)==="symbol"?t:String(t)}function KP(e,t){if(av(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(av(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function rD(e,t){return e5(e)||JP(e,t)||QP(e,t)||$P()}function $P(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QP(e,t){if(e){if(typeof e=="string")return SE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SE(e,t)}}function SE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function JP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function e5(e){if(Array.isArray(e))return e}var nD=null,iD=null;function oD(e,t){return i5(e)||n5(e,t)||r5(e,t)||t5()}function t5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function r5(e,t){if(e){if(typeof e=="string")return AE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return AE(e,t)}}function AE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n5(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function i5(e){if(Array.isArray(e))return e}var aD=null;function sv(e){"@babel/helpers - typeof";return sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sv(e)}var sD=null;function TE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function uD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TE(Object(r),!0).forEach(function(i){o5(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TE(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function o5(e,t,r){return t=a5(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a5(e){var t=s5(e,"string");return sv(t)==="symbol"?t:String(t)}function s5(e,t){if(sv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(sv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lD(e,t){if(e==null)return{};var r=u5(e,t),i,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)i=u[a],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function u5(e,t){if(e==null)return{};var r={},i=Object.keys(e),a,u;for(u=0;u<i.length;u++)a=i[u],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}var cD={exportImage:b2,fullscreen:S2,geoLocate:A2,layer:Vg,layerSwitch:Vg,logo:Zg,mapTheme:w2,mouseLocation:R2,zoom:Fw,scale:M2},fD=null,CE=N(73935);function wE(e,t){return h5(e)||f5(e,t)||c5(e,t)||l5()}function l5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c5(e,t){if(e){if(typeof e=="string")return RE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return RE(e,t)}}function RE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function f5(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function h5(e){if(Array.isArray(e))return e}var ME=Oe.useEffect,IE=Oe.useState,p5=/\B([A-Z])/g,d5=function(t){return t.replace(p5,"-$1").toLowerCase()};function hD(e){var t=e.className,r=e.style,i=e.children,a=e.position,u=IE(),h=wE(u,2),m=h[0],g=h[1],E=useSceneValue(),A=IE(function(){return document.createElement("div")}),w=wE(A,1),R=w[0];return ME(function(){var U=new Control({position:a});return U.onAdd=function(){if(t&&(R.className=t),r){var q=Object.keys(r).map(function(ce){return"".concat(d5(ce),":").concat(r[ce])}).join(";");R.style.cssText=q}return R},U.onRemove=function(){},g(U),E.addControl(U),function(){E.removeControl(U)}},[]),ME(function(){m&&m.setPosition(a||"bottomleft")},[a]),createPortal(i,R)}var PE=(0,Oe.createContext)({});function pD(){return useContext(PE)}var m5=Oe.memo(function(t){var r=t.layer,i=t.active;return r.active(i.option),null},_o()),v5=Oe.memo(function(t){var r=t.layer,i=t.animate;return r.animate(i),null},_o()),_5=Oe.memo(function(t){var r=t.layer,i=t.color;return i.field?r.color(i.field,i.values):r.color(i.values),null},_o()),g5=Oe.memo(function(t){var r=t.layer,i=t.filter;return i.field&&r.filter(i.field,i.values),null},_o()),y5=Oe.memo(function(t){var r=t.layer,i=t.scale;return r.scale(i.values),null},_o()),x5=Oe.memo(function(t){var r=t.layer,i=t.select;return r.select(i.option),null},_o()),E5=Oe.memo(function(t){var r=t.layer,i=t.shape;return i.field?r.shape(i.field,i.values):r.shape(i.values),null},_o()),b5=Oe.memo(function(t){var r=t.layer,i=t.size;return i.field?r.size(i.field,i.values):r.size(i.values),null},_o()),S5=["data"];function A5(e,t){if(e==null)return{};var r=T5(e,t),i,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)i=u[a],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function T5(e,t){if(e==null)return{};var r={},i=Object.keys(e),a,u;for(u=0;u<i.length;u++)a=i[u],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}var C5=Oe.memo(function(t){var r=t.layer,i=t.source,a=i.data,u=A5(i,S5);return r.inited?r.setData(a,u):r.source(a,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions),null},_o()),dD=Oe.useEffect,w5=Oe.memo(function(t){var r=t.layer,i=t.style;return r.style(i),null},_o());function R5(e,t){return O5(e)||P5(e,t)||I5(e,t)||M5()}function M5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I5(e,t){if(e){if(typeof e=="string")return OE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return OE(e,t)}}function OE(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function P5(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,h,m=[],g=!0,E=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);g=!0);}catch(A){E=!0,a=A}finally{try{if(!g&&r.return!=null&&(h=r.return(),Object(h)!==h))return}finally{if(E)throw a}}return m}}function O5(e){if(Array.isArray(e))return e}var uv=Oe.useEffect,D5=Oe.useState;function DE(e,t){var r=t.source,i=t.color,a=t.shape,u=t.style,h=t.size,m=t.scale,g=t.active,E=t.select,A=t.filter,w=t.animate,R=t.options,U=t.onLayerLoaded,q=v(),ce=D5(function(){var Fe;switch(e){case"polygonLayer":Fe=new p0(R);break;case"lineLayer":Fe=new z_(R);break;case"pointLayer":Fe=new h0(R);break;case"heatmapLayer":Fe=new h3(R);break;case"rasterLayer":Fe=new d0(R);break;case"imageLayer":Fe=new O1(R);break;case"citybuildingLayer":Fe=new XT(R);break;default:Fe=new p0(R)}return Fe.on("inited",function(){U&&U(Fe,q)}),Fe}),Se=R5(ce,1),ke=Se[0];return uv(function(){return q.addLayer(ke),function(){q.removeLayer(ke)}},[]),uv(function(){ke.inited&&R&&ke.updateLayerConfig(R)},[R==null?void 0:R.minZoom,R==null?void 0:R.maxZoom,R==null?void 0:R.visible]),uv(function(){ke.inited&&(R!=null&&R.zIndex)&&ke.setIndex(R.zIndex)},[R==null?void 0:R.zIndex]),uv(function(){ke.inited&&(R!=null&&R.blend)&&ke.setBlend(R.blend)},[R==null?void 0:R.blend]),uv(function(){q.render()}),Oe.createElement(PE.Provider,{value:ke},Oe.createElement(C5,{layer:ke,source:r}),m&&Oe.createElement(y5,{layer:ke,scale:m}),i&&Oe.createElement(_5,{layer:ke,color:i}),h&&Oe.createElement(b5,{layer:ke,size:h}),a&&Oe.createElement(E5,{layer:ke,shape:a}),u&&Oe.createElement(w5,{layer:ke,style:u}),g&&Oe.createElement(m5,{layer:ke,active:g}),E&&Oe.createElement(x5,{layer:ke,select:E}),A&&Oe.createElement(g5,{layer:ke,filter:A}),w&&Oe.createElement(v5,{layer:ke,animate:w}),t.children)}var mD=null,vD=null,L5=Oe.memo(function(t){return DE("pointLayer",t)}),F5=Oe.memo(function(t){return DE("heatmapLayer",t)}),_D=null,gD=null,yD=null,xD=Oe.useEffect,ED=null,bD=null;function Kd(e){"@babel/helpers - typeof";return Kd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kd(e)}function LE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function Z0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?LE(Object(r),!0).forEach(function(i){B5(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):LE(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function B5(e,t,r){return t=BE(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function N5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FE(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,BE(i.key),i)}}function k5(e,t,r){return t&&FE(e.prototype,t),r&&FE(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function BE(e){var t=U5(e,"string");return Kd(t)==="symbol"?t:String(t)}function U5(e,t){if(Kd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Kd(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function z5(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ng(e,t)}function ng(e,t){return ng=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},ng(e,t)}function V5(e){var t=H5();return function(){var i=j0(e),a;if(t){var u=j0(this).constructor;a=Reflect.construct(i,arguments,u)}else a=i.apply(this,arguments);return Z5(this,a)}}function Z5(e,t){if(t&&(Kd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return j5(e)}function j5(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function j0(e){return j0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},j0(e)}var SD=function(e){z5(r,e);var t=V5(r);function r(i){var a;return N5(this,r),a=t.call(this,i),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return k5(r,[{key:"componentDidMount",value:function(){var a,u=this.props,h=u.lnglat,m=u.children,g=u.option,E=u.lngLat,A=new ex(Z0(Z0({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));h&&A.setLnglat(h),E&&A.setLnglat(E),m&&A.setHTML(this.el),this.popup=A,this.scene.addPopup(A)}},{key:"componentDidUpdate",value:function(a){var u,h,m,g,E,A,w=Array.isArray(a.lnglat)?a.lnglat:[a==null||(u=a.lnglat)===null||u===void 0?void 0:u.lng,a==null||(h=a.lnglat)===null||h===void 0?void 0:h.lat],R=Array.isArray(this.props.lnglat)?this.props.lnglat:[(m=this.props)===null||m===void 0||(g=m.lnglat)===null||g===void 0?void 0:g.lng,(E=this.props)===null||E===void 0||(A=E.lnglat)===null||A===void 0?void 0:A.lat],U=w.toString()!==R.toString();if(U){var q;this.popup.remove(),this.popup=new ex(Z0(Z0({},this.props.option),{},{stopPropagation:(q=this.props.option)===null||q===void 0?void 0:q.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return Oe.createElement(Qe.Consumer,{},function(u){return u&&(a.scene=u),(0,CE.createPortal)(a.props.children,a.el)})}}]),r}(Oe.PureComponent);function $d(e){"@babel/helpers - typeof";return $d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$d(e)}function W5(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function NE(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,X5(i.key),i)}}function G5(e,t,r){return t&&NE(e.prototype,t),r&&NE(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function X5(e){var t=Y5(e,"string");return $d(t)==="symbol"?t:String(t)}function Y5(e,t){if($d(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if($d(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function q5(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ig(e,t)}function ig(e,t){return ig=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},ig(e,t)}function K5(e){var t=J5();return function(){var i=H0(e),a;if(t){var u=H0(this).constructor;a=Reflect.construct(i,arguments,u)}else a=i.apply(this,arguments);return $5(this,a)}}function $5(e,t){if(t&&($d(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Q5(e)}function Q5(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function H0(e){return H0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},H0(e)}var AD=function(e){q5(r,e);var t=K5(r);function r(i){var a;return W5(this,r),a=t.call(this,i),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return G5(r,[{key:"componentDidMount",value:function(){var a=this.props,u=a.lnglat,h=a.children,m=a.option,g=a.onMarkerLoaded,E=new g2(m);u&&E.setLnglat(u),h&&E.setElement(this.el),this.marker=E,g&&g(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(a){var u,h=JSON.stringify(a==null?void 0:a.lnglat)!==JSON.stringify((u=this.props)===null||u===void 0?void 0:u.lnglat);h&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return Oe.createElement(Qe.Consumer,{},function(u){return u&&(a.scene=u),(0,CE.createPortal)(a.props.children,a.el)})}}]),r}(Oe.PureComponent),TD=Oe.useEffect,CD=null,wD=null,RD=Oe.useEffect,MD=null},52388:function(hr){"use strict";var qt=Object.prototype.hasOwnProperty,N="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(N=!1));function Qe(se,W,ne){this.fn=se,this.context=W,this.once=ne||!1}function v(se,W,ne,G,Ke){if(typeof ne!="function")throw new TypeError("The listener must be a function");var De=new Qe(ne,G||se,Ke),ge=N?N+W:W;return se._events[ge]?se._events[ge].fn?se._events[ge]=[se._events[ge],De]:se._events[ge].push(De):(se._events[ge]=De,se._eventsCount++),se}function it(se,W){--se._eventsCount===0?se._events=new Oe:delete se._events[W]}function V(){this._events=new Oe,this._eventsCount=0}V.prototype.eventNames=function(){var W=[],ne,G;if(this._eventsCount===0)return W;for(G in ne=this._events)qt.call(ne,G)&&W.push(N?G.slice(1):G);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(ne)):W},V.prototype.listeners=function(W){var ne=N?N+W:W,G=this._events[ne];if(!G)return[];if(G.fn)return[G.fn];for(var Ke=0,De=G.length,ge=new Array(De);Ke<De;Ke++)ge[Ke]=G[Ke].fn;return ge},V.prototype.listenerCount=function(W){var ne=N?N+W:W,G=this._events[ne];return G?G.fn?1:G.length:0},V.prototype.emit=function(W,ne,G,Ke,De,ge){var ht=N?N+W:W;if(!this._events[ht])return!1;var ae=this._events[ht],At=arguments.length,wt,et;if(ae.fn){switch(ae.once&&this.removeListener(W,ae.fn,void 0,!0),At){case 1:return ae.fn.call(ae.context),!0;case 2:return ae.fn.call(ae.context,ne),!0;case 3:return ae.fn.call(ae.context,ne,G),!0;case 4:return ae.fn.call(ae.context,ne,G,Ke),!0;case 5:return ae.fn.call(ae.context,ne,G,Ke,De),!0;case 6:return ae.fn.call(ae.context,ne,G,Ke,De,ge),!0}for(et=1,wt=new Array(At-1);et<At;et++)wt[et-1]=arguments[et];ae.fn.apply(ae.context,wt)}else{var mr=ae.length,pr;for(et=0;et<mr;et++)switch(ae[et].once&&this.removeListener(W,ae[et].fn,void 0,!0),At){case 1:ae[et].fn.call(ae[et].context);break;case 2:ae[et].fn.call(ae[et].context,ne);break;case 3:ae[et].fn.call(ae[et].context,ne,G);break;case 4:ae[et].fn.call(ae[et].context,ne,G,Ke);break;default:if(!wt)for(pr=1,wt=new Array(At-1);pr<At;pr++)wt[pr-1]=arguments[pr];ae[et].fn.apply(ae[et].context,wt)}}return!0},V.prototype.on=function(W,ne,G){return v(this,W,ne,G,!1)},V.prototype.once=function(W,ne,G){return v(this,W,ne,G,!0)},V.prototype.removeListener=function(W,ne,G,Ke){var De=N?N+W:W;if(!this._events[De])return this;if(!ne)return it(this,De),this;var ge=this._events[De];if(ge.fn)ge.fn===ne&&(!Ke||ge.once)&&(!G||ge.context===G)&&it(this,De);else{for(var ht=0,ae=[],At=ge.length;ht<At;ht++)(ge[ht].fn!==ne||Ke&&!ge[ht].once||G&&ge[ht].context!==G)&&ae.push(ge[ht]);ae.length?this._events[De]=ae.length===1?ae[0]:ae:it(this,De)}return this},V.prototype.removeAllListeners=function(W){var ne;return W?(ne=N?N+W:W,this._events[ne]&&it(this,ne)):(this._events=new Oe,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,hr.exports=V},4771:function(){},72571:function(hr){"use strict";var qt=Object.prototype.hasOwnProperty,N="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(N=!1));function Qe(se,W,ne){this.fn=se,this.context=W,this.once=ne||!1}function v(se,W,ne,G,Ke){if(typeof ne!="function")throw new TypeError("The listener must be a function");var De=new Qe(ne,G||se,Ke),ge=N?N+W:W;return se._events[ge]?se._events[ge].fn?se._events[ge]=[se._events[ge],De]:se._events[ge].push(De):(se._events[ge]=De,se._eventsCount++),se}function it(se,W){--se._eventsCount===0?se._events=new Oe:delete se._events[W]}function V(){this._events=new Oe,this._eventsCount=0}V.prototype.eventNames=function(){var W=[],ne,G;if(this._eventsCount===0)return W;for(G in ne=this._events)qt.call(ne,G)&&W.push(N?G.slice(1):G);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(ne)):W},V.prototype.listeners=function(W){var ne=N?N+W:W,G=this._events[ne];if(!G)return[];if(G.fn)return[G.fn];for(var Ke=0,De=G.length,ge=new Array(De);Ke<De;Ke++)ge[Ke]=G[Ke].fn;return ge},V.prototype.listenerCount=function(W){var ne=N?N+W:W,G=this._events[ne];return G?G.fn?1:G.length:0},V.prototype.emit=function(W,ne,G,Ke,De,ge){var ht=N?N+W:W;if(!this._events[ht])return!1;var ae=this._events[ht],At=arguments.length,wt,et;if(ae.fn){switch(ae.once&&this.removeListener(W,ae.fn,void 0,!0),At){case 1:return ae.fn.call(ae.context),!0;case 2:return ae.fn.call(ae.context,ne),!0;case 3:return ae.fn.call(ae.context,ne,G),!0;case 4:return ae.fn.call(ae.context,ne,G,Ke),!0;case 5:return ae.fn.call(ae.context,ne,G,Ke,De),!0;case 6:return ae.fn.call(ae.context,ne,G,Ke,De,ge),!0}for(et=1,wt=new Array(At-1);et<At;et++)wt[et-1]=arguments[et];ae.fn.apply(ae.context,wt)}else{var mr=ae.length,pr;for(et=0;et<mr;et++)switch(ae[et].once&&this.removeListener(W,ae[et].fn,void 0,!0),At){case 1:ae[et].fn.call(ae[et].context);break;case 2:ae[et].fn.call(ae[et].context,ne);break;case 3:ae[et].fn.call(ae[et].context,ne,G);break;case 4:ae[et].fn.call(ae[et].context,ne,G,Ke);break;default:if(!wt)for(pr=1,wt=new Array(At-1);pr<At;pr++)wt[pr-1]=arguments[pr];ae[et].fn.apply(ae[et].context,wt)}}return!0},V.prototype.on=function(W,ne,G){return v(this,W,ne,G,!1)},V.prototype.once=function(W,ne,G){return v(this,W,ne,G,!0)},V.prototype.removeListener=function(W,ne,G,Ke){var De=N?N+W:W;if(!this._events[De])return this;if(!ne)return it(this,De),this;var ge=this._events[De];if(ge.fn)ge.fn===ne&&(!Ke||ge.once)&&(!G||ge.context===G)&&it(this,De);else{for(var ht=0,ae=[],At=ge.length;ht<At;ht++)(ge[ht].fn!==ne||Ke&&!ge[ht].once||G&&ge[ht].context!==G)&&ae.push(ge[ht]);ae.length?this._events[De]=ae.length===1?ae[0]:ae:it(this,De)}return this},V.prototype.removeAllListeners=function(W){var ne;return W?(ne=N?N+W:W,this._events[ne]&&it(this,ne)):(this._events=new Oe,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,hr.exports=V},72895:function(hr){"use strict";var qt=Object.prototype.hasOwnProperty,N="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(N=!1));function Qe(se,W,ne){this.fn=se,this.context=W,this.once=ne||!1}function v(se,W,ne,G,Ke){if(typeof ne!="function")throw new TypeError("The listener must be a function");var De=new Qe(ne,G||se,Ke),ge=N?N+W:W;return se._events[ge]?se._events[ge].fn?se._events[ge]=[se._events[ge],De]:se._events[ge].push(De):(se._events[ge]=De,se._eventsCount++),se}function it(se,W){--se._eventsCount===0?se._events=new Oe:delete se._events[W]}function V(){this._events=new Oe,this._eventsCount=0}V.prototype.eventNames=function(){var W=[],ne,G;if(this._eventsCount===0)return W;for(G in ne=this._events)qt.call(ne,G)&&W.push(N?G.slice(1):G);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(ne)):W},V.prototype.listeners=function(W){var ne=N?N+W:W,G=this._events[ne];if(!G)return[];if(G.fn)return[G.fn];for(var Ke=0,De=G.length,ge=new Array(De);Ke<De;Ke++)ge[Ke]=G[Ke].fn;return ge},V.prototype.listenerCount=function(W){var ne=N?N+W:W,G=this._events[ne];return G?G.fn?1:G.length:0},V.prototype.emit=function(W,ne,G,Ke,De,ge){var ht=N?N+W:W;if(!this._events[ht])return!1;var ae=this._events[ht],At=arguments.length,wt,et;if(ae.fn){switch(ae.once&&this.removeListener(W,ae.fn,void 0,!0),At){case 1:return ae.fn.call(ae.context),!0;case 2:return ae.fn.call(ae.context,ne),!0;case 3:return ae.fn.call(ae.context,ne,G),!0;case 4:return ae.fn.call(ae.context,ne,G,Ke),!0;case 5:return ae.fn.call(ae.context,ne,G,Ke,De),!0;case 6:return ae.fn.call(ae.context,ne,G,Ke,De,ge),!0}for(et=1,wt=new Array(At-1);et<At;et++)wt[et-1]=arguments[et];ae.fn.apply(ae.context,wt)}else{var mr=ae.length,pr;for(et=0;et<mr;et++)switch(ae[et].once&&this.removeListener(W,ae[et].fn,void 0,!0),At){case 1:ae[et].fn.call(ae[et].context);break;case 2:ae[et].fn.call(ae[et].context,ne);break;case 3:ae[et].fn.call(ae[et].context,ne,G);break;case 4:ae[et].fn.call(ae[et].context,ne,G,Ke);break;default:if(!wt)for(pr=1,wt=new Array(At-1);pr<At;pr++)wt[pr-1]=arguments[pr];ae[et].fn.apply(ae[et].context,wt)}}return!0},V.prototype.on=function(W,ne,G){return v(this,W,ne,G,!1)},V.prototype.once=function(W,ne,G){return v(this,W,ne,G,!0)},V.prototype.removeListener=function(W,ne,G,Ke){var De=N?N+W:W;if(!this._events[De])return this;if(!ne)return it(this,De),this;var ge=this._events[De];if(ge.fn)ge.fn===ne&&(!Ke||ge.once)&&(!G||ge.context===G)&&it(this,De);else{for(var ht=0,ae=[],At=ge.length;ht<At;ht++)(ge[ht].fn!==ne||Ke&&!ge[ht].once||G&&ge[ht].context!==G)&&ae.push(ge[ht]);ae.length?this._events[De]=ae.length===1?ae[0]:ae:it(this,De)}return this},V.prototype.removeAllListeners=function(W){var ne;return W?(ne=N?N+W:W,this._events[ne]&&it(this,ne)):(this._events=new Oe,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=N,V.EventEmitter=V,hr.exports=V},38163:function(hr){hr.exports=qt;function qt(Qe,v){var it=Qe&&Qe.type,V;if(it==="FeatureCollection")for(V=0;V<Qe.features.length;V++)qt(Qe.features[V],v);else if(it==="GeometryCollection")for(V=0;V<Qe.geometries.length;V++)qt(Qe.geometries[V],v);else if(it==="Feature")qt(Qe.geometry,v);else if(it==="Polygon")N(Qe.coordinates,v);else if(it==="MultiPolygon")for(V=0;V<Qe.coordinates.length;V++)N(Qe.coordinates[V],v);return Qe}function N(Qe,v){if(Qe.length!==0){Oe(Qe[0],v);for(var it=1;it<Qe.length;it++)Oe(Qe[it],!v)}}function Oe(Qe,v){for(var it=0,V=0,se=0,W=Qe.length,ne=W-1;se<W;ne=se++){var G=(Qe[se][0]-Qe[ne][0])*(Qe[ne][1]+Qe[se][1]),Ke=it+G;V+=Math.abs(it)>=Math.abs(G)?it-Ke+G:G-Ke+it,it=Ke}it+V>=0!=!!v&&Qe.reverse()}},75550:function(hr){"use strict";hr.exports=qt;function qt(N,Oe){this.x=N,this.y=Oe}qt.prototype={clone:function(){return new qt(this.x,this.y)},add:function(N){return this.clone()._add(N)},sub:function(N){return this.clone()._sub(N)},multByPoint:function(N){return this.clone()._multByPoint(N)},divByPoint:function(N){return this.clone()._divByPoint(N)},mult:function(N){return this.clone()._mult(N)},div:function(N){return this.clone()._div(N)},rotate:function(N){return this.clone()._rotate(N)},rotateAround:function(N,Oe){return this.clone()._rotateAround(N,Oe)},matMult:function(N){return this.clone()._matMult(N)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(N){return this.x===N.x&&this.y===N.y},dist:function(N){return Math.sqrt(this.distSqr(N))},distSqr:function(N){var Oe=N.x-this.x,Qe=N.y-this.y;return Oe*Oe+Qe*Qe},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(N){return Math.atan2(this.y-N.y,this.x-N.x)},angleWith:function(N){return this.angleWithSep(N.x,N.y)},angleWithSep:function(N,Oe){return Math.atan2(this.x*Oe-this.y*N,this.x*N+this.y*Oe)},_matMult:function(N){var Oe=N[0]*this.x+N[1]*this.y,Qe=N[2]*this.x+N[3]*this.y;return this.x=Oe,this.y=Qe,this},_add:function(N){return this.x+=N.x,this.y+=N.y,this},_sub:function(N){return this.x-=N.x,this.y-=N.y,this},_mult:function(N){return this.x*=N,this.y*=N,this},_div:function(N){return this.x/=N,this.y/=N,this},_multByPoint:function(N){return this.x*=N.x,this.y*=N.y,this},_divByPoint:function(N){return this.x/=N.x,this.y/=N.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var N=this.y;return this.y=this.x,this.x=-N,this},_rotate:function(N){var Oe=Math.cos(N),Qe=Math.sin(N),v=Oe*this.x-Qe*this.y,it=Qe*this.x+Oe*this.y;return this.x=v,this.y=it,this},_rotateAround:function(N,Oe){var Qe=Math.cos(N),v=Math.sin(N),it=Oe.x+Qe*(this.x-Oe.x)-v*(this.y-Oe.y),V=Oe.y+v*(this.x-Oe.x)+Qe*(this.y-Oe.y);return this.x=it,this.y=V,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},qt.convert=function(N){return N instanceof qt?N:Array.isArray(N)?new qt(N[0],N[1]):N}},49296:function(hr){"use strict";hr.exports=N,hr.exports.default=N;var qt=1e20;function N(V,se,W,ne,G,Ke){this.fontSize=V||24,this.buffer=se===void 0?3:se,this.cutoff=ne||.25,this.fontFamily=G||"sans-serif",this.fontWeight=Ke||"normal",this.radius=W||8;var De=this.size=this.fontSize+this.buffer*2,ge=De+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=De,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ge*ge),this.gridInner=new Float64Array(ge*ge),this.f=new Float64Array(ge),this.z=new Float64Array(ge+1),this.v=new Uint16Array(ge),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(De/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Oe(V,se,W,ne,G,Ke,De){Ke.fill(qt,0,se*W),De.fill(0,0,se*W);for(var ge=(se-ne)/2,ht=0;ht<G;ht++)for(var ae=0;ae<ne;ae++){var At=(ht+ge)*se+ae+ge,wt=V.data[4*(ht*ne+ae)+3]/255;if(wt===1)Ke[At]=0,De[At]=qt;else if(wt===0)Ke[At]=qt,De[At]=0;else{var et=Math.max(0,.5-wt),mr=Math.max(0,wt-.5);Ke[At]=et*et,De[At]=mr*mr}}}function Qe(V,se,W,ne,G,Ke,De){for(var ge=0;ge<se*W;ge++){var ht=Math.sqrt(ne[ge])-Math.sqrt(G[ge]);V[ge]=Math.round(255-255*(ht/Ke+De))}}N.prototype._draw=function(V,se){var W=this.ctx.measureText(V),ne=W.width,G=2*this.buffer,Ke,De,ge,ht,ae,At,wt,et;se&&this.useMetrics?(ae=Math.floor(W.actualBoundingBoxAscent),et=this.buffer+Math.ceil(W.actualBoundingBoxAscent),At=this.buffer,wt=this.buffer,De=Math.min(this.size,Math.ceil(W.actualBoundingBoxRight-W.actualBoundingBoxLeft)),ht=Math.min(this.size-At,Math.ceil(W.actualBoundingBoxAscent+W.actualBoundingBoxDescent)),Ke=De+G,ge=ht+G,this.ctx.textBaseline="alphabetic"):(Ke=De=this.size,ge=ht=this.size,ae=19*this.fontSize/24,At=wt=0,et=this.middle,this.ctx.textBaseline="middle");var mr;De&&ht&&(this.ctx.clearRect(wt,At,De,ht),this.ctx.fillText(V,this.buffer,et),mr=this.ctx.getImageData(wt,At,De,ht));var pr=new Uint8ClampedArray(Ke*ge);return Oe(mr,Ke,ge,De,ht,this.gridOuter,this.gridInner),v(this.gridOuter,Ke,ge,this.f,this.v,this.z),v(this.gridInner,Ke,ge,this.f,this.v,this.z),Qe(pr,Ke,ge,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pr,metrics:{width:De,height:ht,sdfWidth:Ke,sdfHeight:ge,top:ae,left:0,advance:ne}}},N.prototype.draw=function(V){return this._draw(V,!1).data},N.prototype.drawWithMetrics=function(V){return this._draw(V,!0)};function v(V,se,W,ne,G,Ke){for(var De=0;De<se;De++)it(V,De,se,W,ne,G,Ke);for(var ge=0;ge<W;ge++)it(V,ge*se,1,se,ne,G,Ke)}function it(V,se,W,ne,G,Ke,De){var ge,ht,ae,At;for(Ke[0]=0,De[0]=-qt,De[1]=qt,ge=0;ge<ne;ge++)G[ge]=V[se+ge*W];for(ge=1,ht=0,ae=0;ge<ne;ge++){do At=Ke[ht],ae=(G[ge]-G[At]+ge*ge-At*At)/(ge-At)/2;while(ae<=De[ht]&&--ht>-1);ht++,Ke[ht]=ge,De[ht]=ae,De[ht+1]=qt}for(ge=0,ht=0;ge<ne;ge++){for(;De[ht+1]<ge;)ht++;At=Ke[ht],V[se+ge*W]=G[At]+(ge-At)*(ge-At)}}},38929:function(hr,qt,N){hr.exports.VectorTile=N(22779),N(66024),N(59701)},22779:function(hr,qt,N){"use strict";var Oe=N(59701);hr.exports=Qe;function Qe(it,V){this.layers=it.readFields(v,{},V)}function v(it,V,se){if(it===3){var W=new Oe(se,se.readVarint()+se.pos);W.length&&(V[W.name]=W)}}},66024:function(hr,qt,N){"use strict";var Oe=N(75550);hr.exports=Qe;function Qe(W,ne,G,Ke,De){this.properties={},this.extent=G,this.type=0,this._pbf=W,this._geometry=-1,this._keys=Ke,this._values=De,W.readFields(v,this,ne)}function v(W,ne,G){W==1?ne.id=G.readVarint():W==2?it(G,ne):W==3?ne.type=G.readVarint():W==4&&(ne._geometry=G.pos)}function it(W,ne){for(var G=W.readVarint()+W.pos;W.pos<G;){var Ke=ne._keys[W.readVarint()],De=ne._values[W.readVarint()];ne.properties[Ke]=De}}Qe.types=["Unknown","Point","LineString","Polygon"],Qe.prototype.loadGeometry=function(){var W=this._pbf;W.pos=this._geometry;for(var ne=W.readVarint()+W.pos,G=1,Ke=0,De=0,ge=0,ht=[],ae;W.pos<ne;){if(Ke<=0){var At=W.readVarint();G=At&7,Ke=At>>3}if(Ke--,G===1||G===2)De+=W.readSVarint(),ge+=W.readSVarint(),G===1&&(ae&&ht.push(ae),ae=[]),ae.push(new Oe(De,ge));else if(G===7)ae&&ae.push(ae[0].clone());else throw new Error("unknown command "+G)}return ae&&ht.push(ae),ht},Qe.prototype.bbox=function(){var W=this._pbf;W.pos=this._geometry;for(var ne=W.readVarint()+W.pos,G=1,Ke=0,De=0,ge=0,ht=1/0,ae=-1/0,At=1/0,wt=-1/0;W.pos<ne;){if(Ke<=0){var et=W.readVarint();G=et&7,Ke=et>>3}if(Ke--,G===1||G===2)De+=W.readSVarint(),ge+=W.readSVarint(),De<ht&&(ht=De),De>ae&&(ae=De),ge<At&&(At=ge),ge>wt&&(wt=ge);else if(G!==7)throw new Error("unknown command "+G)}return[ht,At,ae,wt]},Qe.prototype.toGeoJSON=function(W,ne,G){var Ke=this.extent*Math.pow(2,G),De=this.extent*W,ge=this.extent*ne,ht=this.loadGeometry(),ae=Qe.types[this.type],At,wt;function et(yn){for(var bi=0;bi<yn.length;bi++){var $n=yn[bi],Mt=180-($n.y+ge)*360/Ke;yn[bi]=[($n.x+De)*360/Ke-180,360/Math.PI*Math.atan(Math.exp(Mt*Math.PI/180))-90]}}switch(this.type){case 1:var mr=[];for(At=0;At<ht.length;At++)mr[At]=ht[At][0];ht=mr,et(ht);break;case 2:for(At=0;At<ht.length;At++)et(ht[At]);break;case 3:for(ht=V(ht),At=0;At<ht.length;At++)for(wt=0;wt<ht[At].length;wt++)et(ht[At][wt]);break}ht.length===1?ht=ht[0]:ae="Multi"+ae;var pr={type:"Feature",geometry:{type:ae,coordinates:ht},properties:this.properties};return"id"in this&&(pr.id=this.id),pr};function V(W){var ne=W.length;if(ne<=1)return[W];for(var G=[],Ke,De,ge=0;ge<ne;ge++){var ht=se(W[ge]);ht!==0&&(De===void 0&&(De=ht<0),De===ht<0?(Ke&&G.push(Ke),Ke=[W[ge]]):Ke.push(W[ge]))}return Ke&&G.push(Ke),G}function se(W){for(var ne=0,G=0,Ke=W.length,De=Ke-1,ge,ht;G<Ke;De=G++)ge=W[G],ht=W[De],ne+=(ht.x-ge.x)*(ge.y+ht.y);return ne}},59701:function(hr,qt,N){"use strict";var Oe=N(66024);hr.exports=Qe;function Qe(V,se){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=V,this._keys=[],this._values=[],this._features=[],V.readFields(v,this,se),this.length=this._features.length}function v(V,se,W){V===15?se.version=W.readVarint():V===1?se.name=W.readString():V===5?se.extent=W.readVarint():V===2?se._features.push(W.pos):V===3?se._keys.push(W.readString()):V===4&&se._values.push(it(W))}function it(V){for(var se=null,W=V.readVarint()+V.pos;V.pos<W;){var ne=V.readVarint()>>3;se=ne===1?V.readString():ne===2?V.readFloat():ne===3?V.readDouble():ne===4?V.readVarint64():ne===5?V.readVarint():ne===6?V.readSVarint():ne===7?V.readBoolean():null}return se}Qe.prototype.feature=function(V){if(V<0||V>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[V];var se=this._pbf.readVarint()+this._pbf.pos;return new Oe(this._pbf,se,this.extent,this._keys,this._values)}},55054:function(hr,qt,N){"use strict";N.d(qt,{Z:function(){return Lr}});var Oe=N(67294),Qe=N(57838),v=N(96159),it=N(93967),V=N.n(it),se=N(64217),W=N(53124),ne=N(99559),Ke=K=>{const{value:_e,formatter:Y,precision:ve,decimalSeparator:fe,groupSeparator:He="",prefixCls:at}=K;let _t;if(typeof Y=="function")_t=Y(_e);else{const Tt=String(_e),Pt=Tt.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Pt||Tt==="-")_t=Tt;else{const Xr=Pt[1];let zr=Pt[2]||"0",gn=Pt[4]||"";zr=zr.replace(/\B(?=(\d{3})+(?!\d))/g,He),typeof ve=="number"&&(gn=gn.padEnd(ve,"0").slice(0,ve>0?ve:0)),gn&&(gn=`${fe}${gn}`),_t=[Oe.createElement("span",{key:"int",className:`${at}-content-value-int`},Xr,zr),gn&&Oe.createElement("span",{key:"decimal",className:`${at}-content-value-decimal`},gn)]}}return Oe.createElement("span",{className:`${at}-content-value`},_t)},De=N(14747),ge=N(56023),ht=N(45503);const ae=K=>{const{componentCls:_e,marginXXS:Y,padding:ve,colorTextDescription:fe,titleFontSize:He,colorTextHeading:at,contentFontSize:_t,fontFamily:Tt}=K;return{[`${_e}`]:Object.assign(Object.assign({},(0,De.Wf)(K)),{[`${_e}-title`]:{marginBottom:Y,color:fe,fontSize:He},[`${_e}-skeleton`]:{paddingTop:ve},[`${_e}-content`]:{color:at,fontSize:_t,fontFamily:Tt,[`${_e}-content-value`]:{display:"inline-block",direction:"ltr"},[`${_e}-content-prefix, ${_e}-content-suffix`]:{display:"inline-block"},[`${_e}-content-prefix`]:{marginInlineEnd:Y},[`${_e}-content-suffix`]:{marginInlineStart:Y}}})}},At=K=>{const{fontSizeHeading3:_e,fontSize:Y}=K;return{titleFontSize:Y,contentFontSize:_e}};var wt=(0,ge.I$)("Statistic",K=>{const _e=(0,ht.TS)(K,{});return[ae(_e)]},At),et=function(K,_e){var Y={};for(var ve in K)Object.prototype.hasOwnProperty.call(K,ve)&&_e.indexOf(ve)<0&&(Y[ve]=K[ve]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var fe=0,ve=Object.getOwnPropertySymbols(K);fe<ve.length;fe++)_e.indexOf(ve[fe])<0&&Object.prototype.propertyIsEnumerable.call(K,ve[fe])&&(Y[ve[fe]]=K[ve[fe]]);return Y},pr=K=>{const{prefixCls:_e,className:Y,rootClassName:ve,style:fe,valueStyle:He,value:at=0,title:_t,valueRender:Tt,prefix:Pt,suffix:Xr,loading:zr=!1,formatter:gn,precision:Qr,decimalSeparator:Fn=".",groupSeparator:bn=",",onMouseEnter:dn,onMouseLeave:un}=K,Qn=et(K,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:Vr,direction:Dn,statistic:Wr}=Oe.useContext(W.E_),Jr=Vr("statistic",_e),[ji,gi,Eo]=wt(Jr),$i=Oe.createElement(Ke,{decimalSeparator:Fn,groupSeparator:bn,prefixCls:Jr,formatter:gn,precision:Qr,value:at}),ue=V()(Jr,{[`${Jr}-rtl`]:Dn==="rtl"},Wr==null?void 0:Wr.className,Y,ve,gi,Eo),Xi=(0,se.Z)(Qn,{aria:!0,data:!0});return ji(Oe.createElement("div",Object.assign({},Xi,{className:ue,style:Object.assign(Object.assign({},Wr==null?void 0:Wr.style),fe),onMouseEnter:dn,onMouseLeave:un}),_t&&Oe.createElement("div",{className:`${Jr}-title`},_t),Oe.createElement(ne.Z,{paragraph:!1,loading:zr,className:`${Jr}-skeleton`},Oe.createElement("div",{style:He,className:`${Jr}-content`},Pt&&Oe.createElement("span",{className:`${Jr}-content-prefix`},Pt),Tt?Tt($i):$i,Xr&&Oe.createElement("span",{className:`${Jr}-content-suffix`},Xr)))))};const yn=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function bi(K,_e){let Y=K;const ve=/\[[^\]]*]/g,fe=(_e.match(ve)||[]).map(Tt=>Tt.slice(1,-1)),He=_e.replace(ve,"[]"),at=yn.reduce((Tt,Pt)=>{let[Xr,zr]=Pt;if(Tt.includes(Xr)){const gn=Math.floor(Y/zr);return Y-=gn*zr,Tt.replace(new RegExp(`${Xr}+`,"g"),Qr=>{const Fn=Qr.length;return gn.toString().padStart(Fn,"0")})}return Tt},He);let _t=0;return at.replace(ve,()=>{const Tt=fe[_t];return _t+=1,Tt})}function $n(K,_e){const{format:Y=""}=_e,ve=new Date(K).getTime(),fe=Date.now(),He=Math.max(ve-fe,0);return bi(He,Y)}var Mt=function(K,_e){var Y={};for(var ve in K)Object.prototype.hasOwnProperty.call(K,ve)&&_e.indexOf(ve)<0&&(Y[ve]=K[ve]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var fe=0,ve=Object.getOwnPropertySymbols(K);fe<ve.length;fe++)_e.indexOf(ve[fe])<0&&Object.prototype.propertyIsEnumerable.call(K,ve[fe])&&(Y[ve[fe]]=K[ve[fe]]);return Y};const ze=1e3/30;function Wt(K){return new Date(K).getTime()}const ct=K=>{const{value:_e,format:Y="HH:mm:ss",onChange:ve,onFinish:fe}=K,He=Mt(K,["value","format","onChange","onFinish"]),at=(0,Qe.Z)(),_t=Oe.useRef(null),Tt=()=>{fe==null||fe(),_t.current&&(clearInterval(_t.current),_t.current=null)},Pt=()=>{const gn=Wt(_e);gn>=Date.now()&&(_t.current=setInterval(()=>{at(),ve==null||ve(gn-Date.now()),gn<Date.now()&&Tt()},ze))};Oe.useEffect(()=>(Pt(),()=>{_t.current&&(clearInterval(_t.current),_t.current=null)}),[_e]);const Xr=(gn,Qr)=>$n(gn,Object.assign(Object.assign({},Qr),{format:Y})),zr=gn=>(0,v.Tm)(gn,{title:void 0});return Oe.createElement(pr,Object.assign({},He,{value:_e,valueRender:zr,formatter:Xr}))};var nr=Oe.memo(ct);pr.Countdown=nr;var Lr=pr},98129:function(hr,qt,N){"use strict";var Oe=N(60690);hr.exports=function(it){it=it||{};var V=it.reporter,se=Oe.getOption(it,"async",!0),W=Oe.getOption(it,"auto",!0);W&&!se&&(V&&V.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),se=!0);var ne=Qe(),G,Ke=!1;function De(mr,pr){!Ke&&W&&se&&ne.size()===0&&ae(),ne.add(mr,pr)}function ge(){for(Ke=!0;ne.size();){var mr=ne;ne=Qe(),mr.process()}Ke=!1}function ht(mr){Ke||(mr===void 0&&(mr=se),G&&(wt(G),G=null),mr?ae():ge())}function ae(){G=et(ge)}function At(){ne={},batchSize=0,topLevel=0,bottomLevel=0}function wt(mr){var pr=clearTimeout;return pr(mr)}function et(mr){var pr=function(yn){return setTimeout(yn,0)};return pr(mr)}return{add:De,force:ht}};function Qe(){var v={},it=0,V=0,se=0;function W(Ke,De){De||(De=Ke,Ke=0),Ke>V?V=Ke:Ke<se&&(se=Ke),v[Ke]||(v[Ke]=[]),v[Ke].push(De),it++}function ne(){for(var Ke=se;Ke<=V;Ke++)for(var De=v[Ke],ge=0;ge<De.length;ge++){var ht=De[ge];ht()}}function G(){return it}return{add:W,process:ne,size:G}}},60690:function(hr){"use strict";var qt=hr.exports={};qt.getOption=N;function N(Oe,Qe,v){var it=Oe[Qe];return it==null&&v!==void 0?v:it}},9187:function(hr){"use strict";hr.exports=qt,hr.exports.default=qt;function qt(Y,ve,fe){fe=fe||2;var He=ve&&ve.length,at=He?ve[0]*fe:Y.length,_t=N(Y,0,at,fe,!0),Tt=[];if(!_t||_t.next===_t.prev)return Tt;var Pt,Xr,zr,gn,Qr,Fn,bn;if(He&&(_t=W(Y,ve,_t,fe)),Y.length>80*fe){Pt=zr=Y[0],Xr=gn=Y[1];for(var dn=fe;dn<at;dn+=fe)Qr=Y[dn],Fn=Y[dn+1],Qr<Pt&&(Pt=Qr),Fn<Xr&&(Xr=Fn),Qr>zr&&(zr=Qr),Fn>gn&&(gn=Fn);bn=Math.max(zr-Pt,gn-Xr),bn=bn!==0?32767/bn:0}return Qe(_t,Tt,fe,Pt,Xr,bn,0),Tt}function N(Y,ve,fe,He,at){var _t,Tt;if(at===_e(Y,ve,fe,He)>0)for(_t=ve;_t<fe;_t+=He)Tt=nr(_t,Y[_t],Y[_t+1],Tt);else for(_t=fe-He;_t>=ve;_t-=He)Tt=nr(_t,Y[_t],Y[_t+1],Tt);return Tt&&pr(Tt,Tt.next)&&(Lr(Tt),Tt=Tt.next),Tt}function Oe(Y,ve){if(!Y)return Y;ve||(ve=Y);var fe=Y,He;do if(He=!1,!fe.steiner&&(pr(fe,fe.next)||mr(fe.prev,fe,fe.next)===0)){if(Lr(fe),fe=ve=fe.prev,fe===fe.next)break;He=!0}else fe=fe.next;while(He||fe!==ve);return ve}function Qe(Y,ve,fe,He,at,_t,Tt){if(Y){!Tt&&_t&&ge(Y,He,at,_t);for(var Pt=Y,Xr,zr;Y.prev!==Y.next;){if(Xr=Y.prev,zr=Y.next,_t?it(Y,He,at,_t):v(Y)){ve.push(Xr.i/fe|0),ve.push(Y.i/fe|0),ve.push(zr.i/fe|0),Lr(Y),Y=zr.next,Pt=zr.next;continue}if(Y=zr,Y===Pt){Tt?Tt===1?(Y=V(Oe(Y),ve,fe),Qe(Y,ve,fe,He,at,_t,2)):Tt===2&&se(Y,ve,fe,He,at,_t):Qe(Oe(Y),ve,fe,He,at,_t,1);break}}}}function v(Y){var ve=Y.prev,fe=Y,He=Y.next;if(mr(ve,fe,He)>=0)return!1;for(var at=ve.x,_t=fe.x,Tt=He.x,Pt=ve.y,Xr=fe.y,zr=He.y,gn=at<_t?at<Tt?at:Tt:_t<Tt?_t:Tt,Qr=Pt<Xr?Pt<zr?Pt:zr:Xr<zr?Xr:zr,Fn=at>_t?at>Tt?at:Tt:_t>Tt?_t:Tt,bn=Pt>Xr?Pt>zr?Pt:zr:Xr>zr?Xr:zr,dn=He.next;dn!==ve;){if(dn.x>=gn&&dn.x<=Fn&&dn.y>=Qr&&dn.y<=bn&&wt(at,Pt,_t,Xr,Tt,zr,dn.x,dn.y)&&mr(dn.prev,dn,dn.next)>=0)return!1;dn=dn.next}return!0}function it(Y,ve,fe,He){var at=Y.prev,_t=Y,Tt=Y.next;if(mr(at,_t,Tt)>=0)return!1;for(var Pt=at.x,Xr=_t.x,zr=Tt.x,gn=at.y,Qr=_t.y,Fn=Tt.y,bn=Pt<Xr?Pt<zr?Pt:zr:Xr<zr?Xr:zr,dn=gn<Qr?gn<Fn?gn:Fn:Qr<Fn?Qr:Fn,un=Pt>Xr?Pt>zr?Pt:zr:Xr>zr?Xr:zr,Qn=gn>Qr?gn>Fn?gn:Fn:Qr>Fn?Qr:Fn,Vr=ae(bn,dn,ve,fe,He),Dn=ae(un,Qn,ve,fe,He),Wr=Y.prevZ,Jr=Y.nextZ;Wr&&Wr.z>=Vr&&Jr&&Jr.z<=Dn;){if(Wr.x>=bn&&Wr.x<=un&&Wr.y>=dn&&Wr.y<=Qn&&Wr!==at&&Wr!==Tt&&wt(Pt,gn,Xr,Qr,zr,Fn,Wr.x,Wr.y)&&mr(Wr.prev,Wr,Wr.next)>=0||(Wr=Wr.prevZ,Jr.x>=bn&&Jr.x<=un&&Jr.y>=dn&&Jr.y<=Qn&&Jr!==at&&Jr!==Tt&&wt(Pt,gn,Xr,Qr,zr,Fn,Jr.x,Jr.y)&&mr(Jr.prev,Jr,Jr.next)>=0))return!1;Jr=Jr.nextZ}for(;Wr&&Wr.z>=Vr;){if(Wr.x>=bn&&Wr.x<=un&&Wr.y>=dn&&Wr.y<=Qn&&Wr!==at&&Wr!==Tt&&wt(Pt,gn,Xr,Qr,zr,Fn,Wr.x,Wr.y)&&mr(Wr.prev,Wr,Wr.next)>=0)return!1;Wr=Wr.prevZ}for(;Jr&&Jr.z<=Dn;){if(Jr.x>=bn&&Jr.x<=un&&Jr.y>=dn&&Jr.y<=Qn&&Jr!==at&&Jr!==Tt&&wt(Pt,gn,Xr,Qr,zr,Fn,Jr.x,Jr.y)&&mr(Jr.prev,Jr,Jr.next)>=0)return!1;Jr=Jr.nextZ}return!0}function V(Y,ve,fe){var He=Y;do{var at=He.prev,_t=He.next.next;!pr(at,_t)&&yn(at,He,He.next,_t)&&ze(at,_t)&&ze(_t,at)&&(ve.push(at.i/fe|0),ve.push(He.i/fe|0),ve.push(_t.i/fe|0),Lr(He),Lr(He.next),He=Y=_t),He=He.next}while(He!==Y);return Oe(He)}function se(Y,ve,fe,He,at,_t){var Tt=Y;do{for(var Pt=Tt.next.next;Pt!==Tt.prev;){if(Tt.i!==Pt.i&&et(Tt,Pt)){var Xr=ct(Tt,Pt);Tt=Oe(Tt,Tt.next),Xr=Oe(Xr,Xr.next),Qe(Tt,ve,fe,He,at,_t,0),Qe(Xr,ve,fe,He,at,_t,0);return}Pt=Pt.next}Tt=Tt.next}while(Tt!==Y)}function W(Y,ve,fe,He){var at=[],_t,Tt,Pt,Xr,zr;for(_t=0,Tt=ve.length;_t<Tt;_t++)Pt=ve[_t]*He,Xr=_t<Tt-1?ve[_t+1]*He:Y.length,zr=N(Y,Pt,Xr,He,!1),zr===zr.next&&(zr.steiner=!0),at.push(At(zr));for(at.sort(ne),_t=0;_t<at.length;_t++)fe=G(at[_t],fe);return fe}function ne(Y,ve){return Y.x-ve.x}function G(Y,ve){var fe=Ke(Y,ve);if(!fe)return ve;var He=ct(fe,Y);return Oe(He,He.next),Oe(fe,fe.next)}function Ke(Y,ve){var fe=ve,He=Y.x,at=Y.y,_t=-1/0,Tt;do{if(at<=fe.y&&at>=fe.next.y&&fe.next.y!==fe.y){var Pt=fe.x+(at-fe.y)*(fe.next.x-fe.x)/(fe.next.y-fe.y);if(Pt<=He&&Pt>_t&&(_t=Pt,Tt=fe.x<fe.next.x?fe:fe.next,Pt===He))return Tt}fe=fe.next}while(fe!==ve);if(!Tt)return null;var Xr=Tt,zr=Tt.x,gn=Tt.y,Qr=1/0,Fn;fe=Tt;do He>=fe.x&&fe.x>=zr&&He!==fe.x&&wt(at<gn?He:_t,at,zr,gn,at<gn?_t:He,at,fe.x,fe.y)&&(Fn=Math.abs(at-fe.y)/(He-fe.x),ze(fe,Y)&&(Fn<Qr||Fn===Qr&&(fe.x>Tt.x||fe.x===Tt.x&&De(Tt,fe)))&&(Tt=fe,Qr=Fn)),fe=fe.next;while(fe!==Xr);return Tt}function De(Y,ve){return mr(Y.prev,Y,ve.prev)<0&&mr(ve.next,Y,Y.next)<0}function ge(Y,ve,fe,He){var at=Y;do at.z===0&&(at.z=ae(at.x,at.y,ve,fe,He)),at.prevZ=at.prev,at.nextZ=at.next,at=at.next;while(at!==Y);at.prevZ.nextZ=null,at.prevZ=null,ht(at)}function ht(Y){var ve,fe,He,at,_t,Tt,Pt,Xr,zr=1;do{for(fe=Y,Y=null,_t=null,Tt=0;fe;){for(Tt++,He=fe,Pt=0,ve=0;ve<zr&&(Pt++,He=He.nextZ,!!He);ve++);for(Xr=zr;Pt>0||Xr>0&&He;)Pt!==0&&(Xr===0||!He||fe.z<=He.z)?(at=fe,fe=fe.nextZ,Pt--):(at=He,He=He.nextZ,Xr--),_t?_t.nextZ=at:Y=at,at.prevZ=_t,_t=at;fe=He}_t.nextZ=null,zr*=2}while(Tt>1);return Y}function ae(Y,ve,fe,He,at){return Y=(Y-fe)*at|0,ve=(ve-He)*at|0,Y=(Y|Y<<8)&16711935,Y=(Y|Y<<4)&252645135,Y=(Y|Y<<2)&858993459,Y=(Y|Y<<1)&1431655765,ve=(ve|ve<<8)&16711935,ve=(ve|ve<<4)&252645135,ve=(ve|ve<<2)&858993459,ve=(ve|ve<<1)&1431655765,Y|ve<<1}function At(Y){var ve=Y,fe=Y;do(ve.x<fe.x||ve.x===fe.x&&ve.y<fe.y)&&(fe=ve),ve=ve.next;while(ve!==Y);return fe}function wt(Y,ve,fe,He,at,_t,Tt,Pt){return(at-Tt)*(ve-Pt)>=(Y-Tt)*(_t-Pt)&&(Y-Tt)*(He-Pt)>=(fe-Tt)*(ve-Pt)&&(fe-Tt)*(_t-Pt)>=(at-Tt)*(He-Pt)}function et(Y,ve){return Y.next.i!==ve.i&&Y.prev.i!==ve.i&&!Mt(Y,ve)&&(ze(Y,ve)&&ze(ve,Y)&&Wt(Y,ve)&&(mr(Y.prev,Y,ve.prev)||mr(Y,ve.prev,ve))||pr(Y,ve)&&mr(Y.prev,Y,Y.next)>0&&mr(ve.prev,ve,ve.next)>0)}function mr(Y,ve,fe){return(ve.y-Y.y)*(fe.x-ve.x)-(ve.x-Y.x)*(fe.y-ve.y)}function pr(Y,ve){return Y.x===ve.x&&Y.y===ve.y}function yn(Y,ve,fe,He){var at=$n(mr(Y,ve,fe)),_t=$n(mr(Y,ve,He)),Tt=$n(mr(fe,He,Y)),Pt=$n(mr(fe,He,ve));return!!(at!==_t&&Tt!==Pt||at===0&&bi(Y,fe,ve)||_t===0&&bi(Y,He,ve)||Tt===0&&bi(fe,Y,He)||Pt===0&&bi(fe,ve,He))}function bi(Y,ve,fe){return ve.x<=Math.max(Y.x,fe.x)&&ve.x>=Math.min(Y.x,fe.x)&&ve.y<=Math.max(Y.y,fe.y)&&ve.y>=Math.min(Y.y,fe.y)}function $n(Y){return Y>0?1:Y<0?-1:0}function Mt(Y,ve){var fe=Y;do{if(fe.i!==Y.i&&fe.next.i!==Y.i&&fe.i!==ve.i&&fe.next.i!==ve.i&&yn(fe,fe.next,Y,ve))return!0;fe=fe.next}while(fe!==Y);return!1}function ze(Y,ve){return mr(Y.prev,Y,Y.next)<0?mr(Y,ve,Y.next)>=0&&mr(Y,Y.prev,ve)>=0:mr(Y,ve,Y.prev)<0||mr(Y,Y.next,ve)<0}function Wt(Y,ve){var fe=Y,He=!1,at=(Y.x+ve.x)/2,_t=(Y.y+ve.y)/2;do fe.y>_t!=fe.next.y>_t&&fe.next.y!==fe.y&&at<(fe.next.x-fe.x)*(_t-fe.y)/(fe.next.y-fe.y)+fe.x&&(He=!He),fe=fe.next;while(fe!==Y);return He}function ct(Y,ve){var fe=new K(Y.i,Y.x,Y.y),He=new K(ve.i,ve.x,ve.y),at=Y.next,_t=ve.prev;return Y.next=ve,ve.prev=Y,fe.next=at,at.prev=fe,He.next=fe,fe.prev=He,_t.next=He,He.prev=_t,He}function nr(Y,ve,fe,He){var at=new K(Y,ve,fe);return He?(at.next=He.next,at.prev=He,He.next.prev=at,He.next=at):(at.prev=at,at.next=at),at}function Lr(Y){Y.next.prev=Y.prev,Y.prev.next=Y.next,Y.prevZ&&(Y.prevZ.nextZ=Y.nextZ),Y.nextZ&&(Y.nextZ.prevZ=Y.prevZ)}function K(Y,ve,fe){this.i=Y,this.x=ve,this.y=fe,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}qt.deviation=function(Y,ve,fe,He){var at=ve&&ve.length,_t=at?ve[0]*fe:Y.length,Tt=Math.abs(_e(Y,0,_t,fe));if(at)for(var Pt=0,Xr=ve.length;Pt<Xr;Pt++){var zr=ve[Pt]*fe,gn=Pt<Xr-1?ve[Pt+1]*fe:Y.length;Tt-=Math.abs(_e(Y,zr,gn,fe))}var Qr=0;for(Pt=0;Pt<He.length;Pt+=3){var Fn=He[Pt]*fe,bn=He[Pt+1]*fe,dn=He[Pt+2]*fe;Qr+=Math.abs((Y[Fn]-Y[dn])*(Y[bn+1]-Y[Fn+1])-(Y[Fn]-Y[bn])*(Y[dn+1]-Y[Fn+1]))}return Tt===0&&Qr===0?0:Math.abs((Qr-Tt)/Tt)};function _e(Y,ve,fe,He){for(var at=0,_t=ve,Tt=fe-He;_t<fe;_t+=He)at+=(Y[Tt]-Y[_t])*(Y[_t+1]+Y[Tt+1]),Tt=_t;return at}qt.flatten=function(Y){for(var ve=Y[0][0].length,fe={vertices:[],holes:[],dimensions:ve},He=0,at=0;at<Y.length;at++){for(var _t=0;_t<Y[at].length;_t++)for(var Tt=0;Tt<ve;Tt++)fe.vertices.push(Y[at][_t][Tt]);at>0&&(He+=Y[at-1].length,fe.holes.push(He))}return fe}},2268:function(hr){"use strict";var qt=hr.exports={};qt.isIE=function(N){function Oe(){var v=navigator.userAgent.toLowerCase();return v.indexOf("msie")!==-1||v.indexOf("trident")!==-1||v.indexOf(" edge/")!==-1}if(!Oe())return!1;if(!N)return!0;var Qe=function(){var v,it=3,V=document.createElement("div"),se=V.getElementsByTagName("i");do V.innerHTML="<!--[if gt IE "+ ++it+"]><i></i><![endif]-->";while(se[0]);return it>4?it:v}();return N===Qe},qt.isLegacyOpera=function(){return!!window.opera}},17900:function(hr){"use strict";var qt=hr.exports={};qt.forEach=function(N,Oe){for(var Qe=0;Qe<N.length;Qe++){var v=Oe(N[Qe]);if(v)return v}}},58229:function(hr,qt,N){"use strict";var Oe=N(2268);hr.exports=function(Qe){Qe=Qe||{};var v=Qe.reporter,it=Qe.batchProcessor,V=Qe.stateHandler.getState;if(!v)throw new Error("Missing required dependency: reporter.");function se(De,ge){function ht(){ge(De)}if(Oe.isIE(8))V(De).object={proxy:ht},De.attachEvent("onresize",ht);else{var ae=G(De);if(!ae)throw new Error("Element is not detectable by this strategy.");ae.contentDocument.defaultView.addEventListener("resize",ht)}}function W(De){var ge=Qe.important?" !important; ":"; ";return(De.join(ge)+ge).trim()}function ne(De,ge,ht){ht||(ht=ge,ge=De,De=null),De=De||{};var ae=De.debug;function At(wt,et){var mr=W(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),pr=!1,yn=window.getComputedStyle(wt),bi=wt.offsetWidth,$n=wt.offsetHeight;V(wt).startSize={width:bi,height:$n};function Mt(){function ze(){if(yn.position==="static"){wt.style.setProperty("position","relative",De.important?"important":"");var nr=function(Lr,K,_e,Y){function ve(He){return He.replace(/[^-\d\.]/g,"")}var fe=_e[Y];fe!=="auto"&&ve(fe)!=="0"&&(Lr.warn("An element that is positioned static has style."+Y+"="+fe+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+Y+" will be set to 0. Element: ",K),K.style.setProperty(Y,"0",De.important?"important":""))};nr(v,wt,yn,"top"),nr(v,wt,yn,"right"),nr(v,wt,yn,"bottom"),nr(v,wt,yn,"left")}}function Wt(){pr||ze();function nr(K,_e){if(!K.contentDocument){var Y=V(K);Y.checkForObjectDocumentTimeoutId&&window.clearTimeout(Y.checkForObjectDocumentTimeoutId),Y.checkForObjectDocumentTimeoutId=setTimeout(function(){Y.checkForObjectDocumentTimeoutId=0,nr(K,_e)},100);return}_e(K.contentDocument)}var Lr=this;nr(Lr,function(_e){et(wt)})}yn.position!==""&&(ze(yn),pr=!0);var ct=document.createElement("object");ct.style.cssText=mr,ct.tabIndex=-1,ct.type="text/html",ct.setAttribute("aria-hidden","true"),ct.onload=Wt,Oe.isIE()||(ct.data="about:blank"),V(wt)&&(wt.appendChild(ct),V(wt).object=ct,Oe.isIE()&&(ct.data="about:blank"))}it?it.add(Mt):Mt()}Oe.isIE(8)?ht(ge):At(ge,ht)}function G(De){return V(De).object}function Ke(De){if(V(De)){var ge=G(De);ge&&(Oe.isIE(8)?De.detachEvent("onresize",ge.proxy):De.removeChild(ge),V(De).checkForObjectDocumentTimeoutId&&window.clearTimeout(V(De).checkForObjectDocumentTimeoutId),delete V(De).object)}}return{makeDetectable:ne,addListener:se,uninstall:Ke}}},60787:function(hr,qt,N){"use strict";var Oe=N(17900).forEach;hr.exports=function(Qe){Qe=Qe||{};var v=Qe.reporter,it=Qe.batchProcessor,V=Qe.stateHandler.getState,se=Qe.stateHandler.hasState,W=Qe.idHandler;if(!it)throw new Error("Missing required dependency: batchProcessor");if(!v)throw new Error("Missing required dependency: reporter.");var ne=ht(),G="erd_scroll_detection_scrollbar_style",Ke="erd_scroll_detection_container";function De(Mt){ae(Mt,G,Ke)}De(window.document);function ge(Mt){var ze=Qe.important?" !important; ":"; ";return(Mt.join(ze)+ze).trim()}function ht(){var Mt=500,ze=500,Wt=document.createElement("div");Wt.style.cssText=ge(["position: absolute","width: "+Mt*2+"px","height: "+ze*2+"px","visibility: hidden","margin: 0","padding: 0"]);var ct=document.createElement("div");ct.style.cssText=ge(["position: absolute","width: "+Mt+"px","height: "+ze+"px","overflow: scroll","visibility: none","top: "+-Mt*3+"px","left: "+-ze*3+"px","visibility: hidden","margin: 0","padding: 0"]),ct.appendChild(Wt),document.body.insertBefore(ct,document.body.firstChild);var nr=Mt-ct.clientWidth,Lr=ze-ct.clientHeight;return document.body.removeChild(ct),{width:nr,height:Lr}}function ae(Mt,ze,Wt){function ct(_e,Y){Y=Y||function(fe){Mt.head.appendChild(fe)};var ve=Mt.createElement("style");return ve.innerHTML=_e,ve.id=ze,Y(ve),ve}if(!Mt.getElementById(ze)){var nr=Wt+"_animation",Lr=Wt+"_animation_active",K=`/* Created by the element-resize-detector library. */
`;K+="."+Wt+" > div::-webkit-scrollbar { "+ge(["display: none"])+` }

`,K+="."+Lr+" { "+ge(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+nr,"animation-name: "+nr])+` }
`,K+="@-webkit-keyframes "+nr+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,K+="@keyframes "+nr+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",ct(K)}}function At(Mt){Mt.className+=" "+Ke+"_animation_active"}function wt(Mt,ze,Wt){if(Mt.addEventListener)Mt.addEventListener(ze,Wt);else if(Mt.attachEvent)Mt.attachEvent("on"+ze,Wt);else return v.error("[scroll] Don't know how to add event listeners.")}function et(Mt,ze,Wt){if(Mt.removeEventListener)Mt.removeEventListener(ze,Wt);else if(Mt.detachEvent)Mt.detachEvent("on"+ze,Wt);else return v.error("[scroll] Don't know how to remove event listeners.")}function mr(Mt){return V(Mt).container.childNodes[0].childNodes[0].childNodes[0]}function pr(Mt){return V(Mt).container.childNodes[0].childNodes[0].childNodes[1]}function yn(Mt,ze){var Wt=V(Mt).listeners;if(!Wt.push)throw new Error("Cannot add listener to an element that is not detectable.");V(Mt).listeners.push(ze)}function bi(Mt,ze,Wt){Wt||(Wt=ze,ze=Mt,Mt=null),Mt=Mt||{};function ct(){if(Mt.debug){var Vr=Array.prototype.slice.call(arguments);if(Vr.unshift(W.get(ze),"Scroll: "),v.log.apply)v.log.apply(null,Vr);else for(var Dn=0;Dn<Vr.length;Dn++)v.log(Vr[Dn])}}function nr(Vr){function Dn(Wr){var Jr=Wr.getRootNode&&Wr.getRootNode().contains(Wr);return Wr===Wr.ownerDocument.body||Wr.ownerDocument.body.contains(Wr)||Jr}return!Dn(Vr)||window.getComputedStyle(Vr)===null}function Lr(Vr){var Dn=V(Vr).container.childNodes[0],Wr=window.getComputedStyle(Dn);return!Wr.width||Wr.width.indexOf("px")===-1}function K(){var Vr=window.getComputedStyle(ze),Dn={};return Dn.position=Vr.position,Dn.width=ze.offsetWidth,Dn.height=ze.offsetHeight,Dn.top=Vr.top,Dn.right=Vr.right,Dn.bottom=Vr.bottom,Dn.left=Vr.left,Dn.widthCSS=Vr.width,Dn.heightCSS=Vr.height,Dn}function _e(){var Vr=K();V(ze).startSize={width:Vr.width,height:Vr.height},ct("Element start size",V(ze).startSize)}function Y(){V(ze).listeners=[]}function ve(){if(ct("storeStyle invoked."),!V(ze)){ct("Aborting because element has been uninstalled");return}var Vr=K();V(ze).style=Vr}function fe(Vr,Dn,Wr){V(Vr).lastWidth=Dn,V(Vr).lastHeight=Wr}function He(Vr){return mr(Vr).childNodes[0]}function at(){return 2*ne.width+1}function _t(){return 2*ne.height+1}function Tt(Vr){return Vr+10+at()}function Pt(Vr){return Vr+10+_t()}function Xr(Vr){return Vr*2+at()}function zr(Vr){return Vr*2+_t()}function gn(Vr,Dn,Wr){var Jr=mr(Vr),ji=pr(Vr),gi=Tt(Dn),Eo=Pt(Wr),$i=Xr(Dn),ue=zr(Wr);Jr.scrollLeft=gi,Jr.scrollTop=Eo,ji.scrollLeft=$i,ji.scrollTop=ue}function Qr(){var Vr=V(ze).container;if(!Vr){Vr=document.createElement("div"),Vr.className=Ke,Vr.style.cssText=ge(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),V(ze).container=Vr,At(Vr),ze.appendChild(Vr);var Dn=function(){V(ze).onRendered&&V(ze).onRendered()};wt(Vr,"animationstart",Dn),V(ze).onAnimationStart=Dn}return Vr}function Fn(){function Vr(){var fo=V(ze).style;if(fo.position==="static"){ze.style.setProperty("position","relative",Mt.important?"important":"");var ho=function(pt,Z,Q,Ee){function Ve(jt){return jt.replace(/[^-\d\.]/g,"")}var Le=Q[Ee];Le!=="auto"&&Ve(Le)!=="0"&&(pt.warn("An element that is positioned static has style."+Ee+"="+Le+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+Ee+" will be set to 0. Element: ",Z),Z.style[Ee]=0)};ho(v,ze,fo,"top"),ho(v,ze,fo,"right"),ho(v,ze,fo,"bottom"),ho(v,ze,fo,"left")}}function Dn(fo,ho,pt,Z){return fo=fo?fo+"px":"0",ho=ho?ho+"px":"0",pt=pt?pt+"px":"0",Z=Z?Z+"px":"0",["left: "+fo,"top: "+ho,"right: "+Z,"bottom: "+pt]}if(ct("Injecting elements"),!V(ze)){ct("Aborting because element has been uninstalled");return}Vr();var Wr=V(ze).container;Wr||(Wr=Qr());var Jr=ne.width,ji=ne.height,gi=ge(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),Eo=ge(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(Dn(-(1+Jr),-(1+ji),-ji,-Jr))),$i=ge(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),ue=ge(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),Xi=ge(["position: absolute","left: 0","top: 0"]),co=ge(["position: absolute","width: 200%","height: 200%"]),bo=document.createElement("div"),Sa=document.createElement("div"),da=document.createElement("div"),Ds=document.createElement("div"),Xo=document.createElement("div"),Xs=document.createElement("div");bo.dir="ltr",bo.style.cssText=gi,bo.className=Ke,Sa.className=Ke,Sa.style.cssText=Eo,da.style.cssText=$i,Ds.style.cssText=Xi,Xo.style.cssText=ue,Xs.style.cssText=co,da.appendChild(Ds),Xo.appendChild(Xs),Sa.appendChild(da),Sa.appendChild(Xo),bo.appendChild(Sa),Wr.appendChild(bo);function vu(){var fo=V(ze);fo&&fo.onExpand?fo.onExpand():ct("Aborting expand scroll handler: element has been uninstalled")}function Vo(){var fo=V(ze);fo&&fo.onShrink?fo.onShrink():ct("Aborting shrink scroll handler: element has been uninstalled")}wt(da,"scroll",vu),wt(Xo,"scroll",Vo),V(ze).onExpandScroll=vu,V(ze).onShrinkScroll=Vo}function bn(){function Vr($i,ue,Xi){var co=He($i),bo=Tt(ue),Sa=Pt(Xi);co.style.setProperty("width",bo+"px",Mt.important?"important":""),co.style.setProperty("height",Sa+"px",Mt.important?"important":"")}function Dn($i){var ue=ze.offsetWidth,Xi=ze.offsetHeight,co=ue!==V(ze).lastWidth||Xi!==V(ze).lastHeight;ct("Storing current size",ue,Xi),fe(ze,ue,Xi),it.add(0,function(){if(co){if(!V(ze)){ct("Aborting because element has been uninstalled");return}if(!Wr()){ct("Aborting because element container has not been initialized");return}if(Mt.debug){var Sa=ze.offsetWidth,da=ze.offsetHeight;(Sa!==ue||da!==Xi)&&v.warn(W.get(ze),"Scroll: Size changed before updating detector elements.")}Vr(ze,ue,Xi)}}),it.add(1,function(){if(!V(ze)){ct("Aborting because element has been uninstalled");return}if(!Wr()){ct("Aborting because element container has not been initialized");return}gn(ze,ue,Xi)}),co&&$i&&it.add(2,function(){if(!V(ze)){ct("Aborting because element has been uninstalled");return}if(!Wr()){ct("Aborting because element container has not been initialized");return}$i()})}function Wr(){return!!V(ze).container}function Jr(){function $i(){return V(ze).lastNotifiedWidth===void 0}ct("notifyListenersIfNeeded invoked");var ue=V(ze);if($i()&&ue.lastWidth===ue.startSize.width&&ue.lastHeight===ue.startSize.height)return ct("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(ue.lastWidth===ue.lastNotifiedWidth&&ue.lastHeight===ue.lastNotifiedHeight)return ct("Not notifying: Size already notified");ct("Current size not notified, notifying..."),ue.lastNotifiedWidth=ue.lastWidth,ue.lastNotifiedHeight=ue.lastHeight,Oe(V(ze).listeners,function(Xi){Xi(ze)})}function ji(){if(ct("startanimation triggered."),Lr(ze)){ct("Ignoring since element is still unrendered...");return}ct("Element rendered.");var $i=mr(ze),ue=pr(ze);($i.scrollLeft===0||$i.scrollTop===0||ue.scrollLeft===0||ue.scrollTop===0)&&(ct("Scrollbars out of sync. Updating detector elements..."),Dn(Jr))}function gi(){if(ct("Scroll detected."),Lr(ze)){ct("Scroll event fired while unrendered. Ignoring...");return}Dn(Jr)}if(ct("registerListenersAndPositionElements invoked."),!V(ze)){ct("Aborting because element has been uninstalled");return}V(ze).onRendered=ji,V(ze).onExpand=gi,V(ze).onShrink=gi;var Eo=V(ze).style;Vr(ze,Eo.width,Eo.height)}function dn(){if(ct("finalizeDomMutation invoked."),!V(ze)){ct("Aborting because element has been uninstalled");return}var Vr=V(ze).style;fe(ze,Vr.width,Vr.height),gn(ze,Vr.width,Vr.height)}function un(){Wt(ze)}function Qn(){ct("Installing..."),Y(),_e(),it.add(0,ve),it.add(1,Fn),it.add(2,bn),it.add(3,dn),it.add(4,un)}ct("Making detectable..."),nr(ze)?(ct("Element is detached"),Qr(),ct("Waiting until element is attached..."),V(ze).onRendered=function(){ct("Element is now attached"),Qn()}):Qn()}function $n(Mt){var ze=V(Mt);ze&&(ze.onExpandScroll&&et(mr(Mt),"scroll",ze.onExpandScroll),ze.onShrinkScroll&&et(pr(Mt),"scroll",ze.onShrinkScroll),ze.onAnimationStart&&et(ze.container,"animationstart",ze.onAnimationStart),ze.container&&Mt.removeChild(ze.container))}return{makeDetectable:bi,addListener:yn,uninstall:$n,initDocument:De}}},63844:function(hr,qt,N){"use strict";var Oe=N(17900).forEach,Qe=N(68452),v=N(96199),it=N(75805),V=N(79799),se=N(71724),W=N(2268),ne=N(98129),G=N(21931),Ke=N(58229),De=N(60787);function ge(wt){return Array.isArray(wt)||wt.length!==void 0}function ht(wt){if(Array.isArray(wt))return wt;var et=[];return Oe(wt,function(mr){et.push(mr)}),et}function ae(wt){return wt&&wt.nodeType===1}hr.exports=function(wt){wt=wt||{};var et;if(wt.idHandler)et={get:function(He){return wt.idHandler.get(He,!0)},set:wt.idHandler.set};else{var mr=it(),pr=V({idGenerator:mr,stateHandler:G});et=pr}var yn=wt.reporter;if(!yn){var bi=yn===!1;yn=se(bi)}var $n=At(wt,"batchProcessor",ne({reporter:yn})),Mt={};Mt.callOnAdd=!!At(wt,"callOnAdd",!0),Mt.debug=!!At(wt,"debug",!1);var ze=v(et),Wt=Qe({stateHandler:G}),ct,nr=At(wt,"strategy","object"),Lr=At(wt,"important",!1),K={reporter:yn,batchProcessor:$n,stateHandler:G,idHandler:et,important:Lr};if(nr==="scroll"&&(W.isLegacyOpera()?(yn.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),nr="object"):W.isIE(9)&&(yn.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),nr="object")),nr==="scroll")ct=De(K);else if(nr==="object")ct=Ke(K);else throw new Error("Invalid strategy name: "+nr);var _e={};function Y(He,at,_t){function Tt(Fn){var bn=ze.get(Fn);Oe(bn,function(un){un(Fn)})}function Pt(Fn,bn,dn){ze.add(bn,dn),Fn&&dn(bn)}if(_t||(_t=at,at=He,He={}),!at)throw new Error("At least one element required.");if(!_t)throw new Error("Listener required.");if(ae(at))at=[at];else if(ge(at))at=ht(at);else return yn.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var Xr=0,zr=At(He,"callOnAdd",Mt.callOnAdd),gn=At(He,"onReady",function(){}),Qr=At(He,"debug",Mt.debug);Oe(at,function(bn){G.getState(bn)||(G.initState(bn),et.set(bn));var dn=et.get(bn);if(Qr&&yn.log("Attaching listener to element",dn,bn),!Wt.isDetectable(bn)){if(Qr&&yn.log(dn,"Not detectable."),Wt.isBusy(bn)){Qr&&yn.log(dn,"System busy making it detectable"),Pt(zr,bn,_t),_e[dn]=_e[dn]||[],_e[dn].push(function(){Xr++,Xr===at.length&&gn()});return}return Qr&&yn.log(dn,"Making detectable..."),Wt.markBusy(bn,!0),ct.makeDetectable({debug:Qr,important:Lr},bn,function(Qn){if(Qr&&yn.log(dn,"onElementDetectable"),G.getState(Qn)){Wt.markAsDetectable(Qn),Wt.markBusy(Qn,!1),ct.addListener(Qn,Tt),Pt(zr,Qn,_t);var Vr=G.getState(Qn);if(Vr&&Vr.startSize){var Dn=Qn.offsetWidth,Wr=Qn.offsetHeight;(Vr.startSize.width!==Dn||Vr.startSize.height!==Wr)&&Tt(Qn)}_e[dn]&&Oe(_e[dn],function(Jr){Jr()})}else Qr&&yn.log(dn,"Element uninstalled before being detectable.");delete _e[dn],Xr++,Xr===at.length&&gn()})}Qr&&yn.log(dn,"Already detecable, adding listener."),Pt(zr,bn,_t),Xr++}),Xr===at.length&&gn()}function ve(He){if(!He)return yn.error("At least one element is required.");if(ae(He))He=[He];else if(ge(He))He=ht(He);else return yn.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");Oe(He,function(at){ze.removeAllListeners(at),ct.uninstall(at),G.cleanState(at)})}function fe(He){ct.initDocument&&ct.initDocument(He)}return{listenTo:Y,removeListener:ze.removeListener,removeAllListeners:ze.removeAllListeners,uninstall:ve,initDocument:fe}};function At(wt,et,mr){var pr=wt[et];return pr==null&&mr!==void 0?mr:pr}},68452:function(hr){"use strict";hr.exports=function(qt){var N=qt.stateHandler.getState;function Oe(V){var se=N(V);return se&&!!se.isDetectable}function Qe(V){N(V).isDetectable=!0}function v(V){return!!N(V).busy}function it(V,se){N(V).busy=!!se}return{isDetectable:Oe,markAsDetectable:Qe,isBusy:v,markBusy:it}}},75805:function(hr){"use strict";hr.exports=function(){var qt=1;function N(){return qt++}return{generate:N}}},79799:function(hr){"use strict";hr.exports=function(qt){var N=qt.idGenerator,Oe=qt.stateHandler.getState;function Qe(it){var V=Oe(it);return V&&V.id!==void 0?V.id:null}function v(it){var V=Oe(it);if(!V)throw new Error("setId required the element to have a resize detection state.");var se=N.generate();return V.id=se,se}return{get:Qe,set:v}}},96199:function(hr){"use strict";hr.exports=function(qt){var N={};function Oe(V){var se=qt.get(V);return se===void 0?[]:N[se]||[]}function Qe(V,se){var W=qt.get(V);N[W]||(N[W]=[]),N[W].push(se)}function v(V,se){for(var W=Oe(V),ne=0,G=W.length;ne<G;++ne)if(W[ne]===se){W.splice(ne,1);break}}function it(V){var se=Oe(V);se&&(se.length=0)}return{get:Oe,add:Qe,removeListener:v,removeAllListeners:it}}},71724:function(hr){"use strict";hr.exports=function(qt){function N(){}var Oe={log:N,warn:N,error:N};if(!qt&&window.console){var Qe=function(v,it){v[it]=function(){var se=console[it];if(se.apply)se.apply(console,arguments);else for(var W=0;W<arguments.length;W++)se(arguments[W])}};Qe(Oe,"log"),Qe(Oe,"warn"),Qe(Oe,"error")}return Oe}},21931:function(hr){"use strict";var qt="_erd";function N(v){return v[qt]={},Oe(v)}function Oe(v){return v[qt]}function Qe(v){delete v[qt]}hr.exports={initState:N,getState:Oe,cleanState:Qe}},50840:function(hr,qt,N){var Oe;(function(Qe,v,it,V){"use strict";var se=["","webkit","Moz","MS","ms","o"],W=v.createElement("div"),ne="function",G=Math.round,Ke=Math.abs,De=Date.now;function ge(ie,ye,Je){return setTimeout(yn(ie,Je),ye)}function ht(ie,ye,Je){return Array.isArray(ie)?(ae(ie,Je[ye],Je),!0):!1}function ae(ie,ye,Je){var Gt;if(ie)if(ie.forEach)ie.forEach(ye,Je);else if(ie.length!==V)for(Gt=0;Gt<ie.length;)ye.call(Je,ie[Gt],Gt,ie),Gt++;else for(Gt in ie)ie.hasOwnProperty(Gt)&&ye.call(Je,ie[Gt],Gt,ie)}function At(ie,ye,Je){var Gt="DEPRECATED METHOD: "+ye+`
`+Je+` AT 
`;return function(){var Er=new Error("get-stack-trace"),mn=Er&&Er.stack?Er.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ci=Qe.console&&(Qe.console.warn||Qe.console.log);return Ci&&Ci.call(Qe.console,Gt,mn),ie.apply(this,arguments)}}var wt;typeof Object.assign!="function"?wt=function(ye){if(ye===V||ye===null)throw new TypeError("Cannot convert undefined or null to object");for(var Je=Object(ye),Gt=1;Gt<arguments.length;Gt++){var Er=arguments[Gt];if(Er!==V&&Er!==null)for(var mn in Er)Er.hasOwnProperty(mn)&&(Je[mn]=Er[mn])}return Je}:wt=Object.assign;var et=At(function(ye,Je,Gt){for(var Er=Object.keys(Je),mn=0;mn<Er.length;)(!Gt||Gt&&ye[Er[mn]]===V)&&(ye[Er[mn]]=Je[Er[mn]]),mn++;return ye},"extend","Use `assign`."),mr=At(function(ye,Je){return et(ye,Je,!0)},"merge","Use `assign`.");function pr(ie,ye,Je){var Gt=ye.prototype,Er;Er=ie.prototype=Object.create(Gt),Er.constructor=ie,Er._super=Gt,Je&&wt(Er,Je)}function yn(ie,ye){return function(){return ie.apply(ye,arguments)}}function bi(ie,ye){return typeof ie==ne?ie.apply(ye&&ye[0]||V,ye):ie}function $n(ie,ye){return ie===V?ye:ie}function Mt(ie,ye,Je){ae(nr(ye),function(Gt){ie.addEventListener(Gt,Je,!1)})}function ze(ie,ye,Je){ae(nr(ye),function(Gt){ie.removeEventListener(Gt,Je,!1)})}function Wt(ie,ye){for(;ie;){if(ie==ye)return!0;ie=ie.parentNode}return!1}function ct(ie,ye){return ie.indexOf(ye)>-1}function nr(ie){return ie.trim().split(/\s+/g)}function Lr(ie,ye,Je){if(ie.indexOf&&!Je)return ie.indexOf(ye);for(var Gt=0;Gt<ie.length;){if(Je&&ie[Gt][Je]==ye||!Je&&ie[Gt]===ye)return Gt;Gt++}return-1}function K(ie){return Array.prototype.slice.call(ie,0)}function _e(ie,ye,Je){for(var Gt=[],Er=[],mn=0;mn<ie.length;){var Ci=ye?ie[mn][ye]:ie[mn];Lr(Er,Ci)<0&&Gt.push(ie[mn]),Er[mn]=Ci,mn++}return Je&&(ye?Gt=Gt.sort(function(ia,qo){return ia[ye]>qo[ye]}):Gt=Gt.sort()),Gt}function Y(ie,ye){for(var Je,Gt,Er=ye[0].toUpperCase()+ye.slice(1),mn=0;mn<se.length;){if(Je=se[mn],Gt=Je?Je+Er:ye,Gt in ie)return Gt;mn++}return V}var ve=1;function fe(){return ve++}function He(ie){var ye=ie.ownerDocument||ie;return ye.defaultView||ye.parentWindow||Qe}var at=/mobile|tablet|ip(ad|hone|od)|android/i,_t="ontouchstart"in Qe,Tt=Y(Qe,"PointerEvent")!==V,Pt=_t&&at.test(navigator.userAgent),Xr="touch",zr="pen",gn="mouse",Qr="kinect",Fn=25,bn=1,dn=2,un=4,Qn=8,Vr=1,Dn=2,Wr=4,Jr=8,ji=16,gi=Dn|Wr,Eo=Jr|ji,$i=gi|Eo,ue=["x","y"],Xi=["clientX","clientY"];function co(ie,ye){var Je=this;this.manager=ie,this.callback=ye,this.element=ie.element,this.target=ie.options.inputTarget,this.domHandler=function(Gt){bi(ie.options.enable,[ie])&&Je.handler(Gt)},this.init()}co.prototype={handler:function(){},init:function(){this.evEl&&Mt(this.element,this.evEl,this.domHandler),this.evTarget&&Mt(this.target,this.evTarget,this.domHandler),this.evWin&&Mt(He(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ze(this.element,this.evEl,this.domHandler),this.evTarget&&ze(this.target,this.evTarget,this.domHandler),this.evWin&&ze(He(this.element),this.evWin,this.domHandler)}};function bo(ie){var ye,Je=ie.options.inputClass;return Je?ye=Je:Tt?ye=O:Pt?ye=ut:_t?ye=tr:ye=jt,new ye(ie,Sa)}function Sa(ie,ye,Je){var Gt=Je.pointers.length,Er=Je.changedPointers.length,mn=ye&bn&&Gt-Er===0,Ci=ye&(un|Qn)&&Gt-Er===0;Je.isFirst=!!mn,Je.isFinal=!!Ci,mn&&(ie.session={}),Je.eventType=ye,da(ie,Je),ie.emit("hammer.input",Je),ie.recognize(Je),ie.session.prevInput=Je}function da(ie,ye){var Je=ie.session,Gt=ye.pointers,Er=Gt.length;Je.firstInput||(Je.firstInput=Xs(ye)),Er>1&&!Je.firstMultiple?Je.firstMultiple=Xs(ye):Er===1&&(Je.firstMultiple=!1);var mn=Je.firstInput,Ci=Je.firstMultiple,Yo=Ci?Ci.center:mn.center,ia=ye.center=vu(Gt);ye.timeStamp=De(),ye.deltaTime=ye.timeStamp-mn.timeStamp,ye.angle=pt(Yo,ia),ye.distance=ho(Yo,ia),Ds(Je,ye),ye.offsetDirection=fo(ye.deltaX,ye.deltaY);var qo=Vo(ye.deltaTime,ye.deltaX,ye.deltaY);ye.overallVelocityX=qo.x,ye.overallVelocityY=qo.y,ye.overallVelocity=Ke(qo.x)>Ke(qo.y)?qo.x:qo.y,ye.scale=Ci?Q(Ci.pointers,Gt):1,ye.rotation=Ci?Z(Ci.pointers,Gt):0,ye.maxPointers=Je.prevInput?ye.pointers.length>Je.prevInput.maxPointers?ye.pointers.length:Je.prevInput.maxPointers:ye.pointers.length,Xo(Je,ye);var _s=ie.element;Wt(ye.srcEvent.target,_s)&&(_s=ye.srcEvent.target),ye.target=_s}function Ds(ie,ye){var Je=ye.center,Gt=ie.offsetDelta||{},Er=ie.prevDelta||{},mn=ie.prevInput||{};(ye.eventType===bn||mn.eventType===un)&&(Er=ie.prevDelta={x:mn.deltaX||0,y:mn.deltaY||0},Gt=ie.offsetDelta={x:Je.x,y:Je.y}),ye.deltaX=Er.x+(Je.x-Gt.x),ye.deltaY=Er.y+(Je.y-Gt.y)}function Xo(ie,ye){var Je=ie.lastInterval||ye,Gt=ye.timeStamp-Je.timeStamp,Er,mn,Ci,Yo;if(ye.eventType!=Qn&&(Gt>Fn||Je.velocity===V)){var ia=ye.deltaX-Je.deltaX,qo=ye.deltaY-Je.deltaY,_s=Vo(Gt,ia,qo);mn=_s.x,Ci=_s.y,Er=Ke(_s.x)>Ke(_s.y)?_s.x:_s.y,Yo=fo(ia,qo),ie.lastInterval=ye}else Er=Je.velocity,mn=Je.velocityX,Ci=Je.velocityY,Yo=Je.direction;ye.velocity=Er,ye.velocityX=mn,ye.velocityY=Ci,ye.direction=Yo}function Xs(ie){for(var ye=[],Je=0;Je<ie.pointers.length;)ye[Je]={clientX:G(ie.pointers[Je].clientX),clientY:G(ie.pointers[Je].clientY)},Je++;return{timeStamp:De(),pointers:ye,center:vu(ye),deltaX:ie.deltaX,deltaY:ie.deltaY}}function vu(ie){var ye=ie.length;if(ye===1)return{x:G(ie[0].clientX),y:G(ie[0].clientY)};for(var Je=0,Gt=0,Er=0;Er<ye;)Je+=ie[Er].clientX,Gt+=ie[Er].clientY,Er++;return{x:G(Je/ye),y:G(Gt/ye)}}function Vo(ie,ye,Je){return{x:ye/ie||0,y:Je/ie||0}}function fo(ie,ye){return ie===ye?Vr:Ke(ie)>=Ke(ye)?ie<0?Dn:Wr:ye<0?Jr:ji}function ho(ie,ye,Je){Je||(Je=ue);var Gt=ye[Je[0]]-ie[Je[0]],Er=ye[Je[1]]-ie[Je[1]];return Math.sqrt(Gt*Gt+Er*Er)}function pt(ie,ye,Je){Je||(Je=ue);var Gt=ye[Je[0]]-ie[Je[0]],Er=ye[Je[1]]-ie[Je[1]];return Math.atan2(Er,Gt)*180/Math.PI}function Z(ie,ye){return pt(ye[1],ye[0],Xi)+pt(ie[1],ie[0],Xi)}function Q(ie,ye){return ho(ye[0],ye[1],Xi)/ho(ie[0],ie[1],Xi)}var Ee={mousedown:bn,mousemove:dn,mouseup:un},Ve="mousedown",Le="mousemove mouseup";function jt(){this.evEl=Ve,this.evWin=Le,this.pressed=!1,co.apply(this,arguments)}pr(jt,co,{handler:function(ye){var Je=Ee[ye.type];Je&bn&&ye.button===0&&(this.pressed=!0),Je&dn&&ye.which!==1&&(Je=un),this.pressed&&(Je&un&&(this.pressed=!1),this.callback(this.manager,Je,{pointers:[ye],changedPointers:[ye],pointerType:gn,srcEvent:ye}))}});var Zt={pointerdown:bn,pointermove:dn,pointerup:un,pointercancel:Qn,pointerout:Qn},ur={2:Xr,3:zr,4:gn,5:Qr},Ft="pointerdown",L="pointermove pointerup pointercancel";Qe.MSPointerEvent&&!Qe.PointerEvent&&(Ft="MSPointerDown",L="MSPointerMove MSPointerUp MSPointerCancel");function O(){this.evEl=Ft,this.evWin=L,co.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pr(O,co,{handler:function(ye){var Je=this.store,Gt=!1,Er=ye.type.toLowerCase().replace("ms",""),mn=Zt[Er],Ci=ur[ye.pointerType]||ye.pointerType,Yo=Ci==Xr,ia=Lr(Je,ye.pointerId,"pointerId");mn&bn&&(ye.button===0||Yo)?ia<0&&(Je.push(ye),ia=Je.length-1):mn&(un|Qn)&&(Gt=!0),!(ia<0)&&(Je[ia]=ye,this.callback(this.manager,mn,{pointers:Je,changedPointers:[ye],pointerType:Ci,srcEvent:ye}),Gt&&Je.splice(ia,1))}});var j={touchstart:bn,touchmove:dn,touchend:un,touchcancel:Qn},$="touchstart",de="touchstart touchmove touchend touchcancel";function Ie(){this.evTarget=$,this.evWin=de,this.started=!1,co.apply(this,arguments)}pr(Ie,co,{handler:function(ye){var Je=j[ye.type];if(Je===bn&&(this.started=!0),!!this.started){var Gt=Ze.call(this,ye,Je);Je&(un|Qn)&&Gt[0].length-Gt[1].length===0&&(this.started=!1),this.callback(this.manager,Je,{pointers:Gt[0],changedPointers:Gt[1],pointerType:Xr,srcEvent:ye})}}});function Ze(ie,ye){var Je=K(ie.touches),Gt=K(ie.changedTouches);return ye&(un|Qn)&&(Je=_e(Je.concat(Gt),"identifier",!0)),[Je,Gt]}var ee={touchstart:bn,touchmove:dn,touchend:un,touchcancel:Qn},be="touchstart touchmove touchend touchcancel";function ut(){this.evTarget=be,this.targetIds={},co.apply(this,arguments)}pr(ut,co,{handler:function(ye){var Je=ee[ye.type],Gt=Dt.call(this,ye,Je);Gt&&this.callback(this.manager,Je,{pointers:Gt[0],changedPointers:Gt[1],pointerType:Xr,srcEvent:ye})}});function Dt(ie,ye){var Je=K(ie.touches),Gt=this.targetIds;if(ye&(bn|dn)&&Je.length===1)return Gt[Je[0].identifier]=!0,[Je,Je];var Er,mn,Ci=K(ie.changedTouches),Yo=[],ia=this.target;if(mn=Je.filter(function(qo){return Wt(qo.target,ia)}),ye===bn)for(Er=0;Er<mn.length;)Gt[mn[Er].identifier]=!0,Er++;for(Er=0;Er<Ci.length;)Gt[Ci[Er].identifier]&&Yo.push(Ci[Er]),ye&(un|Qn)&&delete Gt[Ci[Er].identifier],Er++;if(Yo.length)return[_e(mn.concat(Yo),"identifier",!0),Yo]}var ir=2500,Ct=25;function tr(){co.apply(this,arguments);var ie=yn(this.handler,this);this.touch=new ut(this.manager,ie),this.mouse=new jt(this.manager,ie),this.primaryTouch=null,this.lastTouches=[]}pr(tr,co,{handler:function(ye,Je,Gt){var Er=Gt.pointerType==Xr,mn=Gt.pointerType==gn;if(!(mn&&Gt.sourceCapabilities&&Gt.sourceCapabilities.firesTouchEvents)){if(Er)Br.call(this,Je,Gt);else if(mn&&Bt.call(this,Gt))return;this.callback(ye,Je,Gt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Br(ie,ye){ie&bn?(this.primaryTouch=ye.changedPointers[0].identifier,Nr.call(this,ye)):ie&(un|Qn)&&Nr.call(this,ye)}function Nr(ie){var ye=ie.changedPointers[0];if(ye.identifier===this.primaryTouch){var Je={x:ye.clientX,y:ye.clientY};this.lastTouches.push(Je);var Gt=this.lastTouches,Er=function(){var mn=Gt.indexOf(Je);mn>-1&&Gt.splice(mn,1)};setTimeout(Er,ir)}}function Bt(ie){for(var ye=ie.srcEvent.clientX,Je=ie.srcEvent.clientY,Gt=0;Gt<this.lastTouches.length;Gt++){var Er=this.lastTouches[Gt],mn=Math.abs(ye-Er.x),Ci=Math.abs(Je-Er.y);if(mn<=Ct&&Ci<=Ct)return!0}return!1}var Fr=Y(W.style,"touchAction"),Cr=Fr!==V,Ir="compute",Zn="auto",Gr="manipulation",Kn="none",Di="pan-x",oi="pan-y",Ti=Ni();function di(ie,ye){this.manager=ie,this.set(ye)}di.prototype={set:function(ie){ie==Ir&&(ie=this.compute()),Cr&&this.manager.element.style&&Ti[ie]&&(this.manager.element.style[Fr]=ie),this.actions=ie.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ie=[];return ae(this.manager.recognizers,function(ye){bi(ye.options.enable,[ye])&&(ie=ie.concat(ye.getTouchAction()))}),Aa(ie.join(" "))},preventDefaults:function(ie){var ye=ie.srcEvent,Je=ie.offsetDirection;if(this.manager.session.prevented){ye.preventDefault();return}var Gt=this.actions,Er=ct(Gt,Kn)&&!Ti[Kn],mn=ct(Gt,oi)&&!Ti[oi],Ci=ct(Gt,Di)&&!Ti[Di];if(Er){var Yo=ie.pointers.length===1,ia=ie.distance<2,qo=ie.deltaTime<250;if(Yo&&ia&&qo)return}if(!(Ci&&mn)&&(Er||mn&&Je&gi||Ci&&Je&Eo))return this.preventSrc(ye)},preventSrc:function(ie){this.manager.session.prevented=!0,ie.preventDefault()}};function Aa(ie){if(ct(ie,Kn))return Kn;var ye=ct(ie,Di),Je=ct(ie,oi);return ye&&Je?Kn:ye||Je?ye?Di:oi:ct(ie,Gr)?Gr:Zn}function Ni(){if(!Cr)return!1;var ie={},ye=Qe.CSS&&Qe.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Je){ie[Je]=ye?Qe.CSS.supports("touch-action",Je):!0}),ie}var oo=1,mi=2,Jn=4,ui=8,To=ui,Ls=16,ro=32;function po(ie){this.options=wt({},this.defaults,ie||{}),this.id=fe(),this.manager=null,this.options.enable=$n(this.options.enable,!0),this.state=oo,this.simultaneous={},this.requireFail=[]}po.prototype={defaults:{},set:function(ie){return wt(this.options,ie),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ie){if(ht(ie,"recognizeWith",this))return this;var ye=this.simultaneous;return ie=Yi(ie,this),ye[ie.id]||(ye[ie.id]=ie,ie.recognizeWith(this)),this},dropRecognizeWith:function(ie){return ht(ie,"dropRecognizeWith",this)?this:(ie=Yi(ie,this),delete this.simultaneous[ie.id],this)},requireFailure:function(ie){if(ht(ie,"requireFailure",this))return this;var ye=this.requireFail;return ie=Yi(ie,this),Lr(ye,ie)===-1&&(ye.push(ie),ie.requireFailure(this)),this},dropRequireFailure:function(ie){if(ht(ie,"dropRequireFailure",this))return this;ie=Yi(ie,this);var ye=Lr(this.requireFail,ie);return ye>-1&&this.requireFail.splice(ye,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ie){return!!this.simultaneous[ie.id]},emit:function(ie){var ye=this,Je=this.state;function Gt(Er){ye.manager.emit(Er,ie)}Je<ui&&Gt(ye.options.event+_u(Je)),Gt(ye.options.event),ie.additionalEvent&&Gt(ie.additionalEvent),Je>=ui&&Gt(ye.options.event+_u(Je))},tryEmit:function(ie){if(this.canEmit())return this.emit(ie);this.state=ro},canEmit:function(){for(var ie=0;ie<this.requireFail.length;){if(!(this.requireFail[ie].state&(ro|oo)))return!1;ie++}return!0},recognize:function(ie){var ye=wt({},ie);if(!bi(this.options.enable,[this,ye])){this.reset(),this.state=ro;return}this.state&(To|Ls|ro)&&(this.state=oo),this.state=this.process(ye),this.state&(mi|Jn|ui|Ls)&&this.tryEmit(ye)},process:function(ie){},getTouchAction:function(){},reset:function(){}};function _u(ie){return ie&Ls?"cancel":ie&ui?"end":ie&Jn?"move":ie&mi?"start":""}function ms(ie){return ie==ji?"down":ie==Jr?"up":ie==Dn?"left":ie==Wr?"right":""}function Yi(ie,ye){var Je=ye.manager;return Je?Je.get(ie):ie}function ra(){po.apply(this,arguments)}pr(ra,po,{defaults:{pointers:1},attrTest:function(ie){var ye=this.options.pointers;return ye===0||ie.pointers.length===ye},process:function(ie){var ye=this.state,Je=ie.eventType,Gt=ye&(mi|Jn),Er=this.attrTest(ie);return Gt&&(Je&Qn||!Er)?ye|Ls:Gt||Er?Je&un?ye|ui:ye&mi?ye|Jn:mi:ro}});function ao(){ra.apply(this,arguments),this.pX=null,this.pY=null}pr(ao,ra,{defaults:{event:"pan",threshold:10,pointers:1,direction:$i},getTouchAction:function(){var ie=this.options.direction,ye=[];return ie&gi&&ye.push(oi),ie&Eo&&ye.push(Di),ye},directionTest:function(ie){var ye=this.options,Je=!0,Gt=ie.distance,Er=ie.direction,mn=ie.deltaX,Ci=ie.deltaY;return Er&ye.direction||(ye.direction&gi?(Er=mn===0?Vr:mn<0?Dn:Wr,Je=mn!=this.pX,Gt=Math.abs(ie.deltaX)):(Er=Ci===0?Vr:Ci<0?Jr:ji,Je=Ci!=this.pY,Gt=Math.abs(ie.deltaY))),ie.direction=Er,Je&&Gt>ye.threshold&&Er&ye.direction},attrTest:function(ie){return ra.prototype.attrTest.call(this,ie)&&(this.state&mi||!(this.state&mi)&&this.directionTest(ie))},emit:function(ie){this.pX=ie.deltaX,this.pY=ie.deltaY;var ye=ms(ie.direction);ye&&(ie.additionalEvent=this.options.event+ye),this._super.emit.call(this,ie)}});function So(){ra.apply(this,arguments)}pr(So,ra,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Kn]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.scale-1)>this.options.threshold||this.state&mi)},emit:function(ie){if(ie.scale!==1){var ye=ie.scale<1?"in":"out";ie.additionalEvent=this.options.event+ye}this._super.emit.call(this,ie)}});function Fa(){po.apply(this,arguments),this._timer=null,this._input=null}pr(Fa,po,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zn]},process:function(ie){var ye=this.options,Je=ie.pointers.length===ye.pointers,Gt=ie.distance<ye.threshold,Er=ie.deltaTime>ye.time;if(this._input=ie,!Gt||!Je||ie.eventType&(un|Qn)&&!Er)this.reset();else if(ie.eventType&bn)this.reset(),this._timer=ge(function(){this.state=To,this.tryEmit()},ye.time,this);else if(ie.eventType&un)return To;return ro},reset:function(){clearTimeout(this._timer)},emit:function(ie){this.state===To&&(ie&&ie.eventType&un?this.manager.emit(this.options.event+"up",ie):(this._input.timeStamp=De(),this.manager.emit(this.options.event,this._input)))}});function Qi(){ra.apply(this,arguments)}pr(Qi,ra,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Kn]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.rotation)>this.options.threshold||this.state&mi)}});function Wa(){ra.apply(this,arguments)}pr(Wa,ra,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:gi|Eo,pointers:1},getTouchAction:function(){return ao.prototype.getTouchAction.call(this)},attrTest:function(ie){var ye=this.options.direction,Je;return ye&(gi|Eo)?Je=ie.overallVelocity:ye&gi?Je=ie.overallVelocityX:ye&Eo&&(Je=ie.overallVelocityY),this._super.attrTest.call(this,ie)&&ye&ie.offsetDirection&&ie.distance>this.options.threshold&&ie.maxPointers==this.options.pointers&&Ke(Je)>this.options.velocity&&ie.eventType&un},emit:function(ie){var ye=ms(ie.offsetDirection);ye&&this.manager.emit(this.options.event+ye,ie),this.manager.emit(this.options.event,ie)}});function Ba(){po.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pr(Ba,po,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Gr]},process:function(ie){var ye=this.options,Je=ie.pointers.length===ye.pointers,Gt=ie.distance<ye.threshold,Er=ie.deltaTime<ye.time;if(this.reset(),ie.eventType&bn&&this.count===0)return this.failTimeout();if(Gt&&Er&&Je){if(ie.eventType!=un)return this.failTimeout();var mn=this.pTime?ie.timeStamp-this.pTime<ye.interval:!0,Ci=!this.pCenter||ho(this.pCenter,ie.center)<ye.posThreshold;this.pTime=ie.timeStamp,this.pCenter=ie.center,!Ci||!mn?this.count=1:this.count+=1,this._input=ie;var Yo=this.count%ye.taps;if(Yo===0)return this.hasRequireFailures()?(this._timer=ge(function(){this.state=To,this.tryEmit()},ye.interval,this),mi):To}return ro},failTimeout:function(){return this._timer=ge(function(){this.state=ro},this.options.interval,this),ro},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==To&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function gu(ie,ye){return ye=ye||{},ye.recognizers=$n(ye.recognizers,gu.defaults.preset),new Zo(ie,ye)}gu.VERSION="2.0.7",gu.defaults={domEvents:!1,touchAction:Ir,enable:!0,inputTarget:null,inputClass:null,preset:[[Qi,{enable:!1}],[So,{enable:!1},["rotate"]],[Wa,{direction:gi}],[ao,{direction:gi},["swipe"]],[Ba],[Ba,{event:"doubletap",taps:2},["tap"]],[Fa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var vs=1,Rc=2;function Zo(ie,ye){this.options=wt({},gu.defaults,ye||{}),this.options.inputTarget=this.options.inputTarget||ie,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ie,this.input=bo(this),this.touchAction=new di(this,this.options.touchAction),qi(this,!0),ae(this.options.recognizers,function(Je){var Gt=this.add(new Je[0](Je[1]));Je[2]&&Gt.recognizeWith(Je[2]),Je[3]&&Gt.requireFailure(Je[3])},this)}Zo.prototype={set:function(ie){return wt(this.options,ie),ie.touchAction&&this.touchAction.update(),ie.inputTarget&&(this.input.destroy(),this.input.target=ie.inputTarget,this.input.init()),this},stop:function(ie){this.session.stopped=ie?Rc:vs},recognize:function(ie){var ye=this.session;if(!ye.stopped){this.touchAction.preventDefaults(ie);var Je,Gt=this.recognizers,Er=ye.curRecognizer;(!Er||Er&&Er.state&To)&&(Er=ye.curRecognizer=null);for(var mn=0;mn<Gt.length;)Je=Gt[mn],ye.stopped!==Rc&&(!Er||Je==Er||Je.canRecognizeWith(Er))?Je.recognize(ie):Je.reset(),!Er&&Je.state&(mi|Jn|ui)&&(Er=ye.curRecognizer=Je),mn++}},get:function(ie){if(ie instanceof po)return ie;for(var ye=this.recognizers,Je=0;Je<ye.length;Je++)if(ye[Je].options.event==ie)return ye[Je];return null},add:function(ie){if(ht(ie,"add",this))return this;var ye=this.get(ie.options.event);return ye&&this.remove(ye),this.recognizers.push(ie),ie.manager=this,this.touchAction.update(),ie},remove:function(ie){if(ht(ie,"remove",this))return this;if(ie=this.get(ie),ie){var ye=this.recognizers,Je=Lr(ye,ie);Je!==-1&&(ye.splice(Je,1),this.touchAction.update())}return this},on:function(ie,ye){if(ie!==V&&ye!==V){var Je=this.handlers;return ae(nr(ie),function(Gt){Je[Gt]=Je[Gt]||[],Je[Gt].push(ye)}),this}},off:function(ie,ye){if(ie!==V){var Je=this.handlers;return ae(nr(ie),function(Gt){ye?Je[Gt]&&Je[Gt].splice(Lr(Je[Gt],ye),1):delete Je[Gt]}),this}},emit:function(ie,ye){this.options.domEvents&&Qa(ie,ye);var Je=this.handlers[ie]&&this.handlers[ie].slice();if(!(!Je||!Je.length)){ye.type=ie,ye.preventDefault=function(){ye.srcEvent.preventDefault()};for(var Gt=0;Gt<Je.length;)Je[Gt](ye),Gt++}},destroy:function(){this.element&&qi(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function qi(ie,ye){var Je=ie.element;if(Je.style){var Gt;ae(ie.options.cssProps,function(Er,mn){Gt=Y(Je.style,mn),ye?(ie.oldCssProps[Gt]=Je.style[Gt],Je.style[Gt]=Er):Je.style[Gt]=ie.oldCssProps[Gt]||""}),ye||(ie.oldCssProps={})}}function Qa(ie,ye){var Je=v.createEvent("Event");Je.initEvent(ie,!0,!0),Je.gesture=ye,ye.target.dispatchEvent(Je)}wt(gu,{INPUT_START:bn,INPUT_MOVE:dn,INPUT_END:un,INPUT_CANCEL:Qn,STATE_POSSIBLE:oo,STATE_BEGAN:mi,STATE_CHANGED:Jn,STATE_ENDED:ui,STATE_RECOGNIZED:To,STATE_CANCELLED:Ls,STATE_FAILED:ro,DIRECTION_NONE:Vr,DIRECTION_LEFT:Dn,DIRECTION_RIGHT:Wr,DIRECTION_UP:Jr,DIRECTION_DOWN:ji,DIRECTION_HORIZONTAL:gi,DIRECTION_VERTICAL:Eo,DIRECTION_ALL:$i,Manager:Zo,Input:co,TouchAction:di,TouchInput:ut,MouseInput:jt,PointerEventInput:O,TouchMouseInput:tr,SingleTouchInput:Ie,Recognizer:po,AttrRecognizer:ra,Tap:Ba,Pan:ao,Swipe:Wa,Pinch:So,Rotate:Qi,Press:Fa,on:Mt,off:ze,each:ae,merge:mr,extend:et,assign:wt,inherit:pr,bindFn:yn,prefixed:Y});var na=typeof Qe!="undefined"?Qe:typeof self!="undefined"?self:{};na.Hammer=gu,Oe=function(){return gu}.call(qt,N,qt,hr),Oe!==V&&(hr.exports=Oe)})(window,document,"Hammer")},47443:function(hr,qt,N){var Oe=N(42118);function Qe(v,it){var V=v==null?0:v.length;return!!V&&Oe(v,it,0)>-1}hr.exports=Qe},1196:function(hr){function qt(N,Oe,Qe){for(var v=-1,it=N==null?0:N.length;++v<it;)if(Qe(Oe,N[v]))return!0;return!1}hr.exports=qt},29750:function(hr){function qt(N,Oe,Qe){return N===N&&(Qe!==void 0&&(N=N<=Qe?N:Qe),Oe!==void 0&&(N=N>=Oe?N:Oe)),N}hr.exports=qt},41848:function(hr){function qt(N,Oe,Qe,v){for(var it=N.length,V=Qe+(v?1:-1);v?V--:++V<it;)if(Oe(N[V],V,N))return V;return-1}hr.exports=qt},42118:function(hr,qt,N){var Oe=N(41848),Qe=N(62722),v=N(39375);function it(V,se,W){return se===se?v(V,se,W):Oe(V,Qe,W)}hr.exports=it},74221:function(hr){function qt(N,Oe,Qe,v){for(var it=Qe-1,V=N.length;++it<V;)if(v(N[it],Oe))return it;return-1}hr.exports=qt},62722:function(hr){function qt(N){return N!==N}hr.exports=qt},65464:function(hr,qt,N){var Oe=N(29932),Qe=N(42118),v=N(74221),it=N(51717),V=N(6450),se=Array.prototype,W=se.splice;function ne(G,Ke,De,ge){var ht=ge?v:Qe,ae=-1,At=Ke.length,wt=G;for(G===Ke&&(Ke=V(Ke)),De&&(wt=Oe(G,it(De)));++ae<At;)for(var et=0,mr=Ke[ae],pr=De?De(mr):mr;(et=ht(wt,pr,et,ge))>-1;)wt!==G&&W.call(wt,et,1),W.call(G,et,1);return G}hr.exports=ne},45652:function(hr,qt,N){var Oe=N(88668),Qe=N(47443),v=N(1196),it=N(74757),V=N(23593),se=N(21814),W=200;function ne(G,Ke,De){var ge=-1,ht=Qe,ae=G.length,At=!0,wt=[],et=wt;if(De)At=!1,ht=v;else if(ae>=W){var mr=Ke?null:V(G);if(mr)return se(mr);At=!1,ht=it,et=new Oe}else et=Ke?[]:wt;e:for(;++ge<ae;){var pr=G[ge],yn=Ke?Ke(pr):pr;if(pr=De||pr!==0?pr:0,At&&yn===yn){for(var bi=et.length;bi--;)if(et[bi]===yn)continue e;Ke&&et.push(yn),wt.push(pr)}else ht(et,yn,De)||(et!==wt&&et.push(yn),wt.push(pr))}return wt}hr.exports=ne},23593:function(hr,qt,N){var Oe=N(58525),Qe=N(28117),v=N(21814),it=1/0,V=Oe&&1/v(new Oe([,-0]))[1]==it?function(se){return new Oe(se)}:Qe;hr.exports=V},39375:function(hr){function qt(N,Oe,Qe){for(var v=Qe-1,it=N.length;++v<it;)if(N[v]===Oe)return v;return-1}hr.exports=qt},74691:function(hr,qt,N){var Oe=N(29750),Qe=N(14841);function v(it,V,se){return se===void 0&&(se=V,V=void 0),se!==void 0&&(se=Qe(se),se=se===se?se:0),V!==void 0&&(V=Qe(V),V=V===V?V:0),Oe(Qe(it),V,se)}hr.exports=v},51584:function(hr,qt,N){var Oe=N(44239),Qe=N(37005),v="[object Boolean]";function it(V){return V===!0||V===!1||Qe(V)&&Oe(V)==v}hr.exports=it},18446:function(hr,qt,N){var Oe=N(90939);function Qe(v,it){return Oe(v,it)}hr.exports=Qe},14293:function(hr){function qt(N){return N==null}hr.exports=qt},81763:function(hr,qt,N){var Oe=N(44239),Qe=N(37005),v="[object Number]";function it(V){return typeof V=="number"||Qe(V)&&Oe(V)==v}hr.exports=it},52353:function(hr){function qt(N){return N===void 0}hr.exports=qt},30236:function(hr,qt,N){var Oe=N(42980),Qe=N(21463),v=Qe(function(it,V,se,W){Oe(it,V,se,W)});hr.exports=v},28117:function(hr){function qt(){}hr.exports=qt},97019:function(hr,qt,N){var Oe=N(5976),Qe=N(45604),v=Oe(Qe);hr.exports=v},45604:function(hr,qt,N){var Oe=N(65464);function Qe(v,it){return v&&v.length&&it&&it.length?Oe(v,it):v}hr.exports=Qe},44908:function(hr,qt,N){var Oe=N(45652);function Qe(v){return v&&v.length?Oe(v):[]}hr.exports=Qe},6158:function(hr){(function(qt,N){hr.exports=N()})(this,function(){"use strict";var qt,N,Oe;function Qe(v,it){if(!qt)qt=it;else if(!N)N=it;else{var V="var sharedChunk = {}; ("+qt+")(sharedChunk); ("+N+")(sharedChunk);",se={};qt(se),Oe=it(se),typeof window!="undefined"&&(Oe.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}return Qe(["exports"],function(v){"use strict";function it(n,o){return n(o={exports:{}},o.exports),o.exports}var V=se;function se(n,o,s,p){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=p,this.p2x=s,this.p2y=p}se.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},se.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},se.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},se.prototype.solveCurveX=function(n,o){var s,p,_,y,b;for(o===void 0&&(o=1e-6),_=n,b=0;b<8;b++){if(y=this.sampleCurveX(_)-n,Math.abs(y)<o)return _;var C=this.sampleCurveDerivativeX(_);if(Math.abs(C)<1e-6)break;_-=y/C}if((_=n)<(s=0))return s;if(_>(p=1))return p;for(;s<p;){if(y=this.sampleCurveX(_),Math.abs(y-n)<o)return _;n>y?s=_:p=_,_=.5*(p-s)+s}return _},se.prototype.solve=function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))};var W=ne;function ne(n,o){this.x=n,this.y=o}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,o){return this.clone()._rotateAround(n,o)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var o=n.x-this.x,s=n.y-this.y;return o*o+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,o){return Math.atan2(this.x*o-this.y*n,this.x*n+this.y*o)},_matMult:function(n){var o=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=o,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var o=Math.cos(n),s=Math.sin(n),p=s*this.x+o*this.y;return this.x=o*this.x-s*this.y,this.y=p,this},_rotateAround:function(n,o){var s=Math.cos(n),p=Math.sin(n),_=o.y+p*(this.x-o.x)+s*(this.y-o.y);return this.x=o.x+s*(this.x-o.x)-p*(this.y-o.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(n){return n instanceof ne?n:Array.isArray(n)?new ne(n[0],n[1]):n};var G=typeof self!="undefined"?self:{},Ke=Math.pow(2,53)-1;function De(n,o,s,p){var _=new V(n,o,s,p);return function(y){return _.solve(y)}}var ge=De(.25,.1,.25,1);function ht(n,o,s){return Math.min(s,Math.max(o,n))}function ae(n,o,s){var p=s-o,_=((n-o)%p+p)%p+o;return _===o?s:_}function At(n){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];for(var p=0,_=o;p<_.length;p+=1){var y=_[p];for(var b in y)n[b]=y[b]}return n}var wt=1;function et(){return wt++}function mr(){return function n(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function pr(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function yn(n,o){n.forEach(function(s){o[s]&&(o[s]=o[s].bind(o))})}function bi(n,o){return n.indexOf(o,n.length-o.length)!==-1}function $n(n,o,s){var p={};for(var _ in n)p[_]=o.call(s||this,n[_],_,n);return p}function Mt(n,o,s){var p={};for(var _ in n)o.call(s||this,n[_],_,n)&&(p[_]=n[_]);return p}function ze(n){return Array.isArray(n)?n.map(ze):typeof n=="object"&&n?$n(n,ze):n}var Wt={};function ct(n){Wt[n]||(typeof console!="undefined"&&console.warn(n),Wt[n]=!0)}function nr(n,o,s){return(s.y-n.y)*(o.x-n.x)>(o.y-n.y)*(s.x-n.x)}function Lr(n){for(var o=0,s=0,p=n.length,_=p-1,y=void 0,b=void 0;s<p;_=s++)o+=((b=n[_]).x-(y=n[s]).x)*(y.y+b.y);return o}function K(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function _e(n){var o={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,_,y,b){var C=y||b;return o[_]=!C||C.toLowerCase(),""}),o["max-age"]){var s=parseInt(o["max-age"],10);isNaN(s)?delete o["max-age"]:o["max-age"]=s}return o}var Y=null;function ve(n){if(Y==null){var o=n.navigator?n.navigator.userAgent:null;Y=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Y}function fe(n){try{var o=G[n];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var He,at,_t,Tt,Pt=G.performance&&G.performance.now?G.performance.now.bind(G.performance):Date.now.bind(Date),Xr=G.requestAnimationFrame||G.mozRequestAnimationFrame||G.webkitRequestAnimationFrame||G.msRequestAnimationFrame,zr=G.cancelAnimationFrame||G.mozCancelAnimationFrame||G.webkitCancelAnimationFrame||G.msCancelAnimationFrame,gn={now:Pt,frame:function(n){var o=Xr(n);return{cancel:function(){return zr(o)}}},getImageData:function(n,o){o===void 0&&(o=0);var s=G.document.createElement("canvas"),p=s.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return s.width=n.width,s.height=n.height,p.drawImage(n,0,0,n.width,n.height),p.getImageData(-o,-o,n.width+2*o,n.height+2*o)},resolveURL:function(n){return He||(He=G.document.createElement("a")),He.href=n,He.href},hardwareConcurrency:G.navigator&&G.navigator.hardwareConcurrency||4,get devicePixelRatio(){return G.devicePixelRatio},get prefersReducedMotion(){return!!G.matchMedia&&(at==null&&(at=G.matchMedia("(prefers-reduced-motion: reduce)")),at.matches)}},Qr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Fn={supported:!1,testSupport:function(n){!bn&&Tt&&(dn?un(n):_t=n)}},bn=!1,dn=!1;function un(n){var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Tt),n.isContextLost())return;Fn.supported=!0}catch(s){}n.deleteTexture(o),bn=!0}G.document&&((Tt=G.document.createElement("img")).onload=function(){_t&&un(_t),_t=null,dn=!0},Tt.onerror=function(){bn=!0,_t=null},Tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Qn="01",Vr=function(n,o){this._transformRequestFn=n,this._customAccessToken=o,this._createSkuToken()};function Dn(n){return n.indexOf("mapbox:")===0}Vr.prototype._createSkuToken=function(){var n=function(){for(var o="",s=0;s<10;s++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qn,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt},Vr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Vr.prototype.transformRequest=function(n,o){return this._transformRequestFn&&this._transformRequestFn(n,o)||{url:n}},Vr.prototype.normalizeStyleURL=function(n,o){if(!Dn(n))return n;var s=gi(n);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||o)},Vr.prototype.normalizeGlyphsURL=function(n,o){if(!Dn(n))return n;var s=gi(n);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||o)},Vr.prototype.normalizeSourceURL=function(n,o){if(!Dn(n))return n;var s=gi(n);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||o)},Vr.prototype.normalizeSpriteURL=function(n,o,s,p){var _=gi(n);return Dn(n)?(_.path="/styles/v1"+_.path+"/sprite"+o+s,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=""+o+s,Eo(_))},Vr.prototype.normalizeTileURL=function(n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Dn(n))return n;var s=gi(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(gn.devicePixelRatio>=2||o===512?"@2x":"")+(Fn.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var p=this._customAccessToken||function(_){for(var y=0,b=_;y<b.length;y+=1){var C=b[y].match(/^access_token=(.*)$/);if(C)return C[1]}return null}(s.params)||Qr.ACCESS_TOKEN;return Qr.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,p)},Vr.prototype.canonicalizeTileURL=function(n,o){var s=gi(n);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return n;var p="mapbox://tiles/";p+=s.path.replace("/v4/","");var _=s.params;return o&&(_=_.filter(function(y){return!y.match(/^access_token=/)})),_.length&&(p+="?"+_.join("&")),p},Vr.prototype.canonicalizeTileset=function(n,o){for(var s=!!o&&Dn(o),p=[],_=0,y=n.tiles||[];_<y.length;_+=1){var b=y[_];Jr(b)?p.push(this.canonicalizeTileURL(b,s)):p.push(b)}return p},Vr.prototype._makeAPIURL=function(n,o){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=gi(Qr.API_URL);if(n.protocol=p.protocol,n.authority=p.authority,n.protocol==="http"){var _=n.params.indexOf("secure");_>=0&&n.params.splice(_,1)}if(p.path!=="/"&&(n.path=""+p.path+n.path),!Qr.REQUIRE_ACCESS_TOKEN)return Eo(n);if(!(o=o||Qr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return n.params=n.params.filter(function(y){return y.indexOf("access_token")===-1}),n.params.push("access_token="+o),Eo(n)};var Wr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Jr(n){return Wr.test(n)}var ji=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gi(n){var o=n.match(ji);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Eo(n){var o=n.params.length?"?"+n.params.join("&"):"";return n.protocol+"://"+n.authority+n.path+o}function $i(n){if(!n)return null;var o=n.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(G.atob(o[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var ue=function(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ue.prototype.getStorageKey=function(n){var o,s=$i(Qr.ACCESS_TOKEN);return o=s&&s.u?G.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(p,_){return String.fromCharCode(+("0x"+_))})):Qr.ACCESS_TOKEN||"",n?"mapbox.eventData."+n+":"+o:"mapbox.eventData:"+o},ue.prototype.fetchEventData=function(){var n=fe("localStorage"),o=this.getStorageKey(),s=this.getStorageKey("uuid");if(n)try{var p=G.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var _=G.localStorage.getItem(s);_&&(this.anonId=_)}catch(y){ct("Unable to read from LocalStorage")}},ue.prototype.saveEventData=function(){var n=fe("localStorage"),o=this.getStorageKey(),s=this.getStorageKey("uuid");if(n)try{G.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&G.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){ct("Unable to write to LocalStorage")}},ue.prototype.processRequests=function(n){},ue.prototype.postEvent=function(n,o,s,p){var _=this;if(Qr.EVENTS_URL){var y=gi(Qr.EVENTS_URL);y.params.push("access_token="+(p||Qr.ACCESS_TOKEN||""));var b={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Qn,userId:this.anonId},C=o?At(b,o):b,I={url:Eo(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=Ft(I,function(D){_.pendingRequest=null,s(D),_.saveEventData(),_.processRequests(p)})}},ue.prototype.queueRequest=function(n,o){this.queue.push(n),this.processRequests(o)};var Xi,co,bo=function(n){function o(){n.call(this,"map.load"),this.success={},this.skuToken=""}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(s,p,_,y){this.skuToken=_;var b=!(!y&&!Qr.ACCESS_TOKEN),C=Array.isArray(s)&&s.some(function(I){return Dn(I)||Jr(I)});Qr.EVENTS_URL&&b&&C&&this.queueRequest({id:p,timestamp:Date.now()},y)},o.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),y=_.id,b=_.timestamp;y&&this.success[y]||(this.anonId||this.fetchEventData(),pr(this.anonId)||(this.anonId=mr()),this.postEvent(b,{skuToken:this.skuToken},function(C){C||y&&(p.success[y]=!0)},s))}},o}(ue),Sa=new(function(n){function o(s){n.call(this,"appUserTurnstile"),this._customAccessToken=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(s,p){Qr.EVENTS_URL&&Qr.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(_){return Dn(_)||Jr(_)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=$i(Qr.ACCESS_TOKEN),y=_?_.u:Qr.ACCESS_TOKEN,b=y!==this.eventData.tokenU;pr(this.anonId)||(this.anonId=mr(),b=!0);var C=this.queue.shift();if(this.eventData.lastSuccess){var I=new Date(this.eventData.lastSuccess),D=new Date(C),z=(C-this.eventData.lastSuccess)/864e5;b=b||z>=1||z<-1||I.getDate()!==D.getDate()}else b=!0;if(!b)return this.processRequests();this.postEvent(C,{"enabled.telemetry":!1},function(H){H||(p.eventData.lastSuccess=C,p.eventData.tokenU=y)},s)}},o}(ue)),da=Sa.postTurnstileEvent.bind(Sa),Ds=new bo,Xo=Ds.postMapLoadEvent.bind(Ds),Xs=500,vu=50;function Vo(){G.caches&&!Xi&&(Xi=G.caches.open("mapbox-tiles"))}function fo(n){var o=n.indexOf("?");return o<0?n:n.slice(0,o)}var ho,pt=1/0;function Z(){return ho==null&&(ho=G.OffscreenCanvas&&new G.OffscreenCanvas(1,1).getContext("2d")&&typeof G.createImageBitmap=="function"),ho}var Q={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Q);var Ee=function(n){function o(s,p,_){p===401&&Jr(_)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),n.call(this,s),this.status=p,this.url=_,this.name=this.constructor.name,this.message=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ve=K()?function(){return self.worker&&self.worker.referrer}:function(){return(G.location.protocol==="blob:"?G.parent:G).location.href},Le,jt,Zt=function(n,o){if(!(/^file:/.test(s=n.url)||/^file:/.test(Ve())&&!/^\w+:/.test(s))){if(G.fetch&&G.Request&&G.AbortController&&G.Request.prototype.hasOwnProperty("signal"))return function(p,_){var y,b=new G.AbortController,C=new G.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Ve(),signal:b.signal}),I=!1,D=!1,z=(y=C.url).indexOf("sku=")>0&&Jr(y);p.type==="json"&&C.headers.set("Accept","application/json");var H=function(re,Te,Re){if(!D){if(re&&re.message!=="SecurityError"&&ct(re),Te&&Re)return J(Te);var qe=Date.now();G.fetch(C).then(function(je){if(je.ok){var ft=z?je.clone():null;return J(je,ft,qe)}return _(new Ee(je.statusText,je.status,p.url))}).catch(function(je){je.code!==20&&_(new Error(je.message))})}},J=function(re,Te,Re){(p.type==="arrayBuffer"?re.arrayBuffer():p.type==="json"?re.json():re.text()).then(function(qe){D||(Te&&Re&&function(je,ft,gt){if(Vo(),Xi){var zt={status:ft.status,statusText:ft.statusText,headers:new G.Headers};ft.headers.forEach(function(rr,Rr){return zt.headers.set(Rr,rr)});var Ot=_e(ft.headers.get("Cache-Control")||"");Ot["no-store"]||(Ot["max-age"]&&zt.headers.set("Expires",new Date(gt+1e3*Ot["max-age"]).toUTCString()),new Date(zt.headers.get("Expires")).getTime()-gt<42e4||function(rr,Rr){if(co===void 0)try{new Response(new ReadableStream),co=!0}catch(Zr){co=!1}co?Rr(rr.body):rr.blob().then(Rr)}(ft,function(rr){var Rr=new G.Response(rr,zt);Vo(),Xi&&Xi.then(function(Zr){return Zr.put(fo(je.url),Rr)}).catch(function(Zr){return ct(Zr.message)})}))}}(C,Te,Re),I=!0,_(null,qe,re.headers.get("Cache-Control"),re.headers.get("Expires")))}).catch(function(qe){D||_(new Error(qe.message))})};return z?function(re,Te){if(Vo(),!Xi)return Te(null);var Re=fo(re.url);Xi.then(function(qe){qe.match(Re).then(function(je){var ft=function(gt){if(!gt)return!1;var zt=new Date(gt.headers.get("Expires")||0),Ot=_e(gt.headers.get("Cache-Control")||"");return zt>Date.now()&&!Ot["no-cache"]}(je);qe.delete(Re),ft&&qe.put(Re,je.clone()),Te(null,je,ft)}).catch(Te)}).catch(Te)}(C,H):H(null,null),{cancel:function(){D=!0,I||b.abort()}}}(n,o);if(K()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,o,void 0,!0)}var s;return function(p,_){var y=new G.XMLHttpRequest;for(var b in y.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(y.responseType="arraybuffer"),p.headers)y.setRequestHeader(b,p.headers[b]);return p.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=p.credentials==="include",y.onerror=function(){_(new Error(y.statusText))},y.onload=function(){if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){var C=y.response;if(p.type==="json")try{C=JSON.parse(y.response)}catch(I){return _(I)}_(null,C,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else _(new Ee(y.statusText,y.status,p.url))},y.send(p.body),{cancel:function(){return y.abort()}}}(n,o)},ur=function(n,o){return Zt(At(n,{type:"arrayBuffer"}),o)},Ft=function(n,o){return Zt(At(n,{method:"POST"}),o)},L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Le=[],jt=0;var O=function(n,o){if(Fn.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),jt>=Qr.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:n,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Le.push(s),s}jt++;var p=!1,_=function(){if(!p)for(p=!0,jt--;Le.length&&jt<Qr.MAX_PARALLEL_IMAGE_REQUESTS;){var b=Le.shift();b.cancelled||(b.cancel=O(b.requestParameters,b.callback).cancel)}},y=ur(n,function(b,C,I,D){_(),b?o(b):C&&(Z()?function(z,H){var J=new G.Blob([new Uint8Array(z)],{type:"image/png"});G.createImageBitmap(J).then(function(re){H(null,re)}).catch(function(re){H(new Error("Could not load image because of "+re.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(C,o):function(z,H,J,re){var Te=new G.Image,Re=G.URL;Te.onload=function(){H(null,Te),Re.revokeObjectURL(Te.src),Te.onload=null,G.requestAnimationFrame(function(){Te.src=L})},Te.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var qe=new G.Blob([new Uint8Array(z)],{type:"image/png"});Te.cacheControl=J,Te.expires=re,Te.src=z.byteLength?Re.createObjectURL(qe):L}(C,o,I,D))});return{cancel:function(){y.cancel(),_()}}};function j(n,o,s){s[n]&&s[n].indexOf(o)!==-1||(s[n]=s[n]||[],s[n].push(o))}function $(n,o,s){if(s&&s[n]){var p=s[n].indexOf(o);p!==-1&&s[n].splice(p,1)}}var de=function(n,o){o===void 0&&(o={}),At(this,o),this.type=n},Ie=function(n){function o(s,p){p===void 0&&(p={}),n.call(this,"error",At({error:s},p))}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(de),Ze=function(){};Ze.prototype.on=function(n,o){return this._listeners=this._listeners||{},j(n,o,this._listeners),this},Ze.prototype.off=function(n,o){return $(n,o,this._listeners),$(n,o,this._oneTimeListeners),this},Ze.prototype.once=function(n,o){return this._oneTimeListeners=this._oneTimeListeners||{},j(n,o,this._oneTimeListeners),this},Ze.prototype.fire=function(n,o){typeof n=="string"&&(n=new de(n,o||{}));var s=n.type;if(this.listens(s)){n.target=this;for(var p=0,_=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];p<_.length;p+=1)_[p].call(this,n);for(var y=0,b=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];y<b.length;y+=1){var C=b[y];$(s,C,this._oneTimeListeners),C.call(this,n)}var I=this._eventedParent;I&&(At(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(n))}else n instanceof Ie&&console.error(n.error);return this},Ze.prototype.listens=function(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)},Ze.prototype.setEventedParent=function(n,o){return this._eventedParent=n,this._eventedParentData=o,this};var ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},be=function(n,o,s,p){this.message=(n?n+": ":"")+s,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function ut(n){var o=n.value;return o?[new be(n.key,o,"constants have been deprecated as of v8")]:[]}function Dt(n){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];for(var p=0,_=o;p<_.length;p+=1){var y=_[p];for(var b in y)n[b]=y[b]}return n}function ir(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ct(n){if(Array.isArray(n))return n.map(Ct);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){var o={};for(var s in n)o[s]=Ct(n[s]);return o}return ir(n)}var tr=function(n){function o(s,p){n.call(this,p),this.message=p,this.key=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Error),Br=function(n,o){o===void 0&&(o=[]),this.parent=n,this.bindings={};for(var s=0,p=o;s<p.length;s+=1){var _=p[s];this.bindings[_[0]]=_[1]}};Br.prototype.concat=function(n){return new Br(this,n)},Br.prototype.get=function(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(n+" not found in scope.")},Br.prototype.has=function(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)};var Nr={kind:"null"},Bt={kind:"number"},Fr={kind:"string"},Cr={kind:"boolean"},Ir={kind:"color"},Zn={kind:"object"},Gr={kind:"value"},Kn={kind:"collator"},Di={kind:"formatted"},oi={kind:"resolvedImage"};function Ti(n,o){return{kind:"array",itemType:n,N:o}}function di(n){if(n.kind==="array"){var o=di(n.itemType);return typeof n.N=="number"?"array<"+o+", "+n.N+">":n.itemType.kind==="value"?"array":"array<"+o+">"}return n.kind}var Aa=[Nr,Bt,Fr,Cr,Ir,Di,Zn,Ti(Gr),oi];function Ni(n,o){if(o.kind==="error")return null;if(n.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Ni(n.itemType,o.itemType))&&(typeof n.N!="number"||n.N===o.N))return null}else{if(n.kind===o.kind)return null;if(n.kind==="value"){for(var s=0,p=Aa;s<p.length;s+=1)if(!Ni(p[s],o))return null}}return"Expected "+di(n)+" but found "+di(o)+" instead."}function oo(n,o){return o.some(function(s){return s.kind===n.kind})}function mi(n,o){return o.some(function(s){return s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n})}var Jn=it(function(n,o){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(C){return(C=Math.round(C))<0?0:C>255?255:C}function _(C){return p(C[C.length-1]==="%"?parseFloat(C)/100*255:parseInt(C))}function y(C){return(I=C[C.length-1]==="%"?parseFloat(C)/100:parseFloat(C))<0?0:I>1?1:I;var I}function b(C,I,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?C+(I-C)*D*6:2*D<1?I:3*D<2?C+(I-C)*(2/3-D)*6:C}try{o.parseCSSColor=function(C){var I,D=C.replace(/ /g,"").toLowerCase();if(D in s)return s[D].slice();if(D[0]==="#")return D.length===4?(I=parseInt(D.substr(1),16))>=0&&I<=4095?[(3840&I)>>4|(3840&I)>>8,240&I|(240&I)>>4,15&I|(15&I)<<4,1]:null:D.length===7&&(I=parseInt(D.substr(1),16))>=0&&I<=16777215?[(16711680&I)>>16,(65280&I)>>8,255&I,1]:null;var z=D.indexOf("("),H=D.indexOf(")");if(z!==-1&&H+1===D.length){var J=D.substr(0,z),re=D.substr(z+1,H-(z+1)).split(","),Te=1;switch(J){case"rgba":if(re.length!==4)return null;Te=y(re.pop());case"rgb":return re.length!==3?null:[_(re[0]),_(re[1]),_(re[2]),Te];case"hsla":if(re.length!==4)return null;Te=y(re.pop());case"hsl":if(re.length!==3)return null;var Re=(parseFloat(re[0])%360+360)%360/360,qe=y(re[1]),je=y(re[2]),ft=je<=.5?je*(qe+1):je+qe-je*qe,gt=2*je-ft;return[p(255*b(gt,ft,Re+1/3)),p(255*b(gt,ft,Re)),p(255*b(gt,ft,Re-1/3)),Te];default:return null}}return null}}catch(C){}}).parseCSSColor,ui=function(n,o,s,p){p===void 0&&(p=1),this.r=n,this.g=o,this.b=s,this.a=p};ui.parse=function(n){if(n){if(n instanceof ui)return n;if(typeof n=="string"){var o=Jn(n);if(o)return new ui(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},ui.prototype.toString=function(){var n=this.toArray(),o=n[1],s=n[2],p=n[3];return"rgba("+Math.round(n[0])+","+Math.round(o)+","+Math.round(s)+","+p+")"},ui.prototype.toArray=function(){var n=this.a;return n===0?[0,0,0,0]:[255*this.r/n,255*this.g/n,255*this.b/n,n]},ui.black=new ui(0,0,0,1),ui.white=new ui(1,1,1,1),ui.transparent=new ui(0,0,0,0),ui.red=new ui(1,0,0,1);var To=function(n,o,s){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};To.prototype.compare=function(n,o){return this.collator.compare(n,o)},To.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Ls=function(n,o,s,p,_){this.text=n,this.image=o,this.scale=s,this.fontStack=p,this.textColor=_},ro=function(n){this.sections=n};ro.fromString=function(n){return new ro([new Ls(n,null,null,null,null)])},ro.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(n){return n.text.length!==0||n.image&&n.image.name.length!==0})},ro.factory=function(n){return n instanceof ro?n:ro.fromString(n)},ro.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(n){return n.text}).join("")},ro.prototype.serialize=function(){for(var n=["format"],o=0,s=this.sections;o<s.length;o+=1){var p=s[o];if(p.image)n.push(["image",p.image.name]);else{n.push(p.text);var _={};p.fontStack&&(_["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(_["font-scale"]=p.scale),p.textColor&&(_["text-color"]=["rgba"].concat(p.textColor.toArray())),n.push(_)}}return n};var po=function(n){this.name=n.name,this.available=n.available};function _u(n,o,s,p){return typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof s=="number"&&s>=0&&s<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[n,o,s,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[n,o,s,p]:[n,o,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ms(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ui||n instanceof To||n instanceof ro||n instanceof po)return!0;if(Array.isArray(n)){for(var o=0,s=n;o<s.length;o+=1)if(!ms(s[o]))return!1;return!0}if(typeof n=="object"){for(var p in n)if(!ms(n[p]))return!1;return!0}return!1}function Yi(n){if(n===null)return Nr;if(typeof n=="string")return Fr;if(typeof n=="boolean")return Cr;if(typeof n=="number")return Bt;if(n instanceof ui)return Ir;if(n instanceof To)return Kn;if(n instanceof ro)return Di;if(n instanceof po)return oi;if(Array.isArray(n)){for(var o,s=n.length,p=0,_=n;p<_.length;p+=1){var y=Yi(_[p]);if(o){if(o===y)continue;o=Gr;break}o=y}return Ti(o||Gr,s)}return Zn}function ra(n){var o=typeof n;return n===null?"":o==="string"||o==="number"||o==="boolean"?String(n):n instanceof ui||n instanceof ro||n instanceof po?n.toString():JSON.stringify(n)}po.prototype.toString=function(){return this.name},po.fromString=function(n){return n?new po({name:n,available:!1}):null},po.prototype.serialize=function(){return["image",this.name]};var ao=function(n,o){this.type=n,this.value=o};ao.parse=function(n,o){if(n.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(!ms(n[1]))return o.error("invalid value");var s=n[1],p=Yi(s),_=o.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new ao(p,s)},ao.prototype.evaluate=function(){return this.value},ao.prototype.eachChild=function(){},ao.prototype.outputDefined=function(){return!0},ao.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ui?["rgba"].concat(this.value.toArray()):this.value instanceof ro?this.value.serialize():this.value};var So=function(n){this.name="ExpressionEvaluationError",this.message=n};So.prototype.toJSON=function(){return this.message};var Fa={string:Fr,number:Bt,boolean:Cr,object:Zn},Qi=function(n,o){this.type=n,this.args=o};Qi.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var s,p=1,_=n[0];if(_==="array"){var y,b;if(n.length>2){var C=n[1];if(typeof C!="string"||!(C in Fa)||C==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);y=Fa[C],p++}else y=Gr;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);b=n[2],p++}s=Ti(y,b)}else s=Fa[_];for(var I=[];p<n.length;p++){var D=o.parse(n[p],p,Gr);if(!D)return null;I.push(D)}return new Qi(s,I)},Qi.prototype.evaluate=function(n){for(var o=0;o<this.args.length;o++){var s=this.args[o].evaluate(n);if(!Ni(this.type,Yi(s)))return s;if(o===this.args.length-1)throw new So("Expected value to be of type "+di(this.type)+", but found "+di(Yi(s))+" instead.")}return null},Qi.prototype.eachChild=function(n){this.args.forEach(n)},Qi.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},Qi.prototype.serialize=function(){var n=this.type,o=[n.kind];if(n.kind==="array"){var s=n.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){o.push(s.kind);var p=n.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(_){return _.serialize()}))};var Wa=function(n){this.type=Di,this.sections=n};Wa.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var s=n[1];if(!Array.isArray(s)&&typeof s=="object")return o.error("First argument must be an image or text section.");for(var p=[],_=!1,y=1;y<=n.length-1;++y){var b=n[y];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;var C=null;if(b["font-scale"]&&!(C=o.parse(b["font-scale"],1,Bt)))return null;var I=null;if(b["text-font"]&&!(I=o.parse(b["text-font"],1,Ti(Fr))))return null;var D=null;if(b["text-color"]&&!(D=o.parse(b["text-color"],1,Ir)))return null;var z=p[p.length-1];z.scale=C,z.font=I,z.textColor=D}else{var H=o.parse(n[y],1,Gr);if(!H)return null;var J=H.type.kind;if(J!=="string"&&J!=="value"&&J!=="null"&&J!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:H,scale:null,font:null,textColor:null})}}return new Wa(p)},Wa.prototype.evaluate=function(n){return new ro(this.sections.map(function(o){var s=o.content.evaluate(n);return Yi(s)===oi?new Ls("",s,null,null,null):new Ls(ra(s),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))},Wa.prototype.eachChild=function(n){for(var o=0,s=this.sections;o<s.length;o+=1){var p=s[o];n(p.content),p.scale&&n(p.scale),p.font&&n(p.font),p.textColor&&n(p.textColor)}},Wa.prototype.outputDefined=function(){return!1},Wa.prototype.serialize=function(){for(var n=["format"],o=0,s=this.sections;o<s.length;o+=1){var p=s[o];n.push(p.content.serialize());var _={};p.scale&&(_["font-scale"]=p.scale.serialize()),p.font&&(_["text-font"]=p.font.serialize()),p.textColor&&(_["text-color"]=p.textColor.serialize()),n.push(_)}return n};var Ba=function(n){this.type=oi,this.input=n};Ba.parse=function(n,o){if(n.length!==2)return o.error("Expected two arguments.");var s=o.parse(n[1],1,Fr);return s?new Ba(s):o.error("No image name provided.")},Ba.prototype.evaluate=function(n){var o=this.input.evaluate(n),s=po.fromString(o);return s&&n.availableImages&&(s.available=n.availableImages.indexOf(o)>-1),s},Ba.prototype.eachChild=function(n){n(this.input)},Ba.prototype.outputDefined=function(){return!1},Ba.prototype.serialize=function(){return["image",this.input.serialize()]};var gu={"to-boolean":Cr,"to-color":Ir,"to-number":Bt,"to-string":Fr},vs=function(n,o){this.type=n,this.args=o};vs.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var s=n[0];if((s==="to-boolean"||s==="to-string")&&n.length!==2)return o.error("Expected one argument.");for(var p=gu[s],_=[],y=1;y<n.length;y++){var b=o.parse(n[y],y,Gr);if(!b)return null;_.push(b)}return new vs(p,_)},vs.prototype.evaluate=function(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){for(var o,s,p=0,_=this.args;p<_.length;p+=1){if(s=null,(o=_[p].evaluate(n))instanceof ui)return o;if(typeof o=="string"){var y=n.parseColor(o);if(y)return y}else if(Array.isArray(o)&&!(s=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":_u(o[0],o[1],o[2],o[3])))return new ui(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new So(s||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var b=null,C=0,I=this.args;C<I.length;C+=1){if((b=I[C].evaluate(n))===null)return 0;var D=Number(b);if(!isNaN(D))return D}throw new So("Could not convert "+JSON.stringify(b)+" to number.")}return this.type.kind==="formatted"?ro.fromString(ra(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?po.fromString(ra(this.args[0].evaluate(n))):ra(this.args[0].evaluate(n))},vs.prototype.eachChild=function(n){this.args.forEach(n)},vs.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},vs.prototype.serialize=function(){if(this.type.kind==="formatted")return new Wa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ba(this.args[0]).serialize();var n=["to-"+this.type.kind];return this.eachChild(function(o){n.push(o.serialize())}),n};var Rc=["Unknown","Point","LineString","Polygon"],Zo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Zo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Zo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Rc[this.feature.type]:this.feature.type:null},Zo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Zo.prototype.canonicalID=function(){return this.canonical},Zo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Zo.prototype.parseColor=function(n){var o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=ui.parse(n)),o};var qi=function(n,o,s,p){this.name=n,this.type=o,this._evaluate=s,this.args=p};qi.prototype.evaluate=function(n){return this._evaluate(n,this.args)},qi.prototype.eachChild=function(n){this.args.forEach(n)},qi.prototype.outputDefined=function(){return!1},qi.prototype.serialize=function(){return[this.name].concat(this.args.map(function(n){return n.serialize()}))},qi.parse=function(n,o){var s,p=n[0],_=qi.definitions[p];if(!_)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var y=Array.isArray(_)?_[0]:_.type,b=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,C=b.filter(function(In){var rn=In[0];return!Array.isArray(rn)||rn.length===n.length-1}),I=null,D=0,z=C;D<z.length;D+=1){var H=z[D],J=H[0],re=H[1];I=new Nu(o.registry,o.path,null,o.scope);for(var Te=[],Re=!1,qe=1;qe<n.length;qe++){var je=n[qe],ft=Array.isArray(J)?J[qe-1]:J.type,gt=I.parse(je,1+Te.length,ft);if(!gt){Re=!0;break}Te.push(gt)}if(!Re)if(Array.isArray(J)&&J.length!==Te.length)I.error("Expected "+J.length+" arguments, but found "+Te.length+" instead.");else{for(var zt=0;zt<Te.length;zt++){var Ot=Array.isArray(J)?J[zt]:J.type,rr=Te[zt];I.concat(zt+1).checkSubtype(Ot,rr.type)}if(I.errors.length===0)return new qi(p,y,re,Te)}}if(C.length===1)(s=o.errors).push.apply(s,I.errors);else{for(var Rr=(C.length?C:b).map(function(In){var rn;return rn=In[0],Array.isArray(rn)?"("+rn.map(di).join(", ")+")":"("+di(rn.type)+"...)"}).join(" | "),Zr=[],xn=1;xn<n.length;xn++){var nn=o.parse(n[xn],1+Zr.length);if(!nn)return null;Zr.push(di(nn.type))}o.error("Expected arguments of type "+Rr+", but found ("+Zr.join(", ")+") instead.")}return null},qi.register=function(n,o){for(var s in qi.definitions=o,o)n[s]=qi};var Qa=function(n,o,s){this.type=Kn,this.locale=s,this.caseSensitive=n,this.diacriticSensitive=o};function na(n,o){n[0]=Math.min(n[0],o[0]),n[1]=Math.min(n[1],o[1]),n[2]=Math.max(n[2],o[0]),n[3]=Math.max(n[3],o[1])}function ie(n,o){return!(n[0]<=o[0]||n[2]>=o[2]||n[1]<=o[1]||n[3]>=o[3])}function ye(n,o){var s=(180+n[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(s*_*8192),Math.round(p*_*8192)]}function Je(n,o,s){return o[1]>n[1]!=s[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]}function Gt(n,o){for(var s,p,_,y,b,C,I,D=!1,z=0,H=o.length;z<H;z++)for(var J=o[z],re=0,Te=J.length;re<Te-1;re++){if((y=(s=n)[0]-(p=J[re])[0])*(I=s[1]-(_=J[re+1])[1])-(C=s[0]-_[0])*(b=s[1]-p[1])==0&&y*C<=0&&b*I<=0)return!1;Je(n,J[re],J[re+1])&&(D=!D)}return D}function Er(n,o){for(var s=0;s<o.length;s++)if(Gt(n,o[s]))return!0;return!1}function mn(n,o,s,p){var _=p[0]-s[0],y=p[1]-s[1],b=(n[0]-s[0])*y-_*(n[1]-s[1]),C=(o[0]-s[0])*y-_*(o[1]-s[1]);return b>0&&C<0||b<0&&C>0}function Ci(n,o,s){for(var p=0,_=s;p<_.length;p+=1)for(var y=_[p],b=0;b<y.length-1;++b)if((H=[(z=y[b+1])[0]-(D=y[b])[0],z[1]-D[1]])[0]*(J=[(I=o)[0]-(C=n)[0],I[1]-C[1]])[1]-H[1]*J[0]!=0&&mn(C,I,D,z)&&mn(D,z,C,I))return!0;var C,I,D,z,H,J;return!1}function Yo(n,o){for(var s=0;s<n.length;++s)if(!Gt(n[s],o))return!1;for(var p=0;p<n.length-1;++p)if(Ci(n[p],n[p+1],o))return!1;return!0}function ia(n,o){for(var s=0;s<o.length;s++)if(Yo(n,o[s]))return!0;return!1}function qo(n,o,s){for(var p=[],_=0;_<n.length;_++){for(var y=[],b=0;b<n[_].length;b++){var C=ye(n[_][b],s);na(o,C),y.push(C)}p.push(y)}return p}function _s(n,o,s){for(var p=[],_=0;_<n.length;_++){var y=qo(n[_],o,s);p.push(y)}return p}function gs(n,o,s,p){if(n[0]<s[0]||n[0]>s[2]){var _=.5*p,y=n[0]-s[0]>_?-p:s[0]-n[0]>_?p:0;y===0&&(y=n[0]-s[2]>_?-p:s[2]-n[0]>_?p:0),n[0]+=y}na(o,n)}function of(n,o,s,p){for(var _=8192*Math.pow(2,p.z),y=[8192*p.x,8192*p.y],b=[],C=0,I=n;C<I.length;C+=1)for(var D=0,z=I[C];D<z.length;D+=1){var H=z[D],J=[H.x+y[0],H.y+y[1]];gs(J,o,s,_),b.push(J)}return b}function Rf(n,o,s,p){for(var _,y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],C=[],I=0,D=n;I<D.length;I+=1){for(var z=[],H=0,J=D[I];H<J.length;H+=1){var re=J[H],Te=[re.x+b[0],re.y+b[1]];na(o,Te),z.push(Te)}C.push(z)}if(o[2]-o[0]<=y/2){(_=o)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var Re=0,qe=C;Re<qe.length;Re+=1)for(var je=0,ft=qe[Re];je<ft.length;je+=1)gs(ft[je],o,s,y)}return C}Qa.parse=function(n,o){if(n.length!==2)return o.error("Expected one argument.");var s=n[1];if(typeof s!="object"||Array.isArray(s))return o.error("Collator options argument must be an object.");var p=o.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Cr);if(!p)return null;var _=o.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Cr);if(!_)return null;var y=null;return s.locale&&!(y=o.parse(s.locale,1,Fr))?null:new Qa(p,_,y)},Qa.prototype.evaluate=function(n){return new To(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)},Qa.prototype.eachChild=function(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)},Qa.prototype.outputDefined=function(){return!1},Qa.prototype.serialize=function(){var n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]};var ai=function(n,o){this.type=Cr,this.geojson=n,this.geometries=o};function ys(n){if(n instanceof qi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ai)return!1;var o=!0;return n.eachChild(function(s){o&&!ys(s)&&(o=!1)}),o}function Fs(n){if(n instanceof qi&&n.name==="feature-state")return!1;var o=!0;return n.eachChild(function(s){o&&!Fs(s)&&(o=!1)}),o}function au(n,o){if(n instanceof qi&&o.indexOf(n.name)>=0)return!1;var s=!0;return n.eachChild(function(p){s&&!au(p,o)&&(s=!1)}),s}ai.parse=function(n,o){if(n.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(ms(n[1])){var s=n[1];if(s.type==="FeatureCollection")for(var p=0;p<s.features.length;++p){var _=s.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ai(s,s.features[p].geometry)}else if(s.type==="Feature"){var y=s.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ai(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ai(s,s)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ai.prototype.evaluate=function(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,s){var p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(s.type==="Polygon"){var b=qo(s.coordinates,_,y),C=of(o.geometry(),p,_,y);if(!ie(p,_))return!1;for(var I=0,D=C;I<D.length;I+=1)if(!Gt(D[I],b))return!1}if(s.type==="MultiPolygon"){var z=_s(s.coordinates,_,y),H=of(o.geometry(),p,_,y);if(!ie(p,_))return!1;for(var J=0,re=H;J<re.length;J+=1)if(!Er(re[J],z))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,s){var p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(s.type==="Polygon"){var b=qo(s.coordinates,_,y),C=Rf(o.geometry(),p,_,y);if(!ie(p,_))return!1;for(var I=0,D=C;I<D.length;I+=1)if(!Yo(D[I],b))return!1}if(s.type==="MultiPolygon"){var z=_s(s.coordinates,_,y),H=Rf(o.geometry(),p,_,y);if(!ie(p,_))return!1;for(var J=0,re=H;J<re.length;J+=1)if(!ia(re[J],z))return!1}return!0}(n,this.geometries)}return!1},ai.prototype.eachChild=function(){},ai.prototype.outputDefined=function(){return!0},ai.prototype.serialize=function(){return["within",this.geojson]};var yu=function(n,o){this.type=o.type,this.name=n,this.boundExpression=o};yu.parse=function(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var s=n[1];return o.scope.has(s)?new yu(s,o.scope.get(s)):o.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},yu.prototype.evaluate=function(n){return this.boundExpression.evaluate(n)},yu.prototype.eachChild=function(){},yu.prototype.outputDefined=function(){return!1},yu.prototype.serialize=function(){return["var",this.name]};var Nu=function(n,o,s,p,_){o===void 0&&(o=[]),p===void 0&&(p=new Br),_===void 0&&(_=[]),this.registry=n,this.path=o,this.key=o.map(function(y){return"["+y+"]"}).join(""),this.scope=p,this.errors=_,this.expectedType=s};function Mc(n,o){for(var s,p=n.length-1,_=0,y=p,b=0;_<=y;)if((s=n[b=Math.floor((_+y)/2)])<=o){if(b===p||o<n[b+1])return b;_=b+1}else{if(!(s>o))throw new So("Input is not a number.");y=b-1}return 0}Nu.prototype.parse=function(n,o,s,p,_){return _===void 0&&(_={}),o?this.concat(o,s,p)._parse(n,_):this._parse(n,_)},Nu.prototype._parse=function(n,o){function s(D,z,H){return H==="assert"?new Qi(z,[D]):H==="coerce"?new vs(z,[D]):D}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=n[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[p];if(_){var y=_.parse(n,this);if(!y)return null;if(this.expectedType){var b=this.expectedType,C=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||C.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(b,C))return null}else y=s(y,b,o.typeAnnotation||"coerce");else y=s(y,b,o.typeAnnotation||"assert")}if(!(y instanceof ao)&&y.type.kind!=="resolvedImage"&&function D(z){if(z instanceof yu)return D(z.boundExpression);if(z instanceof qi&&z.name==="error"||z instanceof Qa||z instanceof ai)return!1;var H=z instanceof vs||z instanceof Qi,J=!0;return z.eachChild(function(re){J=H?J&&D(re):J&&re instanceof ao}),!!J&&ys(z)&&au(z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(y)){var I=new Zo;try{y=new ao(y.type,y.evaluate(I))}catch(D){return this.error(D.message),null}}return y}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof n+" instead.")},Nu.prototype.concat=function(n,o,s){var p=typeof n=="number"?this.path.concat(n):this.path,_=s?this.scope.concat(s):this.scope;return new Nu(this.registry,p,o||null,_,this.errors)},Nu.prototype.error=function(n){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];var p=""+this.key+o.map(function(_){return"["+_+"]"}).join("");this.errors.push(new tr(p,n))},Nu.prototype.checkSubtype=function(n,o){var s=Ni(n,o);return s&&this.error(s),s};var xs=function(n,o,s){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(var p=0,_=s;p<_.length;p+=1){var y=_[p],b=y[1];this.labels.push(y[0]),this.outputs.push(b)}};function Co(n,o,s){return n*(1-s)+o*s}xs.parse=function(n,o){if(n.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");var s=o.parse(n[1],1,Bt);if(!s)return null;var p=[],_=null;o.expectedType&&o.expectedType.kind!=="value"&&(_=o.expectedType);for(var y=1;y<n.length;y+=2){var b=y===1?-1/0:n[y],C=n[y+1],I=y,D=y+1;if(typeof b!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=b)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);var z=o.parse(C,D,_);if(!z)return null;_=_||z.type,p.push([b,z])}return new xs(_,s,p)},xs.prototype.evaluate=function(n){var o=this.labels,s=this.outputs;if(o.length===1)return s[0].evaluate(n);var p=this.input.evaluate(n);if(p<=o[0])return s[0].evaluate(n);var _=o.length;return p>=o[_-1]?s[_-1].evaluate(n):s[Mc(o,p)].evaluate(n)},xs.prototype.eachChild=function(n){n(this.input);for(var o=0,s=this.outputs;o<s.length;o+=1)n(s[o])},xs.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},xs.prototype.serialize=function(){for(var n=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n};var xu=Object.freeze({__proto__:null,number:Co,color:function(n,o,s){return new ui(Co(n.r,o.r,s),Co(n.g,o.g,s),Co(n.b,o.b,s),Co(n.a,o.a,s))},array:function(n,o,s){return n.map(function(p,_){return Co(p,o[_],s)})}}),is=6/29*3*(6/29),Al=Math.PI/180,ch=180/Math.PI;function af(n){return n>.008856451679035631?Math.pow(n,1/3):n/is+4/29}function Mf(n){return n>6/29?n*n*n:is*(n-4/29)}function If(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Pf(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function fh(n){var o=Pf(n.r),s=Pf(n.g),p=Pf(n.b),_=af((.4124564*o+.3575761*s+.1804375*p)/.95047),y=af((.2126729*o+.7151522*s+.072175*p)/1);return{l:116*y-16,a:500*(_-y),b:200*(y-af((.0193339*o+.119192*s+.9503041*p)/1.08883)),alpha:n.a}}function hh(n){var o=(n.l+16)/116,s=isNaN(n.a)?o:o+n.a/500,p=isNaN(n.b)?o:o-n.b/200;return o=1*Mf(o),s=.95047*Mf(s),p=1.08883*Mf(p),new ui(If(3.2404542*s-1.5371385*o-.4985314*p),If(-.969266*s+1.8760108*o+.041556*p),If(.0556434*s-.2040259*o+1.0572252*p),n.alpha)}function rp(n,o,s){var p=o-n;return n+s*(p>180||p<-180?p-360*Math.round(p/360):p)}var Ic={forward:fh,reverse:hh,interpolate:function(n,o,s){return{l:Co(n.l,o.l,s),a:Co(n.a,o.a,s),b:Co(n.b,o.b,s),alpha:Co(n.alpha,o.alpha,s)}}},Eu={forward:function(n){var o=fh(n),s=o.l,p=o.a,_=o.b,y=Math.atan2(_,p)*ch;return{h:y<0?y+360:y,c:Math.sqrt(p*p+_*_),l:s,alpha:n.a}},reverse:function(n){var o=n.h*Al,s=n.c;return hh({l:n.l,a:Math.cos(o)*s,b:Math.sin(o)*s,alpha:n.alpha})},interpolate:function(n,o,s){return{h:rp(n.h,o.h,s),c:Co(n.c,o.c,s),l:Co(n.l,o.l,s),alpha:Co(n.alpha,o.alpha,s)}}},ph=Object.freeze({__proto__:null,lab:Ic,hcl:Eu}),_o=function(n,o,s,p,_){this.type=n,this.operator=o,this.interpolation=s,this.input=p,this.labels=[],this.outputs=[];for(var y=0,b=_;y<b.length;y+=1){var C=b[y],I=C[1];this.labels.push(C[0]),this.outputs.push(I)}};function Tl(n,o,s,p){var _=p-s,y=n-s;return _===0?0:o===1?y/_:(Math.pow(o,y)-1)/(Math.pow(o,_)-1)}_o.interpolationFactor=function(n,o,s,p){var _=0;if(n.name==="exponential")_=Tl(o,n.base,s,p);else if(n.name==="linear")_=Tl(o,1,s,p);else if(n.name==="cubic-bezier"){var y=n.controlPoints;_=new V(y[0],y[1],y[2],y[3]).solve(Tl(o,1,s,p))}return _},_o.parse=function(n,o){var s=n[0],p=n[1],_=n[2],y=n.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var b=p[1];if(typeof b!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:b}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var C=p.slice(1);if(C.length!==4||C.some(function(qe){return typeof qe!="number"||qe<0||qe>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:C}}if(n.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(_=o.parse(_,2,Bt)))return null;var I=[],D=null;s==="interpolate-hcl"||s==="interpolate-lab"?D=Ir:o.expectedType&&o.expectedType.kind!=="value"&&(D=o.expectedType);for(var z=0;z<y.length;z+=2){var H=y[z],J=y[z+1],re=z+3,Te=z+4;if(typeof H!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(I.length&&I[I.length-1][0]>=H)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);var Re=o.parse(J,Te,D);if(!Re)return null;D=D||Re.type,I.push([H,Re])}return D.kind==="number"||D.kind==="color"||D.kind==="array"&&D.itemType.kind==="number"&&typeof D.N=="number"?new _o(D,s,p,_,I):o.error("Type "+di(D)+" is not interpolatable.")},_o.prototype.evaluate=function(n){var o=this.labels,s=this.outputs;if(o.length===1)return s[0].evaluate(n);var p=this.input.evaluate(n);if(p<=o[0])return s[0].evaluate(n);var _=o.length;if(p>=o[_-1])return s[_-1].evaluate(n);var y=Mc(o,p),b=_o.interpolationFactor(this.interpolation,p,o[y],o[y+1]),C=s[y].evaluate(n),I=s[y+1].evaluate(n);return this.operator==="interpolate"?xu[this.type.kind.toLowerCase()](C,I,b):this.operator==="interpolate-hcl"?Eu.reverse(Eu.interpolate(Eu.forward(C),Eu.forward(I),b)):Ic.reverse(Ic.interpolate(Ic.forward(C),Ic.forward(I),b))},_o.prototype.eachChild=function(n){n(this.input);for(var o=0,s=this.outputs;o<s.length;o+=1)n(s[o])},_o.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},_o.prototype.serialize=function(){var n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,n,this.input.serialize()],s=0;s<this.labels.length;s++)o.push(this.labels[s],this.outputs[s].serialize());return o};var Ju=function(n,o){this.type=n,this.args=o};Ju.parse=function(n,o){if(n.length<2)return o.error("Expectected at least one argument.");var s=null,p=o.expectedType;p&&p.kind!=="value"&&(s=p);for(var _=[],y=0,b=n.slice(1);y<b.length;y+=1){var C=o.parse(b[y],1+_.length,s,void 0,{typeAnnotation:"omit"});if(!C)return null;s=s||C.type,_.push(C)}var I=p&&_.some(function(D){return Ni(p,D.type)});return new Ju(I?Gr:s,_)},Ju.prototype.evaluate=function(n){for(var o,s=null,p=0,_=0,y=this.args;_<y.length&&(p++,(s=y[_].evaluate(n))&&s instanceof po&&!s.available&&(o||(o=s.name),s=null,p===this.args.length&&(s=o)),s===null);_+=1);return s},Ju.prototype.eachChild=function(n){this.args.forEach(n)},Ju.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},Ju.prototype.serialize=function(){var n=["coalesce"];return this.eachChild(function(o){n.push(o.serialize())}),n};var Bs=function(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o};Bs.prototype.evaluate=function(n){return this.result.evaluate(n)},Bs.prototype.eachChild=function(n){for(var o=0,s=this.bindings;o<s.length;o+=1)n(s[o][1]);n(this.result)},Bs.parse=function(n,o){if(n.length<4)return o.error("Expected at least 3 arguments, but found "+(n.length-1)+" instead.");for(var s=[],p=1;p<n.length-1;p+=2){var _=n[p];if(typeof _!="string")return o.error("Expected string, but found "+typeof _+" instead.",p);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var y=o.parse(n[p+1],p+1);if(!y)return null;s.push([_,y])}var b=o.parse(n[n.length-1],n.length-1,o.expectedType,s);return b?new Bs(s,b):null},Bs.prototype.outputDefined=function(){return this.result.outputDefined()},Bs.prototype.serialize=function(){for(var n=["let"],o=0,s=this.bindings;o<s.length;o+=1){var p=s[o];n.push(p[0],p[1].serialize())}return n.push(this.result.serialize()),n};var el=function(n,o,s){this.type=n,this.index=o,this.input=s};el.parse=function(n,o){if(n.length!==3)return o.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,Bt),p=o.parse(n[2],2,Ti(o.expectedType||Gr));return s&&p?new el(p.type.itemType,s,p):null},el.prototype.evaluate=function(n){var o=this.index.evaluate(n),s=this.input.evaluate(n);if(o<0)throw new So("Array index out of bounds: "+o+" < 0.");if(o>=s.length)throw new So("Array index out of bounds: "+o+" > "+(s.length-1)+".");if(o!==Math.floor(o))throw new So("Array index must be an integer, but found "+o+" instead.");return s[o]},el.prototype.eachChild=function(n){n(this.index),n(this.input)},el.prototype.outputDefined=function(){return!1},el.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ys=function(n,o){this.type=Cr,this.needle=n,this.haystack=o};Ys.parse=function(n,o){if(n.length!==3)return o.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,Gr),p=o.parse(n[2],2,Gr);return s&&p?oo(s.type,[Cr,Fr,Bt,Nr,Gr])?new Ys(s,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+di(s.type)+" instead"):null},Ys.prototype.evaluate=function(n){var o=this.needle.evaluate(n),s=this.haystack.evaluate(n);if(!s)return!1;if(!mi(o,["boolean","string","number","null"]))throw new So("Expected first argument to be of type boolean, string, number or null, but found "+di(Yi(o))+" instead.");if(!mi(s,["string","array"]))throw new So("Expected second argument to be of type array or string, but found "+di(Yi(s))+" instead.");return s.indexOf(o)>=0},Ys.prototype.eachChild=function(n){n(this.needle),n(this.haystack)},Ys.prototype.outputDefined=function(){return!0},Ys.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ku=function(n,o,s){this.type=Bt,this.needle=n,this.haystack=o,this.fromIndex=s};ku.parse=function(n,o){if(n.length<=2||n.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,Gr),p=o.parse(n[2],2,Gr);if(!s||!p)return null;if(!oo(s.type,[Cr,Fr,Bt,Nr,Gr]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+di(s.type)+" instead");if(n.length===4){var _=o.parse(n[3],3,Bt);return _?new ku(s,p,_):null}return new ku(s,p)},ku.prototype.evaluate=function(n){var o=this.needle.evaluate(n),s=this.haystack.evaluate(n);if(!mi(o,["boolean","string","number","null"]))throw new So("Expected first argument to be of type boolean, string, number or null, but found "+di(Yi(o))+" instead.");if(!mi(s,["string","array"]))throw new So("Expected second argument to be of type array or string, but found "+di(Yi(s))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(n);return s.indexOf(o,p)}return s.indexOf(o)},ku.prototype.eachChild=function(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)},ku.prototype.outputDefined=function(){return!1},ku.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ns=function(n,o,s,p,_,y){this.inputType=n,this.type=o,this.input=s,this.cases=p,this.outputs=_,this.otherwise=y};Ns.parse=function(n,o){if(n.length<5)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if(n.length%2!=1)return o.error("Expected an even number of arguments.");var s,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var _={},y=[],b=2;b<n.length-1;b+=2){var C=n[b],I=n[b+1];Array.isArray(C)||(C=[C]);var D=o.concat(b);if(C.length===0)return D.error("Expected at least one branch label.");for(var z=0,H=C;z<H.length;z+=1){var J=H[z];if(typeof J!="number"&&typeof J!="string")return D.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return D.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof J=="number"&&Math.floor(J)!==J)return D.error("Numeric branch labels must be integer values.");if(s){if(D.checkSubtype(s,Yi(J)))return null}else s=Yi(J);if(_[String(J)]!==void 0)return D.error("Branch labels must be unique.");_[String(J)]=y.length}var re=o.parse(I,b,p);if(!re)return null;p=p||re.type,y.push(re)}var Te=o.parse(n[1],1,Gr);if(!Te)return null;var Re=o.parse(n[n.length-1],n.length-1,p);return Re?Te.type.kind!=="value"&&o.concat(1).checkSubtype(s,Te.type)?null:new Ns(s,p,Te,_,y,Re):null},Ns.prototype.evaluate=function(n){var o=this.input.evaluate(n);return(Yi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)},Ns.prototype.eachChild=function(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)},Ns.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})&&this.otherwise.outputDefined()},Ns.prototype.serialize=function(){for(var n=this,o=["match",this.input.serialize()],s=[],p={},_=0,y=Object.keys(this.cases).sort();_<y.length;_+=1){var b=y[_];(H=p[this.cases[b]])===void 0?(p[this.cases[b]]=s.length,s.push([this.cases[b],[b]])):s[H][1].push(b)}for(var C=function(re){return n.inputType.kind==="number"?Number(re):re},I=0,D=s;I<D.length;I+=1){var z=D[I],H=z[0],J=z[1];o.push(J.length===1?C(J[0]):J.map(C)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Uu=function(n,o,s){this.type=n,this.branches=o,this.otherwise=s};Uu.parse=function(n,o){if(n.length<4)return o.error("Expected at least 3 arguments, but found only "+(n.length-1)+".");if(n.length%2!=0)return o.error("Expected an odd number of arguments.");var s;o.expectedType&&o.expectedType.kind!=="value"&&(s=o.expectedType);for(var p=[],_=1;_<n.length-1;_+=2){var y=o.parse(n[_],_,Cr);if(!y)return null;var b=o.parse(n[_+1],_+1,s);if(!b)return null;p.push([y,b]),s=s||b.type}var C=o.parse(n[n.length-1],n.length-1,s);return C?new Uu(s,p,C):null},Uu.prototype.evaluate=function(n){for(var o=0,s=this.branches;o<s.length;o+=1){var p=s[o],_=p[1];if(p[0].evaluate(n))return _.evaluate(n)}return this.otherwise.evaluate(n)},Uu.prototype.eachChild=function(n){for(var o=0,s=this.branches;o<s.length;o+=1){var p=s[o],_=p[1];n(p[0]),n(_)}n(this.otherwise)},Uu.prototype.outputDefined=function(){return this.branches.every(function(n){return n[1].outputDefined()})&&this.otherwise.outputDefined()},Uu.prototype.serialize=function(){var n=["case"];return this.eachChild(function(o){n.push(o.serialize())}),n};var tl=function(n,o,s,p){this.type=n,this.input=o,this.beginIndex=s,this.endIndex=p};function dh(n,o){return n==="=="||n==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function mh(n,o,s,p){return p.compare(o,s)===0}function Ji(n,o,s){var p=n!=="=="&&n!=="!=";return function(){function _(y,b,C){this.type=Cr,this.lhs=y,this.rhs=b,this.collator=C,this.hasUntypedArgument=y.type.kind==="value"||b.type.kind==="value"}return _.parse=function(y,b){if(y.length!==3&&y.length!==4)return b.error("Expected two or three arguments.");var C=y[0],I=b.parse(y[1],1,Gr);if(!I)return null;if(!dh(C,I.type))return b.concat(1).error('"'+C+`" comparisons are not supported for type '`+di(I.type)+"'.");var D=b.parse(y[2],2,Gr);if(!D)return null;if(!dh(C,D.type))return b.concat(2).error('"'+C+`" comparisons are not supported for type '`+di(D.type)+"'.");if(I.type.kind!==D.type.kind&&I.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot compare types '"+di(I.type)+"' and '"+di(D.type)+"'.");p&&(I.type.kind==="value"&&D.type.kind!=="value"?I=new Qi(D.type,[I]):I.type.kind!=="value"&&D.type.kind==="value"&&(D=new Qi(I.type,[D])));var z=null;if(y.length===4){if(I.type.kind!=="string"&&D.type.kind!=="string"&&I.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(!(z=b.parse(y[3],3,Kn)))return null}return new _(I,D,z)},_.prototype.evaluate=function(y){var b=this.lhs.evaluate(y),C=this.rhs.evaluate(y);if(p&&this.hasUntypedArgument){var I=Yi(b),D=Yi(C);if(I.kind!==D.kind||I.kind!=="string"&&I.kind!=="number")throw new So('Expected arguments for "'+n+'" to be (string, string) or (number, number), but found ('+I.kind+", "+D.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var z=Yi(b),H=Yi(C);if(z.kind!=="string"||H.kind!=="string")return o(y,b,C)}return this.collator?s(y,b,C,this.collator.evaluate(y)):o(y,b,C)},_.prototype.eachChild=function(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var y=[n];return this.eachChild(function(b){y.push(b.serialize())}),y},_}()}tl.parse=function(n,o){if(n.length<=2||n.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,Gr),p=o.parse(n[2],2,Bt);if(!s||!p)return null;if(!oo(s.type,[Ti(Gr),Fr,Gr]))return o.error("Expected first argument to be of type array or string, but found "+di(s.type)+" instead");if(n.length===4){var _=o.parse(n[3],3,Bt);return _?new tl(s.type,s,p,_):null}return new tl(s.type,s,p)},tl.prototype.evaluate=function(n){var o=this.input.evaluate(n),s=this.beginIndex.evaluate(n);if(!mi(o,["string","array"]))throw new So("Expected first argument to be of type array or string, but found "+di(Yi(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(n);return o.slice(s,p)}return o.slice(s)},tl.prototype.eachChild=function(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)},tl.prototype.outputDefined=function(){return!1},tl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var np=Ji("==",function(n,o,s){return o===s},mh),sf=Ji("!=",function(n,o,s){return o!==s},function(n,o,s,p){return!mh(0,o,s,p)}),Of=Ji("<",function(n,o,s){return o<s},function(n,o,s,p){return p.compare(o,s)<0}),jo=Ji(">",function(n,o,s){return o>s},function(n,o,s,p){return p.compare(o,s)>0}),Df=Ji("<=",function(n,o,s){return o<=s},function(n,o,s,p){return p.compare(o,s)<=0}),vh=Ji(">=",function(n,o,s){return o>=s},function(n,o,s,p){return p.compare(o,s)>=0}),os=function(n,o,s,p,_){this.type=Fr,this.number=n,this.locale=o,this.currency=s,this.minFractionDigits=p,this.maxFractionDigits=_};os.parse=function(n,o){if(n.length!==3)return o.error("Expected two arguments.");var s=o.parse(n[1],1,Bt);if(!s)return null;var p=n[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var _=null;if(p.locale&&!(_=o.parse(p.locale,1,Fr)))return null;var y=null;if(p.currency&&!(y=o.parse(p.currency,1,Fr)))return null;var b=null;if(p["min-fraction-digits"]&&!(b=o.parse(p["min-fraction-digits"],1,Bt)))return null;var C=null;return p["max-fraction-digits"]&&!(C=o.parse(p["max-fraction-digits"],1,Bt))?null:new os(s,_,y,b,C)},os.prototype.evaluate=function(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))},os.prototype.eachChild=function(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)},os.prototype.outputDefined=function(){return!1},os.prototype.serialize=function(){var n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]};var zu=function(n){this.type=Bt,this.input=n};zu.parse=function(n,o){if(n.length!==2)return o.error("Expected 1 argument, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+di(s.type)+" instead."):new zu(s):null},zu.prototype.evaluate=function(n){var o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new So("Expected value to be of type string or array, but found "+di(Yi(o))+" instead.")},zu.prototype.eachChild=function(n){n(this.input)},zu.prototype.outputDefined=function(){return!1},zu.prototype.serialize=function(){var n=["length"];return this.eachChild(function(o){n.push(o.serialize())}),n};var bu={"==":np,"!=":sf,">":jo,"<":Of,">=":vh,"<=":Df,array:Qi,at:el,boolean:Qi,case:Uu,coalesce:Ju,collator:Qa,format:Wa,image:Ba,in:Ys,"index-of":ku,interpolate:_o,"interpolate-hcl":_o,"interpolate-lab":_o,length:zu,let:Bs,literal:ao,match:Ns,number:Qi,"number-format":os,object:Qi,slice:tl,step:xs,string:Qi,"to-boolean":vs,"to-color":vs,"to-number":vs,"to-string":vs,var:yu,within:ai};function rl(n,o){var s=o[0],p=o[1],_=o[2],y=o[3];s=s.evaluate(n),p=p.evaluate(n),_=_.evaluate(n);var b=y?y.evaluate(n):1,C=_u(s,p,_,b);if(C)throw new So(C);return new ui(s/255*b,p/255*b,_/255*b,b)}function uf(n,o){return n in o}function Xl(n,o){var s=o[n];return s===void 0?null:s}function su(n){return{type:n}}function Pc(n){return{result:"success",value:n}}function nl(n){return{result:"error",value:n}}function Vu(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Lf(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Oc(n){return!!n.expression&&n.expression.interpolated}function Yn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function lf(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function _h(n){return n}function Zu(n,o,s){return n!==void 0?n:o!==void 0?o:s!==void 0?s:void 0}function Yl(n,o,s,p,_){return Zu(typeof s===_?p[s]:void 0,n.default,o.default)}function Ff(n,o,s){if(Yn(s)!=="number")return Zu(n.default,o.default);var p=n.stops.length;if(p===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[p-1][0])return n.stops[p-1][1];var _=Mc(n.stops.map(function(y){return y[0]}),s);return n.stops[_][1]}function Mi(n,o,s){var p=n.base!==void 0?n.base:1;if(Yn(s)!=="number")return Zu(n.default,o.default);var _=n.stops.length;if(_===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[_-1][0])return n.stops[_-1][1];var y=Mc(n.stops.map(function(H){return H[0]}),s),b=function(H,J,re,Te){var Re=Te-re,qe=H-re;return Re===0?0:J===1?qe/Re:(Math.pow(J,qe)-1)/(Math.pow(J,Re)-1)}(s,p,n.stops[y][0],n.stops[y+1][0]),C=n.stops[y][1],I=n.stops[y+1][1],D=xu[o.type]||_h;if(n.colorSpace&&n.colorSpace!=="rgb"){var z=ph[n.colorSpace];D=function(H,J){return z.reverse(z.interpolate(z.forward(H),z.forward(J),b))}}return typeof C.evaluate=="function"?{evaluate:function(){for(var H=[],J=arguments.length;J--;)H[J]=arguments[J];var re=C.evaluate.apply(void 0,H),Te=I.evaluate.apply(void 0,H);if(re!==void 0&&Te!==void 0)return D(re,Te,b)}}:D(C,I,b)}function oa(n,o,s){return o.type==="color"?s=ui.parse(s):o.type==="formatted"?s=ro.fromString(s.toString()):o.type==="resolvedImage"?s=po.fromString(s.toString()):Yn(s)===o.type||o.type==="enum"&&o.values[s]||(s=void 0),Zu(s,n.default,o.default)}qi.register(bu,{error:[{kind:"error"},[Fr],function(n,o){throw new So(o[0].evaluate(n))}],typeof:[Fr,[Gr],function(n,o){return di(Yi(o[0].evaluate(n)))}],"to-rgba":[Ti(Bt,4),[Ir],function(n,o){return o[0].evaluate(n).toArray()}],rgb:[Ir,[Bt,Bt,Bt],rl],rgba:[Ir,[Bt,Bt,Bt,Bt],rl],has:{type:Cr,overloads:[[[Fr],function(n,o){return uf(o[0].evaluate(n),n.properties())}],[[Fr,Zn],function(n,o){var s=o[1];return uf(o[0].evaluate(n),s.evaluate(n))}]]},get:{type:Gr,overloads:[[[Fr],function(n,o){return Xl(o[0].evaluate(n),n.properties())}],[[Fr,Zn],function(n,o){var s=o[1];return Xl(o[0].evaluate(n),s.evaluate(n))}]]},"feature-state":[Gr,[Fr],function(n,o){return Xl(o[0].evaluate(n),n.featureState||{})}],properties:[Zn,[],function(n){return n.properties()}],"geometry-type":[Fr,[],function(n){return n.geometryType()}],id:[Gr,[],function(n){return n.id()}],zoom:[Bt,[],function(n){return n.globals.zoom}],"heatmap-density":[Bt,[],function(n){return n.globals.heatmapDensity||0}],"line-progress":[Bt,[],function(n){return n.globals.lineProgress||0}],accumulated:[Gr,[],function(n){return n.globals.accumulated===void 0?null:n.globals.accumulated}],"+":[Bt,su(Bt),function(n,o){for(var s=0,p=0,_=o;p<_.length;p+=1)s+=_[p].evaluate(n);return s}],"*":[Bt,su(Bt),function(n,o){for(var s=1,p=0,_=o;p<_.length;p+=1)s*=_[p].evaluate(n);return s}],"-":{type:Bt,overloads:[[[Bt,Bt],function(n,o){var s=o[1];return o[0].evaluate(n)-s.evaluate(n)}],[[Bt],function(n,o){return-o[0].evaluate(n)}]]},"/":[Bt,[Bt,Bt],function(n,o){var s=o[1];return o[0].evaluate(n)/s.evaluate(n)}],"%":[Bt,[Bt,Bt],function(n,o){var s=o[1];return o[0].evaluate(n)%s.evaluate(n)}],ln2:[Bt,[],function(){return Math.LN2}],pi:[Bt,[],function(){return Math.PI}],e:[Bt,[],function(){return Math.E}],"^":[Bt,[Bt,Bt],function(n,o){var s=o[1];return Math.pow(o[0].evaluate(n),s.evaluate(n))}],sqrt:[Bt,[Bt],function(n,o){return Math.sqrt(o[0].evaluate(n))}],log10:[Bt,[Bt],function(n,o){return Math.log(o[0].evaluate(n))/Math.LN10}],ln:[Bt,[Bt],function(n,o){return Math.log(o[0].evaluate(n))}],log2:[Bt,[Bt],function(n,o){return Math.log(o[0].evaluate(n))/Math.LN2}],sin:[Bt,[Bt],function(n,o){return Math.sin(o[0].evaluate(n))}],cos:[Bt,[Bt],function(n,o){return Math.cos(o[0].evaluate(n))}],tan:[Bt,[Bt],function(n,o){return Math.tan(o[0].evaluate(n))}],asin:[Bt,[Bt],function(n,o){return Math.asin(o[0].evaluate(n))}],acos:[Bt,[Bt],function(n,o){return Math.acos(o[0].evaluate(n))}],atan:[Bt,[Bt],function(n,o){return Math.atan(o[0].evaluate(n))}],min:[Bt,su(Bt),function(n,o){return Math.min.apply(Math,o.map(function(s){return s.evaluate(n)}))}],max:[Bt,su(Bt),function(n,o){return Math.max.apply(Math,o.map(function(s){return s.evaluate(n)}))}],abs:[Bt,[Bt],function(n,o){return Math.abs(o[0].evaluate(n))}],round:[Bt,[Bt],function(n,o){var s=o[0].evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Bt,[Bt],function(n,o){return Math.floor(o[0].evaluate(n))}],ceil:[Bt,[Bt],function(n,o){return Math.ceil(o[0].evaluate(n))}],"filter-==":[Cr,[Fr,Gr],function(n,o){var s=o[0],p=o[1];return n.properties()[s.value]===p.value}],"filter-id-==":[Cr,[Gr],function(n,o){var s=o[0];return n.id()===s.value}],"filter-type-==":[Cr,[Fr],function(n,o){var s=o[0];return n.geometryType()===s.value}],"filter-<":[Cr,[Fr,Gr],function(n,o){var s=o[0],p=o[1],_=n.properties()[s.value],y=p.value;return typeof _==typeof y&&_<y}],"filter-id-<":[Cr,[Gr],function(n,o){var s=o[0],p=n.id(),_=s.value;return typeof p==typeof _&&p<_}],"filter->":[Cr,[Fr,Gr],function(n,o){var s=o[0],p=o[1],_=n.properties()[s.value],y=p.value;return typeof _==typeof y&&_>y}],"filter-id->":[Cr,[Gr],function(n,o){var s=o[0],p=n.id(),_=s.value;return typeof p==typeof _&&p>_}],"filter-<=":[Cr,[Fr,Gr],function(n,o){var s=o[0],p=o[1],_=n.properties()[s.value],y=p.value;return typeof _==typeof y&&_<=y}],"filter-id-<=":[Cr,[Gr],function(n,o){var s=o[0],p=n.id(),_=s.value;return typeof p==typeof _&&p<=_}],"filter->=":[Cr,[Fr,Gr],function(n,o){var s=o[0],p=o[1],_=n.properties()[s.value],y=p.value;return typeof _==typeof y&&_>=y}],"filter-id->=":[Cr,[Gr],function(n,o){var s=o[0],p=n.id(),_=s.value;return typeof p==typeof _&&p>=_}],"filter-has":[Cr,[Gr],function(n,o){return o[0].value in n.properties()}],"filter-has-id":[Cr,[],function(n){return n.id()!==null&&n.id()!==void 0}],"filter-type-in":[Cr,[Ti(Fr)],function(n,o){return o[0].value.indexOf(n.geometryType())>=0}],"filter-id-in":[Cr,[Ti(Gr)],function(n,o){return o[0].value.indexOf(n.id())>=0}],"filter-in-small":[Cr,[Fr,Ti(Gr)],function(n,o){var s=o[0];return o[1].value.indexOf(n.properties()[s.value])>=0}],"filter-in-large":[Cr,[Fr,Ti(Gr)],function(n,o){var s=o[0],p=o[1];return function(_,y,b,C){for(;b<=C;){var I=b+C>>1;if(y[I]===_)return!0;y[I]>_?C=I-1:b=I+1}return!1}(n.properties()[s.value],p.value,0,p.value.length-1)}],all:{type:Cr,overloads:[[[Cr,Cr],function(n,o){var s=o[1];return o[0].evaluate(n)&&s.evaluate(n)}],[su(Cr),function(n,o){for(var s=0,p=o;s<p.length;s+=1)if(!p[s].evaluate(n))return!1;return!0}]]},any:{type:Cr,overloads:[[[Cr,Cr],function(n,o){var s=o[1];return o[0].evaluate(n)||s.evaluate(n)}],[su(Cr),function(n,o){for(var s=0,p=o;s<p.length;s+=1)if(p[s].evaluate(n))return!0;return!1}]]},"!":[Cr,[Cr],function(n,o){return!o[0].evaluate(n)}],"is-supported-script":[Cr,[Fr],function(n,o){var s=n.globals&&n.globals.isSupportedScript;return!s||s(o[0].evaluate(n))}],upcase:[Fr,[Fr],function(n,o){return o[0].evaluate(n).toUpperCase()}],downcase:[Fr,[Fr],function(n,o){return o[0].evaluate(n).toLowerCase()}],concat:[Fr,su(Gr),function(n,o){return o.map(function(s){return ra(s.evaluate(n))}).join("")}],"resolved-locale":[Fr,[Kn],function(n,o){return o[0].evaluate(n).resolvedLocale()}]});var Ta=function(n,o){this.expression=n,this._warningHistory={},this._evaluator=new Zo,this._defaultValue=o?function(s){return s.type==="color"&&lf(s.default)?new ui(0,0,0,0):s.type==="color"?ui.parse(s.default)||null:s.default===void 0?null:s.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Es(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in bu}function Cl(n,o){var s=new Nu(bu,[],o?function(_){var y={color:Ir,string:Fr,number:Bt,enum:Fr,boolean:Cr,formatted:Di,resolvedImage:oi};return _.type==="array"?Ti(y[_.value]||Gr,_.length):y[_.type]}(o):void 0),p=s.parse(n,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Pc(new Ta(p,o)):nl(s.errors)}Ta.prototype.evaluateWithoutErrorHandling=function(n,o,s,p,_,y){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=s,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)},Ta.prototype.evaluate=function(n,o,s,p,_,y){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=s||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{var b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new So("Expected value to be one of "+Object.keys(this._enumValues).map(function(C){return JSON.stringify(C)}).join(", ")+", but found "+JSON.stringify(b)+" instead.");return b}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console!="undefined"&&console.warn(C.message)),this._defaultValue}};var il=function(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!Fs(o.expression)};il.prototype.evaluateWithoutErrorHandling=function(n,o,s,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(n,o,s,p,_,y)},il.prototype.evaluate=function(n,o,s,p,_,y){return this._styleExpression.evaluate(n,o,s,p,_,y)};var wl=function(n,o,s,p){this.kind=n,this.zoomStops=s,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!Fs(o.expression),this.interpolationType=p};function Dc(n,o){if((n=Cl(n,o)).result==="error")return n;var s=n.value.expression,p=ys(s);if(!p&&!Vu(o))return nl([new tr("","data expressions not supported")]);var _=au(s,["zoom"]);if(!_&&!Lf(o))return nl([new tr("","zoom expressions not supported")]);var y=function b(C){var I=null;if(C instanceof Bs)I=b(C.result);else if(C instanceof Ju)for(var D=0,z=C.args;D<z.length&&!(I=b(z[D]));D+=1);else(C instanceof xs||C instanceof _o)&&C.input instanceof qi&&C.input.name==="zoom"&&(I=C);return I instanceof tr||C.eachChild(function(H){var J=b(H);J instanceof tr?I=J:!I&&J?I=new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):I&&J&&I!==J&&(I=new tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),I}(s);return y||_?y instanceof tr?nl([y]):y instanceof _o&&!Oc(o)?nl([new tr("",'"interpolate" expressions cannot be used with this property')]):Pc(y?new wl(p?"camera":"composite",n.value,y.labels,y instanceof _o?y.interpolation:void 0):new il(p?"constant":"source",n.value)):nl([new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}wl.prototype.evaluateWithoutErrorHandling=function(n,o,s,p,_,y){return this._styleExpression.evaluateWithoutErrorHandling(n,o,s,p,_,y)},wl.prototype.evaluate=function(n,o,s,p,_,y){return this._styleExpression.evaluate(n,o,s,p,_,y)},wl.prototype.interpolationFactor=function(n,o,s){return this.interpolationType?_o.interpolationFactor(this.interpolationType,n,o,s):0};var ql=function(n,o){this._parameters=n,this._specification=o,Dt(this,function s(p,_){var y,b,C,I=_.type==="color",D=p.stops&&typeof p.stops[0][0]=="object",z=D||!(D||p.property!==void 0),H=p.type||(Oc(_)?"exponential":"interval");if(I&&((p=Dt({},p)).stops&&(p.stops=p.stops.map(function(nn){return[nn[0],ui.parse(nn[1])]})),p.default=ui.parse(p.default?p.default:_.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!ph[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(H==="exponential")y=Mi;else if(H==="interval")y=Ff;else if(H==="categorical"){y=Yl,b=Object.create(null);for(var J=0,re=p.stops;J<re.length;J+=1){var Te=re[J];b[Te[0]]=Te[1]}C=typeof p.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');y=oa}if(D){for(var Re={},qe=[],je=0;je<p.stops.length;je++){var ft=p.stops[je],gt=ft[0].zoom;Re[gt]===void 0&&(Re[gt]={zoom:gt,type:p.type,property:p.property,default:p.default,stops:[]},qe.push(gt)),Re[gt].stops.push([ft[0].value,ft[1]])}for(var zt=[],Ot=0,rr=qe;Ot<rr.length;Ot+=1){var Rr=rr[Ot];zt.push([Re[Rr].zoom,s(Re[Rr],_)])}var Zr={name:"linear"};return{kind:"composite",interpolationType:Zr,interpolationFactor:_o.interpolationFactor.bind(void 0,Zr),zoomStops:zt.map(function(nn){return nn[0]}),evaluate:function(nn,In){var rn=nn.zoom;return Mi({stops:zt,base:p.base},_,rn).evaluate(rn,In)}}}if(z){var xn=H==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:xn,interpolationFactor:_o.interpolationFactor.bind(void 0,xn),zoomStops:p.stops.map(function(nn){return nn[0]}),evaluate:function(nn){return y(p,_,nn.zoom,b,C)}}}return{kind:"source",evaluate:function(nn,In){var rn=In&&In.properties?In.properties[p.property]:void 0;return rn===void 0?Zu(p.default,_.default):y(p,_,rn,b,C)}}}(this._parameters,this._specification))};function qs(n){var o=n.key,s=n.value,p=n.valueSpec||{},_=n.objectElementValidators||{},y=n.style,b=n.styleSpec,C=[],I=Yn(s);if(I!=="object")return[new be(o,s,"object expected, "+I+" found")];for(var D in s){var z=D.split(".")[0],H=p[z]||p["*"],J=void 0;if(_[z])J=_[z];else if(p[z])J=Ei;else if(_["*"])J=_["*"];else{if(!p["*"]){C.push(new be(o,s[D],'unknown property "'+D+'"'));continue}J=Ei}C=C.concat(J({key:(o&&o+".")+D,value:s[D],valueSpec:H,style:y,styleSpec:b,object:s,objectKey:D},s))}for(var re in p)_[re]||p[re].required&&p[re].default===void 0&&s[re]===void 0&&C.push(new be(o,s,'missing required property "'+re+'"'));return C}function cf(n){var o=n.value,s=n.valueSpec,p=n.style,_=n.styleSpec,y=n.key,b=n.arrayElementValidator||Ei;if(Yn(o)!=="array")return[new be(y,o,"array expected, "+Yn(o)+" found")];if(s.length&&o.length!==s.length)return[new be(y,o,"array length "+s.length+" expected, length "+o.length+" found")];if(s["min-length"]&&o.length<s["min-length"])return[new be(y,o,"array length at least "+s["min-length"]+" expected, length "+o.length+" found")];var C={type:s.value,values:s.values};_.$version<7&&(C.function=s.function),Yn(s.value)==="object"&&(C=s.value);for(var I=[],D=0;D<o.length;D++)I=I.concat(b({array:o,arrayIndex:D,value:o[D],valueSpec:C,style:p,styleSpec:_,key:y+"["+D+"]"}));return I}function gh(n){var o=n.key,s=n.value,p=n.valueSpec,_=Yn(s);return _==="number"&&s!=s&&(_="NaN"),_!=="number"?[new be(o,s,"number expected, "+_+" found")]:"minimum"in p&&s<p.minimum?[new be(o,s,s+" is less than the minimum value "+p.minimum)]:"maximum"in p&&s>p.maximum?[new be(o,s,s+" is greater than the maximum value "+p.maximum)]:[]}function yh(n){var o,s,p,_=n.valueSpec,y=ir(n.value.type),b={},C=y!=="categorical"&&n.value.property===void 0,I=!C,D=Yn(n.value.stops)==="array"&&Yn(n.value.stops[0])==="array"&&Yn(n.value.stops[0][0])==="object",z=qs({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(re){if(y==="identity")return[new be(re.key,re.value,'identity function may not have a "stops" property')];var Te=[],Re=re.value;return Te=Te.concat(cf({key:re.key,value:Re,valueSpec:re.valueSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:H})),Yn(Re)==="array"&&Re.length===0&&Te.push(new be(re.key,Re,"array must have at least one stop")),Te},default:function(re){return Ei({key:re.key,value:re.value,valueSpec:_,style:re.style,styleSpec:re.styleSpec})}}});return y==="identity"&&C&&z.push(new be(n.key,n.value,'missing required property "property"')),y==="identity"||n.value.stops||z.push(new be(n.key,n.value,'missing required property "stops"')),y==="exponential"&&n.valueSpec.expression&&!Oc(n.valueSpec)&&z.push(new be(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(I&&!Vu(n.valueSpec)?z.push(new be(n.key,n.value,"property functions not supported")):C&&!Lf(n.valueSpec)&&z.push(new be(n.key,n.value,"zoom functions not supported"))),y!=="categorical"&&!D||n.value.property!==void 0||z.push(new be(n.key,n.value,'"property" property is required')),z;function H(re){var Te=[],Re=re.value,qe=re.key;if(Yn(Re)!=="array")return[new be(qe,Re,"array expected, "+Yn(Re)+" found")];if(Re.length!==2)return[new be(qe,Re,"array length 2 expected, length "+Re.length+" found")];if(D){if(Yn(Re[0])!=="object")return[new be(qe,Re,"object expected, "+Yn(Re[0])+" found")];if(Re[0].zoom===void 0)return[new be(qe,Re,"object stop key must have zoom")];if(Re[0].value===void 0)return[new be(qe,Re,"object stop key must have value")];if(p&&p>ir(Re[0].zoom))return[new be(qe,Re[0].zoom,"stop zoom values must appear in ascending order")];ir(Re[0].zoom)!==p&&(p=ir(Re[0].zoom),s=void 0,b={}),Te=Te.concat(qs({key:qe+"[0]",value:Re[0],valueSpec:{zoom:{}},style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:gh,value:J}}))}else Te=Te.concat(J({key:qe+"[0]",value:Re[0],valueSpec:{},style:re.style,styleSpec:re.styleSpec},Re));return Es(Ct(Re[1]))?Te.concat([new be(qe+"[1]",Re[1],"expressions are not allowed in function stops.")]):Te.concat(Ei({key:qe+"[1]",value:Re[1],valueSpec:_,style:re.style,styleSpec:re.styleSpec}))}function J(re,Te){var Re=Yn(re.value),qe=ir(re.value),je=re.value!==null?re.value:Te;if(o){if(Re!==o)return[new be(re.key,je,Re+" stop domain type must match previous stop domain type "+o)]}else o=Re;if(Re!=="number"&&Re!=="string"&&Re!=="boolean")return[new be(re.key,je,"stop domain value must be a number, string, or boolean")];if(Re!=="number"&&y!=="categorical"){var ft="number expected, "+Re+" found";return Vu(_)&&y===void 0&&(ft+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new be(re.key,je,ft)]}return y!=="categorical"||Re!=="number"||isFinite(qe)&&Math.floor(qe)===qe?y!=="categorical"&&Re==="number"&&s!==void 0&&qe<s?[new be(re.key,je,"stop domain values must appear in ascending order")]:(s=qe,y==="categorical"&&qe in b?[new be(re.key,je,"stop domain values must be unique")]:(b[qe]=!0,[])):[new be(re.key,je,"integer expected, found "+qe)]}}function ol(n){var o=(n.expressionContext==="property"?Dc:Cl)(Ct(n.value),n.valueSpec);if(o.result==="error")return o.value.map(function(p){return new be(""+n.key+p.key,n.value,p.message)});var s=o.value.expression||o.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new be(n.key,n.value,'Invalid data expression for "'+n.propertyKey+'". Output values must be contained as literals within the expression.')];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Fs(s))return[new be(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Fs(s))return[new be(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!au(s,["zoom","feature-state"]))return[new be(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ys(s))return[new be(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jo(n){var o=n.key,s=n.value,p=n.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(ir(s))===-1&&_.push(new be(o,s,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(p.values).indexOf(ir(s))===-1&&_.push(new be(o,s,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(s)+" found")),_}function al(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(var o=0,s=n.slice(1);o<s.length;o+=1){var p=s[o];if(!al(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}ql.deserialize=function(n){return new ql(n._parameters,n._specification)},ql.serialize=function(n){return{_parameters:n._parameters,_specification:n._specification}};var Kl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rl(n){if(n==null)return{filter:function(){return!0},needGeometry:!1};al(n)||(n=ff(n));var o=Cl(n,Kl);if(o.result==="error")throw new Error(o.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,p,_){return o.value.evaluate(s,p,{},_)},needGeometry:function s(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var _=1;_<p.length;_++)if(s(p[_]))return!0;return!1}(n)}}function ip(n,o){return n<o?-1:n>o?1:0}function ff(n){if(!n)return!0;var o,s=n[0];return n.length<=1?s!=="any":s==="=="?Lc(n[1],n[2],"=="):s==="!="?Fc(Lc(n[1],n[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Lc(n[1],n[2],s):s==="any"?(o=n.slice(1),["any"].concat(o.map(ff))):s==="all"?["all"].concat(n.slice(1).map(ff)):s==="none"?["all"].concat(n.slice(1).map(ff).map(Fc)):s==="in"?sl(n[1],n.slice(2)):s==="!in"?Fc(sl(n[1],n.slice(2))):s==="has"?Bf(n[1]):s==="!has"?Fc(Bf(n[1])):s!=="within"||n}function Lc(n,o,s){switch(n){case"$type":return["filter-type-"+s,o];case"$id":return["filter-id-"+s,o];default:return["filter-"+s,n,o]}}function sl(n,o){if(o.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(s){return typeof s!=typeof o[0]})?["filter-in-large",n,["literal",o.sort(ip)]]:["filter-in-small",n,["literal",o]]}}function Bf(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Fc(n){return["!",n]}function Nf(n){return al(Ct(n.value))?ol(Dt({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(s){var p=s.value,_=s.key;if(Yn(p)!=="array")return[new be(_,p,"array expected, "+Yn(p)+" found")];var y,b=s.styleSpec,C=[];if(p.length<1)return[new be(_,p,"filter array must have at least 1 element")];switch(C=C.concat(Jo({key:_+"[0]",value:p[0],valueSpec:b.filter_operator,style:s.style,styleSpec:s.styleSpec})),ir(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&ir(p[1])==="$type"&&C.push(new be(_,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&C.push(new be(_,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(y=Yn(p[1]))!=="string"&&C.push(new be(_+"[1]",p[1],"string expected, "+y+" found"));for(var I=2;I<p.length;I++)y=Yn(p[I]),ir(p[1])==="$type"?C=C.concat(Jo({key:_+"["+I+"]",value:p[I],valueSpec:b.geometry_type,style:s.style,styleSpec:s.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&C.push(new be(_+"["+I+"]",p[I],"string, number, or boolean expected, "+y+" found"));break;case"any":case"all":case"none":for(var D=1;D<p.length;D++)C=C.concat(o({key:_+"["+D+"]",value:p[D],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":y=Yn(p[1]),p.length!==2?C.push(new be(_,p,'filter array for "'+p[0]+'" operator must have 2 elements')):y!=="string"&&C.push(new be(_+"[1]",p[1],"string expected, "+y+" found"));break;case"within":y=Yn(p[1]),p.length!==2?C.push(new be(_,p,'filter array for "'+p[0]+'" operator must have 2 elements')):y!=="object"&&C.push(new be(_+"[1]",p[1],"object expected, "+y+" found"))}return C}(n)}function Bc(n,o){var s=n.key,p=n.style,_=n.styleSpec,y=n.value,b=n.objectKey,C=_[o+"_"+n.layerType];if(!C)return[];var I=b.match(/^(.*)-transition$/);if(o==="paint"&&I&&C[I[1]]&&C[I[1]].transition)return Ei({key:s,value:y,valueSpec:_.transition,style:p,styleSpec:_});var D,z=n.valueSpec||C[b];if(!z)return[new be(s,y,'unknown property "'+b+'"')];if(Yn(y)==="string"&&Vu(z)&&!z.tokens&&(D=/^{([^}]+)}$/.exec(y)))return[new be(s,y,'"'+b+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(D[1])+" }`.")];var H=[];return n.layerType==="symbol"&&(b==="text-field"&&p&&!p.glyphs&&H.push(new be(s,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&lf(Ct(y))&&ir(y.type)==="identity"&&H.push(new be(s,y,'"text-font" does not support identity functions'))),H.concat(Ei({key:n.key,value:y,valueSpec:z,style:p,styleSpec:_,expressionContext:"property",propertyType:o,propertyKey:b}))}function kf(n){return Bc(n,"paint")}function $l(n){return Bc(n,"layout")}function Ql(n){var o=[],s=n.value,p=n.key,_=n.style,y=n.styleSpec;s.type||s.ref||o.push(new be(p,s,'either "type" or "ref" is required'));var b,C=ir(s.type),I=ir(s.ref);if(s.id)for(var D=ir(s.id),z=0;z<n.arrayIndex;z++){var H=_.layers[z];ir(H.id)===D&&o.push(new be(p,s.id,'duplicate layer id "'+s.id+'", previously used at line '+H.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(Te){Te in s&&o.push(new be(p,s[Te],'"'+Te+'" is prohibited for ref layers'))}),_.layers.forEach(function(Te){ir(Te.id)===I&&(b=Te)}),b?b.ref?o.push(new be(p,s.ref,"ref cannot reference another ref layer")):C=ir(b.type):o.push(new be(p,s.ref,'ref layer "'+I+'" not found'));else if(C!=="background")if(s.source){var J=_.sources&&_.sources[s.source],re=J&&ir(J.type);J?re==="vector"&&C==="raster"?o.push(new be(p,s.source,'layer "'+s.id+'" requires a raster source')):re==="raster"&&C!=="raster"?o.push(new be(p,s.source,'layer "'+s.id+'" requires a vector source')):re!=="vector"||s["source-layer"]?re==="raster-dem"&&C!=="hillshade"?o.push(new be(p,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!s.paint||!s.paint["line-gradient"]||re==="geojson"&&J.lineMetrics||o.push(new be(p,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new be(p,s,'layer "'+s.id+'" must specify a "source-layer"')):o.push(new be(p,s.source,'source "'+s.source+'" not found'))}else o.push(new be(p,s,'missing required property "source"'));return o=o.concat(qs({key:p,value:s,valueSpec:y.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ei({key:p+".type",value:s.type,valueSpec:y.layer.type,style:n.style,styleSpec:n.styleSpec,object:s,objectKey:"type"})},filter:Nf,layout:function(Te){return qs({layer:s,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Re){return $l(Dt({layerType:C},Re))}}})},paint:function(Te){return qs({layer:s,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Re){return kf(Dt({layerType:C},Re))}}})}}}))}function Ml(n){var o=n.value,s=n.key,p=Yn(o);return p!=="string"?[new be(s,o,"string expected, "+p+" found")]:[]}var go={promoteId:function(n){var o=n.key,s=n.value;if(Yn(s)==="string")return Ml({key:o,value:s});var p=[];for(var _ in s)p.push.apply(p,Ml({key:o+"."+_,value:s[_]}));return p}};function hf(n){var o=n.value,s=n.key,p=n.styleSpec,_=n.style;if(!o.type)return[new be(s,o,'"type" is required')];var y,b=ir(o.type);switch(b){case"vector":case"raster":case"raster-dem":return qs({key:s,value:o,valueSpec:p["source_"+b.replace("-","_")],style:n.style,styleSpec:p,objectElementValidators:go});case"geojson":if(y=qs({key:s,value:o,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:go}),o.cluster)for(var C in o.clusterProperties){var I=o.clusterProperties[C],D=I[0],z=typeof D=="string"?[D,["accumulated"],["get",C]]:D;y.push.apply(y,ol({key:s+"."+C+".map",value:I[1],expressionContext:"cluster-map"})),y.push.apply(y,ol({key:s+"."+C+".reduce",value:z,expressionContext:"cluster-reduce"}))}return y;case"video":return qs({key:s,value:o,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return qs({key:s,value:o,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new be(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jo({key:s+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:p})}}function Su(n){var o=n.value,s=n.styleSpec,p=s.light,_=n.style,y=[],b=Yn(o);if(o===void 0)return y;if(b!=="object")return y.concat([new be("light",o,"object expected, "+b+" found")]);for(var C in o){var I=C.match(/^(.*)-transition$/);y=y.concat(I&&p[I[1]]&&p[I[1]].transition?Ei({key:C,value:o[C],valueSpec:s.transition,style:_,styleSpec:s}):p[C]?Ei({key:C,value:o[C],valueSpec:p[C],style:_,styleSpec:s}):[new be(C,o[C],'unknown property "'+C+'"')])}return y}var Il={"*":function(){return[]},array:cf,boolean:function(n){var o=n.value,s=n.key,p=Yn(o);return p!=="boolean"?[new be(s,o,"boolean expected, "+p+" found")]:[]},number:gh,color:function(n){var o=n.key,s=n.value,p=Yn(s);return p!=="string"?[new be(o,s,"color expected, "+p+" found")]:Jn(s)===null?[new be(o,s,'color expected, "'+s+'" found')]:[]},constants:ut,enum:Jo,filter:Nf,function:yh,layer:Ql,object:qs,source:hf,light:Su,string:Ml,formatted:function(n){return Ml(n).length===0?[]:ol(n)},resolvedImage:function(n){return Ml(n).length===0?[]:ol(n)}};function Ei(n){var o=n.value,s=n.valueSpec,p=n.styleSpec;return s.expression&&lf(ir(o))?yh(n):s.expression&&Es(Ct(o))?ol(n):s.type&&Il[s.type]?Il[s.type](n):qs(Dt({},n,{valueSpec:s.type?p[s.type]:s}))}function mo(n){var o=n.value,s=n.key,p=Ml(n);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new be(s,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new be(s,o,'"glyphs" url must include a "{range}" token'))),p}function as(n,o){o===void 0&&(o=ee);var s=[];return s=s.concat(Ei({key:"",value:n,valueSpec:o.$root,styleSpec:o,style:n,objectElementValidators:{glyphs:mo,"*":function(){return[]}}})),n.constants&&(s=s.concat(ut({key:"constants",value:n.constants,style:n,styleSpec:o}))),ul(s)}function ul(n){return[].concat(n).sort(function(o,s){return o.line-s.line})}function Jl(n){return function(){for(var o=[],s=arguments.length;s--;)o[s]=arguments[s];return ul(n.apply(this,o))}}as.source=Jl(hf),as.light=Jl(Su),as.layer=Jl(Ql),as.filter=Jl(Nf),as.paintProperty=Jl(kf),as.layoutProperty=Jl($l);var Nc=as,Uf=Nc.light,zf=Nc.paintProperty,ec=Nc.layoutProperty;function Au(n,o){var s=!1;if(o&&o.length)for(var p=0,_=o;p<_.length;p+=1)n.fire(new Ie(new Error(_[p].message))),s=!0;return s}var Ca=wo;function wo(n,o,s){var p=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var _=new Int32Array(this.arrayBuffer);n=_[0],this.d=(o=_[1])+2*(s=_[2]);for(var y=0;y<this.d*this.d;y++){var b=_[3+y],C=_[3+y+1];p.push(b===C?null:_.subarray(b,C))}var I=_[3+p.length+1];this.keys=_.subarray(_[3+p.length],I),this.bboxes=_.subarray(I),this.insert=this._insertReadonly}else{this.d=o+2*s;for(var D=0;D<this.d*this.d;D++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=n,this.padding=s,this.scale=o/n,this.uid=0;var z=s/o*n;this.min=-z,this.max=n+z}wo.prototype.insert=function(n,o,s,p,_){this._forEachCell(o,s,p,_,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(_)},wo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},wo.prototype._insertCell=function(n,o,s,p,_,y){this.cells[_].push(y)},wo.prototype.query=function(n,o,s,p,_){var y=this.min,b=this.max;if(n<=y&&o<=y&&b<=s&&b<=p&&!_)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(n,o,s,p,this._queryCell,C,{},_),C},wo.prototype._queryCell=function(n,o,s,p,_,y,b,C){var I=this.cells[_];if(I!==null)for(var D=this.keys,z=this.bboxes,H=0;H<I.length;H++){var J=I[H];if(b[J]===void 0){var re=4*J;(C?C(z[re+0],z[re+1],z[re+2],z[re+3]):n<=z[re+2]&&o<=z[re+3]&&s>=z[re+0]&&p>=z[re+1])?(b[J]=!0,y.push(D[J])):b[J]=!1}}},wo.prototype._forEachCell=function(n,o,s,p,_,y,b,C){for(var I=this._convertToCellCoord(n),D=this._convertToCellCoord(o),z=this._convertToCellCoord(s),H=this._convertToCellCoord(p),J=I;J<=z;J++)for(var re=D;re<=H;re++){var Te=this.d*re+J;if((!C||C(this._convertFromCellCoord(J),this._convertFromCellCoord(re),this._convertFromCellCoord(J+1),this._convertFromCellCoord(re+1)))&&_.call(this,n,o,s,p,Te,y,b,C))return}},wo.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},wo.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},wo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,o=3+this.cells.length+1+1,s=0,p=0;p<this.cells.length;p++)s+=this.cells[p].length;var _=new Int32Array(o+s+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var y=o,b=0;b<n.length;b++){var C=n[b];_[3+b]=y,_.set(C,y),y+=C.length}return _[3+n.length]=y,_.set(this.keys,y),_[3+n.length+1]=y+=this.keys.length,_.set(this.bboxes,y),y+=this.bboxes.length,_.buffer};var tc=G.ImageData,Vf=G.ImageBitmap,zi={};function cn(n,o,s){s===void 0&&(s={}),Object.defineProperty(o,"_classRegistryKey",{value:n,writeable:!1}),zi[n]={klass:o,omit:s.omit||[],shallow:s.shallow||[]}}for(var bs in cn("Object",Object),Ca.serialize=function(n,o){var s=n.toArrayBuffer();return o&&o.push(s),{buffer:s}},Ca.deserialize=function(n){return new Ca(n.buffer)},cn("Grid",Ca),cn("Color",ui),cn("Error",Error),cn("ResolvedImage",po),cn("StylePropertyFunction",ql),cn("StyleExpression",Ta,{omit:["_evaluator"]}),cn("ZoomDependentExpression",wl),cn("ZoomConstantExpression",il),cn("CompoundExpression",qi,{omit:["_evaluate"]}),bu)bu[bs]._classRegistryKey||cn("Expression_"+bs,bu[bs]);function pf(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function rc(n){return Vf&&n instanceof Vf}function ss(n,o){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(pf(n)||rc(n))return o&&o.push(n),n;if(ArrayBuffer.isView(n)){var s=n;return o&&o.push(s.buffer),s}if(n instanceof tc)return o&&o.push(n.data.buffer),n;if(Array.isArray(n)){for(var p=[],_=0,y=n;_<y.length;_+=1)p.push(ss(y[_],o));return p}if(typeof n=="object"){var b=n.constructor,C=b._classRegistryKey;if(!C)throw new Error("can't serialize object of unregistered class");var I=b.serialize?b.serialize(n,o):{};if(!b.serialize){for(var D in n)if(n.hasOwnProperty(D)&&!(zi[C].omit.indexOf(D)>=0)){var z=n[D];I[D]=zi[C].shallow.indexOf(D)>=0?z:ss(z,o)}n instanceof Error&&(I.message=n.message)}if(I.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(I.$name=C),I}throw new Error("can't serialize object of type "+typeof n)}function Ki(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||pf(n)||rc(n)||ArrayBuffer.isView(n)||n instanceof tc)return n;if(Array.isArray(n))return n.map(Ki);if(typeof n=="object"){var o=n.$name||"Object",s=zi[o].klass;if(!s)throw new Error("can't deserialize unregistered class "+o);if(s.deserialize)return s.deserialize(n);for(var p=Object.create(s.prototype),_=0,y=Object.keys(n);_<y.length;_+=1){var b=y[_];if(b!=="$name"){var C=n[b];p[b]=zi[o].shallow.indexOf(b)>=0?C:Ki(C)}}return p}throw new Error("can't deserialize object of type "+typeof n)}var kc=function(){this.first=!0};kc.prototype.update=function(n,o){var s=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=o),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=s,!0))};var Ur={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},Khmer:function(n){return n>=6016&&n<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};function ju(n){for(var o=0,s=n;o<s.length;o+=1)if(nc(s[o].charCodeAt(0)))return!0;return!1}function nc(n){return!(n!==746&&n!==747&&(n<4352||!(Ur["Bopomofo Extended"](n)||Ur.Bopomofo(n)||Ur["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ur["CJK Compatibility Ideographs"](n)||Ur["CJK Compatibility"](n)||Ur["CJK Radicals Supplement"](n)||Ur["CJK Strokes"](n)||!(!Ur["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ur["CJK Unified Ideographs Extension A"](n)||Ur["CJK Unified Ideographs"](n)||Ur["Enclosed CJK Letters and Months"](n)||Ur["Hangul Compatibility Jamo"](n)||Ur["Hangul Jamo Extended-A"](n)||Ur["Hangul Jamo Extended-B"](n)||Ur["Hangul Jamo"](n)||Ur["Hangul Syllables"](n)||Ur.Hiragana(n)||Ur["Ideographic Description Characters"](n)||Ur.Kanbun(n)||Ur["Kangxi Radicals"](n)||Ur["Katakana Phonetic Extensions"](n)||Ur.Katakana(n)&&n!==12540||!(!Ur["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ur["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ur["Unified Canadian Aboriginal Syllabics"](n)||Ur["Unified Canadian Aboriginal Syllabics Extended"](n)||Ur["Vertical Forms"](n)||Ur["Yijing Hexagram Symbols"](n)||Ur["Yi Syllables"](n)||Ur["Yi Radicals"](n))))}function df(n){return!(nc(n)||function(o){return!!(Ur["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Ur["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Ur["Letterlike Symbols"](o)||Ur["Number Forms"](o)||Ur["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Ur["Control Pictures"](o)&&o!==9251||Ur["Optical Character Recognition"](o)||Ur["Enclosed Alphanumerics"](o)||Ur["Geometric Shapes"](o)||Ur["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Ur["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Ur["CJK Symbols and Punctuation"](o)||Ur.Katakana(o)||Ur["Private Use Area"](o)||Ur["CJK Compatibility Forms"](o)||Ur["Small Form Variants"](o)||Ur["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(n))}function ks(n){return n>=1424&&n<=2303||Ur["Arabic Presentation Forms-A"](n)||Ur["Arabic Presentation Forms-B"](n)}function Us(n,o){return!(!o&&ks(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ur.Khmer(n))}function mf(n){for(var o=0,s=n;o<s.length;o+=1)if(ks(s[o].charCodeAt(0)))return!0;return!1}var Zf=null,Ko="unavailable",Tu=null,xh=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Ko="error"),Zf&&Zf(n)};function Uc(){jf.fire(new de("pluginStateChange",{pluginStatus:Ko,pluginURL:Tu}))}var jf=new Ze,Hf=function(){return Ko},Ss=function(){if(Ko!=="deferred"||!Tu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ko="loading",Uc(),Tu&&ur({url:Tu},function(n){n?xh(n):(Ko="loaded",Uc())})},Ks={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ko==="loaded"||Ks.applyArabicShaping!=null},isLoading:function(){return Ko==="loading"},setState:function(n){Ko=n.pluginStatus,Tu=n.pluginURL},isParsed:function(){return Ks.applyArabicShaping!=null&&Ks.processBidirectionalText!=null&&Ks.processStyledBidirectionalText!=null},getPluginURL:function(){return Tu}},qn=function(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kc,this.transition={})};qn.prototype.isSupportedScript=function(n){return function(o,s){for(var p=0,_=o;p<_.length;p+=1)if(!Us(_[p].charCodeAt(0),s))return!1;return!0}(n,Ks.isLoaded())},qn.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},qn.prototype.getCrossfadeParameters=function(){var n=this.zoom,o=n-Math.floor(n),s=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*o}};var zs=function(n,o){this.property=n,this.value=o,this.expression=function(s,p){if(lf(s))return new ql(s,p);if(Es(s)){var _=Dc(s,p);if(_.result==="error")throw new Error(_.value.map(function(b){return b.key+": "+b.message}).join(", "));return _.value}var y=s;return typeof s=="string"&&p.type==="color"&&(y=ui.parse(s)),{kind:"constant",evaluate:function(){return y}}}(o===void 0?n.specification.default:o,n.specification)};zs.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},zs.prototype.possiblyEvaluate=function(n,o,s){return this.property.possiblyEvaluate(this,n,o,s)};var As=function(n){this.property=n,this.value=new zs(n,void 0)};As.prototype.transitioned=function(n,o){return new Pl(this.property,this.value,o,At({},n.transition,this.transition),n.now)},As.prototype.untransitioned=function(){return new Pl(this.property,this.value,null,{},0)};var ma=function(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)};ma.prototype.getValue=function(n){return ze(this._values[n].value.value)},ma.prototype.setValue=function(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new As(this._values[n].property)),this._values[n].value=new zs(this._values[n].property,o===null?void 0:ze(o))},ma.prototype.getTransition=function(n){return ze(this._values[n].transition)},ma.prototype.setTransition=function(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new As(this._values[n].property)),this._values[n].transition=ze(o)||void 0},ma.prototype.serialize=function(){for(var n={},o=0,s=Object.keys(this._values);o<s.length;o+=1){var p=s[o],_=this.getValue(p);_!==void 0&&(n[p]=_);var y=this.getTransition(p);y!==void 0&&(n[p+"-transition"]=y)}return n},ma.prototype.transitioned=function(n,o){for(var s=new Hu(this._properties),p=0,_=Object.keys(this._values);p<_.length;p+=1){var y=_[p];s._values[y]=this._values[y].transitioned(n,o._values[y])}return s},ma.prototype.untransitioned=function(){for(var n=new Hu(this._properties),o=0,s=Object.keys(this._values);o<s.length;o+=1){var p=s[o];n._values[p]=this._values[p].untransitioned()}return n};var Pl=function(n,o,s,p,_){this.property=n,this.value=o,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,n.specification.transition&&(p.delay||p.duration)&&(this.prior=s)};Pl.prototype.possiblyEvaluate=function(n,o,s){var p=n.now||0,_=this.value.possiblyEvaluate(n,o,s),y=this.prior;if(y){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return y.possiblyEvaluate(n,o,s);var b=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,o,s),_,function(C){if(C<=0)return 0;if(C>=1)return 1;var I=C*C,D=I*C;return 4*(C<.5?D:3*(C-I)+D-.75)}(b))}return _};var Hu=function(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)};Hu.prototype.possiblyEvaluate=function(n,o,s){for(var p=new ic(this._properties),_=0,y=Object.keys(this._values);_<y.length;_+=1){var b=y[_];p._values[b]=this._values[b].possiblyEvaluate(n,o,s)}return p},Hu.prototype.hasTransition=function(){for(var n=0,o=Object.keys(this._values);n<o.length;n+=1)if(this._values[o[n]].prior)return!0;return!1};var Vs=function(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)};Vs.prototype.getValue=function(n){return ze(this._values[n].value)},Vs.prototype.setValue=function(n,o){this._values[n]=new zs(this._values[n].property,o===null?void 0:ze(o))},Vs.prototype.serialize=function(){for(var n={},o=0,s=Object.keys(this._values);o<s.length;o+=1){var p=s[o],_=this.getValue(p);_!==void 0&&(n[p]=_)}return n},Vs.prototype.possiblyEvaluate=function(n,o,s){for(var p=new ic(this._properties),_=0,y=Object.keys(this._values);_<y.length;_+=1){var b=y[_];p._values[b]=this._values[b].possiblyEvaluate(n,o,s)}return p};var Ga=function(n,o,s){this.property=n,this.value=o,this.parameters=s};Ga.prototype.isConstant=function(){return this.value.kind==="constant"},Ga.prototype.constantOr=function(n){return this.value.kind==="constant"?this.value.value:n},Ga.prototype.evaluate=function(n,o,s,p){return this.property.evaluate(this.value,this.parameters,n,o,s,p)};var ic=function(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)};ic.prototype.get=function(n){return this._values[n]};var Sn=function(n){this.specification=n};Sn.prototype.possiblyEvaluate=function(n,o){return n.expression.evaluate(o)},Sn.prototype.interpolate=function(n,o,s){var p=xu[this.specification.type];return p?p(n,o,s):n};var fn=function(n,o){this.specification=n,this.overrides=o};fn.prototype.possiblyEvaluate=function(n,o,s,p){return new Ga(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},s,p)}:n.expression,o)},fn.prototype.interpolate=function(n,o,s){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new Ga(this,{kind:"constant",value:void 0},n.parameters);var p=xu[this.specification.type];return p?new Ga(this,{kind:"constant",value:p(n.value.value,o.value.value,s)},n.parameters):n},fn.prototype.evaluate=function(n,o,s,p,_,y){return n.kind==="constant"?n.value:n.evaluate(o,s,p,_,y)};var Ts=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(s,p,_,y){if(s.value===void 0)return new Ga(this,{kind:"constant",value:void 0},p);if(s.expression.kind==="constant"){var b=s.expression.evaluate(p,null,{},_,y),C=s.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,I=this._calculate(C,C,C,p);return new Ga(this,{kind:"constant",value:I},p)}if(s.expression.kind==="camera"){var D=this._calculate(s.expression.evaluate({zoom:p.zoom-1}),s.expression.evaluate({zoom:p.zoom}),s.expression.evaluate({zoom:p.zoom+1}),p);return new Ga(this,{kind:"constant",value:D},p)}return new Ga(this,s.expression,p)},o.prototype.evaluate=function(s,p,_,y,b,C){if(s.kind==="source"){var I=s.evaluate(p,_,y,b,C);return this._calculate(I,I,I,p)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(p.zoom)-1},_,y),s.evaluate({zoom:Math.floor(p.zoom)},_,y),s.evaluate({zoom:Math.floor(p.zoom)+1},_,y),p):s.value},o.prototype._calculate=function(s,p,_,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:s,to:p}:{from:_,to:p}},o.prototype.interpolate=function(s){return s},o}(fn),Xa=function(n){this.specification=n};Xa.prototype.possiblyEvaluate=function(n,o,s,p){if(n.value!==void 0){if(n.expression.kind==="constant"){var _=n.expression.evaluate(o,null,{},s,p);return this._calculate(_,_,_,o)}return this._calculate(n.expression.evaluate(new qn(Math.floor(o.zoom-1),o)),n.expression.evaluate(new qn(Math.floor(o.zoom),o)),n.expression.evaluate(new qn(Math.floor(o.zoom+1),o)),o)}},Xa.prototype._calculate=function(n,o,s,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:s,to:o}},Xa.prototype.interpolate=function(n){return n};var $s=function(n){this.specification=n};$s.prototype.possiblyEvaluate=function(n,o,s,p){return!!n.expression.evaluate(o,null,{},s,p)},$s.prototype.interpolate=function(){return!1};var Ro=function(n){for(var o in this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],n){var s=n[o];s.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new zs(s,void 0),_=this.defaultTransitionablePropertyValues[o]=new As(s);this.defaultTransitioningPropertyValues[o]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};cn("DataDrivenProperty",fn),cn("DataConstantProperty",Sn),cn("CrossFadedDataDrivenProperty",Ts),cn("CrossFadedProperty",Xa),cn("ColorRampProperty",$s);var Qs=function(n){function o(s,p){if(n.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),p.layout&&(this._unevaluatedLayout=new Vs(p.layout)),p.paint)){for(var _ in this._transitionablePaint=new ma(p.paint),s.paint)this.setPaintProperty(_,s.paint[_],{validate:!1});for(var y in s.layout)this.setLayoutProperty(y,s.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ic(p.paint)}}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},o.prototype.setLayoutProperty=function(s,p,_){_===void 0&&(_={}),p!=null&&this._validate(ec,"layers."+this.id+".layout."+s,s,p,_)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,p):this.visibility=p)},o.prototype.getPaintProperty=function(s){return bi(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)},o.prototype.setPaintProperty=function(s,p,_){if(_===void 0&&(_={}),p!=null&&this._validate(zf,"layers."+this.id+".paint."+s,s,p,_))return!1;if(bi(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-11),p||void 0),!1;var y=this._transitionablePaint._values[s],b=y.property.specification["property-type"]==="cross-faded-data-driven",C=y.value.isDataDriven(),I=y.value;this._transitionablePaint.setValue(s,p),this._handleSpecialPaintPropertyUpdate(s);var D=this._transitionablePaint._values[s].value;return D.isDataDriven()||C||b||this._handleOverridablePaintPropertyUpdate(s,I,D)},o.prototype._handleSpecialPaintPropertyUpdate=function(s){},o.prototype._handleOverridablePaintPropertyUpdate=function(s,p,_){return!1},o.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(s,p){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,p)},o.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Mt(s,function(p,_){return!(p===void 0||_==="layout"&&!Object.keys(p).length||_==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(s,p,_,y,b){return b===void 0&&(b={}),(!b||b.validate!==!1)&&Au(this,s.call(Nc,{key:p,layerType:this.type,objectKey:_,value:y,styleSpec:ee,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var s in this.paint._values){var p=this.paint.get(s);if(p instanceof Ga&&Vu(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(Ze),Cu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ll=function(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Vi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function wa(n,o){o===void 0&&(o=1);var s=0,p=0;return{members:n.map(function(_){var y=Cu[_.type].BYTES_PER_ELEMENT,b=s=Wf(s,Math.max(o,y)),C=_.components||1;return p=Math.max(p,y),s+=y*C,{name:_.name,type:_.type,components:C,offset:b}}),size:Wf(s,Math.max(p,o)),alignment:o}}function Wf(n,o){return Math.ceil(n/o)*o}Vi.serialize=function(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}},Vi.deserialize=function(n){var o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},Vi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Vi.prototype.clear=function(){this.length=0},Vi.prototype.resize=function(n){this.reserve(n),this.length=n},Vi.prototype.reserve=function(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},Vi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var cl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p){var _=this.length;return this.resize(_+1),this.emplace(_,s,p)},o.prototype.emplace=function(s,p,_){var y=2*s;return this.int16[y+0]=p,this.int16[y+1]=_,s},o}(Vi);cl.prototype.bytesPerElement=4,cn("StructArrayLayout2i4",cl);var vf=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y){var b=this.length;return this.resize(b+1),this.emplace(b,s,p,_,y)},o.prototype.emplace=function(s,p,_,y,b){var C=4*s;return this.int16[C+0]=p,this.int16[C+1]=_,this.int16[C+2]=y,this.int16[C+3]=b,s},o}(Vi);vf.prototype.bytesPerElement=8,cn("StructArrayLayout4i8",vf);var Wu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,_,y,b,C)},o.prototype.emplace=function(s,p,_,y,b,C,I){var D=6*s;return this.int16[D+0]=p,this.int16[D+1]=_,this.int16[D+2]=y,this.int16[D+3]=b,this.int16[D+4]=C,this.int16[D+5]=I,s},o}(Vi);Wu.prototype.bytesPerElement=12,cn("StructArrayLayout2i4i12",Wu);var us=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,_,y,b,C)},o.prototype.emplace=function(s,p,_,y,b,C,I){var D=4*s,z=8*s;return this.int16[D+0]=p,this.int16[D+1]=_,this.uint8[z+4]=y,this.uint8[z+5]=b,this.uint8[z+6]=C,this.uint8[z+7]=I,s},o}(Vi);us.prototype.bytesPerElement=8,cn("StructArrayLayout2i4ub8",us);var oc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p){var _=this.length;return this.resize(_+1),this.emplace(_,s,p)},o.prototype.emplace=function(s,p,_){var y=2*s;return this.float32[y+0]=p,this.float32[y+1]=_,s},o}(Vi);oc.prototype.bytesPerElement=8,cn("StructArrayLayout2f8",oc);var wu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C,I,D,z,H){var J=this.length;return this.resize(J+1),this.emplace(J,s,p,_,y,b,C,I,D,z,H)},o.prototype.emplace=function(s,p,_,y,b,C,I,D,z,H,J){var re=10*s;return this.uint16[re+0]=p,this.uint16[re+1]=_,this.uint16[re+2]=y,this.uint16[re+3]=b,this.uint16[re+4]=C,this.uint16[re+5]=I,this.uint16[re+6]=D,this.uint16[re+7]=z,this.uint16[re+8]=H,this.uint16[re+9]=J,s},o}(Vi);wu.prototype.bytesPerElement=20,cn("StructArrayLayout10ui20",wu);var ac=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C,I,D,z,H,J,re){var Te=this.length;return this.resize(Te+1),this.emplace(Te,s,p,_,y,b,C,I,D,z,H,J,re)},o.prototype.emplace=function(s,p,_,y,b,C,I,D,z,H,J,re,Te){var Re=12*s;return this.int16[Re+0]=p,this.int16[Re+1]=_,this.int16[Re+2]=y,this.int16[Re+3]=b,this.uint16[Re+4]=C,this.uint16[Re+5]=I,this.uint16[Re+6]=D,this.uint16[Re+7]=z,this.int16[Re+8]=H,this.int16[Re+9]=J,this.int16[Re+10]=re,this.int16[Re+11]=Te,s},o}(Vi);ac.prototype.bytesPerElement=24,cn("StructArrayLayout4i4ui4i24",ac);var Ol=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,_)},o.prototype.emplace=function(s,p,_,y){var b=3*s;return this.float32[b+0]=p,this.float32[b+1]=_,this.float32[b+2]=y,s},o}(Vi);Ol.prototype.bytesPerElement=12,cn("StructArrayLayout3f12",Ol);var _f=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},o.prototype.emplace=function(s,p){return this.uint32[1*s+0]=p,s},o}(Vi);_f.prototype.bytesPerElement=4,cn("StructArrayLayout1ul4",_f);var gf=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C,I,D,z){var H=this.length;return this.resize(H+1),this.emplace(H,s,p,_,y,b,C,I,D,z)},o.prototype.emplace=function(s,p,_,y,b,C,I,D,z,H){var J=10*s,re=5*s;return this.int16[J+0]=p,this.int16[J+1]=_,this.int16[J+2]=y,this.int16[J+3]=b,this.int16[J+4]=C,this.int16[J+5]=I,this.uint32[re+3]=D,this.uint16[J+8]=z,this.uint16[J+9]=H,s},o}(Vi);gf.prototype.bytesPerElement=20,cn("StructArrayLayout6i1ul2ui20",gf);var fl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,_,y,b,C)},o.prototype.emplace=function(s,p,_,y,b,C,I){var D=6*s;return this.int16[D+0]=p,this.int16[D+1]=_,this.int16[D+2]=y,this.int16[D+3]=b,this.int16[D+4]=C,this.int16[D+5]=I,s},o}(Vi);fl.prototype.bytesPerElement=12,cn("StructArrayLayout2i2i2i12",fl);var Dl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b){var C=this.length;return this.resize(C+1),this.emplace(C,s,p,_,y,b)},o.prototype.emplace=function(s,p,_,y,b,C){var I=4*s,D=8*s;return this.float32[I+0]=p,this.float32[I+1]=_,this.float32[I+2]=y,this.int16[D+6]=b,this.int16[D+7]=C,s},o}(Vi);Dl.prototype.bytesPerElement=16,cn("StructArrayLayout2f1f2i16",Dl);var Ll=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y){var b=this.length;return this.resize(b+1),this.emplace(b,s,p,_,y)},o.prototype.emplace=function(s,p,_,y,b){var C=12*s,I=3*s;return this.uint8[C+0]=p,this.uint8[C+1]=_,this.float32[I+1]=y,this.float32[I+2]=b,s},o}(Vi);Ll.prototype.bytesPerElement=12,cn("StructArrayLayout2ub2f12",Ll);var aa=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,_)},o.prototype.emplace=function(s,p,_,y){var b=3*s;return this.uint16[b+0]=p,this.uint16[b+1]=_,this.uint16[b+2]=y,s},o}(Vi);aa.prototype.bytesPerElement=6,cn("StructArrayLayout3ui6",aa);var Js=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C,I,D,z,H,J,re,Te,Re,qe,je,ft){var gt=this.length;return this.resize(gt+1),this.emplace(gt,s,p,_,y,b,C,I,D,z,H,J,re,Te,Re,qe,je,ft)},o.prototype.emplace=function(s,p,_,y,b,C,I,D,z,H,J,re,Te,Re,qe,je,ft,gt){var zt=24*s,Ot=12*s,rr=48*s;return this.int16[zt+0]=p,this.int16[zt+1]=_,this.uint16[zt+2]=y,this.uint16[zt+3]=b,this.uint32[Ot+2]=C,this.uint32[Ot+3]=I,this.uint32[Ot+4]=D,this.uint16[zt+10]=z,this.uint16[zt+11]=H,this.uint16[zt+12]=J,this.float32[Ot+7]=re,this.float32[Ot+8]=Te,this.uint8[rr+36]=Re,this.uint8[rr+37]=qe,this.uint8[rr+38]=je,this.uint32[Ot+10]=ft,this.int16[zt+22]=gt,s},o}(Vi);Js.prototype.bytesPerElement=48,cn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Js);var zc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y,b,C,I,D,z,H,J,re,Te,Re,qe,je,ft,gt,zt,Ot,rr,Rr,Zr,xn,nn,In,rn,ci){var Vn=this.length;return this.resize(Vn+1),this.emplace(Vn,s,p,_,y,b,C,I,D,z,H,J,re,Te,Re,qe,je,ft,gt,zt,Ot,rr,Rr,Zr,xn,nn,In,rn,ci)},o.prototype.emplace=function(s,p,_,y,b,C,I,D,z,H,J,re,Te,Re,qe,je,ft,gt,zt,Ot,rr,Rr,Zr,xn,nn,In,rn,ci,Vn){var hn=34*s,pi=17*s;return this.int16[hn+0]=p,this.int16[hn+1]=_,this.int16[hn+2]=y,this.int16[hn+3]=b,this.int16[hn+4]=C,this.int16[hn+5]=I,this.int16[hn+6]=D,this.int16[hn+7]=z,this.uint16[hn+8]=H,this.uint16[hn+9]=J,this.uint16[hn+10]=re,this.uint16[hn+11]=Te,this.uint16[hn+12]=Re,this.uint16[hn+13]=qe,this.uint16[hn+14]=je,this.uint16[hn+15]=ft,this.uint16[hn+16]=gt,this.uint16[hn+17]=zt,this.uint16[hn+18]=Ot,this.uint16[hn+19]=rr,this.uint16[hn+20]=Rr,this.uint16[hn+21]=Zr,this.uint16[hn+22]=xn,this.uint32[pi+12]=nn,this.float32[pi+13]=In,this.float32[pi+14]=rn,this.float32[pi+15]=ci,this.float32[pi+16]=Vn,s},o}(Vi);zc.prototype.bytesPerElement=68,cn("StructArrayLayout8i15ui1ul4f68",zc);var uu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},o.prototype.emplace=function(s,p){return this.float32[1*s+0]=p,s},o}(Vi);uu.prototype.bytesPerElement=4,cn("StructArrayLayout1f4",uu);var eu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,_)},o.prototype.emplace=function(s,p,_,y){var b=3*s;return this.int16[b+0]=p,this.int16[b+1]=_,this.int16[b+2]=y,s},o}(Vi);eu.prototype.bytesPerElement=6,cn("StructArrayLayout3i6",eu);var Gf=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,_)},o.prototype.emplace=function(s,p,_,y){var b=4*s;return this.uint32[2*s+0]=p,this.uint16[b+2]=_,this.uint16[b+3]=y,s},o}(Vi);Gf.prototype.bytesPerElement=8,cn("StructArrayLayout1ul2ui8",Gf);var Vc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p){var _=this.length;return this.resize(_+1),this.emplace(_,s,p)},o.prototype.emplace=function(s,p,_){var y=2*s;return this.uint16[y+0]=p,this.uint16[y+1]=_,s},o}(Vi);Vc.prototype.bytesPerElement=4,cn("StructArrayLayout2ui4",Vc);var Zc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},o.prototype.emplace=function(s,p){return this.uint16[1*s+0]=p,s},o}(Vi);Zc.prototype.bytesPerElement=2,cn("StructArrayLayout1ui2",Zc);var sc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,_,y){var b=this.length;return this.resize(b+1),this.emplace(b,s,p,_,y)},o.prototype.emplace=function(s,p,_,y,b){var C=4*s;return this.float32[C+0]=p,this.float32[C+1]=_,this.float32[C+2]=y,this.float32[C+3]=b,s},o}(Vi);sc.prototype.bytesPerElement=16,cn("StructArrayLayout4f16",sc);var l=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new W(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,s),o}(ll);l.prototype.size=20;var f=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new l(this,s)},o}(gf);cn("CollisionBoxArray",f);var c=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,s),o}(ll);c.prototype.size=48;var d=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new c(this,s)},o}(Js);cn("PlacedSymbolArray",d);var x=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,s),o}(ll);x.prototype.size=68;var S=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new x(this,s)},o}(zc);cn("SymbolInstanceArray",S);var T=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getoffsetX=function(s){return this.float32[1*s+0]},o}(uu);cn("GlyphOffsetArray",T);var M=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getx=function(s){return this.int16[3*s+0]},o.prototype.gety=function(s){return this.int16[3*s+1]},o.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},o}(eu);cn("SymbolLineVertexArray",M);var k=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,s),o}(ll);k.prototype.size=8;var X=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new k(this,s)},o}(Gf);cn("FeatureIndexArray",X);var oe=wa([{name:"a_pos",components:2,type:"Int16"}],4).members,le=function(n){n===void 0&&(n=[]),this.segments=n};function he(n,o){return 256*(n=ht(Math.floor(n),0,255))+ht(Math.floor(o),0,255)}le.prototype.prepareSegment=function(n,o,s,p){var _=this.segments[this.segments.length-1];return n>le.MAX_VERTEX_ARRAY_LENGTH&&ct("Max vertices per segment is "+le.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+n),(!_||_.vertexLength+n>le.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:o.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_},le.prototype.get=function(){return this.segments},le.prototype.destroy=function(){for(var n=0,o=this.segments;n<o.length;n+=1){var s=o[n];for(var p in s.vaos)s.vaos[p].destroy()}},le.simpleSegment=function(n,o,s,p){return new le([{vertexOffset:n,primitiveOffset:o,vertexLength:s,primitiveLength:p,vaos:{},sortKey:0}])},le.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,cn("SegmentVector",le);var Pe=wa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),we=it(function(n){n.exports=function(o,s){var p,_,y,b,C,I,D,z;for(_=o.length-(p=3&o.length),y=s,C=3432918353,I=461845907,z=0;z<_;)D=255&o.charCodeAt(z)|(255&o.charCodeAt(++z))<<8|(255&o.charCodeAt(++z))<<16|(255&o.charCodeAt(++z))<<24,++z,y=27492+(65535&(b=5*(65535&(y=(y^=D=(65535&(D=(D=(65535&D)*C+(((D>>>16)*C&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(D=0,p){case 3:D^=(255&o.charCodeAt(z+2))<<16;case 2:D^=(255&o.charCodeAt(z+1))<<8;case 1:y^=D=(65535&(D=(D=(65535&(D^=255&o.charCodeAt(z)))*C+(((D>>>16)*C&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295}return y^=o.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),Xe=it(function(n){n.exports=function(o,s){for(var p,_=o.length,y=s^_,b=0;_>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(b)|(255&o.charCodeAt(++b))<<8|(255&o.charCodeAt(++b))<<16|(255&o.charCodeAt(++b))<<24))+((1540483477*(p>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++b;switch(_){case 3:y^=(255&o.charCodeAt(b+2))<<16;case 2:y^=(255&o.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&o.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),Ae=we,We=Xe;Ae.murmur3=we,Ae.murmur2=We;var nt=function(){this.ids=[],this.positions=[],this.indexed=!1};nt.prototype.add=function(n,o,s,p){this.ids.push(Vt(n)),this.positions.push(o,s,p)},nt.prototype.getPositions=function(n){for(var o=Vt(n),s=0,p=this.ids.length-1;s<p;){var _=s+p>>1;this.ids[_]>=o?p=_:s=_+1}for(var y=[];this.ids[s]===o;)y.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return y},nt.serialize=function(n,o){var s=new Float64Array(n.ids),p=new Uint32Array(n.positions);return function _(y,b,C,I){for(;C<I;){for(var D=y[C+I>>1],z=C-1,H=I+1;;){do z++;while(y[z]<D);do H--;while(y[H]>D);if(z>=H)break;Rt(y,z,H),Rt(b,3*z,3*H),Rt(b,3*z+1,3*H+1),Rt(b,3*z+2,3*H+2)}H-C<I-H?(_(y,b,C,H),C=H+1):(_(y,b,H+1,I),I=H)}}(s,p,0,s.length-1),o&&o.push(s.buffer,p.buffer),{ids:s,positions:p}},nt.deserialize=function(n){var o=new nt;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o};var vt=Math.pow(2,53)-1;function Vt(n){var o=+n;return!isNaN(o)&&o<=vt?o:Ae(String(n))}function Rt(n,o,s){var p=n[o];n[o]=n[s],n[s]=p}cn("FeaturePositionMap",nt);var Xt=function(n,o){this.gl=n.gl,this.location=o},or=function(n){function o(s,p){n.call(this,s,p),this.current=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},o}(Xt),Pr=function(n){function o(s,p){n.call(this,s,p),this.current=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},o}(Xt),wr=function(n){function o(s,p){n.call(this,s,p),this.current=[0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},o}(Xt),en=function(n){function o(s,p){n.call(this,s,p),this.current=[0,0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},o}(Xt),An=function(n){function o(s,p){n.call(this,s,p),this.current=[0,0,0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},o}(Xt),Cn=function(n){function o(s,p){n.call(this,s,p),this.current=ui.transparent}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},o}(Xt),vn=new Float32Array(16),wi=function(n){function o(s,p){n.call(this,s,p),this.current=vn}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var p=1;p<16;p++)if(s[p]!==this.current[p]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},o}(Xt);function Kr(n){return[he(255*n.r,255*n.g),he(255*n.b,255*n.a)]}var Hn=function(n,o,s){this.value=n,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=s};Hn.prototype.setUniform=function(n,o,s){n.set(s.constantOr(this.value))},Hn.prototype.getBinding=function(n,o,s){return this.type==="color"?new Cn(n,o):new Pr(n,o)};var si=function(n,o){this.uniformNames=o.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};si.prototype.setConstantPatternPositions=function(n,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=n.tlbr},si.prototype.setUniform=function(n,o,s,p){var _=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&n.set(_)},si.prototype.getBinding=function(n,o,s){return s.substr(0,9)==="u_pattern"?new An(n,o):new Pr(n,o)};var jn=function(n,o,s,p){this.expression=n,this.type=s,this.maxValue=0,this.paintVertexAttributes=o.map(function(_){return{name:"a_"+_,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new p};jn.prototype.populatePaintArray=function(n,o,s,p,_){var y=this.paintVertexArray.length,b=this.expression.evaluate(new qn(0),o,{},p,[],_);this.paintVertexArray.resize(n),this._setPaintValue(y,n,b)},jn.prototype.updatePaintArray=function(n,o,s,p){var _=this.expression.evaluate({zoom:0},s,p);this._setPaintValue(n,o,_)},jn.prototype._setPaintValue=function(n,o,s){if(this.type==="color")for(var p=Kr(s),_=n;_<o;_++)this.paintVertexArray.emplace(_,p[0],p[1]);else{for(var y=n;y<o;y++)this.paintVertexArray.emplace(y,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},jn.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Un=function(n,o,s,p,_,y){this.expression=n,this.uniformNames=o.map(function(b){return"u_"+b+"_t"}),this.type=s,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=o.map(function(b){return{name:"a_"+b,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new y};Un.prototype.populatePaintArray=function(n,o,s,p,_){var y=this.expression.evaluate(new qn(this.zoom),o,{},p,[],_),b=this.expression.evaluate(new qn(this.zoom+1),o,{},p,[],_),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,y,b)},Un.prototype.updatePaintArray=function(n,o,s,p){var _=this.expression.evaluate({zoom:this.zoom},s,p),y=this.expression.evaluate({zoom:this.zoom+1},s,p);this._setPaintValue(n,o,_,y)},Un.prototype._setPaintValue=function(n,o,s,p){if(this.type==="color")for(var _=Kr(s),y=Kr(p),b=n;b<o;b++)this.paintVertexArray.emplace(b,_[0],_[1],y[0],y[1]);else{for(var C=n;C<o;C++)this.paintVertexArray.emplace(C,s,p);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(p))}},Un.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Un.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Un.prototype.setUniform=function(n,o){var s=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=ht(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);n.set(p)},Un.prototype.getBinding=function(n,o,s){return new Pr(n,o)};var ei=function(n,o,s,p,_,y){this.expression=n,this.type=o,this.useIntegerZoom=s,this.zoom=p,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};ei.prototype.populatePaintArray=function(n,o,s){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(p,n,o.patterns&&o.patterns[this.layerId],s)},ei.prototype.updatePaintArray=function(n,o,s,p,_){this._setPaintValues(n,o,s.patterns&&s.patterns[this.layerId],_)},ei.prototype._setPaintValues=function(n,o,s,p){if(p&&s){var _=p[s.min],y=p[s.mid],b=p[s.max];if(_&&y&&b)for(var C=n;C<o;C++)this.zoomInPaintVertexArray.emplace(C,y.tl[0],y.tl[1],y.br[0],y.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],y.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,y.tl[0],y.tl[1],y.br[0],y.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],y.pixelRatio,b.pixelRatio)}},ei.prototype.upload=function(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Pe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Pe.members,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Bn=function(n,o,s){this.binders={},this._buffers=[];var p=[];for(var _ in n.paint._values)if(s(_)){var y=n.paint.get(_);if(y instanceof Ga&&Vu(y.property.specification)){var b=Oo(_,n.type),C=y.value,I=y.property.specification.type,D=y.property.useIntegerZoom,z=y.property.specification["property-type"],H=z==="cross-faded"||z==="cross-faded-data-driven";if(C.kind==="constant")this.binders[_]=H?new si(C.value,b):new Hn(C.value,b,I),p.push("/u_"+_);else if(C.kind==="source"||H){var J=Do(_,I,"source");this.binders[_]=H?new ei(C,I,D,o,J,n.id):new jn(C,b,I,J),p.push("/a_"+_)}else{var re=Do(_,I,"composite");this.binders[_]=new Un(C,b,I,D,o,re),p.push("/z_"+_)}}}this.cacheKey=p.sort().join("")};Bn.prototype.getMaxValue=function(n){var o=this.binders[n];return o instanceof jn||o instanceof Un?o.maxValue:0},Bn.prototype.populatePaintArrays=function(n,o,s,p,_){for(var y in this.binders){var b=this.binders[y];(b instanceof jn||b instanceof Un||b instanceof ei)&&b.populatePaintArray(n,o,s,p,_)}},Bn.prototype.setConstantPatternPositions=function(n,o){for(var s in this.binders){var p=this.binders[s];p instanceof si&&p.setConstantPatternPositions(n,o)}},Bn.prototype.updatePaintArrays=function(n,o,s,p,_){var y=!1;for(var b in n)for(var C=0,I=o.getPositions(b);C<I.length;C+=1){var D=I[C],z=s.feature(D.index);for(var H in this.binders){var J=this.binders[H];if((J instanceof jn||J instanceof Un||J instanceof ei)&&J.expression.isStateDependent===!0){var re=p.paint.get(H);J.expression=re.value,J.updatePaintArray(D.start,D.end,z,n[b],_),y=!0}}}return y},Bn.prototype.defines=function(){var n=[];for(var o in this.binders){var s=this.binders[o];(s instanceof Hn||s instanceof si)&&n.push.apply(n,s.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return n},Bn.prototype.getBinderAttributes=function(){var n=[];for(var o in this.binders){var s=this.binders[o];if(s instanceof jn||s instanceof Un)for(var p=0;p<s.paintVertexAttributes.length;p++)n.push(s.paintVertexAttributes[p].name);else if(s instanceof ei)for(var _=0;_<Pe.members.length;_++)n.push(Pe.members[_].name)}return n},Bn.prototype.getBinderUniforms=function(){var n=[];for(var o in this.binders){var s=this.binders[o];if(s instanceof Hn||s instanceof si||s instanceof Un)for(var p=0,_=s.uniformNames;p<_.length;p+=1)n.push(_[p])}return n},Bn.prototype.getPaintVertexBuffers=function(){return this._buffers},Bn.prototype.getUniforms=function(n,o){var s=[];for(var p in this.binders){var _=this.binders[p];if(_ instanceof Hn||_ instanceof si||_ instanceof Un)for(var y=0,b=_.uniformNames;y<b.length;y+=1){var C=b[y];if(o[C]){var I=_.getBinding(n,o[C],C);s.push({name:C,property:p,binding:I})}}}return s},Bn.prototype.setUniforms=function(n,o,s,p){for(var _=0,y=o;_<y.length;_+=1){var b=y[_],C=b.name,I=b.property;this.binders[I].setUniform(b.binding,p,s.get(I),C)}},Bn.prototype.updatePaintBuffers=function(n){for(var o in this._buffers=[],this.binders){var s=this.binders[o];if(n&&s instanceof ei){var p=n.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(s instanceof jn||s instanceof Un)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Bn.prototype.upload=function(n){for(var o in this.binders){var s=this.binders[o];(s instanceof jn||s instanceof Un||s instanceof ei)&&s.upload(n)}this.updatePaintBuffers()},Bn.prototype.destroy=function(){for(var n in this.binders){var o=this.binders[n];(o instanceof jn||o instanceof Un||o instanceof ei)&&o.destroy()}};var On=function(n,o,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var p=0,_=n;p<_.length;p+=1){var y=_[p];this.programConfigurations[y.id]=new Bn(y,o,s)}this.needsUpload=!1,this._featureMap=new nt,this._bufferOffset=0};function Oo(n,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(o+"-","").replace(/-/g,"_")]}function Do(n,o,s){var p={color:{source:oc,composite:sc},number:{source:uu,composite:oc}},_=function(y){return{"line-pattern":{source:wu,composite:wu},"fill-pattern":{source:wu,composite:wu},"fill-extrusion-pattern":{source:wu,composite:wu}}[y]}(n);return _&&_[s]||p[o][s]}On.prototype.populatePaintArrays=function(n,o,s,p,_,y){for(var b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(n,o,p,_,y);o.id!==void 0&&this._featureMap.add(o.id,s,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0},On.prototype.updatePaintArrays=function(n,o,s,p){for(var _=0,y=s;_<y.length;_+=1){var b=y[_];this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(n,this._featureMap,o,b,p)||this.needsUpload}},On.prototype.get=function(n){return this.programConfigurations[n]},On.prototype.upload=function(n){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}},On.prototype.destroy=function(){for(var n in this.programConfigurations)this.programConfigurations[n].destroy()},cn("ConstantBinder",Hn),cn("CrossFadedConstantBinder",si),cn("SourceExpressionBinder",jn),cn("CrossFadedCompositeBinder",ei),cn("CompositeExpressionBinder",Un),cn("ProgramConfiguration",Bn,{omit:["_buffers"]}),cn("ProgramConfigurationSet",On);var Ra=Math.pow(2,14)-1,va=-Ra-1;function Ao(n){for(var o=8192/n.extent,s=n.loadGeometry(),p=0;p<s.length;p++)for(var _=s[p],y=0;y<_.length;y++){var b=_[y],C=Math.round(b.x*o),I=Math.round(b.y*o);b.x=ht(C,va,Ra),b.y=ht(I,va,Ra),(C<b.x||C>b.x+1||I<b.y||I>b.y+1)&&ct("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function Lo(n,o){return{type:n.type,id:n.id,properties:n.properties,geometry:o?Ao(n):[]}}function Ja(n,o,s,p,_){n.emplaceBack(2*o+(p+1)/2,2*s+(_+1)/2)}var Na=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new cl,this.indexArray=new aa,this.segments=new le,this.programConfigurations=new On(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function lu(n,o){for(var s=0;s<n.length;s++)if(cu(o,n[s]))return!0;for(var p=0;p<o.length;p++)if(cu(n,o[p]))return!0;return!!uc(n,o)}function Ya(n,o,s){return!!cu(n,o)||!!Ru(o,n,s)}function Zs(n,o){if(n.length===1)return Xu(o,n[0]);for(var s=0;s<o.length;s++)for(var p=o[s],_=0;_<p.length;_++)if(cu(n,p[_]))return!0;for(var y=0;y<n.length;y++)if(Xu(o,n[y]))return!0;for(var b=0;b<o.length;b++)if(uc(n,o[b]))return!0;return!1}function Cs(n,o,s){if(n.length>1){if(uc(n,o))return!0;for(var p=0;p<o.length;p++)if(Ru(o[p],n,s))return!0}for(var _=0;_<n.length;_++)if(Ru(n[_],o,s))return!0;return!1}function uc(n,o){if(n.length===0||o.length===0)return!1;for(var s=0;s<n.length-1;s++)for(var p=n[s],_=n[s+1],y=0;y<o.length-1;y++)if(Fl(p,_,o[y],o[y+1]))return!0;return!1}function Fl(n,o,s,p){return nr(n,s,p)!==nr(o,s,p)&&nr(n,o,s)!==nr(n,o,p)}function Ru(n,o,s){var p=s*s;if(o.length===1)return n.distSqr(o[0])<p;for(var _=1;_<o.length;_++)if(Gu(n,o[_-1],o[_])<p)return!0;return!1}function Gu(n,o,s){var p=o.distSqr(s);if(p===0)return n.distSqr(o);var _=((n.x-o.x)*(s.x-o.x)+(n.y-o.y)*(s.y-o.y))/p;return n.distSqr(_<0?o:_>1?s:s.sub(o)._mult(_)._add(o))}function Xu(n,o){for(var s,p,_,y=!1,b=0;b<n.length;b++)for(var C=0,I=(s=n[b]).length-1;C<s.length;I=C++)(p=s[C]).y>o.y!=(_=s[I]).y>o.y&&o.x<(_.x-p.x)*(o.y-p.y)/(_.y-p.y)+p.x&&(y=!y);return y}function cu(n,o){for(var s=!1,p=0,_=n.length-1;p<n.length;_=p++){var y=n[p],b=n[_];y.y>o.y!=b.y>o.y&&o.x<(b.x-y.x)*(o.y-y.y)/(b.y-y.y)+y.x&&(s=!s)}return s}function Yu(n,o,s){var p=s[0],_=s[2];if(n.x<p.x&&o.x<p.x||n.x>_.x&&o.x>_.x||n.y<p.y&&o.y<p.y||n.y>_.y&&o.y>_.y)return!1;var y=nr(n,o,s[0]);return y!==nr(n,o,s[1])||y!==nr(n,o,s[2])||y!==nr(n,o,s[3])}function ka(n,o,s){var p=o.paint.get(n).value;return p.kind==="constant"?p.value:s.programConfigurations.get(o.id).getMaxValue(n)}function Ho(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function ls(n,o,s,p,_){if(!o[0]&&!o[1])return n;var y=W.convert(o)._mult(_);s==="viewport"&&y._rotate(-p);for(var b=[],C=0;C<n.length;C++)b.push(n[C].sub(y));return b}Na.prototype.populate=function(n,o,s){var p=this.layers[0],_=[],y=null;p.type==="circle"&&(y=p.layout.get("circle-sort-key"));for(var b=0,C=n;b<C.length;b+=1){var I=C[b],D=I.feature,z=I.id,H=I.index,J=I.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,Te=Lo(D,re);if(this.layers[0]._featureFilter.filter(new qn(this.zoom),Te,s)){var Re=y?y.evaluate(Te,{},s):void 0,qe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:J,index:H,geometry:re?Te.geometry:Ao(D),patterns:{},sortKey:Re};_.push(qe)}}y&&_.sort(function(Zr,xn){return Zr.sortKey-xn.sortKey});for(var je=0,ft=_;je<ft.length;je+=1){var gt=ft[je],zt=gt.geometry,Ot=gt.index,rr=gt.sourceLayerIndex,Rr=n[Ot].feature;this.addFeature(gt,zt,Ot,s),o.featureIndex.insert(Rr,zt,Ot,rr,this.index)}},Na.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},Na.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Na.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Na.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},Na.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Na.prototype.addFeature=function(n,o,s,p){for(var _=0,y=o;_<y.length;_+=1)for(var b=0,C=y[_];b<C.length;b+=1){var I=C[b],D=I.x,z=I.y;if(!(D<0||D>=8192||z<0||z>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),J=H.vertexLength;Ja(this.layoutVertexArray,D,z,-1,-1),Ja(this.layoutVertexArray,D,z,1,-1),Ja(this.layoutVertexArray,D,z,1,1),Ja(this.layoutVertexArray,D,z,-1,1),this.indexArray.emplaceBack(J,J+1,J+2),this.indexArray.emplaceBack(J,J+3,J+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,{},p)},cn("CircleBucket",Na,{omit:["layers"]});var tu=new Ro({"circle-sort-key":new fn(ee.layout_circle["circle-sort-key"])}),fu={paint:new Ro({"circle-radius":new fn(ee.paint_circle["circle-radius"]),"circle-color":new fn(ee.paint_circle["circle-color"]),"circle-blur":new fn(ee.paint_circle["circle-blur"]),"circle-opacity":new fn(ee.paint_circle["circle-opacity"]),"circle-translate":new Sn(ee.paint_circle["circle-translate"]),"circle-translate-anchor":new Sn(ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Sn(ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Sn(ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new fn(ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new fn(ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new fn(ee.paint_circle["circle-stroke-opacity"])}),layout:tu},yi=typeof Float32Array!="undefined"?Float32Array:Array;function Ma(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Fo(n,o,s){var p=o[0],_=o[1],y=o[2],b=o[3],C=o[4],I=o[5],D=o[6],z=o[7],H=o[8],J=o[9],re=o[10],Te=o[11],Re=o[12],qe=o[13],je=o[14],ft=o[15],gt=s[0],zt=s[1],Ot=s[2],rr=s[3];return n[0]=gt*p+zt*C+Ot*H+rr*Re,n[1]=gt*_+zt*I+Ot*J+rr*qe,n[2]=gt*y+zt*D+Ot*re+rr*je,n[3]=gt*b+zt*z+Ot*Te+rr*ft,n[4]=(gt=s[4])*p+(zt=s[5])*C+(Ot=s[6])*H+(rr=s[7])*Re,n[5]=gt*_+zt*I+Ot*J+rr*qe,n[6]=gt*y+zt*D+Ot*re+rr*je,n[7]=gt*b+zt*z+Ot*Te+rr*ft,n[8]=(gt=s[8])*p+(zt=s[9])*C+(Ot=s[10])*H+(rr=s[11])*Re,n[9]=gt*_+zt*I+Ot*J+rr*qe,n[10]=gt*y+zt*D+Ot*re+rr*je,n[11]=gt*b+zt*z+Ot*Te+rr*ft,n[12]=(gt=s[12])*p+(zt=s[13])*C+(Ot=s[14])*H+(rr=s[15])*Re,n[13]=gt*_+zt*I+Ot*J+rr*qe,n[14]=gt*y+zt*D+Ot*re+rr*je,n[15]=gt*b+zt*z+Ot*Te+rr*ft,n}Math.hypot||(Math.hypot=function(){for(var n=arguments,o=0,s=arguments.length;s--;)o+=n[s]*n[s];return Math.sqrt(o)});var Mu,lc=Fo;function hl(n,o,s){var p=o[0],_=o[1],y=o[2],b=o[3];return n[0]=s[0]*p+s[4]*_+s[8]*y+s[12]*b,n[1]=s[1]*p+s[5]*_+s[9]*y+s[13]*b,n[2]=s[2]*p+s[6]*_+s[10]*y+s[14]*b,n[3]=s[3]*p+s[7]*_+s[11]*y+s[15]*b,n}Mu=new yi(3),yi!=Float32Array&&(Mu[0]=0,Mu[1]=0,Mu[2]=0),function(){var n=new yi(4);yi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)}();var cc=(function(){var n=new yi(2);yi!=Float32Array&&(n[0]=0,n[1]=0)}(),function(n){function o(s){n.call(this,s,fu)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(s){return new Na(s)},o.prototype.queryRadius=function(s){var p=s;return ka("circle-radius",this,p)+ka("circle-stroke-width",this,p)+Ho(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(s,p,_,y,b,C,I,D){for(var z=ls(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,I),H=this.paint.get("circle-radius").evaluate(p,_)+this.paint.get("circle-stroke-width").evaluate(p,_),J=this.paint.get("circle-pitch-alignment")==="map",re=J?z:function(Rr,Zr){return Rr.map(function(xn){return pl(xn,Zr)})}(z,D),Te=J?H*I:H,Re=0,qe=y;Re<qe.length;Re+=1)for(var je=0,ft=qe[Re];je<ft.length;je+=1){var gt=ft[je],zt=J?gt:pl(gt,D),Ot=Te,rr=hl([],[gt.x,gt.y,0,1],D);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ot*=rr[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ot*=C.cameraToCenterDistance/rr[3]),Ya(re,zt,Ot))return!0}return!1},o}(Qs));function pl(n,o){var s=hl([],[n.x,n.y,0,1],o);return new W(s[0]/s[3],s[1]/s[3])}var qu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Na);function js(n,o,s,p){var _=o.width,y=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==_*y*s)throw new RangeError("mismatched image size")}else p=new Uint8Array(_*y*s);return n.width=_,n.height=y,n.data=p,n}function jc(n,o,s){var p=o.width,_=o.height;if(p!==n.width||_!==n.height){var y=js({},{width:p,height:_},s);Eh(n,y,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,p),height:Math.min(n.height,_)},s),n.width=p,n.height=_,n.data=y.data}}function Eh(n,o,s,p,_,y){if(_.width===0||_.height===0)return o;if(_.width>n.width||_.height>n.height||s.x>n.width-_.width||s.y>n.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||p.x>o.width-_.width||p.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var b=n.data,C=o.data,I=0;I<_.height;I++)for(var D=((s.y+I)*n.width+s.x)*y,z=((p.y+I)*o.width+p.x)*y,H=0;H<_.width*y;H++)C[z+H]=b[D+H];return o}cn("HeatmapBucket",qu,{omit:["layers"]});var ws=function(n,o){js(this,n,1,o)};ws.prototype.resize=function(n){jc(this,n,1)},ws.prototype.clone=function(){return new ws({width:this.width,height:this.height},new Uint8Array(this.data))},ws.copy=function(n,o,s,p,_){Eh(n,o,s,p,_,1)};var cs=function(n,o){js(this,n,4,o)};cs.prototype.resize=function(n){jc(this,n,4)},cs.prototype.replace=function(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n},cs.prototype.clone=function(){return new cs({width:this.width,height:this.height},new Uint8Array(this.data))},cs.copy=function(n,o,s,p,_){Eh(n,o,s,p,_,4)},cn("AlphaImage",ws),cn("RGBAImage",cs);var op={paint:new Ro({"heatmap-radius":new fn(ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new fn(ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Sn(ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $s(ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Sn(ee.paint_heatmap["heatmap-opacity"])})};function ap(n){var o={},s=n.resolution||256,p=n.clips?n.clips.length:1,_=n.image||new cs({width:s,height:p}),y=function(Te,Re,qe){o[n.evaluationKey]=qe;var je=n.expression.evaluate(o);_.data[Te+Re+0]=Math.floor(255*je.r/je.a),_.data[Te+Re+1]=Math.floor(255*je.g/je.a),_.data[Te+Re+2]=Math.floor(255*je.b/je.a),_.data[Te+Re+3]=Math.floor(255*je.a)};if(n.clips)for(var b=0,C=0;b<p;++b,C+=4*s)for(var I=0,D=0;I<s;I++,D+=4){var z=I/(s-1),H=n.clips[b];y(C,D,H.start*(1-z)+H.end*z)}else for(var J=0,re=0;J<s;J++,re+=4)y(0,re,J/(s-1));return _}var fc=function(n){function o(s){n.call(this,s,op),this._updateColorRamp()}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(s){return new qu(s)},o.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=ap({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Qs),sp={paint:new Ro({"hillshade-illumination-direction":new Sn(ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Sn(ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Sn(ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Sn(ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Sn(ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Sn(ee.paint_hillshade["hillshade-accent-color"])})},Qd=function(n){function o(s){n.call(this,s,sp)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Qs),Jd=wa([{name:"a_pos",components:2,type:"Int16"}],4).members,bh=yf,Jp=yf;function yf(n,o,s){s=s||2;var p,_,y,b,C,I,D,z=o&&o.length,H=z?o[0]*s:n.length,J=up(n,0,H,s,!0),re=[];if(!J||J.next===J.prev)return re;if(z&&(J=function(Re,qe,je,ft){var gt,zt,Ot,rr=[];for(gt=0,zt=qe.length;gt<zt;gt++)(Ot=up(Re,qe[gt]*ft,gt<zt-1?qe[gt+1]*ft:Re.length,ft,!1))===Ot.next&&(Ot.steiner=!0),rr.push(Th(Ot));for(rr.sort(Sh),gt=0;gt<rr.length;gt++)Yf(rr[gt],je),je=Bl(je,je.next);return je}(n,o,J,s)),n.length>80*s){p=y=n[0],_=b=n[1];for(var Te=s;Te<H;Te+=s)(C=n[Te])<p&&(p=C),(I=n[Te+1])<_&&(_=I),C>y&&(y=C),I>b&&(b=I);D=(D=Math.max(y-p,b-_))!==0?1/D:0}return Xf(J,re,s,p,_,D),re}function up(n,o,s,p,_){var y,b;if(_===Gc(n,o,s,p)>0)for(y=o;y<s;y+=p)b=Ef(y,n[y],n[y+1],b);else for(y=s-p;y>=o;y-=p)b=Ef(y,n[y],n[y+1],b);return b&&Hc(b,b.next)&&(Nl(b),b=b.next),b}function Bl(n,o){if(!n)return n;o||(o=n);var s,p=n;do if(s=!1,p.steiner||!Hc(p,p.next)&&Bo(p.prev,p,p.next)!==0)p=p.next;else{if(Nl(p),(p=o=p.prev)===p.next)break;s=!0}while(s||p!==o);return o}function Xf(n,o,s,p,_,y,b){if(n){!b&&y&&function(z,H,J,re){var Te=z;do Te.z===null&&(Te.z=dl(Te.x,Te.y,H,J,re)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==z);Te.prevZ.nextZ=null,Te.prevZ=null,function(Re){var qe,je,ft,gt,zt,Ot,rr,Rr,Zr=1;do{for(je=Re,Re=null,zt=null,Ot=0;je;){for(Ot++,ft=je,rr=0,qe=0;qe<Zr&&(rr++,ft=ft.nextZ);qe++);for(Rr=Zr;rr>0||Rr>0&&ft;)rr!==0&&(Rr===0||!ft||je.z<=ft.z)?(gt=je,je=je.nextZ,rr--):(gt=ft,ft=ft.nextZ,Rr--),zt?zt.nextZ=gt:Re=gt,gt.prevZ=zt,zt=gt;je=ft}zt.nextZ=null,Zr*=2}while(Ot>1)}(Te)}(n,p,_,y);for(var C,I,D=n;n.prev!==n.next;)if(C=n.prev,I=n.next,y?lp(n,p,_,y):em(n))o.push(C.i/s),o.push(n.i/s),o.push(I.i/s),Nl(n),n=I.next,D=I.next;else if((n=I)===D){b?b===1?Xf(n=tm(Bl(n),o,s),o,s,p,_,y,2):b===2&&rm(n,o,s,p,_,y):Xf(Bl(n),o,s,p,_,y,1);break}}}function em(n){var o=n.prev,s=n,p=n.next;if(Bo(o,s,p)>=0)return!1;for(var _=n.next.next;_!==n.prev;){if(hc(o.x,o.y,s.x,s.y,p.x,p.y,_.x,_.y)&&Bo(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function lp(n,o,s,p){var _=n.prev,y=n,b=n.next;if(Bo(_,y,b)>=0)return!1;for(var C=_.x>y.x?_.x>b.x?_.x:b.x:y.x>b.x?y.x:b.x,I=_.y>y.y?_.y>b.y?_.y:b.y:y.y>b.y?y.y:b.y,D=dl(_.x<y.x?_.x<b.x?_.x:b.x:y.x<b.x?y.x:b.x,_.y<y.y?_.y<b.y?_.y:b.y:y.y<b.y?y.y:b.y,o,s,p),z=dl(C,I,o,s,p),H=n.prevZ,J=n.nextZ;H&&H.z>=D&&J&&J.z<=z;){if(H!==n.prev&&H!==n.next&&hc(_.x,_.y,y.x,y.y,b.x,b.y,H.x,H.y)&&Bo(H.prev,H,H.next)>=0||(H=H.prevZ,J!==n.prev&&J!==n.next&&hc(_.x,_.y,y.x,y.y,b.x,b.y,J.x,J.y)&&Bo(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;H&&H.z>=D;){if(H!==n.prev&&H!==n.next&&hc(_.x,_.y,y.x,y.y,b.x,b.y,H.x,H.y)&&Bo(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;J&&J.z<=z;){if(J!==n.prev&&J!==n.next&&hc(_.x,_.y,y.x,y.y,b.x,b.y,J.x,J.y)&&Bo(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function tm(n,o,s){var p=n;do{var _=p.prev,y=p.next.next;!Hc(_,y)&&wh(_,p,p.next,y)&&dc(_,y)&&dc(y,_)&&(o.push(_.i/s),o.push(p.i/s),o.push(y.i/s),Nl(p),Nl(p.next),p=n=y),p=p.next}while(p!==n);return Bl(p)}function rm(n,o,s,p,_,y){var b=n;do{for(var C=b.next.next;C!==b.prev;){if(b.i!==C.i&&Ch(b,C)){var I=xf(b,C);return b=Bl(b,b.next),I=Bl(I,I.next),Xf(b,o,s,p,_,y),void Xf(I,o,s,p,_,y)}C=C.next}b=b.next}while(b!==n)}function Sh(n,o){return n.x-o.x}function Yf(n,o){if(o=function(p,_){var y,b=_,C=p.x,I=p.y,D=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var z=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(z<=C&&z>D){if(D=z,z===C){if(I===b.y)return b;if(I===b.next.y)return b.next}y=b.x<b.next.x?b:b.next}}b=b.next}while(b!==_);if(!y)return null;if(C===D)return y;var H,J=y,re=y.x,Te=y.y,Re=1/0;b=y;do C>=b.x&&b.x>=re&&C!==b.x&&hc(I<Te?C:D,I,re,Te,I<Te?D:C,I,b.x,b.y)&&(H=Math.abs(I-b.y)/(C-b.x),dc(b,p)&&(H<Re||H===Re&&(b.x>y.x||b.x===y.x&&Ah(y,b)))&&(y=b,Re=H)),b=b.next;while(b!==J);return y}(n,o)){var s=xf(o,n);Bl(o,o.next),Bl(s,s.next)}}function Ah(n,o){return Bo(n.prev,n,o.prev)<0&&Bo(o.next,n,n.next)<0}function dl(n,o,s,p,_){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-s)*_)|n<<8))|n<<4))|n<<2))|n<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*_)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Th(n){var o=n,s=n;do(o.x<s.x||o.x===s.x&&o.y<s.y)&&(s=o),o=o.next;while(o!==n);return s}function hc(n,o,s,p,_,y,b,C){return(_-b)*(o-C)-(n-b)*(y-C)>=0&&(n-b)*(p-C)-(s-b)*(o-C)>=0&&(s-b)*(y-C)-(_-b)*(p-C)>=0}function Ch(n,o){return n.next.i!==o.i&&n.prev.i!==o.i&&!function(s,p){var _=s;do{if(_.i!==s.i&&_.next.i!==s.i&&_.i!==p.i&&_.next.i!==p.i&&wh(_,_.next,s,p))return!0;_=_.next}while(_!==s);return!1}(n,o)&&(dc(n,o)&&dc(o,n)&&function(s,p){var _=s,y=!1,b=(s.x+p.x)/2,C=(s.y+p.y)/2;do _.y>C!=_.next.y>C&&_.next.y!==_.y&&b<(_.next.x-_.x)*(C-_.y)/(_.next.y-_.y)+_.x&&(y=!y),_=_.next;while(_!==s);return y}(n,o)&&(Bo(n.prev,n,o.prev)||Bo(n,o.prev,o))||Hc(n,o)&&Bo(n.prev,n,n.next)>0&&Bo(o.prev,o,o.next)>0)}function Bo(n,o,s){return(o.y-n.y)*(s.x-o.x)-(o.x-n.x)*(s.y-o.y)}function Hc(n,o){return n.x===o.x&&n.y===o.y}function wh(n,o,s,p){var _=ml(Bo(n,o,s)),y=ml(Bo(n,o,p)),b=ml(Bo(s,p,n)),C=ml(Bo(s,p,o));return _!==y&&b!==C||!(_!==0||!pc(n,s,o))||!(y!==0||!pc(n,p,o))||!(b!==0||!pc(s,n,p))||!(C!==0||!pc(s,o,p))}function pc(n,o,s){return o.x<=Math.max(n.x,s.x)&&o.x>=Math.min(n.x,s.x)&&o.y<=Math.max(n.y,s.y)&&o.y>=Math.min(n.y,s.y)}function ml(n){return n>0?1:n<0?-1:0}function dc(n,o){return Bo(n.prev,n,n.next)<0?Bo(n,o,n.next)>=0&&Bo(n,n.prev,o)>=0:Bo(n,o,n.prev)<0||Bo(n,n.next,o)<0}function xf(n,o){var s=new Wc(n.i,n.x,n.y),p=new Wc(o.i,o.x,o.y),_=n.next,y=o.prev;return n.next=o,o.prev=n,s.next=_,_.prev=s,p.next=s,s.prev=p,y.next=p,p.prev=y,p}function Ef(n,o,s,p){var _=new Wc(n,o,s);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function Nl(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Wc(n,o,s){this.i=n,this.x=o,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gc(n,o,s,p){for(var _=0,y=o,b=s-p;y<s;y+=p)_+=(n[b]-n[y])*(n[y+1]+n[b+1]),b=y;return _}function ed(n,o,s,p,_){(function y(b,C,I,D,z){for(;D>I;){if(D-I>600){var H=D-I+1,J=C-I+1,re=Math.log(H),Te=.5*Math.exp(2*re/3),Re=.5*Math.sqrt(re*Te*(H-Te)/H)*(J-H/2<0?-1:1);y(b,C,Math.max(I,Math.floor(C-J*Te/H+Re)),Math.min(D,Math.floor(C+(H-J)*Te/H+Re)),z)}var qe=b[C],je=I,ft=D;for(kl(b,I,C),z(b[D],qe)>0&&kl(b,I,D);je<ft;){for(kl(b,je,ft),je++,ft--;z(b[je],qe)<0;)je++;for(;z(b[ft],qe)>0;)ft--}z(b[I],qe)===0?kl(b,I,ft):kl(b,++ft,D),ft<=C&&(I=ft+1),C<=ft&&(D=ft-1)}})(n,o,s||0,p||n.length-1,_||Xc)}function kl(n,o,s){var p=n[o];n[o]=n[s],n[s]=p}function Xc(n,o){return n<o?-1:n>o?1:0}function Rh(n,o){var s=n.length;if(s<=1)return[n];for(var p,_,y=[],b=0;b<s;b++){var C=Lr(n[b]);C!==0&&(n[b].area=Math.abs(C),_===void 0&&(_=C<0),_===C<0?(p&&y.push(p),p=[n[b]]):p.push(n[b]))}if(p&&y.push(p),o>1)for(var I=0;I<y.length;I++)y[I].length<=o||(ed(y[I],o,1,y[I].length-1,cp),y[I]=y[I].slice(0,o));return y}function cp(n,o){return o.area-n.area}function fp(n,o,s){for(var p=s.patternDependencies,_=!1,y=0,b=o;y<b.length;y+=1){var C=b[y].paint.get(n+"-pattern");C.isConstant()||(_=!0);var I=C.constantOr(null);I&&(_=!0,p[I.to]=!0,p[I.from]=!0)}return _}function hp(n,o,s,p,_){for(var y=_.patternDependencies,b=0,C=o;b<C.length;b+=1){var I=C[b],D=I.paint.get(n+"-pattern").value;if(D.kind!=="constant"){var z=D.evaluate({zoom:p-1},s,{},_.availableImages),H=D.evaluate({zoom:p},s,{},_.availableImages),J=D.evaluate({zoom:p+1},s,{},_.availableImages);H=H&&H.name?H.name:H,J=J&&J.name?J.name:J,y[z=z&&z.name?z.name:z]=!0,y[H]=!0,y[J]=!0,s.patterns[I.id]={min:z,mid:H,max:J}}}return s}yf.deviation=function(n,o,s,p){var _=o&&o.length,y=Math.abs(Gc(n,0,_?o[0]*s:n.length,s));if(_)for(var b=0,C=o.length;b<C;b++)y-=Math.abs(Gc(n,o[b]*s,b<C-1?o[b+1]*s:n.length,s));var I=0;for(b=0;b<p.length;b+=3){var D=p[b]*s,z=p[b+1]*s,H=p[b+2]*s;I+=Math.abs((n[D]-n[H])*(n[z+1]-n[D+1])-(n[D]-n[z])*(n[H+1]-n[D+1]))}return y===0&&I===0?0:Math.abs((I-y)/y)},yf.flatten=function(n){for(var o=n[0][0].length,s={vertices:[],holes:[],dimensions:o},p=0,_=0;_<n.length;_++){for(var y=0;y<n[_].length;y++)for(var b=0;b<o;b++)s.vertices.push(n[_][y][b]);_>0&&s.holes.push(p+=n[_-1].length)}return s},bh.default=Jp;var Iu=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cl,this.indexArray=new aa,this.indexArray2=new Vc,this.programConfigurations=new On(n.layers,n.zoom),this.segments=new le,this.segments2=new le,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Iu.prototype.populate=function(n,o,s){this.hasPattern=fp("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),_=[],y=0,b=n;y<b.length;y+=1){var C=b[y],I=C.feature,D=C.id,z=C.index,H=C.sourceLayerIndex,J=this.layers[0]._featureFilter.needGeometry,re=Lo(I,J);if(this.layers[0]._featureFilter.filter(new qn(this.zoom),re,s)){var Te=p?p.evaluate(re,{},s,o.availableImages):void 0,Re={id:D,properties:I.properties,type:I.type,sourceLayerIndex:H,index:z,geometry:J?re.geometry:Ao(I),patterns:{},sortKey:Te};_.push(Re)}}p&&_.sort(function(Rr,Zr){return Rr.sortKey-Zr.sortKey});for(var qe=0,je=_;qe<je.length;qe+=1){var ft=je[qe],gt=ft.geometry,zt=ft.index,Ot=ft.sourceLayerIndex;if(this.hasPattern){var rr=hp("fill",this.layers,ft,this.zoom,o);this.patternFeatures.push(rr)}else this.addFeature(ft,gt,zt,s,{});o.featureIndex.insert(n[zt].feature,gt,zt,Ot,this.index)}},Iu.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},Iu.prototype.addFeatures=function(n,o,s){for(var p=0,_=this.patternFeatures;p<_.length;p+=1){var y=_[p];this.addFeature(y,y.geometry,y.index,o,s)}},Iu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Iu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Iu.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Jd),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0},Iu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Iu.prototype.addFeature=function(n,o,s,p,_){for(var y=0,b=Rh(o,500);y<b.length;y+=1){for(var C=b[y],I=0,D=0,z=C;D<z.length;D+=1)I+=z[D].length;for(var H=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),J=H.vertexLength,re=[],Te=[],Re=0,qe=C;Re<qe.length;Re+=1){var je=qe[Re];if(je.length!==0){je!==C[0]&&Te.push(re.length/2);var ft=this.segments2.prepareSegment(je.length,this.layoutVertexArray,this.indexArray2),gt=ft.vertexLength;this.layoutVertexArray.emplaceBack(je[0].x,je[0].y),this.indexArray2.emplaceBack(gt+je.length-1,gt),re.push(je[0].x),re.push(je[0].y);for(var zt=1;zt<je.length;zt++)this.layoutVertexArray.emplaceBack(je[zt].x,je[zt].y),this.indexArray2.emplaceBack(gt+zt-1,gt+zt),re.push(je[zt].x),re.push(je[zt].y);ft.vertexLength+=je.length,ft.primitiveLength+=je.length}}for(var Ot=bh(re,Te),rr=0;rr<Ot.length;rr+=3)this.indexArray.emplaceBack(J+Ot[rr],J+Ot[rr+1],J+Ot[rr+2]);H.vertexLength+=I,H.primitiveLength+=Ot.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,_,p)},cn("FillBucket",Iu,{omit:["layers","patternFeatures"]});var mc=new Ro({"fill-sort-key":new fn(ee.layout_fill["fill-sort-key"])}),td={paint:new Ro({"fill-antialias":new Sn(ee.paint_fill["fill-antialias"]),"fill-opacity":new fn(ee.paint_fill["fill-opacity"]),"fill-color":new fn(ee.paint_fill["fill-color"]),"fill-outline-color":new fn(ee.paint_fill["fill-outline-color"]),"fill-translate":new Sn(ee.paint_fill["fill-translate"]),"fill-translate-anchor":new Sn(ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ts(ee.paint_fill["fill-pattern"])}),layout:mc},pp=function(n){function o(s){n.call(this,s,td)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.recalculate=function(s,p){n.prototype.recalculate.call(this,s,p);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(s){return new Iu(s)},o.prototype.queryRadius=function(){return Ho(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(s,p,_,y,b,C,I){return Zs(ls(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,I),y)},o.prototype.isTileClipped=function(){return!0},o}(Qs),dp=wa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,mp=vc;function vc(n,o,s,p,_){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=p,this._values=_,n.readFields(nm,this,o)}function nm(n,o,s){n==1?o.id=s.readVarint():n==2?function(p,_){for(var y=p.readVarint()+p.pos;p.pos<y;){var b=_._keys[p.readVarint()],C=_._values[p.readVarint()];_.properties[b]=C}}(s,o):n==3?o.type=s.readVarint():n==4&&(o._geometry=s.pos)}function vl(n){for(var o,s,p=0,_=0,y=n.length,b=y-1;_<y;b=_++)p+=((s=n[b]).x-(o=n[_]).x)*(o.y+s.y);return p}vc.types=["Unknown","Point","LineString","Polygon"],vc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var o,s=n.readVarint()+n.pos,p=1,_=0,y=0,b=0,C=[];n.pos<s;){if(_<=0){var I=n.readVarint();p=7&I,_=I>>3}if(_--,p===1||p===2)y+=n.readSVarint(),b+=n.readSVarint(),p===1&&(o&&C.push(o),o=[]),o.push(new W(y,b));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&C.push(o),C},vc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var o=n.readVarint()+n.pos,s=1,p=0,_=0,y=0,b=1/0,C=-1/0,I=1/0,D=-1/0;n.pos<o;){if(p<=0){var z=n.readVarint();s=7&z,p=z>>3}if(p--,s===1||s===2)(_+=n.readSVarint())<b&&(b=_),_>C&&(C=_),(y+=n.readSVarint())<I&&(I=y),y>D&&(D=y);else if(s!==7)throw new Error("unknown command "+s)}return[b,I,C,D]},vc.prototype.toGeoJSON=function(n,o,s){var p,_,y=this.extent*Math.pow(2,s),b=this.extent*n,C=this.extent*o,I=this.loadGeometry(),D=vc.types[this.type];function z(re){for(var Te=0;Te<re.length;Te++){var Re=re[Te];re[Te]=[360*(Re.x+b)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(Re.y+C)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(p=0;p<I.length;p++)H[p]=I[p][0];z(I=H);break;case 2:for(p=0;p<I.length;p++)z(I[p]);break;case 3:for(I=function(re){var Te=re.length;if(Te<=1)return[re];for(var Re,qe,je=[],ft=0;ft<Te;ft++){var gt=vl(re[ft]);gt!==0&&(qe===void 0&&(qe=gt<0),qe===gt<0?(Re&&je.push(Re),Re=[re[ft]]):Re.push(re[ft]))}return Re&&je.push(Re),je}(I),p=0;p<I.length;p++)for(_=0;_<I[p].length;_++)z(I[p][_])}I.length===1?I=I[0]:D="Multi"+D;var J={type:"Feature",geometry:{type:D,coordinates:I},properties:this.properties};return"id"in this&&(J.id=this.id),J};var vp=Yc;function Yc(n,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Ul,this,o),this.length=this._features.length}function Ul(n,o,s){n===15?o.version=s.readVarint():n===1?o.name=s.readString():n===5?o.extent=s.readVarint():n===2?o._features.push(s.pos):n===3?o._keys.push(s.readString()):n===4&&o._values.push(function(p){for(var _=null,y=p.readVarint()+p.pos;p.pos<y;){var b=p.readVarint()>>3;_=b===1?p.readString():b===2?p.readFloat():b===3?p.readDouble():b===4?p.readVarint64():b===5?p.readVarint():b===6?p.readSVarint():b===7?p.readBoolean():null}return _}(s))}function rd(n,o,s){if(n===3){var p=new vp(s,s.readVarint()+s.pos);p.length&&(o[p.name]=p)}}Yc.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var o=this._pbf.readVarint()+this._pbf.pos;return new mp(this._pbf,o,this.extent,this._keys,this._values)};var _c={VectorTile:function(n,o){this.layers=n.readFields(rd,{},o)},VectorTileFeature:mp,VectorTileLayer:vp},qf=_c.VectorTileFeature.types,Kf=Math.pow(2,13);function es(n,o,s,p,_,y,b,C){n.emplaceBack(o,s,2*Math.floor(p*Kf)+b,_*Kf*2,y*Kf*2,Math.round(C))}var ts=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Wu,this.indexArray=new aa,this.programConfigurations=new On(n.layers,n.zoom),this.segments=new le,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function _a(n,o){return n.x===o.x&&(n.x<0||n.x>8192)||n.y===o.y&&(n.y<0||n.y>8192)}ts.prototype.populate=function(n,o,s){this.features=[],this.hasPattern=fp("fill-extrusion",this.layers,o);for(var p=0,_=n;p<_.length;p+=1){var y=_[p],b=y.feature,C=y.id,I=y.index,D=y.sourceLayerIndex,z=this.layers[0]._featureFilter.needGeometry,H=Lo(b,z);if(this.layers[0]._featureFilter.filter(new qn(this.zoom),H,s)){var J={id:C,sourceLayerIndex:D,index:I,geometry:z?H.geometry:Ao(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(hp("fill-extrusion",this.layers,J,this.zoom,o)):this.addFeature(J,J.geometry,I,s,{}),o.featureIndex.insert(b,J.geometry,I,D,this.index,!0)}}},ts.prototype.addFeatures=function(n,o,s){for(var p=0,_=this.features;p<_.length;p+=1){var y=_[p];this.addFeature(y,y.geometry,y.index,o,s)}},ts.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},ts.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ts.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ts.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,dp),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},ts.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ts.prototype.addFeature=function(n,o,s,p,_){for(var y=0,b=Rh(o,500);y<b.length;y+=1){for(var C=b[y],I=0,D=0,z=C;D<z.length;D+=1)I+=z[D].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),J=0,re=C;J<re.length;J+=1){var Te=re[J];if(Te.length!==0&&!((pi=Te).every(function(ni){return ni.x<0})||pi.every(function(ni){return ni.x>8192})||pi.every(function(ni){return ni.y<0})||pi.every(function(ni){return ni.y>8192})))for(var Re=0,qe=0;qe<Te.length;qe++){var je=Te[qe];if(qe>=1){var ft=Te[qe-1];if(!_a(je,ft)){H.vertexLength+4>le.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var gt=je.sub(ft)._perp()._unit(),zt=ft.dist(je);Re+zt>32768&&(Re=0),es(this.layoutVertexArray,je.x,je.y,gt.x,gt.y,0,0,Re),es(this.layoutVertexArray,je.x,je.y,gt.x,gt.y,0,1,Re),es(this.layoutVertexArray,ft.x,ft.y,gt.x,gt.y,0,0,Re+=zt),es(this.layoutVertexArray,ft.x,ft.y,gt.x,gt.y,0,1,Re);var Ot=H.vertexLength;this.indexArray.emplaceBack(Ot,Ot+2,Ot+1),this.indexArray.emplaceBack(Ot+1,Ot+2,Ot+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+I>le.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),qf[n.type]==="Polygon"){for(var rr=[],Rr=[],Zr=H.vertexLength,xn=0,nn=C;xn<nn.length;xn+=1){var In=nn[xn];if(In.length!==0){In!==C[0]&&Rr.push(rr.length/2);for(var rn=0;rn<In.length;rn++){var ci=In[rn];es(this.layoutVertexArray,ci.x,ci.y,0,0,1,1,0),rr.push(ci.x),rr.push(ci.y)}}}for(var Vn=bh(rr,Rr),hn=0;hn<Vn.length;hn+=3)this.indexArray.emplaceBack(Zr+Vn[hn],Zr+Vn[hn+2],Zr+Vn[hn+1]);H.primitiveLength+=Vn.length/3,H.vertexLength+=I}}var pi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,_,p)},cn("FillExtrusionBucket",ts,{omit:["layers","features"]});var ru={paint:new Ro({"fill-extrusion-opacity":new Sn(ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new fn(ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Sn(ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Sn(ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ts(ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new fn(ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new fn(ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Sn(ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},nd=function(n){function o(s){n.call(this,s,ru)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(s){return new ts(s)},o.prototype.queryRadius=function(){return Ho(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(s,p,_,y,b,C,I,D){var z=ls(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,I),H=this.paint.get("fill-extrusion-height").evaluate(p,_),J=this.paint.get("fill-extrusion-base").evaluate(p,_),re=function(Re,qe,je,ft){for(var gt=[],zt=0,Ot=Re;zt<Ot.length;zt+=1){var rr=Ot[zt],Rr=[rr.x,rr.y,0,1];hl(Rr,Rr,qe),gt.push(new W(Rr[0]/Rr[3],Rr[1]/Rr[3]))}return gt}(z,D),Te=function(Re,qe,je,ft){for(var gt=[],zt=[],Ot=ft[8]*qe,rr=ft[9]*qe,Rr=ft[10]*qe,Zr=ft[11]*qe,xn=ft[8]*je,nn=ft[9]*je,In=ft[10]*je,rn=ft[11]*je,ci=0,Vn=Re;ci<Vn.length;ci+=1){for(var hn=[],pi=[],ni=0,Ri=Vn[ci];ni<Ri.length;ni+=1){var Tn=Ri[ni],Ii=Tn.x,Fi=Tn.y,Wo=ft[0]*Ii+ft[4]*Fi+ft[12],Uo=ft[1]*Ii+ft[5]*Fi+ft[13],eo=ft[2]*Ii+ft[6]*Fi+ft[14],ta=ft[3]*Ii+ft[7]*Fi+ft[15],za=eo+Rr,Va=ta+Zr,ps=Wo+xn,Za=Uo+nn,ja=eo+In,fa=ta+rn,Ka=new W((Wo+Ot)/Va,(Uo+rr)/Va);Ka.z=za/Va,hn.push(Ka);var Si=new W(ps/fa,Za/fa);Si.z=ja/fa,pi.push(Si)}gt.push(hn),zt.push(pi)}return[gt,zt]}(y,J,H,D);return function(Re,qe,je){var ft=1/0;Zs(je,qe)&&(ft=id(je,qe[0]));for(var gt=0;gt<qe.length;gt++)for(var zt=qe[gt],Ot=Re[gt],rr=0;rr<zt.length-1;rr++){var Rr=zt[rr],Zr=[Rr,zt[rr+1],Ot[rr+1],Ot[rr],Rr];lu(je,Zr)&&(ft=Math.min(ft,id(je,Zr)))}return ft!==1/0&&ft}(Te[0],Te[1],re)},o}(Qs);function $f(n,o){return n.x*o.x+n.y*o.y}function id(n,o){if(n.length===1){for(var s,p=0,_=o[p++];!s||_.equals(s);)if(!(s=o[p++]))return 1/0;for(;p<o.length;p++){var y=o[p],b=n[0],C=s.sub(_),I=y.sub(_),D=b.sub(_),z=$f(C,C),H=$f(C,I),J=$f(I,I),re=$f(D,C),Te=$f(D,I),Re=z*J-H*H,qe=(J*re-H*Te)/Re,je=(z*Te-H*re)/Re,ft=_.z*(1-qe-je)+s.z*qe+y.z*je;if(isFinite(ft))return ft}return 1/0}for(var gt=1/0,zt=0,Ot=o;zt<Ot.length;zt+=1)gt=Math.min(gt,Ot[zt].z);return gt}var im=wa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,om=wa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,od=_c.VectorTileFeature.types,ad=Math.cos(Math.PI/180*37.5),sd=Math.pow(2,14)/.5,fs=function(n){var o=this;this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){o.gradients[s.id]={}}),this.layoutVertexArray=new us,this.layoutVertexArray2=new oc,this.indexArray=new aa,this.programConfigurations=new On(n.layers,n.zoom),this.segments=new le,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};fs.prototype.populate=function(n,o,s){this.hasPattern=fp("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),_=[],y=0,b=n;y<b.length;y+=1){var C=b[y],I=C.feature,D=C.id,z=C.index,H=C.sourceLayerIndex,J=this.layers[0]._featureFilter.needGeometry,re=Lo(I,J);if(this.layers[0]._featureFilter.filter(new qn(this.zoom),re,s)){var Te=p?p.evaluate(re,{},s):void 0,Re={id:D,properties:I.properties,type:I.type,sourceLayerIndex:H,index:z,geometry:J?re.geometry:Ao(I),patterns:{},sortKey:Te};_.push(Re)}}p&&_.sort(function(Rr,Zr){return Rr.sortKey-Zr.sortKey});for(var qe=0,je=_;qe<je.length;qe+=1){var ft=je[qe],gt=ft.geometry,zt=ft.index,Ot=ft.sourceLayerIndex;if(this.hasPattern){var rr=hp("line",this.layers,ft,this.zoom,o);this.patternFeatures.push(rr)}else this.addFeature(ft,gt,zt,s,{});o.featureIndex.insert(n[zt].feature,gt,zt,Ot,this.index)}},fs.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},fs.prototype.addFeatures=function(n,o,s){for(var p=0,_=this.patternFeatures;p<_.length;p+=1){var y=_[p];this.addFeature(y,y.geometry,y.index,o,s)}},fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fs.prototype.upload=function(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,om)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,im),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fs.prototype.lineFeatureClips=function(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}},fs.prototype.addFeature=function(n,o,s,p,_){var y=this.layers[0].layout,b=y.get("line-join").evaluate(n,{}),C=y.get("line-cap"),I=y.get("line-miter-limit"),D=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(var z=0,H=o;z<H.length;z+=1)this.addLine(H[z],n,b,C,I,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,_,p)},fs.prototype.addLine=function(n,o,s,p,_,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var b=0;b<n.length-1;b++)this.totalDistance+=n[b].dist(n[b+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var C=od[o.type]==="Polygon",I=n.length;I>=2&&n[I-1].equals(n[I-2]);)I--;for(var D=0;D<I-1&&n[D].equals(n[D+1]);)D++;if(!(I<(C?3:2))){s==="bevel"&&(_=1.05);var z,H=this.overscaling<=16?122880/(512*this.overscaling):0,J=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),re=void 0,Te=void 0,Re=void 0,qe=void 0;this.e1=this.e2=-1,C&&(qe=n[D].sub(z=n[I-2])._unit()._perp());for(var je=D;je<I;je++)if(!(Te=je===I-1?C?n[D+1]:void 0:n[je+1])||!n[je].equals(Te)){qe&&(Re=qe),z&&(re=z),z=n[je],qe=Te?Te.sub(z)._unit()._perp():Re;var ft=(Re=Re||qe).add(qe);ft.x===0&&ft.y===0||ft._unit();var gt=Re.x*qe.x+Re.y*qe.y,zt=ft.x*qe.x+ft.y*qe.y,Ot=zt!==0?1/zt:1/0,rr=2*Math.sqrt(2-2*zt),Rr=zt<ad&&re&&Te,Zr=Re.x*qe.y-Re.y*qe.x>0;if(Rr&&je>D){var xn=z.dist(re);if(xn>2*H){var nn=z.sub(z.sub(re)._mult(H/xn)._round());this.updateDistance(re,nn),this.addCurrentVertex(nn,Re,0,0,J),re=nn}}var In=re&&Te,rn=In?s:C?"butt":p;if(In&&rn==="round"&&(Ot<y?rn="miter":Ot<=2&&(rn="fakeround")),rn==="miter"&&Ot>_&&(rn="bevel"),rn==="bevel"&&(Ot>2&&(rn="flipbevel"),Ot<_&&(rn="miter")),re&&this.updateDistance(re,z),rn==="miter")ft._mult(Ot),this.addCurrentVertex(z,ft,0,0,J);else if(rn==="flipbevel"){if(Ot>100)ft=qe.mult(-1);else{var ci=Ot*Re.add(qe).mag()/Re.sub(qe).mag();ft._perp()._mult(ci*(Zr?-1:1))}this.addCurrentVertex(z,ft,0,0,J),this.addCurrentVertex(z,ft.mult(-1),0,0,J)}else if(rn==="bevel"||rn==="fakeround"){var Vn=-Math.sqrt(Ot*Ot-1),hn=Zr?Vn:0,pi=Zr?0:Vn;if(re&&this.addCurrentVertex(z,Re,hn,pi,J),rn==="fakeround")for(var ni=Math.round(180*rr/Math.PI/20),Ri=1;Ri<ni;Ri++){var Tn=Ri/ni;if(Tn!==.5){var Ii=Tn-.5;Tn+=Tn*Ii*(Tn-1)*((1.0904+gt*(gt*(3.55645-1.43519*gt)-3.2452))*Ii*Ii+(.848013+gt*(.215638*gt-1.06021)))}var Fi=qe.sub(Re)._mult(Tn)._add(Re)._unit()._mult(Zr?-1:1);this.addHalfVertex(z,Fi.x,Fi.y,!1,Zr,0,J)}Te&&this.addCurrentVertex(z,qe,-hn,-pi,J)}else if(rn==="butt")this.addCurrentVertex(z,ft,0,0,J);else if(rn==="square"){var Wo=re?1:-1;this.addCurrentVertex(z,ft,Wo,Wo,J)}else rn==="round"&&(re&&(this.addCurrentVertex(z,Re,0,0,J),this.addCurrentVertex(z,Re,1,1,J,!0)),Te&&(this.addCurrentVertex(z,qe,-1,-1,J,!0),this.addCurrentVertex(z,qe,0,0,J)));if(Rr&&je<I-1){var Uo=z.dist(Te);if(Uo>2*H){var eo=z.add(Te.sub(z)._mult(H/Uo)._round());this.updateDistance(z,eo),this.addCurrentVertex(eo,qe,0,0,J),z=eo}}}}},fs.prototype.addCurrentVertex=function(n,o,s,p,_,y){y===void 0&&(y=!1);var b=o.y*p-o.x,C=-o.y-o.x*p;this.addHalfVertex(n,o.x+o.y*s,o.y-o.x*s,y,!1,s,_),this.addHalfVertex(n,b,C,y,!0,-p,_),this.distance>sd/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,o,s,p,_,y))},fs.prototype.addHalfVertex=function(n,o,s,p,_,y,b){var C=.5*(this.lineClips?this.scaledDistance*(sd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n.x<<1)+(p?1:0),(n.y<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(y===0?0:y<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),_?this.e2=I:this.e1=I},fs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},fs.prototype.updateDistance=function(n,o){this.distance+=n.dist(o),this.updateScaledDistance()},cn("LineBucket",fs,{omit:["layers","patternFeatures"]});var ud=new Ro({"line-cap":new Sn(ee.layout_line["line-cap"]),"line-join":new fn(ee.layout_line["line-join"]),"line-miter-limit":new Sn(ee.layout_line["line-miter-limit"]),"line-round-limit":new Sn(ee.layout_line["line-round-limit"]),"line-sort-key":new fn(ee.layout_line["line-sort-key"])}),_p={paint:new Ro({"line-opacity":new fn(ee.paint_line["line-opacity"]),"line-color":new fn(ee.paint_line["line-color"]),"line-translate":new Sn(ee.paint_line["line-translate"]),"line-translate-anchor":new Sn(ee.paint_line["line-translate-anchor"]),"line-width":new fn(ee.paint_line["line-width"]),"line-gap-width":new fn(ee.paint_line["line-gap-width"]),"line-offset":new fn(ee.paint_line["line-offset"]),"line-blur":new fn(ee.paint_line["line-blur"]),"line-dasharray":new Xa(ee.paint_line["line-dasharray"]),"line-pattern":new Ts(ee.paint_line["line-pattern"]),"line-gradient":new $s(ee.paint_line["line-gradient"])}),layout:ud},gp=new(function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(s,p){return p=new qn(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),n.prototype.possiblyEvaluate.call(this,s,p)},o.prototype.evaluate=function(s,p,_,y){return p=At({},p,{zoom:Math.floor(p.zoom)}),n.prototype.evaluate.call(this,s,p,_,y)},o}(fn))(_p.paint.properties["line-width"].specification);gp.useIntegerZoom=!0;var yp=function(n){function o(s){n.call(this,s,_p),this.gradientVersion=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof xs,this.gradientVersion=(this.gradientVersion+1)%Ke)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(s,p){n.prototype.recalculate.call(this,s,p),this.paint._values["line-floorwidth"]=gp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},o.prototype.createBucket=function(s){return new fs(s)},o.prototype.queryRadius=function(s){var p=s,_=xp(ka("line-width",this,p),ka("line-gap-width",this,p)),y=ka("line-offset",this,p);return _/2+Math.abs(y)+Ho(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(s,p,_,y,b,C,I){var D=ls(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,I),z=I/2*xp(this.paint.get("line-width").evaluate(p,_),this.paint.get("line-gap-width").evaluate(p,_)),H=this.paint.get("line-offset").evaluate(p,_);return H&&(y=function(J,re){for(var Te=[],Re=new W(0,0),qe=0;qe<J.length;qe++){for(var je=J[qe],ft=[],gt=0;gt<je.length;gt++){var zt=je[gt],Ot=je[gt+1],rr=gt===0?Re:zt.sub(je[gt-1])._unit()._perp(),Rr=gt===je.length-1?Re:Ot.sub(zt)._unit()._perp(),Zr=rr._add(Rr)._unit();Zr._mult(1/(Zr.x*Rr.x+Zr.y*Rr.y)),ft.push(Zr._mult(re)._add(zt))}Te.push(ft)}return Te}(y,H*I)),function(J,re,Te){for(var Re=0;Re<re.length;Re++){var qe=re[Re];if(J.length>=3){for(var je=0;je<qe.length;je++)if(cu(J,qe[je]))return!0}if(Cs(J,qe,Te))return!0}return!1}(D,y,z)},o.prototype.isTileClipped=function(){return!0},o}(Qs);function xp(n,o){return o>0?o+2*n:n}var am=wa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sm=wa([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ep=(wa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),wa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ld=(wa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),wa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),B=wa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function pe(n,o,s){return n.sections.forEach(function(p){p.text=function(_,y,b){var C=y.layout.get("text-transform").evaluate(b,{});return C==="uppercase"?_=_.toLocaleUpperCase():C==="lowercase"&&(_=_.toLocaleLowerCase()),Ks.applyArabicShaping&&(_=Ks.applyArabicShaping(_)),_}(p.text,o,s)}),n}wa([{name:"triangle",components:3,type:"Uint16"}]),wa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),wa([{type:"Float32",name:"offsetX"}]),wa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ne={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},It=function(n,o,s,p,_){var y,b,C=8*_-p-1,I=(1<<C)-1,D=I>>1,z=-7,H=s?_-1:0,J=s?-1:1,re=n[o+H];for(H+=J,y=re&(1<<-z)-1,re>>=-z,z+=C;z>0;y=256*y+n[o+H],H+=J,z-=8);for(b=y&(1<<-z)-1,y>>=-z,z+=p;z>0;b=256*b+n[o+H],H+=J,z-=8);if(y===0)y=1-D;else{if(y===I)return b?NaN:1/0*(re?-1:1);b+=Math.pow(2,p),y-=D}return(re?-1:1)*b*Math.pow(2,y-p)},$t=function(n,o,s,p,_,y){var b,C,I,D=8*y-_-1,z=(1<<D)-1,H=z>>1,J=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=p?0:y-1,Te=p?1:-1,Re=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(C=isNaN(o)?1:0,b=z):(b=Math.floor(Math.log(o)/Math.LN2),o*(I=Math.pow(2,-b))<1&&(b--,I*=2),(o+=b+H>=1?J/I:J*Math.pow(2,1-H))*I>=2&&(b++,I/=2),b+H>=z?(C=0,b=z):b+H>=1?(C=(o*I-1)*Math.pow(2,_),b+=H):(C=o*Math.pow(2,H-1)*Math.pow(2,_),b=0));_>=8;n[s+re]=255&C,re+=Te,C/=256,_-=8);for(b=b<<_|C,D+=_;D>0;n[s+re]=255&b,re+=Te,b/=256,D-=8);n[s+re-Te]|=128*Re},Lt=yt;function yt(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}yt.Varint=0,yt.Fixed64=1,yt.Bytes=2,yt.Fixed32=5;var br=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function _r(n){return n.type===yt.Bytes?n.readVarint()+n.pos:n.pos+1}function Mr(n,o,s){return s?4294967296*o+(n>>>0):4294967296*(o>>>0)+(n>>>0)}function Sr(n,o,s){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));s.realloc(p);for(var _=s.pos-1;_>=n;_--)s.buf[_+p]=s.buf[_]}function Or(n,o){for(var s=0;s<n.length;s++)o.writeVarint(n[s])}function kr(n,o){for(var s=0;s<n.length;s++)o.writeSVarint(n[s])}function gr(n,o){for(var s=0;s<n.length;s++)o.writeFloat(n[s])}function Dr(n,o){for(var s=0;s<n.length;s++)o.writeDouble(n[s])}function dt(n,o){for(var s=0;s<n.length;s++)o.writeBoolean(n[s])}function Ht(n,o){for(var s=0;s<n.length;s++)o.writeFixed32(n[s])}function Ar(n,o){for(var s=0;s<n.length;s++)o.writeSFixed32(n[s])}function Yr(n,o){for(var s=0;s<n.length;s++)o.writeFixed64(n[s])}function sr(n,o){for(var s=0;s<n.length;s++)o.writeSFixed64(n[s])}function tn(n,o){return(n[o]|n[o+1]<<8|n[o+2]<<16)+16777216*n[o+3]}function yr(n,o,s){n[s]=o,n[s+1]=o>>>8,n[s+2]=o>>>16,n[s+3]=o>>>24}function qr(n,o){return(n[o]|n[o+1]<<8|n[o+2]<<16)+(n[o+3]<<24)}function fr(n,o,s){n===1&&s.readMessage(jr,o)}function jr(n,o,s){if(n===3){var p=s.readMessage(wn,{}),_=p.width,y=p.height,b=p.left,C=p.top,I=p.advance;o.push({id:p.id,bitmap:new ws({width:_+6,height:y+6},p.bitmap),metrics:{width:_,height:y,left:b,top:C,advance:I}})}}function wn(n,o,s){n===1?o.id=s.readVarint():n===2?o.bitmap=s.readBytes():n===3?o.width=s.readVarint():n===4?o.height=s.readVarint():n===5?o.left=s.readSVarint():n===6?o.top=s.readSVarint():n===7&&(o.advance=s.readVarint())}function Wn(n){for(var o=0,s=0,p=0,_=n;p<_.length;p+=1){var y=_[p];o+=y.w*y.h,s=Math.max(s,y.w)}n.sort(function(Re,qe){return qe.h-Re.h});for(var b=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),s),h:1/0}],C=0,I=0,D=0,z=n;D<z.length;D+=1)for(var H=z[D],J=b.length-1;J>=0;J--){var re=b[J];if(!(H.w>re.w||H.h>re.h)){if(H.x=re.x,H.y=re.y,I=Math.max(I,H.y+H.h),C=Math.max(C,H.x+H.w),H.w===re.w&&H.h===re.h){var Te=b.pop();J<b.length&&(b[J]=Te)}else H.h===re.h?(re.x+=H.w,re.w-=H.w):H.w===re.w?(re.y+=H.h,re.h-=H.h):(b.push({x:re.x+H.w,y:re.y,w:re.w-H.w,h:H.h}),re.y+=H.h,re.h-=H.h);break}}return{w:C,h:I,fill:o/(C*I)||0}}yt.prototype={destroy:function(){this.buf=null},readFields:function(n,o,s){for(s=s||this.length;this.pos<s;){var p=this.readVarint(),_=p>>3,y=this.pos;this.type=7&p,n(_,o,this),this.pos===y&&this.skip(p)}return o},readMessage:function(n,o){return this.readFields(n,o,this.readVarint()+this.pos)},readFixed32:function(){var n=tn(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=qr(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=tn(this.buf,this.pos)+4294967296*tn(this.buf,this.pos+4);return this.pos+=8,n},readSFixed64:function(){var n=tn(this.buf,this.pos)+4294967296*qr(this.buf,this.pos+4);return this.pos+=8,n},readFloat:function(){var n=It(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=It(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var o,s,p=this.buf;return o=127&(s=p[this.pos++]),s<128?o:(o|=(127&(s=p[this.pos++]))<<7,s<128?o:(o|=(127&(s=p[this.pos++]))<<14,s<128?o:(o|=(127&(s=p[this.pos++]))<<21,s<128?o:function(_,y,b){var C,I,D=b.buf;if(C=(112&(I=D[b.pos++]))>>4,I<128||(C|=(127&(I=D[b.pos++]))<<3,I<128)||(C|=(127&(I=D[b.pos++]))<<10,I<128)||(C|=(127&(I=D[b.pos++]))<<17,I<128)||(C|=(127&(I=D[b.pos++]))<<24,I<128)||(C|=(1&(I=D[b.pos++]))<<31,I<128))return Mr(_,C,y);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(s=p[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,o=this.pos;return this.pos=n,n-o>=12&&br?function(s,p,_){return br.decode(s.subarray(p,_))}(this.buf,o,n):function(s,p,_){for(var y="",b=p;b<_;){var C,I,D,z=s[b],H=null,J=z>239?4:z>223?3:z>191?2:1;if(b+J>_)break;J===1?z<128&&(H=z):J===2?(192&(C=s[b+1]))==128&&(H=(31&z)<<6|63&C)<=127&&(H=null):J===3?(I=s[b+2],(192&(C=s[b+1]))==128&&(192&I)==128&&((H=(15&z)<<12|(63&C)<<6|63&I)<=2047||H>=55296&&H<=57343)&&(H=null)):J===4&&(I=s[b+2],D=s[b+3],(192&(C=s[b+1]))==128&&(192&I)==128&&(192&D)==128&&((H=(15&z)<<18|(63&C)<<12|(63&I)<<6|63&D)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,J=1):H>65535&&(H-=65536,y+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),y+=String.fromCharCode(H),b+=J}return y}(this.buf,o,n)},readBytes:function(){var n=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,n);return this.pos=n,o},readPackedVarint:function(n,o){if(this.type!==yt.Bytes)return n.push(this.readVarint(o));var s=_r(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(o));return n},readPackedSVarint:function(n){if(this.type!==yt.Bytes)return n.push(this.readSVarint());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==yt.Bytes)return n.push(this.readBoolean());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==yt.Bytes)return n.push(this.readFloat());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==yt.Bytes)return n.push(this.readDouble());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==yt.Bytes)return n.push(this.readFixed32());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==yt.Bytes)return n.push(this.readSFixed32());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==yt.Bytes)return n.push(this.readFixed64());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==yt.Bytes)return n.push(this.readSFixed64());var o=_r(this);for(n=n||[];this.pos<o;)n.push(this.readSFixed64());return n},skip:function(n){var o=7&n;if(o===yt.Varint)for(;this.buf[this.pos++]>127;);else if(o===yt.Bytes)this.pos=this.readVarint()+this.pos;else if(o===yt.Fixed32)this.pos+=4;else{if(o!==yt.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(n,o){this.writeVarint(n<<3|o)},realloc:function(n){for(var o=this.length||16;o<this.pos+n;)o*=2;if(o!==this.length){var s=new Uint8Array(o);s.set(this.buf),this.buf=s,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),yr(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),yr(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),yr(this.buf,-1&n,this.pos),yr(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),yr(this.buf,-1&n,this.pos),yr(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(o,s){var p,_;if(o>=0?(p=o%4294967296|0,_=o/4294967296|0):(_=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,_=_+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(y,b,C){C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,C.buf[C.pos]=127&(y>>>=7)}(p,0,s),function(y,b){var C=(7&y)<<4;b.buf[b.pos++]|=C|((y>>>=3)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y|((y>>>=7)?128:0),y&&(b.buf[b.pos++]=127&y)))))}(_,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var o=this.pos;this.pos=function(p,_,y){for(var b,C,I=0;I<_.length;I++){if((b=_.charCodeAt(I))>55295&&b<57344){if(!C){b>56319||I+1===_.length?(p[y++]=239,p[y++]=191,p[y++]=189):C=b;continue}if(b<56320){p[y++]=239,p[y++]=191,p[y++]=189,C=b;continue}b=C-55296<<10|b-56320|65536,C=null}else C&&(p[y++]=239,p[y++]=191,p[y++]=189,C=null);b<128?p[y++]=b:(b<2048?p[y++]=b>>6|192:(b<65536?p[y++]=b>>12|224:(p[y++]=b>>18|240,p[y++]=b>>12&63|128),p[y++]=b>>6&63|128),p[y++]=63&b|128)}return y}(this.buf,n,this.pos);var s=this.pos-o;s>=128&&Sr(o,s,this),this.pos=o-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),$t(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),$t(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var o=n.length;this.writeVarint(o),this.realloc(o);for(var s=0;s<o;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,o){this.pos++;var s=this.pos;n(o,this);var p=this.pos-s;p>=128&&Sr(s,p,this),this.pos=s-1,this.writeVarint(p),this.pos+=p},writeMessage:function(n,o,s){this.writeTag(n,yt.Bytes),this.writeRawMessage(o,s)},writePackedVarint:function(n,o){o.length&&this.writeMessage(n,Or,o)},writePackedSVarint:function(n,o){o.length&&this.writeMessage(n,kr,o)},writePackedBoolean:function(n,o){o.length&&this.writeMessage(n,dt,o)},writePackedFloat:function(n,o){o.length&&this.writeMessage(n,gr,o)},writePackedDouble:function(n,o){o.length&&this.writeMessage(n,Dr,o)},writePackedFixed32:function(n,o){o.length&&this.writeMessage(n,Ht,o)},writePackedSFixed32:function(n,o){o.length&&this.writeMessage(n,Ar,o)},writePackedFixed64:function(n,o){o.length&&this.writeMessage(n,Yr,o)},writePackedSFixed64:function(n,o){o.length&&this.writeMessage(n,sr,o)},writeBytesField:function(n,o){this.writeTag(n,yt.Bytes),this.writeBytes(o)},writeFixed32Field:function(n,o){this.writeTag(n,yt.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(n,o){this.writeTag(n,yt.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(n,o){this.writeTag(n,yt.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(n,o){this.writeTag(n,yt.Fixed64),this.writeSFixed64(o)},writeVarintField:function(n,o){this.writeTag(n,yt.Varint),this.writeVarint(o)},writeSVarintField:function(n,o){this.writeTag(n,yt.Varint),this.writeSVarint(o)},writeStringField:function(n,o){this.writeTag(n,yt.Bytes),this.writeString(o)},writeFloatField:function(n,o){this.writeTag(n,yt.Fixed32),this.writeFloat(o)},writeDoubleField:function(n,o){this.writeTag(n,yt.Fixed64),this.writeDouble(o)},writeBooleanField:function(n,o){this.writeVarintField(n,!!o)}};var Hr=function(n,o){var s=o.pixelRatio,p=o.version,_=o.stretchX,y=o.stretchY,b=o.content;this.paddedRect=n,this.pixelRatio=s,this.stretchX=_,this.stretchY=y,this.content=b,this.version=p},xr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};xr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},xr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},xr.tlbr.get=function(){return this.tl.concat(this.br)},xr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Hr.prototype,xr);var Qt=function(n,o){var s={},p={};this.haveRenderCallbacks=[];var _=[];this.addImages(n,s,_),this.addImages(o,p,_);var y=Wn(_),b=new cs({width:y.w||1,height:y.h||1});for(var C in n){var I=n[C],D=s[C].paddedRect;cs.copy(I.data,b,{x:0,y:0},{x:D.x+1,y:D.y+1},I.data)}for(var z in o){var H=o[z],J=p[z].paddedRect,re=J.x+1,Te=J.y+1,Re=H.data.width,qe=H.data.height;cs.copy(H.data,b,{x:0,y:0},{x:re,y:Te},H.data),cs.copy(H.data,b,{x:0,y:qe-1},{x:re,y:Te-1},{width:Re,height:1}),cs.copy(H.data,b,{x:0,y:0},{x:re,y:Te+qe},{width:Re,height:1}),cs.copy(H.data,b,{x:Re-1,y:0},{x:re-1,y:Te},{width:1,height:qe}),cs.copy(H.data,b,{x:0,y:0},{x:re+Re,y:Te},{width:1,height:qe})}this.image=b,this.iconPositions=s,this.patternPositions=p};Qt.prototype.addImages=function(n,o,s){for(var p in n){var _=n[p],y={x:0,y:0,w:_.data.width+2,h:_.data.height+2};s.push(y),o[p]=new Hr(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},Qt.prototype.patchUpdatedImages=function(n,o){for(var s in n.dispatchRenderCallbacks(this.haveRenderCallbacks),n.updatedImages)this.patchUpdatedImage(this.iconPositions[s],n.getImage(s),o),this.patchUpdatedImage(this.patternPositions[s],n.getImage(s),o)},Qt.prototype.patchUpdatedImage=function(n,o,s){if(n&&o&&n.version!==o.version){n.version=o.version;var p=n.tl;s.update(o.data,void 0,{x:p[0],y:p[1]})}},cn("ImagePosition",Hr),cn("ImageAtlas",Qt);var Mn={horizontal:1,vertical:2,horizontalOnly:3},lt=function(){this.scale=1,this.fontStack="",this.imageName=null};lt.forText=function(n,o){var s=new lt;return s.scale=n||1,s.fontStack=o,s},lt.forImage=function(n){var o=new lt;return o.imageName=n,o};var P=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function ti(n,o,s,p,_,y,b,C,I,D,z,H,J,re,Te,Re){var qe,je=P.fromFeature(n,_);H===Mn.vertical&&je.verticalizePunctuation();var ft=Ks.processBidirectionalText,gt=Ks.processStyledBidirectionalText;if(ft&&je.sections.length===1){qe=[];for(var zt=0,Ot=ft(je.toString(),ua(je,D,y,o,p,re,Te));zt<Ot.length;zt+=1){var rr=Ot[zt],Rr=new P;Rr.text=rr,Rr.sections=je.sections;for(var Zr=0;Zr<rr.length;Zr++)Rr.sectionIndex.push(0);qe.push(Rr)}}else if(gt){qe=[];for(var xn=0,nn=gt(je.text,je.sectionIndex,ua(je,D,y,o,p,re,Te));xn<nn.length;xn+=1){var In=nn[xn],rn=new P;rn.text=In[0],rn.sectionIndex=In[1],rn.sections=je.sections,qe.push(rn)}}else qe=function(hn,pi){for(var ni=[],Ri=hn.text,Tn=0,Ii=0,Fi=pi;Ii<Fi.length;Ii+=1){var Wo=Fi[Ii];ni.push(hn.substring(Tn,Wo)),Tn=Wo}return Tn<Ri.length&&ni.push(hn.substring(Tn,Ri.length)),ni}(je,ua(je,D,y,o,p,re,Te));var ci=[],Vn={positionedLines:ci,text:je.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(hn,pi,ni,Ri,Tn,Ii,Fi,Wo,Uo,eo,ta,za){for(var Va=0,ps=-17,Za=0,ja=0,fa=Wo==="right"?1:Wo==="left"?0:.5,Ka=0,Si=0,uo=Tn;Si<uo.length;Si+=1){var io=uo[Si];io.trim();var Ui=io.getMaxScale(),Hs=24*(Ui-1),ha={positionedGlyphs:[],lineOffset:0};hn.positionedLines[Ka]=ha;var yo=ha.positionedGlyphs,$o=0;if(io.length()){for(var $a=0;$a<io.length();$a++){var Pi=io.getSection($a),gl=io.getSectionIndex($a),nu=io.getCharCode($a),Pu=0,Qo=null,Ou=null,hu=null,pu=24,Qc=!(Uo===Mn.horizontal||!ta&&!nc(nu)||ta&&(F[nu]||(ef=nu,Ur.Arabic(ef)||Ur["Arabic Supplement"](ef)||Ur["Arabic Extended-A"](ef)||Ur["Arabic Presentation Forms-A"](ef)||Ur["Arabic Presentation Forms-B"](ef))));if(Pi.imageName){var Sf=Ri[Pi.imageName];if(!Sf)continue;hu=Pi.imageName,hn.iconsInText=hn.iconsInText||!0,Ou=Sf.paddedRect;var Jc=Sf.displaySize;Pi.scale=24*Pi.scale/za,Pu=Hs+(24-Jc[1]*Pi.scale),pu=(Qo={width:Jc[0],height:Jc[1],left:1,top:-3,advance:Qc?Jc[1]:Jc[0]}).advance;var Sp=Qc?Jc[0]*Pi.scale-24*Ui:Jc[1]*Pi.scale-24*Ui;Sp>0&&Sp>$o&&($o=Sp)}else{var Oh=ni[Pi.fontStack],eh=Oh&&Oh[nu];if(eh&&eh.rect)Ou=eh.rect,Qo=eh.metrics;else{var dd=pi[Pi.fontStack],Ap=dd&&dd[nu];if(!Ap)continue;Qo=Ap.metrics}Pu=24*(Ui-Pi.scale)}Qc?(hn.verticalizable=!0,yo.push({glyph:nu,imageName:hu,x:Va,y:ps+Pu,vertical:Qc,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:gl,metrics:Qo,rect:Ou}),Va+=pu*Pi.scale+eo):(yo.push({glyph:nu,imageName:hu,x:Va,y:ps+Pu,vertical:Qc,scale:Pi.scale,fontStack:Pi.fontStack,sectionIndex:gl,metrics:Qo,rect:Ou}),Va+=Qo.advance*Pi.scale+eo)}yo.length!==0&&(Za=Math.max(Va-eo,Za),la(yo,0,yo.length-1,fa,$o)),Va=0;var md=Ii*Ui+$o;ha.lineOffset=Math.max($o,Hs),ps+=md,ja=Math.max(md,ja),++Ka}else ps+=Ii,++Ka}var ef,Tp=ps- -17,Dh=vo(Fi),Af=Dh.horizontalAlign,Lh=Dh.verticalAlign;(function(vd,Cp,wp,Rp,_d,Mp,Ip,Fh,gd){var th,yd=(Cp-wp)*_d;th=Mp!==Ip?-Fh*Rp- -17:(-Rp*gd+.5)*Ip;for(var rh=0,Pp=vd;rh<Pp.length;rh+=1)for(var Tf=0,Bh=Pp[rh].positionedGlyphs;Tf<Bh.length;Tf+=1){var Nh=Bh[Tf];Nh.x+=yd,Nh.y+=th}})(hn.positionedLines,fa,Af,Lh,Za,ja,Ii,Tp,Tn.length),hn.top+=-Lh*Tp,hn.bottom=hn.top+Tp,hn.left+=-Af*Za,hn.right=hn.left+Za}(Vn,o,s,p,qe,b,C,I,H,D,J,Re),!function(hn){for(var pi=0,ni=hn;pi<ni.length;pi+=1)if(ni[pi].positionedGlyphs.length!==0)return!1;return!0}(ci)&&Vn}P.fromFeature=function(n,o){for(var s=new P,p=0;p<n.sections.length;p++){var _=n.sections[p];_.image?s.addImageSection(_):s.addTextSection(_,o)}return s},P.prototype.length=function(){return this.text.length},P.prototype.getSection=function(n){return this.sections[this.sectionIndex[n]]},P.prototype.getSectionIndex=function(n){return this.sectionIndex[n]},P.prototype.getCharCode=function(n){return this.text.charCodeAt(n)},P.prototype.verticalizePunctuation=function(){this.text=function(n){for(var o="",s=0;s<n.length;s++){var p=n.charCodeAt(s+1)||null,_=n.charCodeAt(s-1)||null;o+=p&&df(p)&&!Ne[n[s+1]]||_&&df(_)&&!Ne[n[s-1]]||!Ne[n[s]]?n[s]:Ne[n[s]]}return o}(this.text)},P.prototype.trim=function(){for(var n=0,o=0;o<this.text.length&&F[this.text.charCodeAt(o)];o++)n++;for(var s=this.text.length,p=this.text.length-1;p>=0&&p>=n&&F[this.text.charCodeAt(p)];p--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)},P.prototype.substring=function(n,o){var s=new P;return s.text=this.text.substring(n,o),s.sectionIndex=this.sectionIndex.slice(n,o),s.sections=this.sections,s},P.prototype.toString=function(){return this.text},P.prototype.getMaxScale=function(){var n=this;return this.sectionIndex.reduce(function(o,s){return Math.max(o,n.sections[s].scale)},0)},P.prototype.addTextSection=function(n,o){this.text+=n.text,this.sections.push(lt.forText(n.scale,n.fontStack||o));for(var s=this.sections.length-1,p=0;p<n.text.length;++p)this.sectionIndex.push(s)},P.prototype.addImageSection=function(n){var o=n.image?n.image.name:"";if(o.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(lt.forImage(o)),this.sectionIndex.push(this.sections.length-1)):ct("Reached maximum number of images 6401")}else ct("Can't add FormattedSection with an empty image.")},P.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var F={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zn={};function ki(n,o,s,p,_,y){if(o.imageName){var b=p[o.imageName];return b?b.displaySize[0]*o.scale*24/y+_:0}var C=s[o.fontStack],I=C&&C[n];return I?I.metrics.advance*o.scale+_:0}function sa(n,o,s,p){var _=Math.pow(n-o,2);return p?n<o?_/2:2*_:_+Math.abs(s)*s}function Ua(n,o,s){var p=0;return n===10&&(p-=1e4),s&&(p+=150),n!==40&&n!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function ri(n,o,s,p,_,y){for(var b=null,C=sa(o,s,_,y),I=0,D=p;I<D.length;I+=1){var z=D[I],H=sa(o-z.x,s,_,y)+z.badness;H<=C&&(b=z,C=H)}return{index:n,x:o,priorBreak:b,badness:C}}function ua(n,o,s,p,_,y,b){if(y!=="point")return[];if(!n)return[];for(var C,I=[],D=function(qe,je,ft,gt,zt,Ot){for(var rr=0,Rr=0;Rr<qe.length();Rr++){var Zr=qe.getSection(Rr);rr+=ki(qe.getCharCode(Rr),Zr,gt,zt,je,Ot)}return rr/Math.max(1,Math.ceil(rr/ft))}(n,o,s,p,_,b),z=n.text.indexOf("\u200B")>=0,H=0,J=0;J<n.length();J++){var re=n.getSection(J),Te=n.getCharCode(J);if(F[Te]||(H+=ki(Te,re,p,_,o,b)),J<n.length()-1){var Re=!((C=Te)<11904||!(Ur["Bopomofo Extended"](C)||Ur.Bopomofo(C)||Ur["CJK Compatibility Forms"](C)||Ur["CJK Compatibility Ideographs"](C)||Ur["CJK Compatibility"](C)||Ur["CJK Radicals Supplement"](C)||Ur["CJK Strokes"](C)||Ur["CJK Symbols and Punctuation"](C)||Ur["CJK Unified Ideographs Extension A"](C)||Ur["CJK Unified Ideographs"](C)||Ur["Enclosed CJK Letters and Months"](C)||Ur["Halfwidth and Fullwidth Forms"](C)||Ur.Hiragana(C)||Ur["Ideographic Description Characters"](C)||Ur["Kangxi Radicals"](C)||Ur["Katakana Phonetic Extensions"](C)||Ur.Katakana(C)||Ur["Vertical Forms"](C)||Ur["Yi Radicals"](C)||Ur["Yi Syllables"](C)));(zn[Te]||Re||re.imageName)&&I.push(ri(J+1,H,D,I,Ua(Te,n.getCharCode(J+1),Re&&z),!1))}}return function qe(je){return je?qe(je.priorBreak).concat(je.index):[]}(ri(n.length(),H,D,I,0,!0))}function vo(n){var o=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:o,verticalAlign:s}}function la(n,o,s,p,_){if(p||_)for(var y=n[s],b=(n[s].x+y.metrics.advance*y.scale)*p,C=o;C<=s;C++)n[C].x-=b,n[C].y+=_}function ea(n,o,s,p,_,y){var b,C=n.image;if(C.content){var I=C.content,D=C.pixelRatio||1;b=[I[0]/D,I[1]/D,C.displaySize[0]-I[2]/D,C.displaySize[1]-I[3]/D]}var z,H,J,re,Te=o.left*y,Re=o.right*y;s==="width"||s==="both"?(re=_[0]+Te-p[3],H=_[0]+Re+p[1]):H=(re=_[0]+(Te+Re-C.displaySize[0])/2)+C.displaySize[0];var qe=o.top*y,je=o.bottom*y;return s==="height"||s==="both"?(z=_[1]+qe-p[0],J=_[1]+je+p[2]):J=(z=_[1]+(qe+je-C.displaySize[1])/2)+C.displaySize[1],{image:C,top:z,right:H,bottom:J,left:re,collisionPadding:b}}zn[10]=!0,zn[32]=!0,zn[38]=!0,zn[40]=!0,zn[41]=!0,zn[43]=!0,zn[45]=!0,zn[47]=!0,zn[173]=!0,zn[183]=!0,zn[8203]=!0,zn[8208]=!0,zn[8211]=!0,zn[8231]=!0;var No=function(n){function o(s,p,_,y){n.call(this,s,p),this.angle=_,y!==void 0&&(this.segment=y)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(W);function Ia(n,o){var s=o.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new qn(n+1))};if(s.kind==="source")return{kind:"source"};for(var p=s.zoomStops,_=s.interpolationType,y=0;y<p.length&&p[y]<=n;)y++;for(var b=y=Math.max(0,y-1);b<p.length&&p[b]<n+1;)b++;b=Math.min(p.length-1,b);var C=p[y],I=p[b];return s.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:I,interpolationType:_}:{kind:"camera",minZoom:C,maxZoom:I,minSize:s.evaluate(new qn(C)),maxSize:s.evaluate(new qn(I)),interpolationType:_}}function hs(n,o,s){var p=o.uSize,_=s.lowerSize;return n.kind==="source"?_/128:n.kind==="composite"?Co(_/128,s.upperSize/128,o.uSizeT):p}function ca(n,o){var s=0,p=0;if(n.kind==="constant")p=n.layoutSize;else if(n.kind!=="source"){var _=n.interpolationType,y=_?ht(_o.interpolationFactor(_,o,n.minZoom,n.maxZoom),0,1):0;n.kind==="camera"?p=Co(n.minSize,n.maxSize,y):s=y}return{uSizeT:s,uSize:p}}cn("Anchor",No);var li=Object.freeze({__proto__:null,getSizeData:Ia,evaluateSizeForFeature:hs,evaluateSizeForZoom:ca,SIZE_PACK_FACTOR:128});function rs(n,o,s,p,_){if(o.segment===void 0)return!0;for(var y=o,b=o.segment+1,C=0;C>-s/2;){if(--b<0)return!1;C-=n[b].dist(y),y=n[b]}C+=n[b].dist(n[b+1]),b++;for(var I=[],D=0;C<s/2;){var z=n[b],H=n[b+1];if(!H)return!1;var J=n[b-1].angleTo(z)-z.angleTo(H);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:C,angleDelta:J}),D+=J;C-I[0].distance>p;)D-=I.shift().angleDelta;if(D>_)return!1;b++,C+=z.dist(H)}return!0}function Hi(n){for(var o=0,s=0;s<n.length-1;s++)o+=n[s].dist(n[s+1]);return o}function Nn(n,o,s){return n?.6*o*s:0}function xi(n,o){return Math.max(n?n.right-n.left:0,o?o.right-o.left:0)}function Li(n,o,s,p,_,y){for(var b=Nn(s,_,y),C=xi(s,p)*y,I=0,D=Hi(n)/2,z=0;z<n.length-1;z++){var H=n[z],J=n[z+1],re=H.dist(J);if(I+re>D){var Te=(D-I)/re,Re=Co(H.x,J.x,Te),qe=Co(H.y,J.y,Te),je=new No(Re,qe,J.angleTo(H),z);return je._round(),!b||rs(n,je,C,b,o)?je:void 0}I+=re}}function ga(n,o,s,p,_,y,b,C,I){var D=Nn(p,y,b),z=xi(p,_),H=z*b,J=n[0].x===0||n[0].x===I||n[0].y===0||n[0].y===I;return o-H<o/4&&(o=H+o/4),function re(Te,Re,qe,je,ft,gt,zt,Ot,rr){for(var Rr=gt/2,Zr=Hi(Te),xn=0,nn=Re-qe,In=[],rn=0;rn<Te.length-1;rn++){for(var ci=Te[rn],Vn=Te[rn+1],hn=ci.dist(Vn),pi=Vn.angleTo(ci);nn+qe<xn+hn;){var ni=((nn+=qe)-xn)/hn,Ri=Co(ci.x,Vn.x,ni),Tn=Co(ci.y,Vn.y,ni);if(Ri>=0&&Ri<rr&&Tn>=0&&Tn<rr&&nn-Rr>=0&&nn+Rr<=Zr){var Ii=new No(Ri,Tn,pi,rn);Ii._round(),je&&!rs(Te,Ii,gt,je,ft)||In.push(Ii)}}xn+=hn}return Ot||In.length||zt||(In=re(Te,xn/2,qe,je,ft,gt,zt,!0,rr)),In}(n,J?o/2*C%o:(z/2+2*y)*b*C%o,o,D,s,H,J,!1,I)}function _l(n,o,s,p,_){for(var y=[],b=0;b<n.length;b++)for(var C=n[b],I=void 0,D=0;D<C.length-1;D++){var z=C[D],H=C[D+1];z.x<o&&H.x<o||(z.x<o?z=new W(o,z.y+(o-z.x)/(H.x-z.x)*(H.y-z.y))._round():H.x<o&&(H=new W(o,z.y+(o-z.x)/(H.x-z.x)*(H.y-z.y))._round()),z.y<s&&H.y<s||(z.y<s?z=new W(z.x+(s-z.y)/(H.y-z.y)*(H.x-z.x),s)._round():H.y<s&&(H=new W(z.x+(s-z.y)/(H.y-z.y)*(H.x-z.x),s)._round()),z.x>=p&&H.x>=p||(z.x>=p?z=new W(p,z.y+(p-z.x)/(H.x-z.x)*(H.y-z.y))._round():H.x>=p&&(H=new W(p,z.y+(p-z.x)/(H.x-z.x)*(H.y-z.y))._round()),z.y>=_&&H.y>=_||(z.y>=_?z=new W(z.x+(_-z.y)/(H.y-z.y)*(H.x-z.x),_)._round():H.y>=_&&(H=new W(z.x+(_-z.y)/(H.y-z.y)*(H.x-z.x),_)._round()),I&&z.equals(I[I.length-1])||y.push(I=[z]),I.push(H)))))}return y}function Me(n,o,s,p){var _=[],y=n.image,b=y.pixelRatio,C=y.paddedRect.w-2,I=y.paddedRect.h-2,D=n.right-n.left,z=n.bottom-n.top,H=y.stretchX||[[0,C]],J=y.stretchY||[[0,I]],re=function(Ri,Tn){return Ri+Tn[1]-Tn[0]},Te=H.reduce(re,0),Re=J.reduce(re,0),qe=C-Te,je=I-Re,ft=0,gt=Te,zt=0,Ot=Re,rr=0,Rr=qe,Zr=0,xn=je;if(y.content&&p){var nn=y.content;ft=Ut(H,0,nn[0]),zt=Ut(J,0,nn[1]),gt=Ut(H,nn[0],nn[2]),Ot=Ut(J,nn[1],nn[3]),rr=nn[0]-ft,Zr=nn[1]-zt,Rr=nn[2]-nn[0]-gt,xn=nn[3]-nn[1]-Ot}var In=function(Ri,Tn,Ii,Fi){var Wo=on(Ri.stretch-ft,gt,D,n.left),Uo=hi(Ri.fixed-rr,Rr,Ri.stretch,Te),eo=on(Tn.stretch-zt,Ot,z,n.top),ta=hi(Tn.fixed-Zr,xn,Tn.stretch,Re),za=on(Ii.stretch-ft,gt,D,n.left),Va=hi(Ii.fixed-rr,Rr,Ii.stretch,Te),ps=on(Fi.stretch-zt,Ot,z,n.top),Za=hi(Fi.fixed-Zr,xn,Fi.stretch,Re),ja=new W(Wo,eo),fa=new W(za,eo),Ka=new W(za,ps),Si=new W(Wo,ps),uo=new W(Uo/b,ta/b),io=new W(Va/b,Za/b),Ui=o*Math.PI/180;if(Ui){var Hs=Math.sin(Ui),ha=Math.cos(Ui),yo=[ha,-Hs,Hs,ha];ja._matMult(yo),fa._matMult(yo),Si._matMult(yo),Ka._matMult(yo)}var $o=Ri.stretch+Ri.fixed,$a=Tn.stretch+Tn.fixed;return{tl:ja,tr:fa,bl:Si,br:Ka,tex:{x:y.paddedRect.x+1+$o,y:y.paddedRect.y+1+$a,w:Ii.stretch+Ii.fixed-$o,h:Fi.stretch+Fi.fixed-$a},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:uo,pixelOffsetBR:io,minFontScaleX:Rr/b/D,minFontScaleY:xn/b/z,isSDF:s}};if(p&&(y.stretchX||y.stretchY))for(var rn=bt(H,qe,Te),ci=bt(J,je,Re),Vn=0;Vn<rn.length-1;Vn++)for(var hn=rn[Vn],pi=rn[Vn+1],ni=0;ni<ci.length-1;ni++)_.push(In(hn,ci[ni],pi,ci[ni+1]));else _.push(In({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:I+1}));return _}function Ut(n,o,s){for(var p=0,_=0,y=n;_<y.length;_+=1){var b=y[_];p+=Math.max(o,Math.min(s,b[1]))-Math.max(o,Math.min(s,b[0]))}return p}function bt(n,o,s){for(var p=[{fixed:-1,stretch:0}],_=0,y=n;_<y.length;_+=1){var b=y[_],C=b[0],I=b[1],D=p[p.length-1];p.push({fixed:C-D.stretch,stretch:D.stretch}),p.push({fixed:C-D.stretch,stretch:D.stretch+(I-C)})}return p.push({fixed:o+1,stretch:s}),p}function on(n,o,s,p){return n/o*s+p}function hi(n,o,s,p){return n-o*s/p}var so=function(n,o,s,p,_,y,b,C,I,D){if(this.boxStartIndex=n.length,I){var z=y.top,H=y.bottom,J=y.collisionPadding;J&&(z-=J[1],H+=J[3]);var re=H-z;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{var Te=y.top*b-C,Re=y.bottom*b+C,qe=y.left*b-C,je=y.right*b+C,ft=y.collisionPadding;if(ft&&(qe-=ft[0]*b,Te-=ft[1]*b,je+=ft[2]*b,Re+=ft[3]*b),D){var gt=new W(qe,Te),zt=new W(je,Te),Ot=new W(qe,Re),rr=new W(je,Re),Rr=D*Math.PI/180;gt._rotate(Rr),zt._rotate(Rr),Ot._rotate(Rr),rr._rotate(Rr),qe=Math.min(gt.x,zt.x,Ot.x,rr.x),je=Math.max(gt.x,zt.x,Ot.x,rr.x),Te=Math.min(gt.y,zt.y,Ot.y,rr.y),Re=Math.max(gt.y,zt.y,Ot.y,rr.y)}n.emplaceBack(o.x,o.y,qe,Te,je,Re,s,p,_)}this.boxEndIndex=n.length},te=function(n,o){if(n===void 0&&(n=[]),o===void 0&&(o=xe),this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function xe(n,o){return n<o?-1:n>o?1:0}function Ue(n,o,s){o===void 0&&(o=1),s===void 0&&(s=!1);for(var p=1/0,_=1/0,y=-1/0,b=-1/0,C=n[0],I=0;I<C.length;I++){var D=C[I];(!I||D.x<p)&&(p=D.x),(!I||D.y<_)&&(_=D.y),(!I||D.x>y)&&(y=D.x),(!I||D.y>b)&&(b=D.y)}var z=Math.min(y-p,b-_),H=z/2,J=new te([],St);if(z===0)return new W(p,_);for(var re=p;re<y;re+=z)for(var Te=_;Te<b;Te+=z)J.push(new xt(re+H,Te+H,H,n));for(var Re=function(ft){for(var gt=0,zt=0,Ot=0,rr=ft[0],Rr=0,Zr=rr.length,xn=Zr-1;Rr<Zr;xn=Rr++){var nn=rr[Rr],In=rr[xn],rn=nn.x*In.y-In.x*nn.y;zt+=(nn.x+In.x)*rn,Ot+=(nn.y+In.y)*rn,gt+=3*rn}return new xt(zt/gt,Ot/gt,0,ft)}(n),qe=J.length;J.length;){var je=J.pop();(je.d>Re.d||!Re.d)&&(Re=je,s&&console.log("found best %d after %d probes",Math.round(1e4*je.d)/1e4,qe)),je.max-Re.d<=o||(J.push(new xt(je.p.x-(H=je.h/2),je.p.y-H,H,n)),J.push(new xt(je.p.x+H,je.p.y-H,H,n)),J.push(new xt(je.p.x-H,je.p.y+H,H,n)),J.push(new xt(je.p.x+H,je.p.y+H,H,n)),qe+=4)}return s&&(console.log("num probes: "+qe),console.log("best distance: "+Re.d)),Re.p}function St(n,o){return o.max-n.max}function xt(n,o,s,p){this.p=new W(n,o),this.h=s,this.d=function(_,y){for(var b=!1,C=1/0,I=0;I<y.length;I++)for(var D=y[I],z=0,H=D.length,J=H-1;z<H;J=z++){var re=D[z],Te=D[J];re.y>_.y!=Te.y>_.y&&_.x<(Te.x-re.x)*(_.y-re.y)/(Te.y-re.y)+re.x&&(b=!b),C=Math.min(C,Gu(_,re,Te))}return(b?1:-1)*Math.sqrt(C)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}te.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},te.prototype.pop=function(){if(this.length!==0){var n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}},te.prototype.peek=function(){return this.data[0]},te.prototype._up=function(n){for(var o=this.data,s=this.compare,p=o[n];n>0;){var _=n-1>>1,y=o[_];if(s(p,y)>=0)break;o[n]=y,n=_}o[n]=p},te.prototype._down=function(n){for(var o=this.data,s=this.compare,p=this.length>>1,_=o[n];n<p;){var y=1+(n<<1),b=o[y],C=y+1;if(C<this.length&&s(o[C],b)<0&&(y=C,b=o[C]),s(b,_)>=0)break;o[n]=b,n=y}o[n]=_};var Ge=Number.POSITIVE_INFINITY;function tt(n,o){return o[1]!==Ge?function(s,p,_){var y=0,b=0;switch(p=Math.abs(p),_=Math.abs(_),s){case"top-right":case"top-left":case"top":b=_-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-_}switch(s){case"top-right":case"bottom-right":case"right":y=-p;break;case"top-left":case"bottom-left":case"left":y=p}return[y,b]}(n,o[0],o[1]):function(s,p){var _=0,y=0;p<0&&(p=0);var b=p/Math.sqrt(2);switch(s){case"top-right":case"top-left":y=b-7;break;case"bottom-right":case"bottom-left":y=7-b;break;case"bottom":y=7-p;break;case"top":y=p-7}switch(s){case"top-right":case"bottom-right":_=-b;break;case"top-left":case"bottom-left":_=b;break;case"left":_=p;break;case"right":_=-p}return[_,y]}(n,o[0])}function ot(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ce(n,o,s,p,_,y,b,C,I,D,z,H,J,re,Te){var Re=function(zt,Ot,rr,Rr,Zr,xn,nn,In){for(var rn=Rr.layout.get("text-rotate").evaluate(xn,{})*Math.PI/180,ci=[],Vn=0,hn=Ot.positionedLines;Vn<hn.length;Vn+=1)for(var pi=hn[Vn],ni=0,Ri=pi.positionedGlyphs;ni<Ri.length;ni+=1){var Tn=Ri[ni];if(Tn.rect){var Ii=Tn.rect||{},Fi=4,Wo=!0,Uo=1,eo=0,ta=(Zr||In)&&Tn.vertical,za=Tn.metrics.advance*Tn.scale/2;if(In&&Ot.verticalizable&&(eo=pi.lineOffset/2-(Tn.imageName?-(24-Tn.metrics.width*Tn.scale)/2:24*(Tn.scale-1))),Tn.imageName){var Va=nn[Tn.imageName];Wo=Va.sdf,Fi=1/(Uo=Va.pixelRatio)}var ps=Zr?[Tn.x+za,Tn.y]:[0,0],Za=Zr?[0,0]:[Tn.x+za+rr[0],Tn.y+rr[1]-eo],ja=[0,0];ta&&(ja=Za,Za=[0,0]);var fa=(Tn.metrics.left-Fi)*Tn.scale-za+Za[0],Ka=(-Tn.metrics.top-Fi)*Tn.scale+Za[1],Si=fa+Ii.w*Tn.scale/Uo,uo=Ka+Ii.h*Tn.scale/Uo,io=new W(fa,Ka),Ui=new W(Si,Ka),Hs=new W(fa,uo),ha=new W(Si,uo);if(ta){var yo=new W(-za,za- -17),$o=-Math.PI/2,$a=12-za,Pi=new W(22-$a,-(Tn.imageName?$a:0)),gl=new(Function.prototype.bind.apply(W,[null].concat(ja)));io._rotateAround($o,yo)._add(Pi)._add(gl),Ui._rotateAround($o,yo)._add(Pi)._add(gl),Hs._rotateAround($o,yo)._add(Pi)._add(gl),ha._rotateAround($o,yo)._add(Pi)._add(gl)}if(rn){var nu=Math.sin(rn),Pu=Math.cos(rn),Qo=[Pu,-nu,nu,Pu];io._matMult(Qo),Ui._matMult(Qo),Hs._matMult(Qo),ha._matMult(Qo)}var Ou=new W(0,0),hu=new W(0,0);ci.push({tl:io,tr:Ui,bl:Hs,br:ha,tex:Ii,writingMode:Ot.writingMode,glyphOffset:ps,sectionIndex:Tn.sectionIndex,isSDF:Wo,pixelOffsetTL:Ou,pixelOffsetBR:hu,minFontScaleX:0,minFontScaleY:0})}}return ci}(0,s,C,_,y,b,p,n.allowVerticalPlacement),qe=n.textSizeData,je=null;qe.kind==="source"?(je=[128*_.layout.get("text-size").evaluate(b,{})])[0]>32640&&ct(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):qe.kind==="composite"&&((je=[128*re.compositeTextSizes[0].evaluate(b,{},Te),128*re.compositeTextSizes[1].evaluate(b,{},Te)])[0]>32640||je[1]>32640)&&ct(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),n.addSymbols(n.text,Re,je,C,y,b,D,o,I.lineStartIndex,I.lineLength,J,Te);for(var ft=0,gt=z;ft<gt.length;ft+=1)H[gt[ft]]=n.text.placedSymbolArray.length-1;return 4*Re.length}function Ye(n){for(var o in n)return n[o];return null}function me(n,o,s,p){var _=n.compareText;if(o in _){for(var y=_[o],b=y.length-1;b>=0;b--)if(p.dist(y[b])<s)return!0}else _[o]=[];return _[o].push(p),!1}var $e=_c.VectorTileFeature.types,Et=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nt(n,o,s,p,_,y,b,C,I,D,z,H,J){var re=C?Math.min(32640,Math.round(C[0])):0,Te=C?Math.min(32640,Math.round(C[1])):0;n.emplaceBack(o,s,Math.round(32*p),Math.round(32*_),y,b,(re<<1)+(I?1:0),Te,16*D,16*z,256*H,256*J)}function ar(n,o,s){n.emplaceBack(o.x,o.y,s),n.emplaceBack(o.x,o.y,s),n.emplaceBack(o.x,o.y,s),n.emplaceBack(o.x,o.y,s)}function Jt(n){for(var o=0,s=n.sections;o<s.length;o+=1)if(mf(s[o].text))return!0;return!1}var vr=function(n){this.layoutVertexArray=new ac,this.indexArray=new aa,this.programConfigurations=n,this.segments=new le,this.dynamicLayoutVertexArray=new Ol,this.opacityVertexArray=new _f,this.placedSymbolArray=new d};vr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},vr.prototype.upload=function(n,o,s,p){this.isEmpty()||(s&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,am.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,sm.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Et,!0),this.opacityVertexBuffer.itemSize=1),(s||p)&&this.programConfigurations.upload(n))},vr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},cn("SymbolBuffers",vr);var $r=function(n,o,s){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new s,this.segments=new le,this.collisionVertexArray=new Ll};$r.prototype.upload=function(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Ep.members,!0)},$r.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},cn("CollisionBuffers",$r);var Tr=function(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(y){return y.id}),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ma([]),this.placementViewportMatrix=Ma([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ia(this.zoom,o["text-size"]),this.iconSizeData=Ia(this.zoom,o["icon-size"]);var s=this.layers[0].layout,p=s.get("symbol-sort-key"),_=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(y){return Mn[y]})),this.stateDependentLayerIds=this.layers.filter(function(y){return y.isStateDependent()}).map(function(y){return y.id}),this.sourceID=n.sourceID};Tr.prototype.createArrays=function(){this.text=new vr(new On(this.layers,this.zoom,function(n){return/^text/.test(n)})),this.icon=new vr(new On(this.layers,this.zoom,function(n){return/^icon/.test(n)})),this.glyphOffsetArray=new T,this.lineVertexArray=new M,this.symbolInstances=new S},Tr.prototype.calculateGlyphDependencies=function(n,o,s,p,_){for(var y=0;y<n.length;y++)if(o[n.charCodeAt(y)]=!0,(s||p)&&_){var b=Ne[n.charAt(y)];b&&(o[b.charCodeAt(0)]=!0)}},Tr.prototype.populate=function(n,o,s){var p=this.layers[0],_=p.layout,y=_.get("text-font"),b=_.get("text-field"),C=_.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof ro&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,z=_.get("symbol-sort-key");if(this.features=[],I||D){for(var H=o.iconDependencies,J=o.glyphDependencies,re=o.availableImages,Te=new qn(this.zoom),Re=0,qe=n;Re<qe.length;Re+=1){var je=qe[Re],ft=je.feature,gt=je.id,zt=je.index,Ot=je.sourceLayerIndex,rr=p._featureFilter.needGeometry,Rr=Lo(ft,rr);if(p._featureFilter.filter(Te,Rr,s)){rr||(Rr.geometry=Ao(ft));var Zr=void 0;if(I){var xn=p.getValueAndResolveTokens("text-field",Rr,s,re),nn=ro.factory(xn);Jt(nn)&&(this.hasRTLText=!0),(!this.hasRTLText||Hf()==="unavailable"||this.hasRTLText&&Ks.isParsed())&&(Zr=pe(nn,p,Rr))}var In=void 0;if(D){var rn=p.getValueAndResolveTokens("icon-image",Rr,s,re);In=rn instanceof po?rn:po.fromString(rn)}if(Zr||In){var ci=this.sortFeaturesByKey?z.evaluate(Rr,{},s):void 0;if(this.features.push({id:gt,text:Zr,icon:In,index:zt,sourceLayerIndex:Ot,geometry:Rr.geometry,properties:ft.properties,type:$e[ft.type],sortKey:ci}),In&&(H[In.name]=!0),Zr){var Vn=y.evaluate(Rr,{},s).join(","),hn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Mn.vertical)>=0;for(var pi=0,ni=Zr.sections;pi<ni.length;pi+=1){var Ri=ni[pi];if(Ri.image)H[Ri.image.name]=!0;else{var Tn=ju(Zr.toString()),Ii=Ri.fontStack||Vn,Fi=J[Ii]=J[Ii]||{};this.calculateGlyphDependencies(Ri.text,Fi,hn,this.allowVerticalPlacement,Tn)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(Wo){var Uo={},eo={},ta=[],za=0;function Va(yo){ta.push(Wo[yo]),za++}function ps(yo,$o,$a){var Pi=eo[yo];return delete eo[yo],eo[$o]=Pi,ta[Pi].geometry[0].pop(),ta[Pi].geometry[0]=ta[Pi].geometry[0].concat($a[0]),Pi}function Za(yo,$o,$a){var Pi=Uo[$o];return delete Uo[$o],Uo[yo]=Pi,ta[Pi].geometry[0].shift(),ta[Pi].geometry[0]=$a[0].concat(ta[Pi].geometry[0]),Pi}function ja(yo,$o,$a){var Pi=$a?$o[0][$o[0].length-1]:$o[0][0];return yo+":"+Pi.x+":"+Pi.y}for(var fa=0;fa<Wo.length;fa++){var Ka=Wo[fa],Si=Ka.geometry,uo=Ka.text?Ka.text.toString():null;if(uo){var io=ja(uo,Si),Ui=ja(uo,Si,!0);if(io in eo&&Ui in Uo&&eo[io]!==Uo[Ui]){var Hs=Za(io,Ui,Si),ha=ps(io,Ui,ta[Hs].geometry);delete Uo[io],delete eo[Ui],eo[ja(uo,ta[ha].geometry,!0)]=ha,ta[Hs].geometry=null}else io in eo?ps(io,Ui,Si):Ui in Uo?Za(io,Ui,Si):(Va(fa),Uo[io]=za-1,eo[Ui]=za-1)}else Va(fa)}return ta.filter(function(yo){return yo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Wo,Uo){return Wo.sortKey-Uo.sortKey})}},Tr.prototype.update=function(n,o,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,s),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,s))},Tr.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Tr.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Tr.prototype.upload=function(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Tr.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Tr.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Tr.prototype.addToLineVertexArray=function(n,o){var s=this.lineVertexArray.length;if(n.segment!==void 0){for(var p=n.dist(o[n.segment+1]),_=n.dist(o[n.segment]),y={},b=n.segment+1;b<o.length;b++)y[b]={x:o[b].x,y:o[b].y,tileUnitDistanceFromAnchor:p},b<o.length-1&&(p+=o[b+1].dist(o[b]));for(var C=n.segment||0;C>=0;C--)y[C]={x:o[C].x,y:o[C].y,tileUnitDistanceFromAnchor:_},C>0&&(_+=o[C-1].dist(o[C]));for(var I=0;I<o.length;I++){var D=y[I];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},Tr.prototype.addSymbols=function(n,o,s,p,_,y,b,C,I,D,z,H){for(var J=n.indexArray,re=n.layoutVertexArray,Te=n.segments.prepareSegment(4*o.length,re,J,this.canOverlap?y.sortKey:void 0),Re=this.glyphOffsetArray.length,qe=Te.vertexLength,je=this.allowVerticalPlacement&&b===Mn.vertical?Math.PI/2:0,ft=y.text&&y.text.sections,gt=0;gt<o.length;gt++){var zt=o[gt],Ot=zt.tl,rr=zt.tr,Rr=zt.bl,Zr=zt.br,xn=zt.tex,nn=zt.pixelOffsetTL,In=zt.pixelOffsetBR,rn=zt.minFontScaleX,ci=zt.minFontScaleY,Vn=zt.glyphOffset,hn=zt.isSDF,pi=zt.sectionIndex,ni=Te.vertexLength,Ri=Vn[1];Nt(re,C.x,C.y,Ot.x,Ri+Ot.y,xn.x,xn.y,s,hn,nn.x,nn.y,rn,ci),Nt(re,C.x,C.y,rr.x,Ri+rr.y,xn.x+xn.w,xn.y,s,hn,In.x,nn.y,rn,ci),Nt(re,C.x,C.y,Rr.x,Ri+Rr.y,xn.x,xn.y+xn.h,s,hn,nn.x,In.y,rn,ci),Nt(re,C.x,C.y,Zr.x,Ri+Zr.y,xn.x+xn.w,xn.y+xn.h,s,hn,In.x,In.y,rn,ci),ar(n.dynamicLayoutVertexArray,C,je),J.emplaceBack(ni,ni+1,ni+2),J.emplaceBack(ni+1,ni+2,ni+3),Te.vertexLength+=4,Te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vn[0]),gt!==o.length-1&&pi===o[gt+1].sectionIndex||n.programConfigurations.populatePaintArrays(re.length,y,y.index,{},H,ft&&ft[pi])}n.placedSymbolArray.emplaceBack(C.x,C.y,Re,this.glyphOffsetArray.length-Re,qe,I,D,C.segment,s?s[0]:0,s?s[1]:0,p[0],p[1],b,0,!1,0,z)},Tr.prototype._addCollisionDebugVertex=function(n,o,s,p,_,y){return o.emplaceBack(0,0),n.emplaceBack(s.x,s.y,p,_,Math.round(y.x),Math.round(y.y))},Tr.prototype.addCollisionDebugVertices=function(n,o,s,p,_,y,b){var C=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),I=C.vertexLength,D=_.layoutVertexArray,z=_.collisionVertexArray,H=b.anchorX,J=b.anchorY;this._addCollisionDebugVertex(D,z,y,H,J,new W(n,o)),this._addCollisionDebugVertex(D,z,y,H,J,new W(s,o)),this._addCollisionDebugVertex(D,z,y,H,J,new W(s,p)),this._addCollisionDebugVertex(D,z,y,H,J,new W(n,p)),C.vertexLength+=4;var re=_.indexArray;re.emplaceBack(I,I+1),re.emplaceBack(I+1,I+2),re.emplaceBack(I+2,I+3),re.emplaceBack(I+3,I),C.primitiveLength+=4},Tr.prototype.addDebugCollisionBoxes=function(n,o,s,p){for(var _=n;_<o;_++){var y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,p?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,s)}},Tr.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $r(fl,ld.members,Vc),this.iconCollisionBox=new $r(fl,ld.members,Vc);for(var n=0;n<this.symbolInstances.length;n++){var o=this.symbolInstances.get(n);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Tr.prototype._deserializeCollisionBoxesForSymbol=function(n,o,s,p,_,y,b,C,I){for(var D={},z=o;z<s;z++){var H=n.get(z);D.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},D.textFeatureIndex=H.featureIndex;break}for(var J=p;J<_;J++){var re=n.get(J);D.verticalTextBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},D.verticalTextFeatureIndex=re.featureIndex;break}for(var Te=y;Te<b;Te++){var Re=n.get(Te);D.iconBox={x1:Re.x1,y1:Re.y1,x2:Re.x2,y2:Re.y2,anchorPointX:Re.anchorPointX,anchorPointY:Re.anchorPointY},D.iconFeatureIndex=Re.featureIndex;break}for(var qe=C;qe<I;qe++){var je=n.get(qe);D.verticalIconBox={x1:je.x1,y1:je.y1,x2:je.x2,y2:je.y2,anchorPointX:je.anchorPointX,anchorPointY:je.anchorPointY},D.verticalIconFeatureIndex=je.featureIndex;break}return D},Tr.prototype.deserializeCollisionBoxes=function(n){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var s=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},Tr.prototype.hasTextData=function(){return this.text.segments.get().length>0},Tr.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Tr.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Tr.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Tr.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Tr.prototype.addIndicesForPlacedSymbol=function(n,o){for(var s=n.placedSymbolArray.get(o),p=s.vertexStartIndex+4*s.numGlyphs,_=s.vertexStartIndex;_<p;_+=4)n.indexArray.emplaceBack(_,_+1,_+2),n.indexArray.emplaceBack(_+1,_+2,_+3)},Tr.prototype.getSortedSymbolIndexes=function(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(n),s=Math.cos(n),p=[],_=[],y=[],b=0;b<this.symbolInstances.length;++b){y.push(b);var C=this.symbolInstances.get(b);p.push(0|Math.round(o*C.anchorX+s*C.anchorY)),_.push(C.featureIndex)}return y.sort(function(I,D){return p[I]-p[D]||_[D]-_[I]}),y},Tr.prototype.addToSortKeyRanges=function(n,o){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===o?s.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})},Tr.prototype.sortFeatures=function(n){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,p=this.symbolInstanceIndexes;s<p.length;s+=1){var _=this.symbolInstances.get(p[s]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(y,b,C){y>=0&&C.indexOf(y)===b&&o.addIndicesForPlacedSymbol(o.text,y)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},cn("SymbolBucket",Tr,{omit:["layers","collisionBoxArray","features","compareText"]}),Tr.MAX_GLYPHS=65535,Tr.addDynamicAttributes=ar;var ln=new Ro({"symbol-placement":new Sn(ee.layout_symbol["symbol-placement"]),"symbol-spacing":new Sn(ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Sn(ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new fn(ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Sn(ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Sn(ee.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Sn(ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new Sn(ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Sn(ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new fn(ee.layout_symbol["icon-size"]),"icon-text-fit":new Sn(ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Sn(ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new fn(ee.layout_symbol["icon-image"]),"icon-rotate":new fn(ee.layout_symbol["icon-rotate"]),"icon-padding":new Sn(ee.layout_symbol["icon-padding"]),"icon-keep-upright":new Sn(ee.layout_symbol["icon-keep-upright"]),"icon-offset":new fn(ee.layout_symbol["icon-offset"]),"icon-anchor":new fn(ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Sn(ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Sn(ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Sn(ee.layout_symbol["text-rotation-alignment"]),"text-field":new fn(ee.layout_symbol["text-field"]),"text-font":new fn(ee.layout_symbol["text-font"]),"text-size":new fn(ee.layout_symbol["text-size"]),"text-max-width":new fn(ee.layout_symbol["text-max-width"]),"text-line-height":new Sn(ee.layout_symbol["text-line-height"]),"text-letter-spacing":new fn(ee.layout_symbol["text-letter-spacing"]),"text-justify":new fn(ee.layout_symbol["text-justify"]),"text-radial-offset":new fn(ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Sn(ee.layout_symbol["text-variable-anchor"]),"text-anchor":new fn(ee.layout_symbol["text-anchor"]),"text-max-angle":new Sn(ee.layout_symbol["text-max-angle"]),"text-writing-mode":new Sn(ee.layout_symbol["text-writing-mode"]),"text-rotate":new fn(ee.layout_symbol["text-rotate"]),"text-padding":new Sn(ee.layout_symbol["text-padding"]),"text-keep-upright":new Sn(ee.layout_symbol["text-keep-upright"]),"text-transform":new fn(ee.layout_symbol["text-transform"]),"text-offset":new fn(ee.layout_symbol["text-offset"]),"text-allow-overlap":new Sn(ee.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Sn(ee.layout_symbol["text-ignore-placement"]),"text-optional":new Sn(ee.layout_symbol["text-optional"])}),Kt={paint:new Ro({"icon-opacity":new fn(ee.paint_symbol["icon-opacity"]),"icon-color":new fn(ee.paint_symbol["icon-color"]),"icon-halo-color":new fn(ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new fn(ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new fn(ee.paint_symbol["icon-halo-blur"]),"icon-translate":new Sn(ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new Sn(ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new fn(ee.paint_symbol["text-opacity"]),"text-color":new fn(ee.paint_symbol["text-color"],{runtimeType:Ir,getOverride:function(n){return n.textColor},hasOverride:function(n){return!!n.textColor}}),"text-halo-color":new fn(ee.paint_symbol["text-halo-color"]),"text-halo-width":new fn(ee.paint_symbol["text-halo-width"]),"text-halo-blur":new fn(ee.paint_symbol["text-halo-blur"]),"text-translate":new Sn(ee.paint_symbol["text-translate"]),"text-translate-anchor":new Sn(ee.paint_symbol["text-translate-anchor"])}),layout:ln},Gn=function(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Nr,this.defaultValue=n};Gn.prototype.evaluate=function(n){if(n.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default},Gn.prototype.eachChild=function(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)},Gn.prototype.outputDefined=function(){return!1},Gn.prototype.serialize=function(){return null},cn("FormatSectionOverride",Gn,{omit:["defaultValue"]});var Wi=function(n){function o(s){n.call(this,s,Kt)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.recalculate=function(s,p){if(n.prototype.recalculate.call(this,s,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var y=[],b=0,C=_;b<C.length;b+=1){var I=C[b];y.indexOf(I)<0&&y.push(I)}this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(s,p,_,y){var b=this.layout.get(s).evaluate(p,{},_,y),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||Es(C.value)||!b?b:function(I,D){return D.replace(/{([^{}]+)}/g,function(z,H){return H in I?String(I[H]):""})}(p.properties,b)},o.prototype.createBucket=function(s){return new Tr(s)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var s=0,p=Kt.paint.overridableProperties;s<p.length;s+=1){var _=p[s];if(o.hasPaintOverride(this.layout,_)){var y,b=this.paint.get(_),C=new Gn(b),I=new Ta(C,b.property.specification);y=b.value.kind==="constant"||b.value.kind==="source"?new il("source",I):new wl("composite",I,b.value.zoomStops,b.value._interpolationType),this.paint._values[_]=new Ga(b.property,y,b.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(s,p,_){return!(!this.layout||p.isDataDriven()||_.isDataDriven())&&o.hasPaintOverride(this.layout,s)},o.hasPaintOverride=function(s,p){var _=s.get("text-field"),y=Kt.paint.properties[p],b=!1,C=function(z){for(var H=0,J=z;H<J.length;H+=1)if(y.overrides&&y.overrides.hasOverride(J[H]))return void(b=!0)};if(_.value.kind==="constant"&&_.value.value instanceof ro)C(_.value.value.sections);else if(_.value.kind==="source"){var I=function(z){b||(z instanceof ao&&Yi(z.value)===Di?C(z.value.sections):z instanceof Wa?C(z.sections):z.eachChild(I))},D=_.value;D._styleExpression&&I(D._styleExpression.expression)}return b},o}(Qs),ya={paint:new Ro({"background-color":new Sn(ee.paint_background["background-color"]),"background-pattern":new Xa(ee.paint_background["background-pattern"]),"background-opacity":new Sn(ee.paint_background["background-opacity"])})},Rs=function(n){function o(s){n.call(this,s,ya)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Qs),bp={paint:new Ro({"raster-opacity":new Sn(ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new Sn(ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Sn(ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Sn(ee.paint_raster["raster-brightness-max"]),"raster-saturation":new Sn(ee.paint_raster["raster-saturation"]),"raster-contrast":new Sn(ee.paint_raster["raster-contrast"]),"raster-resampling":new Sn(ee.paint_raster["raster-resampling"]),"raster-fade-duration":new Sn(ee.paint_raster["raster-fade-duration"])})},Ms=function(n){function o(s){n.call(this,s,bp)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Qs),cd=function(n){function o(s){n.call(this,s,{}),this.implementation=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},o.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},o}(Qs),zl={circle:cc,heatmap:fc,hillshade:Qd,fill:pp,"fill-extrusion":nd,line:yp,symbol:Wi,background:Rs,raster:Ms},Mh=G.HTMLImageElement,um=G.HTMLCanvasElement,cv=G.HTMLVideoElement,fv=G.ImageData,fd=G.ImageBitmap,Qf=function(n,o,s,p){this.context=n,this.format=s,this.texture=n.gl.createTexture(),this.update(o,p)};Qf.prototype.update=function(n,o,s){var p=n.width,_=n.height,y=!(this.size&&this.size[0]===p&&this.size[1]===_||s),b=this.context,C=b.gl;if(this.useMipmap=!!(o&&o.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!o||o.premultiply!==!1)),y)this.size=[p,_],n instanceof Mh||n instanceof um||n instanceof cv||n instanceof fv||fd&&n instanceof fd?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,n):C.texImage2D(C.TEXTURE_2D,0,this.format,p,_,0,this.format,C.UNSIGNED_BYTE,n.data);else{var I=s||{x:0,y:0},D=I.x,z=I.y;n instanceof Mh||n instanceof um||n instanceof cv||n instanceof fv||fd&&n instanceof fd?C.texSubImage2D(C.TEXTURE_2D,0,D,z,C.RGBA,C.UNSIGNED_BYTE,n):C.texSubImage2D(C.TEXTURE_2D,0,D,z,p,_,C.RGBA,C.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)},Qf.prototype.bind=function(n,o,s){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),s!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=p.LINEAR),n!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,s||n),this.filter=n),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},Qf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Qf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var lm=function(n){var o=this;this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};lm.prototype.trigger=function(){var n=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){n._triggered=!1,n._callback()},0))},lm.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ih=function(n,o,s){this.target=n,this.parent=o,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},yn(["receive","process"],this),this.invoker=new lm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=K()?n:G};function hv(n,o,s){var p=2*Math.PI*6378137/256/Math.pow(2,s);return[n*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}Ih.prototype.send=function(n,o,s,p,_){var y=this;_===void 0&&(_=!1);var b=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[b]=s);var C=ve(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:n,hasCallback:!!s,targetMapId:p,mustQueue:_,sourceMapId:this.mapId,data:ss(o,C)},C),{cancel:function(){s&&delete y.callbacks[b],y.target.postMessage({id:b,type:"<cancel>",targetMapId:p,sourceMapId:y.mapId})}}},Ih.prototype.receive=function(n){var o=n.data,s=o.id;if(s&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[s];var p=this.cancelCallbacks[s];delete this.cancelCallbacks[s],p&&p()}else K()||o.mustQueue?(this.tasks[s]=o,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,o)},Ih.prototype.process=function(){if(this.taskQueue.length){var n=this.taskQueue.shift(),o=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(n,o)}},Ih.prototype.processTask=function(n,o){var s=this;if(o.type==="<response>"){var p=this.callbacks[n];delete this.callbacks[n],p&&(o.error?p(Ki(o.error)):p(null,Ki(o.data)))}else{var _=!1,y=ve(this.globalScope)?void 0:[],b=o.hasCallback?function(z,H){_=!0,delete s.cancelCallbacks[n],s.target.postMessage({id:n,type:"<response>",sourceMapId:s.mapId,error:z?ss(z):null,data:ss(H,y)},y)}:function(z){_=!0},C=null,I=Ki(o.data);if(this.parent[o.type])C=this.parent[o.type](o.sourceMapId,I,b);else if(this.parent.getWorkerSource){var D=o.type.split(".");C=this.parent.getWorkerSource(o.sourceMapId,D[0],I.source)[D[1]](I,b)}else b(new Error("Could not find function "+o.type));!_&&C&&C.cancel&&(this.cancelCallbacks[n]=C.cancel)}},Ih.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var xa=function(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))};xa.prototype.setNorthEast=function(n){return this._ne=n instanceof ko?new ko(n.lng,n.lat):ko.convert(n),this},xa.prototype.setSouthWest=function(n){return this._sw=n instanceof ko?new ko(n.lng,n.lat):ko.convert(n),this},xa.prototype.extend=function(n){var o,s,p=this._sw,_=this._ne;if(n instanceof ko)o=n,s=n;else{if(!(n instanceof xa))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(xa.convert(n)):this.extend(ko.convert(n)):this;if(s=n._ne,!(o=n._sw)||!s)return this}return p||_?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),_.lng=Math.max(s.lng,_.lng),_.lat=Math.max(s.lat,_.lat)):(this._sw=new ko(o.lng,o.lat),this._ne=new ko(s.lng,s.lat)),this},xa.prototype.getCenter=function(){return new ko((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},xa.prototype.getSouthWest=function(){return this._sw},xa.prototype.getNorthEast=function(){return this._ne},xa.prototype.getNorthWest=function(){return new ko(this.getWest(),this.getNorth())},xa.prototype.getSouthEast=function(){return new ko(this.getEast(),this.getSouth())},xa.prototype.getWest=function(){return this._sw.lng},xa.prototype.getSouth=function(){return this._sw.lat},xa.prototype.getEast=function(){return this._ne.lng},xa.prototype.getNorth=function(){return this._ne.lat},xa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},xa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},xa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},xa.prototype.contains=function(n){var o=ko.convert(n),s=o.lng,p=o.lat,_=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&_},xa.convert=function(n){return!n||n instanceof xa?n:new xa(n)};var ko=function(n,o){if(isNaN(n)||isNaN(o))throw new Error("Invalid LngLat object: ("+n+", "+o+")");if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ko.prototype.wrap=function(){return new ko(ae(this.lng,-180,180),this.lat)},ko.prototype.toArray=function(){return[this.lng,this.lat]},ko.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ko.prototype.distanceTo=function(n){var o=Math.PI/180,s=this.lat*o,p=n.lat*o,_=Math.sin(s)*Math.sin(p)+Math.cos(s)*Math.cos(p)*Math.cos((n.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(_,1))},ko.prototype.toBounds=function(n){n===void 0&&(n=0);var o=360*n/40075017,s=o/Math.cos(Math.PI/180*this.lat);return new xa(new ko(this.lng-s,this.lat-o),new ko(this.lng+s,this.lat+o))},ko.convert=function(n){if(n instanceof ko)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new ko(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new ko(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var cm=2*Math.PI*63710088e-1;function pv(n){return cm*Math.cos(n*Math.PI/180)}function W0(n){return(180+n)/360}function dv(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function fm(n,o){return n/pv(o)}function hd(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}var Jf=function(n,o,s){s===void 0&&(s=0),this.x=+n,this.y=+o,this.z=+s};Jf.fromLngLat=function(n,o){o===void 0&&(o=0);var s=ko.convert(n);return new Jf(W0(s.lng),dv(s.lat),fm(o,s.lat))},Jf.prototype.toLngLat=function(){return new ko(360*this.x-180,hd(this.y))},Jf.prototype.toAltitude=function(){return this.z*pv(hd(this.y))},Jf.prototype.meterInMercatorCoordinateUnits=function(){return 1/cm*(n=hd(this.y),1/Math.cos(n*Math.PI/180));var n};var Yt=function(n,o,s){this.z=n,this.x=o,this.y=s,this.key=qc(0,n,n,o,s)};Yt.prototype.equals=function(n){return this.z===n.z&&this.x===n.x&&this.y===n.y},Yt.prototype.url=function(n,o){var s,p,_,y,b,C=(p=this.y,_=this.z,y=hv(256*(s=this.x),256*(p=Math.pow(2,_)-p-1),_),b=hv(256*(s+1),256*(p+1),_),y[0]+","+y[1]+","+b[0]+","+b[1]),I=function(D,z,H){for(var J,re="",Te=D;Te>0;Te--)re+=(z&(J=1<<Te-1)?1:0)+(H&J?2:0);return re}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",I).replace("{bbox-epsg-3857}",C)},Yt.prototype.getTilePoint=function(n){var o=Math.pow(2,this.z);return new W(8192*(n.x*o-this.x),8192*(n.y*o-this.y))},Yt.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var mv=function(n,o){this.wrap=n,this.canonical=o,this.key=qc(n,o.z,o.z,o.x,o.y)},Ea=function(n,o,s,p,_){this.overscaledZ=n,this.wrap=o,this.canonical=new Yt(s,+p,+_),this.key=qc(o,n,s,p,_)};function qc(n,o,s,p,_){(n*=2)<0&&(n=-1*n-1);var y=1<<s;return(y*y*n+y*_+p).toString(36)+s.toString(36)+o.toString(36)}Ea.prototype.equals=function(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)},Ea.prototype.scaledTo=function(n){var o=this.canonical.z-n;return n>this.canonical.z?new Ea(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ea(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)},Ea.prototype.calculateScaledKey=function(n,o){var s=this.canonical.z-n;return n>this.canonical.z?qc(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y):qc(this.wrap*+o,n,n,this.canonical.x>>s,this.canonical.y>>s)},Ea.prototype.isChildOf=function(n){if(n.wrap!==this.wrap)return!1;var o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o},Ea.prototype.children=function(n){if(this.overscaledZ>=n)return[new Ea(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,s=2*this.canonical.x,p=2*this.canonical.y;return[new Ea(o,this.wrap,o,s,p),new Ea(o,this.wrap,o,s+1,p),new Ea(o,this.wrap,o,s,p+1),new Ea(o,this.wrap,o,s+1,p+1)]},Ea.prototype.isLessThan=function(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))},Ea.prototype.wrapped=function(){return new Ea(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ea.prototype.unwrapTo=function(n){return new Ea(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)},Ea.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ea.prototype.toUnwrapped=function(){return new mv(this.wrap,this.canonical)},Ea.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ea.prototype.getTilePoint=function(n){return this.canonical.getTilePoint(new Jf(n.x-this.wrap,n.y))},cn("CanonicalTileID",Yt),cn("OverscaledTileID",Ea,{omit:["posMatrix"]});var Kc=function(n,o,s){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return ct('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=s||"mapbox";for(var _=0;_<p;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(p,_)]=this.data[this._idx(p-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,p)]=this.data[this._idx(_,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Kc.prototype.get=function(n,o){var s=new Uint8Array(this.data.buffer),p=4*this._idx(n,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[p],s[p+1],s[p+2])},Kc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Kc.prototype._idx=function(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)},Kc.prototype._unpackMapbox=function(n,o,s){return(256*n*256+256*o+s)/10-1e4},Kc.prototype._unpackTerrarium=function(n,o,s){return 256*n+o+s/256-32768},Kc.prototype.getPixels=function(){return new cs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Kc.prototype.backfillBorder=function(n,o,s){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,_=o*this.dim+this.dim,y=s*this.dim,b=s*this.dim+this.dim;switch(o){case-1:p=_-1;break;case 1:_=p+1}switch(s){case-1:y=b-1;break;case 1:b=y+1}for(var C=-o*this.dim,I=-s*this.dim,D=y;D<b;D++)for(var z=p;z<_;z++)this.data[this._idx(z,D)]=n.data[this._idx(z+C,D+I)]},cn("DEMData",Kc);var no=function(n){this._stringToNumber={},this._numberToString=[];for(var o=0;o<n.length;o++){var s=n[o];this._stringToNumber[s]=o,this._numberToString[o]=s}};no.prototype.encode=function(n){return this._stringToNumber[n]},no.prototype.decode=function(n){return this._numberToString[n]};var pd=function(n,o,s,p,_){this.type="Feature",this._vectorTileFeature=n,n._z=o,n._x=s,n._y=p,this.properties=n.properties,this.id=_},hm={geometry:{configurable:!0}};hm.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},hm.geometry.set=function(n){this._geometry=n},pd.prototype.toJSON=function(){var n={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(n[o]=this[o]);return n},Object.defineProperties(pd.prototype,hm);var Ph=function(){this.state={},this.stateChanges={},this.deletedStates={}};Ph.prototype.updateState=function(n,o,s){var p=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][p]=this.stateChanges[n][p]||{},At(this.stateChanges[n][p],s),this.deletedStates[n]===null)for(var _ in this.deletedStates[n]={},this.state[n])_!==p&&(this.deletedStates[n][_]=null);else if(this.deletedStates[n]&&this.deletedStates[n][p]===null)for(var y in this.deletedStates[n][p]={},this.state[n][p])s[y]||(this.deletedStates[n][p][y]=null);else for(var b in s)this.deletedStates[n]&&this.deletedStates[n][p]&&this.deletedStates[n][p][b]===null&&delete this.deletedStates[n][p][b]},Ph.prototype.removeFeatureState=function(n,o,s){if(this.deletedStates[n]!==null){var p=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},s&&o!==void 0)this.deletedStates[n][p]!==null&&(this.deletedStates[n][p]=this.deletedStates[n][p]||{},this.deletedStates[n][p][s]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][p])for(s in this.deletedStates[n][p]={},this.stateChanges[n][p])this.deletedStates[n][p][s]=null;else this.deletedStates[n][p]=null;else this.deletedStates[n]=null}},Ph.prototype.getState=function(n,o){var s=String(o),p=At({},(this.state[n]||{})[s],(this.stateChanges[n]||{})[s]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){var _=this.deletedStates[n][o];if(_===null)return{};for(var y in _)delete p[y]}return p},Ph.prototype.initializeTileState=function(n,o){n.setFeatureState(this.state,o)},Ph.prototype.coalesceChanges=function(n,o){var s={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var _={};for(var y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),At(this.state[p][y],this.stateChanges[p][y]),_[y]=this.state[p][y];s[p]=_}for(var b in this.deletedStates){this.state[b]=this.state[b]||{};var C={};if(this.deletedStates[b]===null)for(var I in this.state[b])C[I]={},this.state[b][I]={};else for(var D in this.deletedStates[b]){if(this.deletedStates[b][D]===null)this.state[b][D]={};else for(var z=0,H=Object.keys(this.deletedStates[b][D]);z<H.length;z+=1)delete this.state[b][D][H[z]];C[D]=this.state[b][D]}s[b]=s[b]||{},At(s[b],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var J in n)n[J].setFeatureState(s,o)};var $c=function(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Ca(8192,16,0),this.grid3D=new Ca(8192,16,0),this.featureIndexArray=new X,this.promoteId=o};function vv(n,o,s,p,_){return $n(n,function(y,b){var C=o instanceof ic?o.get(b):null;return C&&C.evaluate?C.evaluate(s,p,_):C})}function G0(n){for(var o=1/0,s=1/0,p=-1/0,_=-1/0,y=0,b=n;y<b.length;y+=1){var C=b[y];o=Math.min(o,C.x),s=Math.min(s,C.y),p=Math.max(p,C.x),_=Math.max(_,C.y)}return{minX:o,minY:s,maxX:p,maxY:_}}function X0(n,o){return o-n}$c.prototype.insert=function(n,o,s,p,_,y){var b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,p,_);for(var C=y?this.grid3D:this.grid,I=0;I<o.length;I++){for(var D=o[I],z=[1/0,1/0,-1/0,-1/0],H=0;H<D.length;H++){var J=D[H];z[0]=Math.min(z[0],J.x),z[1]=Math.min(z[1],J.y),z[2]=Math.max(z[2],J.x),z[3]=Math.max(z[3],J.y)}z[0]<8192&&z[1]<8192&&z[2]>=0&&z[3]>=0&&C.insert(b,z[0],z[1],z[2],z[3])}},$c.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new _c.VectorTile(new Lt(this.rawTileData)).layers,this.sourceLayerCoder=new no(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},$c.prototype.query=function(n,o,s,p){var _=this;this.loadVTLayers();for(var y=n.params||{},b=8192/n.tileSize/n.scale,C=Rl(y.filter),I=n.queryGeometry,D=n.queryPadding*b,z=G0(I),H=this.grid.query(z.minX-D,z.minY-D,z.maxX+D,z.maxY+D),J=G0(n.cameraQueryGeometry),re=this.grid3D.query(J.minX-D,J.minY-D,J.maxX+D,J.maxY+D,function(zt,Ot,rr,Rr){return function(Zr,xn,nn,In,rn){for(var ci=0,Vn=Zr;ci<Vn.length;ci+=1){var hn=Vn[ci];if(xn<=hn.x&&nn<=hn.y&&In>=hn.x&&rn>=hn.y)return!0}var pi=[new W(xn,nn),new W(xn,rn),new W(In,rn),new W(In,nn)];if(Zr.length>2){for(var ni=0,Ri=pi;ni<Ri.length;ni+=1)if(cu(Zr,Ri[ni]))return!0}for(var Tn=0;Tn<Zr.length-1;Tn++)if(Yu(Zr[Tn],Zr[Tn+1],pi))return!0;return!1}(n.cameraQueryGeometry,zt-D,Ot-D,rr+D,Rr+D)}),Te=0,Re=re;Te<Re.length;Te+=1)H.push(Re[Te]);H.sort(X0);for(var qe,je={},ft=function(zt){var Ot=H[zt];if(Ot!==qe){qe=Ot;var rr=_.featureIndexArray.get(Ot),Rr=null;_.loadMatchingFeature(je,rr.bucketIndex,rr.sourceLayerIndex,rr.featureIndex,C,y.layers,y.availableImages,o,s,p,function(Zr,xn,nn){return Rr||(Rr=Ao(Zr)),xn.queryIntersectsFeature(I,Zr,nn,Rr,_.z,n.transform,b,n.pixelPosMatrix)})}},gt=0;gt<H.length;gt++)ft(gt);return je},$c.prototype.loadMatchingFeature=function(n,o,s,p,_,y,b,C,I,D,z){var H=this.bucketLayerIDs[o];if(!y||function(Zr,xn){for(var nn=0;nn<Zr.length;nn++)if(xn.indexOf(Zr[nn])>=0)return!0;return!1}(y,H)){var J=this.sourceLayerCoder.decode(s),re=this.vtLayers[J].feature(p);if(_.needGeometry){var Te=Lo(re,!0);if(!_.filter(new qn(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!_.filter(new qn(this.tileID.overscaledZ),re))return;for(var Re=this.getId(re,J),qe=0;qe<H.length;qe++){var je=H[qe];if(!(y&&y.indexOf(je)<0)){var ft=C[je];if(ft){var gt={};Re!==void 0&&D&&(gt=D.getState(ft.sourceLayer||"_geojsonTileLayer",Re));var zt=At({},I[je]);zt.paint=vv(zt.paint,ft.paint,re,gt,b),zt.layout=vv(zt.layout,ft.layout,re,gt,b);var Ot=!z||z(re,ft,gt);if(Ot){var rr=new pd(re,this.z,this.x,this.y,Re);rr.layer=zt;var Rr=n[je];Rr===void 0&&(Rr=n[je]=[]),Rr.push({featureIndex:p,feature:rr,intersectionZ:Ot})}}}}}},$c.prototype.lookupSymbolFeatures=function(n,o,s,p,_,y,b,C){var I={};this.loadVTLayers();for(var D=Rl(_),z=0,H=n;z<H.length;z+=1)this.loadMatchingFeature(I,s,p,H[z],D,y,b,C,o);return I},$c.prototype.hasLayer=function(n){for(var o=0,s=this.bucketLayerIDs;o<s.length;o+=1)for(var p=0,_=s[o];p<_.length;p+=1)if(n===_[p])return!0;return!1},$c.prototype.getId=function(n,o){var s=n.id;return this.promoteId&&typeof(s=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(s=Number(s)),s},cn("FeatureIndex",$c,{omit:["rawTileData","sourceLayerCoder"]});var qa=function(n,o){this.tileID=n,this.uid=et(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};qa.prototype.registerFadeDuration=function(n){var o=n+this.timeAdded;o<gn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},qa.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},qa.prototype.loadVectorData=function(n,o,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){for(var p in n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(D,z){var H={};if(!z)return H;for(var J=function(){var Re=Te[re],qe=Re.layerIds.map(function(gt){return z.getLayer(gt)}).filter(Boolean);if(qe.length!==0){Re.layers=qe,Re.stateDependentLayerIds&&(Re.stateDependentLayers=Re.stateDependentLayerIds.map(function(gt){return qe.filter(function(zt){return zt.id===gt})[0]}));for(var je=0,ft=qe;je<ft.length;je+=1)H[ft[je].id]=Re}},re=0,Te=D;re<Te.length;re+=1)J();return H}(n.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[p];if(_ instanceof Tr){if(this.hasSymbolBuckets=!0,!s)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var y in this.buckets){var b=this.buckets[y];if(b instanceof Tr&&b.hasRTLText){this.hasRTLText=!0,Ks.isLoading()||Ks.isLoaded()||Hf()!=="deferred"||Ss();break}}for(var C in this.queryPadding=0,this.buckets){var I=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(C).queryRadius(I))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new f},qa.prototype.unloadVectorData=function(){for(var n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},qa.prototype.getBucket=function(n){return this.buckets[n.id]},qa.prototype.upload=function(n){for(var o in this.buckets){var s=this.buckets[o];s.uploadPending()&&s.upload(n)}var p=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Qf(n,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Qf(n,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},qa.prototype.prepare=function(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)},qa.prototype.queryRenderedFeatures=function(n,o,s,p,_,y,b,C,I,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:_,scale:y,tileSize:this.tileSize,pixelPosMatrix:D,transform:C,params:b,queryPadding:this.queryPadding*I},n,o,s):{}},qa.prototype.querySourceFeatures=function(n,o){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var p=s.loadVTLayers(),_=o?o.sourceLayer:"",y=p._geojsonTileLayer||p[_];if(y)for(var b=Rl(o&&o.filter),C=this.tileID.canonical,I=C.z,D=C.x,z=C.y,H={z:I,x:D,y:z},J=0;J<y.length;J++){var re=y.feature(J);if(b.needGeometry){var Te=Lo(re,!0);if(!b.filter(new qn(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!b.filter(new qn(this.tileID.overscaledZ),re))continue;var Re=s.getId(re,_),qe=new pd(re,I,D,z,Re);qe.tile=H,n.push(qe)}}},qa.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},qa.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},qa.prototype.setExpiryData=function(n){var o=this.expirationTime;if(n.cacheControl){var s=_e(n.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){var p=Date.now(),_=!1;if(this.expirationTime>p)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{var y=this.expirationTime-o;y?this.expirationTime=p+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},qa.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},qa.prototype.setFeatureState=function(n,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var _=this.buckets[p],y=_.layers[0].sourceLayer||"_geojsonTileLayer",b=s[y],C=n[y];if(b&&C&&Object.keys(C).length!==0){_.update(C,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});var I=o&&o.style&&o.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}}},qa.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},qa.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<gn.now()},qa.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},qa.prototype.setHoldDuration=function(n){this.symbolFadeHoldUntil=gn.now()+n},qa.prototype.setDependencies=function(n,o){for(var s={},p=0,_=o;p<_.length;p+=1)s[_[p]]=!0;this.dependencies[n]=s},qa.prototype.hasDependency=function(n,o){for(var s=0,p=n;s<p.length;s+=1){var _=this.dependencies[p[s]];if(_){for(var y=0,b=o;y<b.length;y+=1)if(_[b[y]])return!0}}return!1};var bf=G.performance,_v=function(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},bf.mark(this._marks.start)};_v.prototype.finish=function(){bf.mark(this._marks.end);var n=bf.getEntriesByName(this._marks.measure);return n.length===0&&(bf.measure(this._marks.measure,this._marks.start,this._marks.end),n=bf.getEntriesByName(this._marks.measure),bf.clearMarks(this._marks.start),bf.clearMarks(this._marks.end),bf.clearMeasures(this._marks.measure)),n},v.Actor=Ih,v.AlphaImage=ws,v.CanonicalTileID=Yt,v.CollisionBoxArray=f,v.Color=ui,v.DEMData=Kc,v.DataConstantProperty=Sn,v.DictionaryCoder=no,v.EXTENT=8192,v.ErrorEvent=Ie,v.EvaluationParameters=qn,v.Event=de,v.Evented=Ze,v.FeatureIndex=$c,v.FillBucket=Iu,v.FillExtrusionBucket=ts,v.ImageAtlas=Qt,v.ImagePosition=Hr,v.LineBucket=fs,v.LngLat=ko,v.LngLatBounds=xa,v.MercatorCoordinate=Jf,v.ONE_EM=24,v.OverscaledTileID=Ea,v.Point=W,v.Point$1=W,v.Properties=Ro,v.Protobuf=Lt,v.RGBAImage=cs,v.RequestManager=Vr,v.RequestPerformance=_v,v.ResourceType=Q,v.SegmentVector=le,v.SourceFeatureState=Ph,v.StructArrayLayout1ui2=Zc,v.StructArrayLayout2f1f2i16=Dl,v.StructArrayLayout2i4=cl,v.StructArrayLayout3ui6=aa,v.StructArrayLayout4i8=vf,v.SymbolBucket=Tr,v.Texture=Qf,v.Tile=qa,v.Transitionable=ma,v.Uniform1f=Pr,v.Uniform1i=or,v.Uniform2f=wr,v.Uniform3f=en,v.Uniform4f=An,v.UniformColor=Cn,v.UniformMatrix4f=wi,v.UnwrappedTileID=mv,v.ValidationError=be,v.WritingMode=Mn,v.ZoomHistory=kc,v.add=function(n,o,s){return n[0]=o[0]+s[0],n[1]=o[1]+s[1],n[2]=o[2]+s[2],n},v.addDynamicAttributes=ar,v.asyncAll=function(n,o,s){if(!n.length)return s(null,[]);var p=n.length,_=new Array(n.length),y=null;n.forEach(function(b,C){o(b,function(I,D){I&&(y=I),_[C]=D,--p==0&&s(y,_)})})},v.bezier=De,v.bindAll=yn,v.browser=gn,v.cacheEntryPossiblyAdded=function(n){++pt>vu&&(n.getActor().send("enforceCacheSizeLimit",Xs),pt=0)},v.clamp=ht,v.clearTileCache=function(n){var o=G.caches.delete("mapbox-tiles");n&&o.catch(n).then(function(){return n()})},v.clipLine=_l,v.clone=function(n){var o=new yi(16);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},v.clone$1=ze,v.clone$2=function(n){var o=new yi(3);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o},v.collisionCircleLayout=B,v.config=Qr,v.create=function(){var n=new yi(16);return yi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},v.create$1=function(){var n=new yi(9);return yi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},v.create$2=function(){var n=new yi(4);return yi!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},v.createCommonjsModule=it,v.createExpression=Cl,v.createLayout=wa,v.createStyleLayer=function(n){return n.type==="custom"?new cd(n):new zl[n.type](n)},v.cross=function(n,o,s){var p=o[0],_=o[1],y=o[2],b=s[0],C=s[1],I=s[2];return n[0]=_*I-y*C,n[1]=y*b-p*I,n[2]=p*C-_*b,n},v.deepEqual=function n(o,s){if(Array.isArray(o)){if(!Array.isArray(s)||o.length!==s.length)return!1;for(var p=0;p<o.length;p++)if(!n(o[p],s[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&s!==null){if(typeof s!="object"||Object.keys(o).length!==Object.keys(s).length)return!1;for(var _ in o)if(!n(o[_],s[_]))return!1;return!0}return o===s},v.dot=function(n,o){return n[0]*o[0]+n[1]*o[1]+n[2]*o[2]},v.dot$1=function(n,o){return n[0]*o[0]+n[1]*o[1]+n[2]*o[2]+n[3]*o[3]},v.ease=ge,v.emitValidationErrors=Au,v.endsWith=bi,v.enforceCacheSizeLimit=function(n){Vo(),Xi&&Xi.then(function(o){o.keys().then(function(s){for(var p=0;p<s.length-n;p++)o.delete(s[p])})})},v.evaluateSizeForFeature=hs,v.evaluateSizeForZoom=ca,v.evaluateVariableOffset=tt,v.evented=jf,v.extend=At,v.featureFilter=Rl,v.filterObject=Mt,v.fromRotation=function(n,o){var s=Math.sin(o),p=Math.cos(o);return n[0]=p,n[1]=s,n[2]=0,n[3]=-s,n[4]=p,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},v.getAnchorAlignment=vo,v.getAnchorJustification=ot,v.getArrayBuffer=ur,v.getImage=O,v.getJSON=function(n,o){return Zt(At(n,{type:"json"}),o)},v.getRTLTextPluginStatus=Hf,v.getReferrer=Ve,v.getVideo=function(n,o){var s,p,_=G.document.createElement("video");_.muted=!0,_.onloadstart=function(){o(null,_)};for(var y=0;y<n.length;y++){var b=G.document.createElement("source");s=n[y],p=void 0,(p=G.document.createElement("a")).href=s,(p.protocol!==G.document.location.protocol||p.host!==G.document.location.host)&&(_.crossOrigin="Anonymous"),b.src=n[y],_.appendChild(b)}return{cancel:function(){}}},v.identity=Ma,v.invert=function(n,o){var s=o[0],p=o[1],_=o[2],y=o[3],b=o[4],C=o[5],I=o[6],D=o[7],z=o[8],H=o[9],J=o[10],re=o[11],Te=o[12],Re=o[13],qe=o[14],je=o[15],ft=s*C-p*b,gt=s*I-_*b,zt=s*D-y*b,Ot=p*I-_*C,rr=p*D-y*C,Rr=_*D-y*I,Zr=z*Re-H*Te,xn=z*qe-J*Te,nn=z*je-re*Te,In=H*qe-J*Re,rn=H*je-re*Re,ci=J*je-re*qe,Vn=ft*ci-gt*rn+zt*In+Ot*nn-rr*xn+Rr*Zr;return Vn?(n[0]=(C*ci-I*rn+D*In)*(Vn=1/Vn),n[1]=(_*rn-p*ci-y*In)*Vn,n[2]=(Re*Rr-qe*rr+je*Ot)*Vn,n[3]=(J*rr-H*Rr-re*Ot)*Vn,n[4]=(I*nn-b*ci-D*xn)*Vn,n[5]=(s*ci-_*nn+y*xn)*Vn,n[6]=(qe*zt-Te*Rr-je*gt)*Vn,n[7]=(z*Rr-J*zt+re*gt)*Vn,n[8]=(b*rn-C*nn+D*Zr)*Vn,n[9]=(p*nn-s*rn-y*Zr)*Vn,n[10]=(Te*rr-Re*zt+je*ft)*Vn,n[11]=(H*zt-z*rr-re*ft)*Vn,n[12]=(C*xn-b*In-I*Zr)*Vn,n[13]=(s*In-p*xn+_*Zr)*Vn,n[14]=(Re*gt-Te*Ot-qe*ft)*Vn,n[15]=(z*Ot-H*gt+J*ft)*Vn,n):null},v.isChar=Ur,v.isMapboxURL=Dn,v.keysDifference=function(n,o){var s=[];for(var p in n)p in o||s.push(p);return s},v.makeRequest=Zt,v.mapObject=$n,v.mercatorXfromLng=W0,v.mercatorYfromLat=dv,v.mercatorZfromAltitude=fm,v.mul=lc,v.multiply=Fo,v.mvt=_c,v.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},v.normalize=function(n,o){var s=o[0],p=o[1],_=o[2],y=s*s+p*p+_*_;return y>0&&(y=1/Math.sqrt(y)),n[0]=o[0]*y,n[1]=o[1]*y,n[2]=o[2]*y,n},v.number=Co,v.offscreenCanvasSupported=Z,v.ortho=function(n,o,s,p,_,y,b){var C=1/(o-s),I=1/(p-_),D=1/(y-b);return n[0]=-2*C,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*I,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*D,n[11]=0,n[12]=(o+s)*C,n[13]=(_+p)*I,n[14]=(b+y)*D,n[15]=1,n},v.parseGlyphPBF=function(n){return new Lt(n).readFields(fr,[])},v.pbf=Lt,v.performSymbolLayout=function(n,o,s,p,_,y,b){n.createArrays(),n.tilePixelRatio=8192/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;var C=n.layers[0].layout,I=n.layers[0]._unevaluatedLayout._values,D={};if(n.textSizeData.kind==="composite"){var z=n.textSizeData,H=z.maxZoom;D.compositeTextSizes=[I["text-size"].possiblyEvaluate(new qn(z.minZoom),b),I["text-size"].possiblyEvaluate(new qn(H),b)]}if(n.iconSizeData.kind==="composite"){var J=n.iconSizeData,re=J.maxZoom;D.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new qn(J.minZoom),b),I["icon-size"].possiblyEvaluate(new qn(re),b)]}D.layoutTextSize=I["text-size"].possiblyEvaluate(new qn(n.zoom+1),b),D.layoutIconSize=I["icon-size"].possiblyEvaluate(new qn(n.zoom+1),b),D.textMaxSize=I["text-size"].possiblyEvaluate(new qn(18));for(var Te=24*C.get("text-line-height"),Re=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",qe=C.get("text-keep-upright"),je=C.get("text-size"),ft=function(){var Ot=zt[gt],rr=C.get("text-font").evaluate(Ot,{},b).join(","),Rr=je.evaluate(Ot,{},b),Zr=D.layoutTextSize.evaluate(Ot,{},b),xn=D.layoutIconSize.evaluate(Ot,{},b),nn={horizontal:{},vertical:void 0},In=Ot.text,rn=[0,0];if(In){var ci=In.toString(),Vn=24*C.get("text-letter-spacing").evaluate(Ot,{},b),hn=function(Si){for(var uo=0,io=Si;uo<io.length;uo+=1)if(Ui=io[uo].charCodeAt(0),Ur.Arabic(Ui)||Ur["Arabic Supplement"](Ui)||Ur["Arabic Extended-A"](Ui)||Ur["Arabic Presentation Forms-A"](Ui)||Ur["Arabic Presentation Forms-B"](Ui))return!1;var Ui;return!0}(ci)?Vn:0,pi=C.get("text-anchor").evaluate(Ot,{},b),ni=C.get("text-variable-anchor");if(!ni){var Ri=C.get("text-radial-offset").evaluate(Ot,{},b);rn=Ri?tt(pi,[24*Ri,Ge]):C.get("text-offset").evaluate(Ot,{},b).map(function(Si){return 24*Si})}var Tn=Re?"center":C.get("text-justify").evaluate(Ot,{},b),Ii=C.get("symbol-placement"),Fi=Ii==="point"?24*C.get("text-max-width").evaluate(Ot,{},b):0,Wo=function(){n.allowVerticalPlacement&&ju(ci)&&(nn.vertical=ti(In,o,s,_,rr,Fi,Te,pi,"left",hn,rn,Mn.vertical,!0,Ii,Zr,Rr))};if(!Re&&ni){for(var Uo=Tn==="auto"?ni.map(function(Si){return ot(Si)}):[Tn],eo=!1,ta=0;ta<Uo.length;ta++){var za=Uo[ta];if(!nn.horizontal[za])if(eo)nn.horizontal[za]=nn.horizontal[0];else{var Va=ti(In,o,s,_,rr,Fi,Te,"center",za,hn,rn,Mn.horizontal,!1,Ii,Zr,Rr);Va&&(nn.horizontal[za]=Va,eo=Va.positionedLines.length===1)}}Wo()}else{Tn==="auto"&&(Tn=ot(pi));var ps=ti(In,o,s,_,rr,Fi,Te,pi,Tn,hn,rn,Mn.horizontal,!1,Ii,Zr,Rr);ps&&(nn.horizontal[Tn]=ps),Wo(),ju(ci)&&Re&&qe&&(nn.vertical=ti(In,o,s,_,rr,Fi,Te,pi,Tn,hn,rn,Mn.vertical,!1,Ii,Zr,Rr))}}var Za=void 0,ja=!1;if(Ot.icon&&Ot.icon.name){var fa=p[Ot.icon.name];fa&&(Za=function(Si,uo,io){var Ui=vo(io),Hs=uo[0]-Si.displaySize[0]*Ui.horizontalAlign,ha=uo[1]-Si.displaySize[1]*Ui.verticalAlign;return{image:Si,top:ha,bottom:ha+Si.displaySize[1],left:Hs,right:Hs+Si.displaySize[0]}}(_[Ot.icon.name],C.get("icon-offset").evaluate(Ot,{},b),C.get("icon-anchor").evaluate(Ot,{},b)),ja=fa.sdf,n.sdfIcons===void 0?n.sdfIcons=fa.sdf:n.sdfIcons!==fa.sdf&&ct("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fa.pixelRatio!==n.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}var Ka=Ye(nn.horizontal)||nn.vertical;n.iconsInText=!!Ka&&Ka.iconsInText,(Ka||Za)&&function(Si,uo,io,Ui,Hs,ha,yo,$o,$a,Pi,gl){var nu=ha.textMaxSize.evaluate(uo,{});nu===void 0&&(nu=yo);var Pu,Qo=Si.layers[0].layout,Ou=Qo.get("icon-offset").evaluate(uo,{},gl),hu=Ye(io.horizontal),pu=yo/24,Qc=Si.tilePixelRatio*pu,Sf=Si.tilePixelRatio*nu/24,Jc=Si.tilePixelRatio*$o,Sp=Si.tilePixelRatio*Qo.get("symbol-spacing"),Oh=Qo.get("text-padding")*Si.tilePixelRatio,eh=Qo.get("icon-padding")*Si.tilePixelRatio,dd=Qo.get("text-max-angle")/180*Math.PI,Ap=Qo.get("text-rotation-alignment")==="map"&&Qo.get("symbol-placement")!=="point",md=Qo.get("icon-rotation-alignment")==="map"&&Qo.get("symbol-placement")!=="point",ef=Qo.get("symbol-placement"),Tp=Sp/2,Dh=Qo.get("icon-text-fit");Ui&&Dh!=="none"&&(Si.allowVerticalPlacement&&io.vertical&&(Pu=ea(Ui,io.vertical,Dh,Qo.get("icon-text-fit-padding"),Ou,pu)),hu&&(Ui=ea(Ui,hu,Dh,Qo.get("icon-text-fit-padding"),Ou,pu)));var Af=function(Y0,Dp){Dp.x<0||Dp.x>=8192||Dp.y<0||Dp.y>=8192||function(pa,Vl,q0,gc,mm,xv,xd,yc,Ed,Lp,bd,Sd,vm,Ev,Fp,bv,Sv,Av,Tv,Cv,Du,Ad,wv,xc,K0){var Rv,nh,kh,Uh,zh,Vh=pa.addToLineVertexArray(Vl,q0),_m=0,Mv=0,Iv=0,Zh=0,jh=-1,ds=-1,Ec={},Pv=Ae(""),gm=0,ym=0;if(yc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(gm=(Rv=yc.layout.get("text-offset").evaluate(Du,{},xc).map(function(Hh){return 24*Hh}))[0],ym=Rv[1]):(gm=24*yc.layout.get("text-radial-offset").evaluate(Du,{},xc),ym=Ge),pa.allowVerticalPlacement&&gc.vertical){var Ov=yc.layout.get("text-rotate").evaluate(Du,{},xc)+90;Uh=new so(Ed,Vl,Lp,bd,Sd,gc.vertical,vm,Ev,Fp,Ov),xd&&(zh=new so(Ed,Vl,Lp,bd,Sd,xd,Sv,Av,Fp,Ov))}if(mm){var Td=yc.layout.get("icon-rotate").evaluate(Du,{}),Dv=yc.layout.get("icon-text-fit")!=="none",Lv=Me(mm,Td,wv,Dv),xm=xd?Me(xd,Td,wv,Dv):void 0;kh=new so(Ed,Vl,Lp,bd,Sd,mm,Sv,Av,!1,Td),_m=4*Lv.length;var Em=pa.iconSizeData,Bp=null;Em.kind==="source"?(Bp=[128*yc.layout.get("icon-size").evaluate(Du,{})])[0]>32640&&ct(pa.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Em.kind==="composite"&&((Bp=[128*Ad.compositeIconSizes[0].evaluate(Du,{},xc),128*Ad.compositeIconSizes[1].evaluate(Du,{},xc)])[0]>32640||Bp[1]>32640)&&ct(pa.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),pa.addSymbols(pa.icon,Lv,Bp,Cv,Tv,Du,!1,Vl,Vh.lineStartIndex,Vh.lineLength,-1,xc),jh=pa.icon.placedSymbolArray.length-1,xm&&(Mv=4*xm.length,pa.addSymbols(pa.icon,xm,Bp,Cv,Tv,Du,Mn.vertical,Vl,Vh.lineStartIndex,Vh.lineLength,-1,xc),ds=pa.icon.placedSymbolArray.length-1)}for(var Fv in gc.horizontal){var Np=gc.horizontal[Fv];if(!nh){Pv=Ae(Np.text);var Bv=yc.layout.get("text-rotate").evaluate(Du,{},xc);nh=new so(Ed,Vl,Lp,bd,Sd,Np,vm,Ev,Fp,Bv)}var bm=Np.positionedLines.length===1;if(Iv+=Ce(pa,Vl,Np,xv,yc,Fp,Du,bv,Vh,gc.vertical?Mn.horizontal:Mn.horizontalOnly,bm?Object.keys(gc.horizontal):[Fv],Ec,jh,Ad,xc),bm)break}gc.vertical&&(Zh+=Ce(pa,Vl,gc.vertical,xv,yc,Fp,Du,bv,Vh,Mn.vertical,["vertical"],Ec,ds,Ad,xc));var Nv=nh?nh.boxStartIndex:pa.collisionBoxArray.length,$0=nh?nh.boxEndIndex:pa.collisionBoxArray.length,Q0=Uh?Uh.boxStartIndex:pa.collisionBoxArray.length,J0=Uh?Uh.boxEndIndex:pa.collisionBoxArray.length,e_=kh?kh.boxStartIndex:pa.collisionBoxArray.length,t_=kh?kh.boxEndIndex:pa.collisionBoxArray.length,kv=zh?zh.boxStartIndex:pa.collisionBoxArray.length,r_=zh?zh.boxEndIndex:pa.collisionBoxArray.length,bc=-1,kp=function(Hh,Sm){return Hh&&Hh.circleDiameter?Math.max(Hh.circleDiameter,Sm):Sm};bc=kp(nh,bc),bc=kp(Uh,bc),bc=kp(kh,bc);var Up=(bc=kp(zh,bc))>-1?1:0;Up&&(bc*=K0/24),pa.glyphOffsetArray.length>=Tr.MAX_GLYPHS&&ct("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Du.sortKey!==void 0&&pa.addToSortKeyRanges(pa.symbolInstances.length,Du.sortKey),pa.symbolInstances.emplaceBack(Vl.x,Vl.y,Ec.right>=0?Ec.right:-1,Ec.center>=0?Ec.center:-1,Ec.left>=0?Ec.left:-1,Ec.vertical||-1,jh,ds,Pv,Nv,$0,Q0,J0,e_,t_,kv,r_,Lp,Iv,Zh,_m,Mv,Up,0,vm,gm,ym,bc)}(Si,Dp,Y0,io,Ui,Hs,Pu,Si.layers[0],Si.collisionBoxArray,uo.index,uo.sourceLayerIndex,Si.index,Qc,Oh,Ap,$a,Jc,eh,md,Ou,uo,ha,Pi,gl,yo)};if(ef==="line")for(var Lh=0,vd=_l(uo.geometry,0,0,8192,8192);Lh<vd.length;Lh+=1)for(var Cp=vd[Lh],wp=0,Rp=ga(Cp,Sp,dd,io.vertical||hu,Ui,24,Sf,Si.overscaling,8192);wp<Rp.length;wp+=1){var _d=Rp[wp];hu&&me(Si,hu.text,Tp,_d)||Af(Cp,_d)}else if(ef==="line-center")for(var Mp=0,Ip=uo.geometry;Mp<Ip.length;Mp+=1){var Fh=Ip[Mp];if(Fh.length>1){var gd=Li(Fh,dd,io.vertical||hu,Ui,24,Sf);gd&&Af(Fh,gd)}}else if(uo.type==="Polygon")for(var th=0,yd=Rh(uo.geometry,0);th<yd.length;th+=1){var rh=yd[th],Pp=Ue(rh,16);Af(rh[0],new No(Pp.x,Pp.y,0))}else if(uo.type==="LineString")for(var Tf=0,Bh=uo.geometry;Tf<Bh.length;Tf+=1){var Nh=Bh[Tf];Af(Nh,new No(Nh[0].x,Nh[0].y,0))}else if(uo.type==="Point")for(var pm=0,gv=uo.geometry;pm<gv.length;pm+=1)for(var Op=0,yv=gv[pm];Op<yv.length;Op+=1){var dm=yv[Op];Af([dm],new No(dm.x,dm.y,0))}}(n,Ot,nn,Za,p,D,Zr,xn,rn,ja,b)},gt=0,zt=n.features;gt<zt.length;gt+=1)ft();y&&n.generateCollisionDebugBuffers()},v.perspective=function(n,o,s,p,_){var y,b=1/Math.tan(o/2);return n[0]=b/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,_!=null&&_!==1/0?(n[10]=(_+p)*(y=1/(p-_)),n[14]=2*_*p*y):(n[10]=-1,n[14]=-2*p),n},v.pick=function(n,o){for(var s={},p=0;p<o.length;p++){var _=o[p];_ in n&&(s[_]=n[_])}return s},v.plugin=Ks,v.polygonIntersectsPolygon=lu,v.postMapLoadEvent=Xo,v.postTurnstileEvent=da,v.potpack=Wn,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=cn,v.registerForPluginStateChange=function(n){return n({pluginStatus:Ko,pluginURL:Tu}),jf.on("pluginStateChange",n),n},v.renderColorRamp=ap,v.rotate=function(n,o,s){var p=o[0],_=o[1],y=o[2],b=o[3],C=Math.sin(s),I=Math.cos(s);return n[0]=p*I+y*C,n[1]=_*I+b*C,n[2]=p*-C+y*I,n[3]=_*-C+b*I,n},v.rotateX=function(n,o,s){var p=Math.sin(s),_=Math.cos(s),y=o[4],b=o[5],C=o[6],I=o[7],D=o[8],z=o[9],H=o[10],J=o[11];return o!==n&&(n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15]),n[4]=y*_+D*p,n[5]=b*_+z*p,n[6]=C*_+H*p,n[7]=I*_+J*p,n[8]=D*_-y*p,n[9]=z*_-b*p,n[10]=H*_-C*p,n[11]=J*_-I*p,n},v.rotateZ=function(n,o,s){var p=Math.sin(s),_=Math.cos(s),y=o[0],b=o[1],C=o[2],I=o[3],D=o[4],z=o[5],H=o[6],J=o[7];return o!==n&&(n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15]),n[0]=y*_+D*p,n[1]=b*_+z*p,n[2]=C*_+H*p,n[3]=I*_+J*p,n[4]=D*_-y*p,n[5]=z*_-b*p,n[6]=H*_-C*p,n[7]=J*_-I*p,n},v.scale=function(n,o,s){var p=s[0],_=s[1],y=s[2];return n[0]=o[0]*p,n[1]=o[1]*p,n[2]=o[2]*p,n[3]=o[3]*p,n[4]=o[4]*_,n[5]=o[5]*_,n[6]=o[6]*_,n[7]=o[7]*_,n[8]=o[8]*y,n[9]=o[9]*y,n[10]=o[10]*y,n[11]=o[11]*y,n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},v.scale$1=function(n,o,s){return n[0]=o[0]*s,n[1]=o[1]*s,n[2]=o[2]*s,n[3]=o[3]*s,n},v.scale$2=function(n,o,s){return n[0]=o[0]*s,n[1]=o[1]*s,n[2]=o[2]*s,n},v.setCacheLimits=function(n,o){Xs=n,vu=o},v.setRTLTextPlugin=function(n,o,s){if(s===void 0&&(s=!1),Ko==="deferred"||Ko==="loading"||Ko==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Tu=gn.resolveURL(n),Ko="deferred",Zf=o,Uc(),s||Ss()},v.sphericalToCartesian=function(n){var o=n[0],s=n[1],p=n[2];return s+=90,s*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(s)*Math.sin(p),y:o*Math.sin(s)*Math.sin(p),z:o*Math.cos(p)}},v.sqrLen=function(n){var o=n[0],s=n[1];return o*o+s*s},v.styleSpec=ee,v.sub=function(n,o,s){return n[0]=o[0]-s[0],n[1]=o[1]-s[1],n[2]=o[2]-s[2],n},v.symbolSize=li,v.transformMat3=function(n,o,s){var p=o[0],_=o[1],y=o[2];return n[0]=p*s[0]+_*s[3]+y*s[6],n[1]=p*s[1]+_*s[4]+y*s[7],n[2]=p*s[2]+_*s[5]+y*s[8],n},v.transformMat4=hl,v.translate=function(n,o,s){var p,_,y,b,C,I,D,z,H,J,re,Te,Re=s[0],qe=s[1],je=s[2];return o===n?(n[12]=o[0]*Re+o[4]*qe+o[8]*je+o[12],n[13]=o[1]*Re+o[5]*qe+o[9]*je+o[13],n[14]=o[2]*Re+o[6]*qe+o[10]*je+o[14],n[15]=o[3]*Re+o[7]*qe+o[11]*je+o[15]):(_=o[1],y=o[2],b=o[3],C=o[4],I=o[5],D=o[6],z=o[7],H=o[8],J=o[9],re=o[10],Te=o[11],n[0]=p=o[0],n[1]=_,n[2]=y,n[3]=b,n[4]=C,n[5]=I,n[6]=D,n[7]=z,n[8]=H,n[9]=J,n[10]=re,n[11]=Te,n[12]=p*Re+C*qe+H*je+o[12],n[13]=_*Re+I*qe+J*je+o[13],n[14]=y*Re+D*qe+re*je+o[14],n[15]=b*Re+z*qe+Te*je+o[15]),n},v.triggerPluginCompletionEvent=xh,v.uniqueId=et,v.validateCustomStyleLayer=function(n){var o=[],s=n.id;return s===void 0&&o.push({message:"layers."+s+': missing required property "id"'}),n.render===void 0&&o.push({message:"layers."+s+': missing required method "render"'}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&o.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),o},v.validateLight=Uf,v.validateStyle=Nc,v.values=function(n){var o=[];for(var s in n)o.push(n[s]);return o},v.vectorTile=_c,v.version="1.13.3",v.warnOnce=ct,v.webpSupported=Fn,v.window=G,v.wrap=ae}),Qe(["./shared"],function(v){"use strict";function it(L){var O=typeof L;if(O==="number"||O==="boolean"||O==="string"||L==null)return JSON.stringify(L);if(Array.isArray(L)){for(var j="[",$=0,de=L;$<de.length;$+=1)j+=it(de[$])+",";return j+"]"}for(var Ie=Object.keys(L).sort(),Ze="{",ee=0;ee<Ie.length;ee++)Ze+=JSON.stringify(Ie[ee])+":"+it(L[Ie[ee]])+",";return Ze+"}"}function V(L){for(var O="",j=0,$=v.refProperties;j<$.length;j+=1)O+="/"+it(L[$[j]]);return O}var se=function(L){this.keyCache={},L&&this.replace(L)};se.prototype.replace=function(L){this._layerConfigs={},this._layers={},this.update(L,[])},se.prototype.update=function(L,O){for(var j=this,$=0,de=L;$<de.length;$+=1){var Ie=de[$];this._layerConfigs[Ie.id]=Ie;var Ze=this._layers[Ie.id]=v.createStyleLayer(Ie);Ze._featureFilter=v.featureFilter(Ze.filter),this.keyCache[Ie.id]&&delete this.keyCache[Ie.id]}for(var ee=0,be=O;ee<be.length;ee+=1){var ut=be[ee];delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut]}this.familiesBySource={};for(var Dt=0,ir=function(Cr,Ir){for(var Zn={},Gr=0;Gr<Cr.length;Gr++){var Kn=Ir&&Ir[Cr[Gr].id]||V(Cr[Gr]);Ir&&(Ir[Cr[Gr].id]=Kn);var Di=Zn[Kn];Di||(Di=Zn[Kn]=[]),Di.push(Cr[Gr])}var oi=[];for(var Ti in Zn)oi.push(Zn[Ti]);return oi}(v.values(this._layerConfigs),this.keyCache);Dt<ir.length;Dt+=1){var Ct=ir[Dt].map(function(Cr){return j._layers[Cr.id]}),tr=Ct[0];if(tr.visibility!=="none"){var Br=tr.source||"",Nr=this.familiesBySource[Br];Nr||(Nr=this.familiesBySource[Br]={});var Bt=tr.sourceLayer||"_geojsonTileLayer",Fr=Nr[Bt];Fr||(Fr=Nr[Bt]=[]),Fr.push(Ct)}}};var W=function(L){var O={},j=[];for(var $ in L){var de=L[$],Ie=O[$]={};for(var Ze in de){var ee=de[+Ze];if(ee&&ee.bitmap.width!==0&&ee.bitmap.height!==0){var be={x:0,y:0,w:ee.bitmap.width+2,h:ee.bitmap.height+2};j.push(be),Ie[Ze]={rect:be,metrics:ee.metrics}}}}var ut=v.potpack(j),Dt=new v.AlphaImage({width:ut.w||1,height:ut.h||1});for(var ir in L){var Ct=L[ir];for(var tr in Ct){var Br=Ct[+tr];if(Br&&Br.bitmap.width!==0&&Br.bitmap.height!==0){var Nr=O[ir][tr].rect;v.AlphaImage.copy(Br.bitmap,Dt,{x:0,y:0},{x:Nr.x+1,y:Nr.y+1},Br.bitmap)}}}this.image=Dt,this.positions=O};v.register("GlyphAtlas",W);var ne=function(L){this.tileID=new v.OverscaledTileID(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId};function G(L,O,j){for(var $=new v.EvaluationParameters(O),de=0,Ie=L;de<Ie.length;de+=1)Ie[de].recalculate($,j)}function Ke(L,O){var j=v.getArrayBuffer(L.request,function($,de,Ie,Ze){$?O($):de&&O(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(de)),rawData:de,cacheControl:Ie,expires:Ze})});return function(){j.cancel(),O()}}ne.prototype.parse=function(L,O,j,$,de){var Ie=this;this.status="parsing",this.data=L,this.collisionBoxArray=new v.CollisionBoxArray;var Ze=new v.DictionaryCoder(Object.keys(L.layers).sort()),ee=new v.FeatureIndex(this.tileID,this.promoteId);ee.bucketLayerIDs=[];var be,ut,Dt,ir,Ct={},tr={featureIndex:ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Br=O.familiesBySource[this.source];for(var Nr in Br){var Bt=L.layers[Nr];if(Bt){Bt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+Nr+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Fr=Ze.encode(Nr),Cr=[],Ir=0;Ir<Bt.length;Ir++){var Zn=Bt.feature(Ir),Gr=ee.getId(Zn,Nr);Cr.push({feature:Zn,id:Gr,index:Ir,sourceLayerIndex:Fr})}for(var Kn=0,Di=Br[Nr];Kn<Di.length;Kn+=1){var oi=Di[Kn],Ti=oi[0];Ti.minzoom&&this.zoom<Math.floor(Ti.minzoom)||Ti.maxzoom&&this.zoom>=Ti.maxzoom||Ti.visibility!=="none"&&(G(oi,this.zoom,j),(Ct[Ti.id]=Ti.createBucket({index:ee.bucketLayerIDs.length,layers:oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fr,sourceID:this.source})).populate(Cr,tr,this.tileID.canonical),ee.bucketLayerIDs.push(oi.map(function(mi){return mi.id})))}}}var di=v.mapObject(tr.glyphDependencies,function(mi){return Object.keys(mi).map(Number)});Object.keys(di).length?$.send("getGlyphs",{uid:this.uid,stacks:di},function(mi,Jn){be||(be=mi,ut=Jn,oo.call(Ie))}):ut={};var Aa=Object.keys(tr.iconDependencies);Aa.length?$.send("getImages",{icons:Aa,source:this.source,tileID:this.tileID,type:"icons"},function(mi,Jn){be||(be=mi,Dt=Jn,oo.call(Ie))}):Dt={};var Ni=Object.keys(tr.patternDependencies);function oo(){if(be)return de(be);if(ut&&Dt&&ir){var mi=new W(ut),Jn=new v.ImageAtlas(Dt,ir);for(var ui in Ct){var To=Ct[ui];To instanceof v.SymbolBucket?(G(To.layers,this.zoom,j),v.performSymbolLayout(To,ut,mi.positions,Dt,Jn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):To.hasPattern&&(To instanceof v.LineBucket||To instanceof v.FillBucket||To instanceof v.FillExtrusionBucket)&&(G(To.layers,this.zoom,j),To.addFeatures(tr,this.tileID.canonical,Jn.patternPositions))}this.status="done",de(null,{buckets:v.values(Ct).filter(function(Ls){return!Ls.isEmpty()}),featureIndex:ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mi.image,imageAtlas:Jn,glyphMap:this.returnDependencies?ut:null,iconMap:this.returnDependencies?Dt:null,glyphPositions:this.returnDependencies?mi.positions:null})}}Ni.length?$.send("getImages",{icons:Ni,source:this.source,tileID:this.tileID,type:"patterns"},function(mi,Jn){be||(be=mi,ir=Jn,oo.call(Ie))}):ir={},oo.call(this)};var De=function(L,O,j,$){this.actor=L,this.layerIndex=O,this.availableImages=j,this.loadVectorData=$||Ke,this.loading={},this.loaded={}};De.prototype.loadTile=function(L,O){var j=this,$=L.uid;this.loading||(this.loading={});var de=!!(L&&L.request&&L.request.collectResourceTiming)&&new v.RequestPerformance(L.request),Ie=this.loading[$]=new ne(L);Ie.abort=this.loadVectorData(L,function(Ze,ee){if(delete j.loading[$],Ze||!ee)return Ie.status="done",j.loaded[$]=Ie,O(Ze);var be=ee.rawData,ut={};ee.expires&&(ut.expires=ee.expires),ee.cacheControl&&(ut.cacheControl=ee.cacheControl);var Dt={};if(de){var ir=de.finish();ir&&(Dt.resourceTiming=JSON.parse(JSON.stringify(ir)))}Ie.vectorTile=ee.vectorTile,Ie.parse(ee.vectorTile,j.layerIndex,j.availableImages,j.actor,function(Ct,tr){if(Ct||!tr)return O(Ct);O(null,v.extend({rawTileData:be.slice(0)},tr,ut,Dt))}),j.loaded=j.loaded||{},j.loaded[$]=Ie})},De.prototype.reloadTile=function(L,O){var j=this,$=this.loaded,de=L.uid,Ie=this;if($&&$[de]){var Ze=$[de];Ze.showCollisionBoxes=L.showCollisionBoxes;var ee=function(be,ut){var Dt=Ze.reloadCallback;Dt&&(delete Ze.reloadCallback,Ze.parse(Ze.vectorTile,Ie.layerIndex,j.availableImages,Ie.actor,Dt)),O(be,ut)};Ze.status==="parsing"?Ze.reloadCallback=ee:Ze.status==="done"&&(Ze.vectorTile?Ze.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.actor,ee):ee())}},De.prototype.abortTile=function(L,O){var j=this.loading,$=L.uid;j&&j[$]&&j[$].abort&&(j[$].abort(),delete j[$]),O()},De.prototype.removeTile=function(L,O){var j=this.loaded,$=L.uid;j&&j[$]&&delete j[$],O()};var ge=v.window.ImageBitmap,ht=function(){this.loaded={}};function ae(L,O){if(L.length!==0){At(L[0],O);for(var j=1;j<L.length;j++)At(L[j],!O)}}function At(L,O){for(var j=0,$=0,de=0,Ie=L.length,Ze=Ie-1;de<Ie;Ze=de++){var ee=(L[de][0]-L[Ze][0])*(L[Ze][1]+L[de][1]),be=j+ee;$+=Math.abs(j)>=Math.abs(ee)?j-be+ee:ee-be+j,j=be}j+$>=0!=!!O&&L.reverse()}ht.prototype.loadTile=function(L,O){var j=L.uid,$=L.encoding,de=L.rawImageData,Ie=ge&&de instanceof ge?this.getImageData(de):de,Ze=new v.DEMData(j,Ie,$);this.loaded=this.loaded||{},this.loaded[j]=Ze,O(null,Ze)},ht.prototype.getImageData=function(L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(L.width,L.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=L.width,this.offscreenCanvas.height=L.height,this.offscreenCanvasContext.drawImage(L,0,0,L.width,L.height);var O=this.offscreenCanvasContext.getImageData(-1,-1,L.width+2,L.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:O.width,height:O.height},O.data)},ht.prototype.removeTile=function(L){var O=this.loaded,j=L.uid;O&&O[j]&&delete O[j]};var wt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,et=function(L){this._feature=L,this.extent=v.EXTENT,this.type=L.type,this.properties=L.tags,"id"in L&&!isNaN(L.id)&&(this.id=parseInt(L.id,10))};et.prototype.loadGeometry=function(){if(this._feature.type===1){for(var L=[],O=0,j=this._feature.geometry;O<j.length;O+=1){var $=j[O];L.push([new v.Point$1($[0],$[1])])}return L}for(var de=[],Ie=0,Ze=this._feature.geometry;Ie<Ze.length;Ie+=1){for(var ee=[],be=0,ut=Ze[Ie];be<ut.length;be+=1){var Dt=ut[be];ee.push(new v.Point$1(Dt[0],Dt[1]))}de.push(ee)}return de},et.prototype.toGeoJSON=function(L,O,j){return wt.call(this,L,O,j)};var mr=function(L){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=L.length,this._features=L};mr.prototype.feature=function(L){return new et(this._features[L])};var pr=v.vectorTile.VectorTileFeature,yn=bi;function bi(L,O){this.options=O||{},this.features=L,this.length=L.length}function $n(L,O){this.id=typeof L.id=="number"?L.id:void 0,this.type=L.type,this.rawGeometry=L.type===1?[L.geometry]:L.geometry,this.properties=L.tags,this.extent=O||4096}bi.prototype.feature=function(L){return new $n(this.features[L],this.options.extent)},$n.prototype.loadGeometry=function(){var L=this.rawGeometry;this.geometry=[];for(var O=0;O<L.length;O++){for(var j=L[O],$=[],de=0;de<j.length;de++)$.push(new v.Point$1(j[de][0],j[de][1]));this.geometry.push($)}return this.geometry},$n.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var L=this.geometry,O=1/0,j=-1/0,$=1/0,de=-1/0,Ie=0;Ie<L.length;Ie++)for(var Ze=L[Ie],ee=0;ee<Ze.length;ee++){var be=Ze[ee];O=Math.min(O,be.x),j=Math.max(j,be.x),$=Math.min($,be.y),de=Math.max(de,be.y)}return[O,$,j,de]},$n.prototype.toGeoJSON=pr.prototype.toGeoJSON;var Mt=Wt,ze=yn;function Wt(L){var O=new v.pbf;return function(j,$){for(var de in j.layers)$.writeMessage(3,ct,j.layers[de])}(L,O),O.finish()}function ct(L,O){var j;O.writeVarintField(15,L.version||1),O.writeStringField(1,L.name||""),O.writeVarintField(5,L.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<L.length;j++)$.feature=L.feature(j),O.writeMessage(2,nr,$);var de=$.keys;for(j=0;j<de.length;j++)O.writeStringField(3,de[j]);var Ie=$.values;for(j=0;j<Ie.length;j++)O.writeMessage(4,ve,Ie[j])}function nr(L,O){var j=L.feature;j.id!==void 0&&O.writeVarintField(1,j.id),O.writeMessage(2,Lr,L),O.writeVarintField(3,j.type),O.writeMessage(4,Y,j)}function Lr(L,O){var j=L.feature,$=L.keys,de=L.values,Ie=L.keycache,Ze=L.valuecache;for(var ee in j.properties){var be=Ie[ee];be===void 0&&($.push(ee),Ie[ee]=be=$.length-1),O.writeVarint(be);var ut=j.properties[ee],Dt=typeof ut;Dt!=="string"&&Dt!=="boolean"&&Dt!=="number"&&(ut=JSON.stringify(ut));var ir=Dt+":"+ut,Ct=Ze[ir];Ct===void 0&&(de.push(ut),Ze[ir]=Ct=de.length-1),O.writeVarint(Ct)}}function K(L,O){return(O<<3)+(7&L)}function _e(L){return L<<1^L>>31}function Y(L,O){for(var j=L.loadGeometry(),$=L.type,de=0,Ie=0,Ze=j.length,ee=0;ee<Ze;ee++){var be=j[ee],ut=1;$===1&&(ut=be.length),O.writeVarint(K(1,ut));for(var Dt=$===3?be.length-1:be.length,ir=0;ir<Dt;ir++){ir===1&&$!==1&&O.writeVarint(K(2,Dt-1));var Ct=be[ir].x-de,tr=be[ir].y-Ie;O.writeVarint(_e(Ct)),O.writeVarint(_e(tr)),de+=Ct,Ie+=tr}$===3&&O.writeVarint(K(7,1))}}function ve(L,O){var j=typeof L;j==="string"?O.writeStringField(1,L):j==="boolean"?O.writeBooleanField(7,L):j==="number"&&(L%1!=0?O.writeDoubleField(3,L):L<0?O.writeSVarintField(6,L):O.writeVarintField(5,L))}function fe(L,O,j,$){He(L,j,$),He(O,2*j,2*$),He(O,2*j+1,2*$+1)}function He(L,O,j){var $=L[O];L[O]=L[j],L[j]=$}function at(L,O,j,$){var de=L-j,Ie=O-$;return de*de+Ie*Ie}Mt.fromVectorTileJs=Wt,Mt.fromGeojsonVt=function(L,O){O=O||{};var j={};for(var $ in L)j[$]=new yn(L[$].features,O),j[$].name=$,j[$].version=O.version,j[$].extent=O.extent;return Wt({layers:j})},Mt.GeoJSONWrapper=ze;var _t=function(L){return L[0]},Tt=function(L){return L[1]},Pt=function(L,O,j,$,de){O===void 0&&(O=_t),j===void 0&&(j=Tt),$===void 0&&($=64),de===void 0&&(de=Float64Array),this.nodeSize=$,this.points=L;for(var Ie=L.length<65536?Uint16Array:Uint32Array,Ze=this.ids=new Ie(L.length),ee=this.coords=new de(2*L.length),be=0;be<L.length;be++)Ze[be]=be,ee[2*be]=O(L[be]),ee[2*be+1]=j(L[be]);(function ut(Dt,ir,Ct,tr,Br,Nr){if(!(Br-tr<=Ct)){var Bt=tr+Br>>1;(function Fr(Cr,Ir,Zn,Gr,Kn,Di){for(;Kn>Gr;){if(Kn-Gr>600){var oi=Kn-Gr+1,Ti=Zn-Gr+1,di=Math.log(oi),Aa=.5*Math.exp(2*di/3),Ni=.5*Math.sqrt(di*Aa*(oi-Aa)/oi)*(Ti-oi/2<0?-1:1);Fr(Cr,Ir,Zn,Math.max(Gr,Math.floor(Zn-Ti*Aa/oi+Ni)),Math.min(Kn,Math.floor(Zn+(oi-Ti)*Aa/oi+Ni)),Di)}var oo=Ir[2*Zn+Di],mi=Gr,Jn=Kn;for(fe(Cr,Ir,Gr,Zn),Ir[2*Kn+Di]>oo&&fe(Cr,Ir,Gr,Kn);mi<Jn;){for(fe(Cr,Ir,mi,Jn),mi++,Jn--;Ir[2*mi+Di]<oo;)mi++;for(;Ir[2*Jn+Di]>oo;)Jn--}Ir[2*Gr+Di]===oo?fe(Cr,Ir,Gr,Jn):fe(Cr,Ir,++Jn,Kn),Jn<=Zn&&(Gr=Jn+1),Zn<=Jn&&(Kn=Jn-1)}})(Dt,ir,Bt,tr,Br,Nr%2),ut(Dt,ir,Ct,tr,Bt-1,Nr+1),ut(Dt,ir,Ct,Bt+1,Br,Nr+1)}})(Ze,ee,$,0,Ze.length-1,0)};Pt.prototype.range=function(L,O,j,$){return function(de,Ie,Ze,ee,be,ut,Dt){for(var ir,Ct,tr=[0,de.length-1,0],Br=[];tr.length;){var Nr=tr.pop(),Bt=tr.pop(),Fr=tr.pop();if(Bt-Fr<=Dt)for(var Cr=Fr;Cr<=Bt;Cr++)Ct=Ie[2*Cr+1],(ir=Ie[2*Cr])>=Ze&&ir<=be&&Ct>=ee&&Ct<=ut&&Br.push(de[Cr]);else{var Ir=Math.floor((Fr+Bt)/2);Ct=Ie[2*Ir+1],(ir=Ie[2*Ir])>=Ze&&ir<=be&&Ct>=ee&&Ct<=ut&&Br.push(de[Ir]);var Zn=(Nr+1)%2;(Nr===0?Ze<=ir:ee<=Ct)&&(tr.push(Fr),tr.push(Ir-1),tr.push(Zn)),(Nr===0?be>=ir:ut>=Ct)&&(tr.push(Ir+1),tr.push(Bt),tr.push(Zn))}}return Br}(this.ids,this.coords,L,O,j,$,this.nodeSize)},Pt.prototype.within=function(L,O,j){return function($,de,Ie,Ze,ee,be){for(var ut=[0,$.length-1,0],Dt=[],ir=ee*ee;ut.length;){var Ct=ut.pop(),tr=ut.pop(),Br=ut.pop();if(tr-Br<=be)for(var Nr=Br;Nr<=tr;Nr++)at(de[2*Nr],de[2*Nr+1],Ie,Ze)<=ir&&Dt.push($[Nr]);else{var Bt=Math.floor((Br+tr)/2),Fr=de[2*Bt],Cr=de[2*Bt+1];at(Fr,Cr,Ie,Ze)<=ir&&Dt.push($[Bt]);var Ir=(Ct+1)%2;(Ct===0?Ie-ee<=Fr:Ze-ee<=Cr)&&(ut.push(Br),ut.push(Bt-1),ut.push(Ir)),(Ct===0?Ie+ee>=Fr:Ze+ee>=Cr)&&(ut.push(Bt+1),ut.push(tr),ut.push(Ir))}}return Dt}(this.ids,this.coords,L,O,j,this.nodeSize)};var Xr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(L){return L}},zr=function(L){this.options=Qn(Object.create(Xr),L),this.trees=new Array(this.options.maxZoom+1)};function gn(L,O,j,$,de){return{x:L,y:O,zoom:1/0,id:j,parentId:-1,numPoints:$,properties:de}}function Qr(L,O){var j=L.geometry.coordinates,$=j[1];return{x:dn(j[0]),y:un($),zoom:1/0,index:O,parentId:-1}}function Fn(L){return{type:"Feature",id:L.id,properties:bn(L),geometry:{type:"Point",coordinates:[($=L.x,360*($-.5)),(O=L.y,j=(180-360*O)*Math.PI/180,360*Math.atan(Math.exp(j))/Math.PI-90)]}};var O,j,$}function bn(L){var O=L.numPoints,j=O>=1e4?Math.round(O/1e3)+"k":O>=1e3?Math.round(O/100)/10+"k":O;return Qn(Qn({},L.properties),{cluster:!0,cluster_id:L.id,point_count:O,point_count_abbreviated:j})}function dn(L){return L/360+.5}function un(L){var O=Math.sin(L*Math.PI/180),j=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return j<0?0:j>1?1:j}function Qn(L,O){for(var j in O)L[j]=O[j];return L}function Vr(L){return L.x}function Dn(L){return L.y}function Wr(L,O,j,$,de,Ie){var Ze=de-j,ee=Ie-$;if(Ze!==0||ee!==0){var be=((L-j)*Ze+(O-$)*ee)/(Ze*Ze+ee*ee);be>1?(j=de,$=Ie):be>0&&(j+=Ze*be,$+=ee*be)}return(Ze=L-j)*Ze+(ee=O-$)*ee}function Jr(L,O,j,$){var de={id:L===void 0?null:L,type:O,geometry:j,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ie){var Ze=Ie.geometry,ee=Ie.type;if(ee==="Point"||ee==="MultiPoint"||ee==="LineString")ji(Ie,Ze);else if(ee==="Polygon"||ee==="MultiLineString")for(var be=0;be<Ze.length;be++)ji(Ie,Ze[be]);else if(ee==="MultiPolygon")for(be=0;be<Ze.length;be++)for(var ut=0;ut<Ze[be].length;ut++)ji(Ie,Ze[be][ut])}(de),de}function ji(L,O){for(var j=0;j<O.length;j+=3)L.minX=Math.min(L.minX,O[j]),L.minY=Math.min(L.minY,O[j+1]),L.maxX=Math.max(L.maxX,O[j]),L.maxY=Math.max(L.maxY,O[j+1])}function gi(L,O,j,$){if(O.geometry){var de=O.geometry.coordinates,Ie=O.geometry.type,Ze=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),ee=[],be=O.id;if(j.promoteId?be=O.properties[j.promoteId]:j.generateId&&(be=$||0),Ie==="Point")Eo(de,ee);else if(Ie==="MultiPoint")for(var ut=0;ut<de.length;ut++)Eo(de[ut],ee);else if(Ie==="LineString")$i(de,ee,Ze,!1);else if(Ie==="MultiLineString"){if(j.lineMetrics){for(ut=0;ut<de.length;ut++)$i(de[ut],ee=[],Ze,!1),L.push(Jr(be,"LineString",ee,O.properties));return}ue(de,ee,Ze,!1)}else if(Ie==="Polygon")ue(de,ee,Ze,!0);else{if(Ie!=="MultiPolygon"){if(Ie==="GeometryCollection"){for(ut=0;ut<O.geometry.geometries.length;ut++)gi(L,{id:be,geometry:O.geometry.geometries[ut],properties:O.properties},j,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ut=0;ut<de.length;ut++){var Dt=[];ue(de[ut],Dt,Ze,!0),ee.push(Dt)}}L.push(Jr(be,Ie,ee,O.properties))}}function Eo(L,O){O.push(Xi(L[0])),O.push(co(L[1])),O.push(0)}function $i(L,O,j,$){for(var de,Ie,Ze=0,ee=0;ee<L.length;ee++){var be=Xi(L[ee][0]),ut=co(L[ee][1]);O.push(be),O.push(ut),O.push(0),ee>0&&(Ze+=$?(de*ut-be*Ie)/2:Math.sqrt(Math.pow(be-de,2)+Math.pow(ut-Ie,2))),de=be,Ie=ut}var Dt=O.length-3;O[2]=1,function ir(Ct,tr,Br,Nr){for(var Bt,Fr=Nr,Cr=Br-tr>>1,Ir=Br-tr,Zn=Ct[tr],Gr=Ct[tr+1],Kn=Ct[Br],Di=Ct[Br+1],oi=tr+3;oi<Br;oi+=3){var Ti=Wr(Ct[oi],Ct[oi+1],Zn,Gr,Kn,Di);if(Ti>Fr)Bt=oi,Fr=Ti;else if(Ti===Fr){var di=Math.abs(oi-Cr);di<Ir&&(Bt=oi,Ir=di)}}Fr>Nr&&(Bt-tr>3&&ir(Ct,tr,Bt,Nr),Ct[Bt+2]=Fr,Br-Bt>3&&ir(Ct,Bt,Br,Nr))}(O,0,Dt,j),O[Dt+2]=1,O.size=Math.abs(Ze),O.start=0,O.end=O.size}function ue(L,O,j,$){for(var de=0;de<L.length;de++){var Ie=[];$i(L[de],Ie,j,$),O.push(Ie)}}function Xi(L){return L/360+.5}function co(L){var O=Math.sin(L*Math.PI/180),j=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return j<0?0:j>1?1:j}function bo(L,O,j,$,de,Ie,Ze,ee){if($/=O,Ie>=(j/=O)&&Ze<$)return L;if(Ze<j||Ie>=$)return null;for(var be=[],ut=0;ut<L.length;ut++){var Dt=L[ut],ir=Dt.geometry,Ct=Dt.type,tr=de===0?Dt.minX:Dt.minY,Br=de===0?Dt.maxX:Dt.maxY;if(tr>=j&&Br<$)be.push(Dt);else if(!(Br<j||tr>=$)){var Nr=[];if(Ct==="Point"||Ct==="MultiPoint")Sa(ir,Nr,j,$,de);else if(Ct==="LineString")da(ir,Nr,j,$,de,!1,ee.lineMetrics);else if(Ct==="MultiLineString")Xo(ir,Nr,j,$,de,!1);else if(Ct==="Polygon")Xo(ir,Nr,j,$,de,!0);else if(Ct==="MultiPolygon")for(var Bt=0;Bt<ir.length;Bt++){var Fr=[];Xo(ir[Bt],Fr,j,$,de,!0),Fr.length&&Nr.push(Fr)}if(Nr.length){if(ee.lineMetrics&&Ct==="LineString"){for(Bt=0;Bt<Nr.length;Bt++)be.push(Jr(Dt.id,Ct,Nr[Bt],Dt.tags));continue}Ct!=="LineString"&&Ct!=="MultiLineString"||(Nr.length===1?(Ct="LineString",Nr=Nr[0]):Ct="MultiLineString"),Ct!=="Point"&&Ct!=="MultiPoint"||(Ct=Nr.length===3?"Point":"MultiPoint"),be.push(Jr(Dt.id,Ct,Nr,Dt.tags))}}}return be.length?be:null}function Sa(L,O,j,$,de){for(var Ie=0;Ie<L.length;Ie+=3){var Ze=L[Ie+de];Ze>=j&&Ze<=$&&(O.push(L[Ie]),O.push(L[Ie+1]),O.push(L[Ie+2]))}}function da(L,O,j,$,de,Ie,Ze){for(var ee,be,ut=Ds(L),Dt=de===0?vu:Vo,ir=L.start,Ct=0;Ct<L.length-3;Ct+=3){var tr=L[Ct],Br=L[Ct+1],Nr=L[Ct+2],Bt=L[Ct+3],Fr=L[Ct+4],Cr=de===0?tr:Br,Ir=de===0?Bt:Fr,Zn=!1;Ze&&(ee=Math.sqrt(Math.pow(tr-Bt,2)+Math.pow(Br-Fr,2))),Cr<j?Ir>j&&(be=Dt(ut,tr,Br,Bt,Fr,j),Ze&&(ut.start=ir+ee*be)):Cr>$?Ir<$&&(be=Dt(ut,tr,Br,Bt,Fr,$),Ze&&(ut.start=ir+ee*be)):Xs(ut,tr,Br,Nr),Ir<j&&Cr>=j&&(be=Dt(ut,tr,Br,Bt,Fr,j),Zn=!0),Ir>$&&Cr<=$&&(be=Dt(ut,tr,Br,Bt,Fr,$),Zn=!0),!Ie&&Zn&&(Ze&&(ut.end=ir+ee*be),O.push(ut),ut=Ds(L)),Ze&&(ir+=ee)}var Gr=L.length-3;tr=L[Gr],Br=L[Gr+1],Nr=L[Gr+2],(Cr=de===0?tr:Br)>=j&&Cr<=$&&Xs(ut,tr,Br,Nr),Gr=ut.length-3,Ie&&Gr>=3&&(ut[Gr]!==ut[0]||ut[Gr+1]!==ut[1])&&Xs(ut,ut[0],ut[1],ut[2]),ut.length&&O.push(ut)}function Ds(L){var O=[];return O.size=L.size,O.start=L.start,O.end=L.end,O}function Xo(L,O,j,$,de,Ie){for(var Ze=0;Ze<L.length;Ze++)da(L[Ze],O,j,$,de,Ie,!1)}function Xs(L,O,j,$){L.push(O),L.push(j),L.push($)}function vu(L,O,j,$,de,Ie){var Ze=(Ie-O)/($-O);return L.push(Ie),L.push(j+(de-j)*Ze),L.push(1),Ze}function Vo(L,O,j,$,de,Ie){var Ze=(Ie-j)/(de-j);return L.push(O+($-O)*Ze),L.push(Ie),L.push(1),Ze}function fo(L,O){for(var j=[],$=0;$<L.length;$++){var de,Ie=L[$],Ze=Ie.type;if(Ze==="Point"||Ze==="MultiPoint"||Ze==="LineString")de=ho(Ie.geometry,O);else if(Ze==="MultiLineString"||Ze==="Polygon"){de=[];for(var ee=0;ee<Ie.geometry.length;ee++)de.push(ho(Ie.geometry[ee],O))}else if(Ze==="MultiPolygon")for(de=[],ee=0;ee<Ie.geometry.length;ee++){for(var be=[],ut=0;ut<Ie.geometry[ee].length;ut++)be.push(ho(Ie.geometry[ee][ut],O));de.push(be)}j.push(Jr(Ie.id,Ze,de,Ie.tags))}return j}function ho(L,O){var j=[];j.size=L.size,L.start!==void 0&&(j.start=L.start,j.end=L.end);for(var $=0;$<L.length;$+=3)j.push(L[$]+O,L[$+1],L[$+2]);return j}function pt(L,O){if(L.transformed)return L;var j,$,de,Ie=1<<L.z,Ze=L.x,ee=L.y;for(j=0;j<L.features.length;j++){var be=L.features[j],ut=be.geometry,Dt=be.type;if(be.geometry=[],Dt===1)for($=0;$<ut.length;$+=2)be.geometry.push(Z(ut[$],ut[$+1],O,Ie,Ze,ee));else for($=0;$<ut.length;$++){var ir=[];for(de=0;de<ut[$].length;de+=2)ir.push(Z(ut[$][de],ut[$][de+1],O,Ie,Ze,ee));be.geometry.push(ir)}}return L.transformed=!0,L}function Z(L,O,j,$,de,Ie){return[Math.round(j*(L*$-de)),Math.round(j*(O*$-Ie))]}function Q(L,O,j,$,de){for(var Ie=O===de.maxZoom?0:de.tolerance/((1<<O)*de.extent),Ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:$,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ee=0;ee<L.length;ee++){Ze.numFeatures++,Ee(Ze,L[ee],Ie,de);var be=L[ee].minX,ut=L[ee].minY,Dt=L[ee].maxX,ir=L[ee].maxY;be<Ze.minX&&(Ze.minX=be),ut<Ze.minY&&(Ze.minY=ut),Dt>Ze.maxX&&(Ze.maxX=Dt),ir>Ze.maxY&&(Ze.maxY=ir)}return Ze}function Ee(L,O,j,$){var de=O.geometry,Ie=O.type,Ze=[];if(Ie==="Point"||Ie==="MultiPoint")for(var ee=0;ee<de.length;ee+=3)Ze.push(de[ee]),Ze.push(de[ee+1]),L.numPoints++,L.numSimplified++;else if(Ie==="LineString")Ve(Ze,de,L,j,!1,!1);else if(Ie==="MultiLineString"||Ie==="Polygon")for(ee=0;ee<de.length;ee++)Ve(Ze,de[ee],L,j,Ie==="Polygon",ee===0);else if(Ie==="MultiPolygon")for(var be=0;be<de.length;be++){var ut=de[be];for(ee=0;ee<ut.length;ee++)Ve(Ze,ut[ee],L,j,!0,ee===0)}if(Ze.length){var Dt=O.tags||null;if(Ie==="LineString"&&$.lineMetrics){for(var ir in Dt={},O.tags)Dt[ir]=O.tags[ir];Dt.mapbox_clip_start=de.start/de.size,Dt.mapbox_clip_end=de.end/de.size}var Ct={geometry:Ze,type:Ie==="Polygon"||Ie==="MultiPolygon"?3:Ie==="LineString"||Ie==="MultiLineString"?2:1,tags:Dt};O.id!==null&&(Ct.id=O.id),L.features.push(Ct)}}function Ve(L,O,j,$,de,Ie){var Ze=$*$;if($>0&&O.size<(de?Ze:$))j.numPoints+=O.length/3;else{for(var ee=[],be=0;be<O.length;be+=3)($===0||O[be+2]>Ze)&&(j.numSimplified++,ee.push(O[be]),ee.push(O[be+1])),j.numPoints++;de&&function(ut,Dt){for(var ir=0,Ct=0,tr=ut.length,Br=tr-2;Ct<tr;Br=Ct,Ct+=2)ir+=(ut[Ct]-ut[Br])*(ut[Ct+1]+ut[Br+1]);if(ir>0===Dt)for(Ct=0,tr=ut.length;Ct<tr/2;Ct+=2){var Nr=ut[Ct],Bt=ut[Ct+1];ut[Ct]=ut[tr-2-Ct],ut[Ct+1]=ut[tr-1-Ct],ut[tr-2-Ct]=Nr,ut[tr-1-Ct]=Bt}}(ee,Ie),L.push(ee)}}function Le(L,O){var j=(O=this.options=function(de,Ie){for(var Ze in Ie)de[Ze]=Ie[Ze];return de}(Object.create(this.options),O)).debug;if(j&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(de,Ie){var Ze=[];if(de.type==="FeatureCollection")for(var ee=0;ee<de.features.length;ee++)gi(Ze,de.features[ee],Ie,ee);else gi(Ze,de.type==="Feature"?de:{geometry:de},Ie);return Ze}(L,O);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),($=function(de,Ie){var Ze=Ie.buffer/Ie.extent,ee=de,be=bo(de,1,-1-Ze,Ze,0,-1,2,Ie),ut=bo(de,1,1-Ze,2+Ze,0,-1,2,Ie);return(be||ut)&&(ee=bo(de,1,-Ze,1+Ze,0,-1,2,Ie)||[],be&&(ee=fo(be,1).concat(ee)),ut&&(ee=ee.concat(fo(ut,-1)))),ee}($,O)).length&&this.splitTile($,0,0,0),j&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jt(L,O,j){return 32*((1<<L)*j+O)+L}function Zt(L,O){var j=L.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);var $=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!$)return O(null,null);var de=new mr($.features),Ie=Mt(de);Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),O(null,{vectorTile:de,rawData:Ie.buffer})}zr.prototype.load=function(L){var O=this.options,j=O.log,$=O.minZoom,de=O.maxZoom,Ie=O.nodeSize;j&&console.time("total time");var Ze="prepare "+L.length+" points";j&&console.time(Ze),this.points=L;for(var ee=[],be=0;be<L.length;be++)L[be].geometry&&ee.push(Qr(L[be],be));this.trees[de+1]=new Pt(ee,Vr,Dn,Ie,Float32Array),j&&console.timeEnd(Ze);for(var ut=de;ut>=$;ut--){var Dt=+Date.now();ee=this._cluster(ee,ut),this.trees[ut]=new Pt(ee,Vr,Dn,Ie,Float32Array),j&&console.log("z%d: %d clusters in %dms",ut,ee.length,+Date.now()-Dt)}return j&&console.timeEnd("total time"),this},zr.prototype.getClusters=function(L,O){var j=((L[0]+180)%360+360)%360-180,$=Math.max(-90,Math.min(90,L[1])),de=L[2]===180?180:((L[2]+180)%360+360)%360-180,Ie=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)j=-180,de=180;else if(j>de){var Ze=this.getClusters([j,$,180,Ie],O),ee=this.getClusters([-180,$,de,Ie],O);return Ze.concat(ee)}for(var be=this.trees[this._limitZoom(O)],ut=[],Dt=0,ir=be.range(dn(j),un(Ie),dn(de),un($));Dt<ir.length;Dt+=1){var Ct=be.points[ir[Dt]];ut.push(Ct.numPoints?Fn(Ct):this.points[Ct.index])}return ut},zr.prototype.getChildren=function(L){var O=this._getOriginId(L),j=this._getOriginZoom(L),$="No cluster with the specified id.",de=this.trees[j];if(!de)throw new Error($);var Ie=de.points[O];if(!Ie)throw new Error($);for(var Ze=this.options.radius/(this.options.extent*Math.pow(2,j-1)),ee=[],be=0,ut=de.within(Ie.x,Ie.y,Ze);be<ut.length;be+=1){var Dt=de.points[ut[be]];Dt.parentId===L&&ee.push(Dt.numPoints?Fn(Dt):this.points[Dt.index])}if(ee.length===0)throw new Error($);return ee},zr.prototype.getLeaves=function(L,O,j){var $=[];return this._appendLeaves($,L,O=O||10,j=j||0,0),$},zr.prototype.getTile=function(L,O,j){var $=this.trees[this._limitZoom(L)],de=Math.pow(2,L),Ie=this.options,Ze=Ie.radius/Ie.extent,ee=(j-Ze)/de,be=(j+1+Ze)/de,ut={features:[]};return this._addTileFeatures($.range((O-Ze)/de,ee,(O+1+Ze)/de,be),$.points,O,j,de,ut),O===0&&this._addTileFeatures($.range(1-Ze/de,ee,1,be),$.points,de,j,de,ut),O===de-1&&this._addTileFeatures($.range(0,ee,Ze/de,be),$.points,-1,j,de,ut),ut.features.length?ut:null},zr.prototype.getClusterExpansionZoom=function(L){for(var O=this._getOriginZoom(L)-1;O<=this.options.maxZoom;){var j=this.getChildren(L);if(O++,j.length!==1)break;L=j[0].properties.cluster_id}return O},zr.prototype._appendLeaves=function(L,O,j,$,de){for(var Ie=0,Ze=this.getChildren(O);Ie<Ze.length;Ie+=1){var ee=Ze[Ie],be=ee.properties;if(be&&be.cluster?de+be.point_count<=$?de+=be.point_count:de=this._appendLeaves(L,be.cluster_id,j,$,de):de<$?de++:L.push(ee),L.length===j)break}return de},zr.prototype._addTileFeatures=function(L,O,j,$,de,Ie){for(var Ze=0,ee=L;Ze<ee.length;Ze+=1){var be=O[ee[Ze]],ut=be.numPoints,Dt={type:1,geometry:[[Math.round(this.options.extent*(be.x*de-j)),Math.round(this.options.extent*(be.y*de-$))]],tags:ut?bn(be):this.points[be.index].properties},ir=void 0;ut?ir=be.id:this.options.generateId?ir=be.index:this.points[be.index].id&&(ir=this.points[be.index].id),ir!==void 0&&(Dt.id=ir),Ie.features.push(Dt)}},zr.prototype._limitZoom=function(L){return Math.max(this.options.minZoom,Math.min(+L,this.options.maxZoom+1))},zr.prototype._cluster=function(L,O){for(var j=[],$=this.options,de=$.reduce,Ie=$.minPoints,Ze=$.radius/($.extent*Math.pow(2,O)),ee=0;ee<L.length;ee++){var be=L[ee];if(!(be.zoom<=O)){be.zoom=O;for(var ut=this.trees[O+1],Dt=ut.within(be.x,be.y,Ze),ir=be.numPoints||1,Ct=ir,tr=0,Br=Dt;tr<Br.length;tr+=1){var Nr=ut.points[Br[tr]];Nr.zoom>O&&(Ct+=Nr.numPoints||1)}if(Ct>=Ie){for(var Bt=be.x*ir,Fr=be.y*ir,Cr=de&&ir>1?this._map(be,!0):null,Ir=(ee<<5)+(O+1)+this.points.length,Zn=0,Gr=Dt;Zn<Gr.length;Zn+=1){var Kn=ut.points[Gr[Zn]];if(!(Kn.zoom<=O)){Kn.zoom=O;var Di=Kn.numPoints||1;Bt+=Kn.x*Di,Fr+=Kn.y*Di,Kn.parentId=Ir,de&&(Cr||(Cr=this._map(be,!0)),de(Cr,this._map(Kn)))}}be.parentId=Ir,j.push(gn(Bt/Ct,Fr/Ct,Ir,Ct,Cr))}else if(j.push(be),Ct>1)for(var oi=0,Ti=Dt;oi<Ti.length;oi+=1){var di=ut.points[Ti[oi]];di.zoom<=O||(di.zoom=O,j.push(di))}}}return j},zr.prototype._getOriginId=function(L){return L-this.points.length>>5},zr.prototype._getOriginZoom=function(L){return(L-this.points.length)%32},zr.prototype._map=function(L,O){if(L.numPoints)return O?Qn({},L.properties):L.properties;var j=this.points[L.index].properties,$=this.options.map(j);return O&&$===j?Qn({},$):$},Le.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Le.prototype.splitTile=function(L,O,j,$,de,Ie,Ze){for(var ee=[L,O,j,$],be=this.options,ut=be.debug;ee.length;){$=ee.pop(),j=ee.pop(),O=ee.pop(),L=ee.pop();var Dt=1<<O,ir=jt(O,j,$),Ct=this.tiles[ir];if(!Ct&&(ut>1&&console.time("creation"),Ct=this.tiles[ir]=Q(L,O,j,$,be),this.tileCoords.push({z:O,x:j,y:$}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,j,$,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));var tr="z"+O;this.stats[tr]=(this.stats[tr]||0)+1,this.total++}if(Ct.source=L,de){if(O===be.maxZoom||O===de)continue;var Br=1<<de-O;if(j!==Math.floor(Ie/Br)||$!==Math.floor(Ze/Br))continue}else if(O===be.indexMaxZoom||Ct.numPoints<=be.indexMaxPoints)continue;if(Ct.source=null,L.length!==0){ut>1&&console.time("clipping");var Nr,Bt,Fr,Cr,Ir,Zn,Gr=.5*be.buffer/be.extent,Kn=.5-Gr,Di=.5+Gr,oi=1+Gr;Nr=Bt=Fr=Cr=null,Ir=bo(L,Dt,j-Gr,j+Di,0,Ct.minX,Ct.maxX,be),Zn=bo(L,Dt,j+Kn,j+oi,0,Ct.minX,Ct.maxX,be),L=null,Ir&&(Nr=bo(Ir,Dt,$-Gr,$+Di,1,Ct.minY,Ct.maxY,be),Bt=bo(Ir,Dt,$+Kn,$+oi,1,Ct.minY,Ct.maxY,be),Ir=null),Zn&&(Fr=bo(Zn,Dt,$-Gr,$+Di,1,Ct.minY,Ct.maxY,be),Cr=bo(Zn,Dt,$+Kn,$+oi,1,Ct.minY,Ct.maxY,be),Zn=null),ut>1&&console.timeEnd("clipping"),ee.push(Nr||[],O+1,2*j,2*$),ee.push(Bt||[],O+1,2*j,2*$+1),ee.push(Fr||[],O+1,2*j+1,2*$),ee.push(Cr||[],O+1,2*j+1,2*$+1)}}},Le.prototype.getTile=function(L,O,j){var $=this.options,de=$.extent,Ie=$.debug;if(L<0||L>24)return null;var Ze=1<<L,ee=jt(L,O=(O%Ze+Ze)%Ze,j);if(this.tiles[ee])return pt(this.tiles[ee],de);Ie>1&&console.log("drilling down to z%d-%d-%d",L,O,j);for(var be,ut=L,Dt=O,ir=j;!be&&ut>0;)ut--,Dt=Math.floor(Dt/2),ir=Math.floor(ir/2),be=this.tiles[jt(ut,Dt,ir)];return be&&be.source?(Ie>1&&console.log("found parent tile z%d-%d-%d",ut,Dt,ir),Ie>1&&console.time("drilling down"),this.splitTile(be.source,ut,Dt,ir,L,O,j),Ie>1&&console.timeEnd("drilling down"),this.tiles[ee]?pt(this.tiles[ee],de):null):null};var ur=function(L){function O(j,$,de,Ie){L.call(this,j,$,de,Zt),Ie&&(this.loadGeoJSON=Ie)}return L&&(O.__proto__=L),(O.prototype=Object.create(L&&L.prototype)).constructor=O,O.prototype.loadData=function(j,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=$,this._pendingLoadDataParams=j,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},O.prototype._loadData=function(){var j=this;if(this._pendingCallback&&this._pendingLoadDataParams){var $=this._pendingCallback,de=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ie=!!(de&&de.request&&de.request.collectResourceTiming)&&new v.RequestPerformance(de.request);this.loadGeoJSON(de,function(Ze,ee){if(Ze||!ee)return $(Ze);if(typeof ee!="object")return $(new Error("Input data given to '"+de.source+"' is not a valid GeoJSON object."));(function Ct(tr,Br){var Nr,Bt=tr&&tr.type;if(Bt==="FeatureCollection")for(Nr=0;Nr<tr.features.length;Nr++)Ct(tr.features[Nr],Br);else if(Bt==="GeometryCollection")for(Nr=0;Nr<tr.geometries.length;Nr++)Ct(tr.geometries[Nr],Br);else if(Bt==="Feature")Ct(tr.geometry,Br);else if(Bt==="Polygon")ae(tr.coordinates,Br);else if(Bt==="MultiPolygon")for(Nr=0;Nr<tr.coordinates.length;Nr++)ae(tr.coordinates[Nr],Br);return tr})(ee,!0);try{if(de.filter){var be=v.createExpression(de.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(be.result==="error")throw new Error(be.value.map(function(Ct){return Ct.key+": "+Ct.message}).join(", "));var ut=ee.features.filter(function(Ct){return be.value.evaluate({zoom:0},Ct)});ee={type:"FeatureCollection",features:ut}}j._geoJSONIndex=de.cluster?new zr(function(Ct){var tr=Ct.superclusterOptions,Br=Ct.clusterProperties;if(!Br||!tr)return tr;for(var Nr={},Bt={},Fr={accumulated:null,zoom:0},Cr={properties:null},Ir=Object.keys(Br),Zn=0,Gr=Ir;Zn<Gr.length;Zn+=1){var Kn=Gr[Zn],Di=Br[Kn],oi=Di[0],Ti=v.createExpression(Di[1]),di=v.createExpression(typeof oi=="string"?[oi,["accumulated"],["get",Kn]]:oi);Nr[Kn]=Ti.value,Bt[Kn]=di.value}return tr.map=function(Aa){Cr.properties=Aa;for(var Ni={},oo=0,mi=Ir;oo<mi.length;oo+=1){var Jn=mi[oo];Ni[Jn]=Nr[Jn].evaluate(Fr,Cr)}return Ni},tr.reduce=function(Aa,Ni){Cr.properties=Ni;for(var oo=0,mi=Ir;oo<mi.length;oo+=1){var Jn=mi[oo];Fr.accumulated=Aa[Jn],Aa[Jn]=Bt[Jn].evaluate(Fr,Cr)}},tr}(de)).load(ee.features):function(Ct,tr){return new Le(Ct,tr)}(ee,de.geojsonVtOptions)}catch(Ct){return $(Ct)}j.loaded={};var Dt={};if(Ie){var ir=Ie.finish();ir&&(Dt.resourceTiming={},Dt.resourceTiming[de.source]=JSON.parse(JSON.stringify(ir)))}$(null,Dt)})}},O.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},O.prototype.reloadTile=function(j,$){var de=this.loaded;return de&&de[j.uid]?L.prototype.reloadTile.call(this,j,$):this.loadTile(j,$)},O.prototype.loadGeoJSON=function(j,$){if(j.request)v.getJSON(j.request,$);else{if(typeof j.data!="string")return $(new Error("Input data given to '"+j.source+"' is not a valid GeoJSON object."));try{return $(null,JSON.parse(j.data))}catch(de){return $(new Error("Input data given to '"+j.source+"' is not a valid GeoJSON object."))}}},O.prototype.removeSource=function(j,$){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),$()},O.prototype.getClusterExpansionZoom=function(j,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(de){$(de)}},O.prototype.getClusterChildren=function(j,$){try{$(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(de){$(de)}},O.prototype.getClusterLeaves=function(j,$){try{$(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(de){$(de)}},O}(De),Ft=function(L){var O=this;this.self=L,this.actor=new v.Actor(L,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:De,geojson:ur},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(j,$){if(O.workerSourceTypes[j])throw new Error('Worker source with name "'+j+'" already registered.');O.workerSourceTypes[j]=$},this.self.registerRTLTextPlugin=function(j){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=j.applyArabicShaping,v.plugin.processBidirectionalText=j.processBidirectionalText,v.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}};return Ft.prototype.setReferrer=function(L,O){this.referrer=O},Ft.prototype.setImages=function(L,O,j){for(var $ in this.availableImages[L]=O,this.workerSources[L]){var de=this.workerSources[L][$];for(var Ie in de)de[Ie].availableImages=O}j()},Ft.prototype.setLayers=function(L,O,j){this.getLayerIndex(L).replace(O),j()},Ft.prototype.updateLayers=function(L,O,j){this.getLayerIndex(L).update(O.layers,O.removedIds),j()},Ft.prototype.loadTile=function(L,O,j){this.getWorkerSource(L,O.type,O.source).loadTile(O,j)},Ft.prototype.loadDEMTile=function(L,O,j){this.getDEMWorkerSource(L,O.source).loadTile(O,j)},Ft.prototype.reloadTile=function(L,O,j){this.getWorkerSource(L,O.type,O.source).reloadTile(O,j)},Ft.prototype.abortTile=function(L,O,j){this.getWorkerSource(L,O.type,O.source).abortTile(O,j)},Ft.prototype.removeTile=function(L,O,j){this.getWorkerSource(L,O.type,O.source).removeTile(O,j)},Ft.prototype.removeDEMTile=function(L,O){this.getDEMWorkerSource(L,O.source).removeTile(O)},Ft.prototype.removeSource=function(L,O,j){if(this.workerSources[L]&&this.workerSources[L][O.type]&&this.workerSources[L][O.type][O.source]){var $=this.workerSources[L][O.type][O.source];delete this.workerSources[L][O.type][O.source],$.removeSource!==void 0?$.removeSource(O,j):j()}},Ft.prototype.loadWorkerSource=function(L,O,j){try{this.self.importScripts(O.url),j()}catch($){j($.toString())}},Ft.prototype.syncRTLPluginState=function(L,O,j){try{v.plugin.setState(O);var $=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&$!=null){this.self.importScripts($);var de=v.plugin.isParsed();j(de?void 0:new Error("RTL Text Plugin failed to import scripts from "+$),de)}}catch(Ie){j(Ie.toString())}},Ft.prototype.getAvailableImages=function(L){var O=this.availableImages[L];return O||(O=[]),O},Ft.prototype.getLayerIndex=function(L){var O=this.layerIndexes[L];return O||(O=this.layerIndexes[L]=new se),O},Ft.prototype.getWorkerSource=function(L,O,j){var $=this;return this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][O]||(this.workerSources[L][O]={}),this.workerSources[L][O][j]||(this.workerSources[L][O][j]=new this.workerSourceTypes[O]({send:function(de,Ie,Ze){$.actor.send(de,Ie,Ze,L)}},this.getLayerIndex(L),this.getAvailableImages(L))),this.workerSources[L][O][j]},Ft.prototype.getDEMWorkerSource=function(L,O){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][O]||(this.demWorkerSources[L][O]=new ht),this.demWorkerSources[L][O]},Ft.prototype.enforceCacheSizeLimit=function(L,O){v.enforceCacheSizeLimit(O)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ft(self)),Ft}),Qe(["./shared"],function(v){"use strict";var it=v.createCommonjsModule(function(l){function f(x){return!c(x)}function c(x){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,M,k=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(k);try{M=new Worker(X),T=!0}catch(oe){T=!1}return M&&M.terminate(),URL.revokeObjectURL(X),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var M=T.getContext("2d");if(!M)return!1;var k=M.getImageData(0,0,1,1);return k&&k.width===T.width}()?(d[S=x&&x.failIfMajorPerformanceCaveat]===void 0&&(d[S]=function(T){var M=function(X){var oe=document.createElement("canvas"),le=Object.create(f.webGLContextAttributes);return le.failIfMajorPerformanceCaveat=X,oe.probablySupportsContext?oe.probablySupportsContext("webgl",le)||oe.probablySupportsContext("experimental-webgl",le):oe.supportsContext?oe.supportsContext("webgl",le)||oe.supportsContext("experimental-webgl",le):oe.getContext("webgl",le)||oe.getContext("experimental-webgl",le)}(T);if(!M)return!1;var k=M.createShader(M.VERTEX_SHADER);return!(!k||M.isContextLost())&&(M.shaderSource(k,"void main() {}"),M.compileShader(k),M.getShaderParameter(k,M.COMPILE_STATUS)===!0)}(S)),d[S]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),V={create:function(l,f,c){var d=v.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},se=v.window.document&&v.window.document.documentElement.style;function W(l){if(!se)return l[0];for(var f=0;f<l.length;f++)if(l[f]in se)return l[f];return l[0]}var ne,G=W(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);V.disableDrag=function(){se&&G&&(ne=se[G],se[G]="none")},V.enableDrag=function(){se&&G&&(se[G]=ne)};var Ke=W(["transform","WebkitTransform"]);V.setTransform=function(l,f){l.style[Ke]=f};var De=!1;try{var ge=Object.defineProperty({},"passive",{get:function(){De=!0}});v.window.addEventListener("test",ge,ge),v.window.removeEventListener("test",ge,ge)}catch(l){De=!1}V.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&De?d:d.capture)},V.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&De?d:d.capture)};var ht=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",ht,!0)};function ae(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}V.suppressClick=function(){v.window.addEventListener("click",ht,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",ht,!0)},0)},V.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},V.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],x=0;x<f.length;x++)d.push(new v.Point(f[x].clientX-c.left-l.clientLeft,f[x].clientY-c.top-l.clientTop));return d},V.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},V.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var At=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,x=this.requestors;d<x.length;d+=1){var S=x[d];this._notify(S.ids,S.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var x=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),x=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),x=!1),this._validateContent(d.content,d)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),x=!1),x},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var x=0,S=0,T=c;S<T.length;S+=1){var M=T[S];if(M[0]<x||M[1]<M[0]||d<M[1])return!1;x=M[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var x=!0;if(!this.isLoaded())for(var S=0,T=c;S<T.length;S+=1)this.images[T[S]]||(x=!1);this.isLoaded()||x?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var x={},S=0,T=c;S<T.length;S+=1){var M=T[S];this.images[M]||this.fire(new v.Event("styleimagemissing",{id:M}));var k=this.images[M];k?x[M]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,hasRenderCallback:!!(k.userImage&&k.userImage.render)}:v.warnOnce('Image "'+M+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,x)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],x=this.getImage(c);if(!x)return null;if(d&&d.position.version===x.version)return d.position;if(d)d.position.version=x.version;else{var S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},T=new v.ImagePosition(S,x);this.patterns[c]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var x=v.potpack(c),S=x.w,T=x.h,M=this.atlasImage;for(var k in M.resize({width:S||1,height:T||1}),this.patterns){var X=this.patterns[k].bin,oe=X.x+1,le=X.y+1,he=this.images[k].data,Pe=he.width,we=he.height;v.RGBAImage.copy(he,M,{x:0,y:0},{x:oe,y:le},{width:Pe,height:we}),v.RGBAImage.copy(he,M,{x:0,y:we-1},{x:oe,y:le-1},{width:Pe,height:1}),v.RGBAImage.copy(he,M,{x:0,y:0},{x:oe,y:le+we},{width:Pe,height:1}),v.RGBAImage.copy(he,M,{x:Pe-1,y:0},{x:oe-1,y:le},{width:1,height:we}),v.RGBAImage.copy(he,M,{x:0,y:0},{x:oe+Pe,y:le},{width:1,height:we})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,x=c;d<x.length;d+=1){var S=x[d];if(!this.callbackDispatchedThisFrame[S]){this.callbackDispatchedThisFrame[S]=!0;var T=this.images[S];ae(T)&&this.updateImage(S,T)}}},f}(v.Evented),wt=pr,et=pr,mr=1e20;function pr(l,f,c,d,x,S){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=x||"sans-serif",this.fontWeight=S||"normal",this.radius=c||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function yn(l,f,c,d,x,S,T){for(var M=0;M<f;M++){for(var k=0;k<c;k++)d[k]=l[k*f+M];for(bi(d,x,S,T,c),k=0;k<c;k++)l[k*f+M]=x[k]}for(k=0;k<c;k++){for(M=0;M<f;M++)d[M]=l[k*f+M];for(bi(d,x,S,T,f),M=0;M<f;M++)l[k*f+M]=Math.sqrt(x[M])}}function bi(l,f,c,d,x){c[0]=0,d[0]=-mr,d[1]=+mr;for(var S=1,T=0;S<x;S++){for(var M=(l[S]+S*S-(l[c[T]]+c[T]*c[T]))/(2*S-2*c[T]);M<=d[T];)T--,M=(l[S]+S*S-(l[c[T]]+c[T]*c[T]))/(2*S-2*c[T]);c[++T]=S,d[T]=M,d[T+1]=+mr}for(S=0,T=0;S<x;S++){for(;d[T+1]<S;)T++;f[S]=(S-c[T])*(S-c[T])+l[c[T]]}}pr.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var x=f.data[4*d+3]/255;this.gridOuter[d]=x===1?0:x===0?mr:Math.pow(Math.max(0,.5-x),2),this.gridInner[d]=x===1?mr:x===0?0:Math.pow(Math.max(0,x-.5),2)}for(yn(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),yn(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},wt.default=et;var $n=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};$n.prototype.setURL=function(l){this.url=l},$n.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var x in l)for(var S=0,T=l[x];S<T.length;S+=1)d.push({stack:x,id:T[S]});v.asyncAll(d,function(M,k){var X=M.stack,oe=M.id,le=c.entries[X];le||(le=c.entries[X]={glyphs:{},requests:{},ranges:{}});var he=le.glyphs[oe];if(he===void 0){if(he=c._tinySDF(le,X,oe))return le.glyphs[oe]=he,void k(null,{stack:X,id:oe,glyph:he});var Pe=Math.floor(oe/256);if(256*Pe>65535)k(new Error("glyphs > 65535 not supported"));else if(le.ranges[Pe])k(null,{stack:X,id:oe,glyph:he});else{var we=le.requests[Pe];we||(we=le.requests[Pe]=[],$n.loadGlyphRange(X,Pe,c.url,c.requestManager,function(Xe,Ae){if(Ae){for(var We in Ae)c._doesCharSupportLocalGlyph(+We)||(le.glyphs[+We]=Ae[+We]);le.ranges[Pe]=!0}for(var nt=0,vt=we;nt<vt.length;nt+=1)(0,vt[nt])(Xe,Ae);delete le.requests[Pe]})),we.push(function(Xe,Ae){Xe?k(Xe):Ae&&k(null,{stack:X,id:oe,glyph:Ae[oe]||null})})}}else k(null,{stack:X,id:oe,glyph:he})},function(M,k){if(M)f(M);else if(k){for(var X={},oe=0,le=k;oe<le.length;oe+=1){var he=le[oe],Pe=he.stack,we=he.id,Xe=he.glyph;(X[Pe]||(X[Pe]={}))[we]=Xe&&{id:Xe.id,bitmap:Xe.bitmap.clone(),metrics:Xe.metrics}}f(null,X)}})},$n.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},$n.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var x=l.tinySDF;if(!x){var S="400";/bold/i.test(f)?S="900":/medium/i.test(f)?S="500":/light/i.test(f)&&(S="200"),x=l.tinySDF=new $n.TinySDF(24,3,8,.25,d,S)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},x.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},$n.loadGlyphRange=function(l,f,c,d,x){var S=256*f,T=S+255,M=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",S+"-"+T),v.ResourceType.Glyphs);v.getArrayBuffer(M,function(k,X){if(k)x(k);else if(X){for(var oe={},le=0,he=v.parseGlyphPBF(X);le<he.length;le+=1){var Pe=he[le];oe[Pe.id]=Pe}x(null,oe)}})},$n.TinySDF=wt;var Mt=function(){this.specification=v.styleSpec.light.position};Mt.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},Mt.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var ze=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new Mt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),Wt=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(ze),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(v.validateLight,c,d))for(var x in c){var S=c[x];v.endsWith(x,"-transition")?this._transitionable.setTransition(x.slice(0,-11),S):this._transitionable.setValue(x,S)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,x){return(!x||x.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),ct=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ct.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},ct.prototype.getDashRanges=function(l,f,c){var d=[],x=l.length%2==1?-l[l.length-1]*c:0,S=l[0]*c,T=!0;d.push({left:x,right:S,isDash:T,zeroLength:l[0]===0});for(var M=l[0],k=1;k<l.length;k++){var X=l[k];d.push({left:x=M*c,right:S=(M+=X)*c,isDash:T=!T,zeroLength:X===0})}return d},ct.prototype.addRoundDash=function(l,f,c){for(var d=f/2,x=-c;x<=c;x++)for(var S=this.width*(this.nextRow+c+x),T=0,M=l[T],k=0;k<this.width;k++){k/M.right>1&&(M=l[++T]);var X=Math.abs(k-M.left),oe=Math.abs(k-M.right),le=Math.min(X,oe),he=void 0,Pe=x/c*(d+1);if(M.isDash){var we=d-Math.abs(Pe);he=Math.sqrt(le*le+we*we)}else he=d-Math.sqrt(le*le+Pe*Pe);this.data[S+k]=Math.max(0,Math.min(255,he+128))}},ct.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var x=l[0],S=l[l.length-1];x.isDash===S.isDash&&(x.left=S.left-this.width,S.right=x.right+this.width);for(var T=this.width*this.nextRow,M=0,k=l[M],X=0;X<this.width;X++){X/k.right>1&&(k=l[++M]);var oe=Math.abs(X-k.left),le=Math.abs(X-k.right),he=Math.min(oe,le);this.data[T+X]=Math.max(0,Math.min(255,(k.isDash?he:-he)+128))}},ct.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var x=0,S=0;S<l.length;S++)x+=l[S];if(x!==0){var T=this.width/x,M=this.getDashRanges(l,this.width,T);f?this.addRoundDash(M,T,c):this.addRegularDash(M)}var k={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:x};return this.nextRow+=d,this.dirty=!0,k},ct.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var nr=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var d=this.workerPool.acquire(this.id),x=0;x<d.length;x++){var S=new l.Actor(d[x],c,this.id);S.name="Worker "+x,this.actors.push(S)}};function Lr(l,f,c){var d=function(x,S){if(x)return c(x);if(S){var T=v.pick(v.extend(S,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(T.vectorLayers=S.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(M){return M.id})),T.tiles=f.canonicalizeTileset(T,l.url),c(null,T)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),d):v.browser.frame(function(){return d(null,l)})}nr.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(d,x){d.send(l,f,x)},c=c||function(){})},nr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},nr.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},nr.Actor=v.Actor;var K=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};K.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},K.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),x=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),S=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<x&&l.y>=d&&l.y<S};var _e=function(l){function f(c,d,x,S){if(l.call(this),this.id=c,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(d,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lr(this._options,this.map._requestManager,function(d,x){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):x&&(v.extend(c,x),x.bounds&&(c.tileBounds=new K(x.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(x.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(x.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,d){var x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(x,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(M,k){return delete c.request,c.aborted?d(null):M&&M.status!==404?d(M):(k&&k.resourceTiming&&(c.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&c.setExpiryData(k),c.loadVectorData(k,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",S,T.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",S,T.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Y=function(l){function f(c,d,x,S){l.call(this),this.id=c,this.dispatcher=x,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},d),v.extend(this,v.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Lr(this._options,this.map._requestManager,function(d,x){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):x&&(v.extend(c,x),x.bounds&&(c.tileBounds=new K(x.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(x.tiles),v.postMapLoadEvent(x.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var x=this,S=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(S,v.ResourceType.Tile),function(T,M){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(T)c.state="errored",d(T);else if(M){x.map._refreshExpiredTiles&&c.setExpiryData(M),delete M.cacheControl,delete M.expires;var k=x.map.painter.context,X=k.gl;c.texture=x.map.painter.getTileTexture(M.width),c.texture?c.texture.update(M,{useMipmap:!0}):(c.texture=new v.Texture(k,M,X.RGBA,{useMipmap:!0}),c.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),k.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(x.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),ve=function(l){function f(c,d,x,S){l.call(this,c,d,x,S),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function S(T,M){T&&(c.state="errored",d(T)),M&&(c.dem=M,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=v.getImage(this.map._requestManager.transformRequest(x,v.ResourceType.Tile),function(T,M){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(T)c.state="errored",d(T);else if(M){this.map._refreshExpiredTiles&&c.setExpiryData(M),delete M.cacheControl,delete M.expires;var k=v.window.ImageBitmap&&M instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?M:v.browser.getImageData(M,1),X={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:k,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",X,S.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,x=Math.pow(2,d.z),S=(d.x-1+x)%x,T=d.x===0?c.wrap-1:c.wrap,M=(d.x+1+x)%x,k=d.x+1===x?c.wrap+1:c.wrap,X={};return X[new v.OverscaledTileID(c.overscaledZ,T,d.z,S,d.y).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,k,d.z,M,d.y).key]={backfilled:!1},d.y>0&&(X[new v.OverscaledTileID(c.overscaledZ,T,d.z,S,d.y-1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,k,d.z,M,d.y-1).key]={backfilled:!1}),d.y+1<x&&(X[new v.OverscaledTileID(c.overscaledZ,T,d.z,S,d.y+1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},X[new v.OverscaledTileID(c.overscaledZ,k,d.z,M,d.y+1).key]={backfilled:!1}),X},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(Y),fe=function(l){function f(c,d,x,S){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=x.getActor(),this.setEventedParent(S),this._data=d.data,this._options=v.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var T=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*T,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*T,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:v.EXTENT,radius:(d.clusterRadius||50)*T,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new v.ErrorEvent(d));else{var x={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(x.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",x))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(x){if(x)d.fire(new v.ErrorEvent(x));else{var S={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(S.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new v.Event("data",S))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,x,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:x},S),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var x=v.extend({},this.workerOptions),S=this._data;typeof S=="string"?(x.request=this.map._requestManager.transformRequest(v.browser.resolveURL(S),v.ResourceType.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(S),this.actor.send(this.type+".loadData",x,function(T,M){d._removed||M&&M.abandoned||(d._loaded=!0,M&&M.resourceTiming&&M.resourceTiming[d.id]&&(d._resourceTiming=M.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:x.source},null),c(T))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var x=this,S=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(S,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,M){return delete c.request,c.unloadVectorData(),c.aborted?d(null):T?d(T):(c.loadVectorData(M,x.map.painter,S==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),He=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),at=function(l){function f(c,d,x,S){l.call(this),this.id=c,this.dispatcher=x,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var x=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(S,T){x._loaded=!0,S?x.fire(new v.ErrorEvent(S)):T&&(x.image=T,c&&(x.coordinates=c),d&&d(),x._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var x=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var M=1/0,k=1/0,X=-1/0,oe=-1/0,le=0,he=T;le<he.length;le+=1){var Pe=he[le];M=Math.min(M,Pe.x),k=Math.min(k,Pe.y),X=Math.max(X,Pe.x),oe=Math.max(oe,Pe.y)}var we=Math.max(X-M,oe-k),Xe=Math.max(0,Math.floor(-Math.log(we)/Math.LN2)),Ae=Math.pow(2,Xe);return new v.CanonicalTileID(Xe,Math.floor((M+X)/2*Ae),Math.floor((k+oe)/2*Ae))}(x),this.minzoom=this.maxzoom=this.tileID.z;var S=x.map(function(T){return d.tileID.getTilePoint(T)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),_t=function(l){function f(c,d,x,S){l.call(this,c,d,x,S),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var x=0,S=d.urls;x<S.length;x+=1)this.urls.push(this.map._requestManager.transformRequest(S[x],v.ResourceType.Source).url);v.getVideo(this.urls,function(T,M){c._loaded=!0,T?c.fire(new v.ErrorEvent(T)):M&&(c.video=M,c.video.loop=!0,c.video.setAttribute("playsinline",""),c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(at),Tt=function(l){function f(c,d,x,S){l.call(this,c,d,x,S),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(M){return typeof M!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,x=d.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,He.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(d,this.canvas,x.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var x=d[c];if(isNaN(x)||x<=0)return!0}return!1},f}(at),Pt={vector:_e,raster:Y,"raster-dem":ve,geojson:fe,video:_t,image:at,canvas:Tt};function Xr(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function zr(l,f,c,d,x,S){var T=function(Xe,Ae,We){if(Xe)for(var nt=0,vt=Xe;nt<vt.length;nt+=1){var Vt=Ae[vt[nt]];if(Vt&&Vt.source===We&&Vt.type==="fill-extrusion")return!0}else for(var Rt in Ae){var Xt=Ae[Rt];if(Xt.source===We&&Xt.type==="fill-extrusion")return!0}return!1}(x&&x.layers,f,l.id),M=S.maxPitchScaleFactor(),k=l.tilesIn(d,M,T);k.sort(gn);for(var X=[],oe=0,le=k;oe<le.length;oe+=1){var he=le[oe];X.push({wrappedTileID:he.tileID.wrapped().key,queryResults:he.tile.queryRenderedFeatures(f,c,l._state,he.queryGeometry,he.cameraQueryGeometry,he.scale,x,S,M,Xr(l.transform,he.tileID))})}var Pe=function(Xe){for(var Ae={},We={},nt=0,vt=Xe;nt<vt.length;nt+=1){var Vt=vt[nt],Rt=Vt.queryResults,Xt=Vt.wrappedTileID,or=We[Xt]=We[Xt]||{};for(var Pr in Rt)for(var wr=Rt[Pr],en=or[Pr]=or[Pr]||{},An=Ae[Pr]=Ae[Pr]||[],Cn=0,vn=wr;Cn<vn.length;Cn+=1){var wi=vn[Cn];en[wi.featureIndex]||(en[wi.featureIndex]=!0,An.push(wi))}}return Ae}(X);for(var we in Pe)Pe[we].forEach(function(Xe){var Ae=Xe.feature,We=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=We});return Pe}function gn(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Qr=function(l,f){this.max=l,this.onRemove=f,this.reset()};Qr.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Qr.prototype.add=function(l,f,c){var d=this,x=l.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);var S={value:f,timeout:void 0};if(c!==void 0&&(S.timeout=setTimeout(function(){d.remove(l,S)},c)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},Qr.prototype.has=function(l){return l.wrapped().key in this.data},Qr.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Qr.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Qr.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Qr.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Qr.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),x=this.data[c][d];return this.data[c].splice(d,1),x.timeout&&clearTimeout(x.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(x.value),this.order.splice(this.order.indexOf(c),1),this},Qr.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Qr.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,x=this.data[c];d<x.length;d+=1){var S=x[d];l(S.value)||f.push(S)}for(var T=0,M=f;T<M.length;T+=1){var k=M[T];this.remove(k.value.tileID,k)}};var Fn=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Fn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Fn.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Fn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var bn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},dn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var x=l.gl;this.buffer=x.createBuffer(),l.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};dn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},dn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},dn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},dn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var x=this.attributes[d],S=f.attributes[x.name];S!==void 0&&l.vertexAttribPointer(S,x.components,l[bn[x.type]],!1,this.itemSize,x.offset+this.itemSize*(c||0))}},dn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var un=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};un.prototype.get=function(){return this.current},un.prototype.set=function(l){},un.prototype.getDefault=function(){return this.default},un.prototype.setDefault=function(){this.set(this.default)};var Qn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(un),Vr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(un),Dn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(un),Wr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(un),Jr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(un),ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(un),gi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(un),Eo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(un),$i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(un),ue=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(un),Xi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(un),co=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(un),bo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(un),Sa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(un),da=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(un),Ds=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(un),Xo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(un),Xs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(un),vu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(un),Vo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(un),fo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(un),ho=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(un),pt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(un),Z=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(un),Q=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(un),Ee=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(un),Ve=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(un),Le=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(un),jt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(un),Zt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(un),ur=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(un),Ft=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(un),L=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Ft),O=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Ft),j=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var x=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new L(l,x),d&&(this.depthAttachment=new O(l,x))};j.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var $=function(l,f,c){this.func=l,this.mask=f,this.range=c};$.ReadOnly=!1,$.ReadWrite=!0,$.disabled=new $(519,$.ReadOnly,[0,1]);var de=function(l,f,c,d,x,S){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=x,this.pass=S};de.disabled=new de({func:519,mask:0},0,0,7680,7680,7680);var Ie=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ie.disabled=new Ie(Ie.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ie.unblended=new Ie(Ie.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ie.alphaBlended=new Ie([1,771],v.Color.transparent,[!0,!0,!0,!0]);var Ze=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};Ze.disabled=new Ze(!1,1029,2305),Ze.backCCW=new Ze(!0,1029,2305);var ee=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Qn(this),this.clearDepth=new Vr(this),this.clearStencil=new Dn(this),this.colorMask=new Wr(this),this.depthMask=new Jr(this),this.stencilMask=new ji(this),this.stencilFunc=new gi(this),this.stencilOp=new Eo(this),this.stencilTest=new $i(this),this.depthRange=new ue(this),this.depthTest=new Xi(this),this.depthFunc=new co(this),this.blend=new bo(this),this.blendFunc=new Sa(this),this.blendColor=new da(this),this.blendEquation=new Ds(this),this.cullFace=new Xo(this),this.cullFaceSide=new Xs(this),this.frontFace=new vu(this),this.program=new Vo(this),this.activeTexture=new fo(this),this.viewport=new ho(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new Z(this),this.bindTexture=new Q(this),this.bindVertexBuffer=new Ee(this),this.bindElementBuffer=new Ve(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Le(this),this.pixelStoreUnpack=new jt(this),this.pixelStoreUnpackPremultiplyAlpha=new Zt(this),this.pixelStoreUnpackFlipY=new ur(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ee.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ee.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ee.prototype.createIndexBuffer=function(l,f){return new Fn(this,l,f)},ee.prototype.createVertexBuffer=function(l,f,c){return new dn(this,l,f,c)},ee.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,x=d.createRenderbuffer();return this.bindRenderbuffer.set(x),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),x},ee.prototype.createFramebuffer=function(l,f,c){return new j(this,l,f,c)},ee.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,x=0;f&&(x|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(x|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(x)},ee.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ee.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ee.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ee.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,Ie.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ee.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var be=function(l){function f(c,d,x){var S=this;l.call(this),this.id=c,this.dispatcher=x,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(S._sourceLoaded=!0),S._sourceLoaded&&!S._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(S.reload(),S.transform&&S.update(S.transform))}),this.on("error",function(){S._sourceErrored=!0}),this._source=function(T,M,k,X){var oe=new Pt[M.type](T,M,k,X);if(oe.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+oe.id);return v.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(c,d,x,this),this._tiles={},this._cache=new Qr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var x=this._tiles[d];x.upload(c),x.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(ut).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,x=[];for(var S in this._tiles)this._isIdRenderable(S,c)&&x.push(this._tiles[S]);return c?x.sort(function(T,M){var k=T.tileID,X=M.tileID,oe=new v.Point(k.canonical.x,k.canonical.y)._rotate(d.transform.angle),le=new v.Point(X.canonical.x,X.canonical.y)._rotate(d.transform.angle);return k.overscaledZ-X.overscaledZ||le.y-oe.y||le.x-oe.x}).map(function(T){return T.tileID.key}):x.map(function(T){return T.tileID}).sort(ut).map(function(T){return T.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var x=this._tiles[c];x&&(x.state!=="loading"&&(x.state=d),this._loadTile(x,this._tileLoaded.bind(this,x,c,d)))},f.prototype._tileLoaded=function(c,d,x,S){if(S)return c.state="errored",void(S.status!==404?this._source.fire(new v.ErrorEvent(S,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),x==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),x=0;x<d.length;x++){var S=d[x];if(c.neighboringTiles&&c.neighboringTiles[S]){var T=this.getTileByID(S);M(c,T),M(T,c)}}function M(k,X){k.needsHillshadePrepare=!0;var oe=X.tileID.canonical.x-k.tileID.canonical.x,le=X.tileID.canonical.y-k.tileID.canonical.y,he=Math.pow(2,k.tileID.canonical.z),Pe=X.tileID.key;oe===0&&le===0||Math.abs(le)>1||(Math.abs(oe)>1&&(Math.abs(oe+he)===1?oe+=he:Math.abs(oe-he)===1&&(oe-=he)),X.dem&&k.dem&&(k.dem.backfillBorder(X.dem,oe,le),k.neighboringTiles&&k.neighboringTiles[Pe]&&(k.neighboringTiles[Pe].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,x,S){for(var T in this._tiles){var M=this._tiles[T];if(!(S[T]||!M.hasData()||M.tileID.overscaledZ<=d||M.tileID.overscaledZ>x)){for(var k=M.tileID;M&&M.tileID.overscaledZ>d+1;){var X=M.tileID.scaledTo(M.tileID.overscaledZ-1);(M=this._tiles[X.key])&&M.hasData()&&(k=X)}for(var oe=k;oe.overscaledZ>d;)if(c[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){S[k.key]=k;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var x=this._loadedParentTiles[c.key];return x&&x.tileID.overscaledZ>=d?x:null}for(var S=c.overscaledZ-1;S>=d;S--){var T=c.scaledTo(S),M=this._getLoadedTile(T);if(M)return M}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,x=Math.ceil(c.height/this._source.tileSize)+1,S=Math.floor(d*x*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(T)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var x={};for(var S in this._tiles){var T=this._tiles[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+d),x[T.tileID.key]=T}for(var M in this._tiles=x,this._timers)clearTimeout(this._timers[M]),delete this._timers[M];for(var k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var x;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?x=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(or){return new v.OverscaledTileID(or.canonical.z,or.wrap,or.canonical.z,or.canonical.x,or.canonical.y)}):(x=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(x=x.filter(function(or){return d._source.hasTile(or)}))):x=[];var S=c.coveringZoomLevel(this._source),T=Math.max(S-f.maxOverzooming,this._source.minzoom),M=Math.max(S+f.maxUnderzooming,this._source.minzoom),k=this._updateRetainedTiles(x,S);if(Dt(this._source.type)){for(var X={},oe={},le=0,he=Object.keys(k);le<he.length;le+=1){var Pe=he[le],we=k[Pe],Xe=this._tiles[Pe];if(Xe&&!(Xe.fadeEndTime&&Xe.fadeEndTime<=v.browser.now())){var Ae=this.findLoadedParent(we,T);Ae&&(this._addTile(Ae.tileID),X[Ae.tileID.key]=Ae.tileID),oe[Pe]=we}}for(var We in this._retainLoadedChildren(oe,S,M,k),X)k[We]||(this._coveredTiles[We]=!0,k[We]=X[We])}for(var nt in k)this._tiles[nt].clearFadeHold();for(var vt=0,Vt=v.keysDifference(this._tiles,k);vt<Vt.length;vt+=1){var Rt=Vt[vt],Xt=this._tiles[Rt];Xt.hasSymbolBuckets&&!Xt.holdingForFade()?Xt.setHoldDuration(this.map._fadeDuration):Xt.hasSymbolBuckets&&!Xt.symbolFadeFinished()||this._removeTile(Rt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var x={},S={},T=Math.max(d-f.maxOverzooming,this._source.minzoom),M=Math.max(d+f.maxUnderzooming,this._source.minzoom),k={},X=0,oe=c;X<oe.length;X+=1){var le=oe[X],he=this._addTile(le);x[le.key]=le,he.hasData()||d<this._source.maxzoom&&(k[le.key]=le)}this._retainLoadedChildren(k,d,M,x);for(var Pe=0,we=c;Pe<we.length;Pe+=1){var Xe=we[Pe],Ae=this._tiles[Xe.key];if(!Ae.hasData()){if(d+1>this._source.maxzoom){var We=Xe.children(this._source.maxzoom)[0],nt=this.getTile(We);if(nt&&nt.hasData()){x[We.key]=We;continue}}else{var vt=Xe.children(this._source.maxzoom);if(x[vt[0].key]&&x[vt[1].key]&&x[vt[2].key]&&x[vt[3].key])continue}for(var Vt=Ae.wasRequested(),Rt=Xe.overscaledZ-1;Rt>=T;--Rt){var Xt=Xe.scaledTo(Rt);if(S[Xt.key]||(S[Xt.key]=!0,!(Ae=this.getTile(Xt))&&Vt&&(Ae=this._addTile(Xt)),Ae&&(x[Xt.key]=Xt,Vt=Ae.wasRequested(),Ae.hasData())))break}}}return x},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],x=void 0,S=this._tiles[c].tileID;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){x=this._loadedParentTiles[S.key];break}d.push(S.key);var T=S.scaledTo(S.overscaledZ-1);if(x=this._getLoadedTile(T))break;S=T}for(var M=0,k=d;M<k.length;M+=1)this._loadedParentTiles[k[M]]=x}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var x=!!d;return x||(d=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,x||this._source.fire(new v.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var x=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var S=d.getExpiryTimeout();S&&(this._timers[c]=setTimeout(function(){x._reloadTile(c,"expired"),delete x._timers[c]},S))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,x){var S=this,T=[],M=this.transform;if(!M)return T;for(var k=x?M.getCameraQueryGeometry(c):c,X=c.map(function(Rt){return M.pointCoordinate(Rt)}),oe=k.map(function(Rt){return M.pointCoordinate(Rt)}),le=this.getIds(),he=1/0,Pe=1/0,we=-1/0,Xe=-1/0,Ae=0,We=oe;Ae<We.length;Ae+=1){var nt=We[Ae];he=Math.min(he,nt.x),Pe=Math.min(Pe,nt.y),we=Math.max(we,nt.x),Xe=Math.max(Xe,nt.y)}for(var vt=function(Rt){var Xt=S._tiles[le[Rt]];if(!Xt.holdingForFade()){var or=Xt.tileID,Pr=Math.pow(2,M.zoom-Xt.tileID.overscaledZ),wr=d*Xt.queryPadding*v.EXTENT/Xt.tileSize/Pr,en=[or.getTilePoint(new v.MercatorCoordinate(he,Pe)),or.getTilePoint(new v.MercatorCoordinate(we,Xe))];if(en[0].x-wr<v.EXTENT&&en[0].y-wr<v.EXTENT&&en[1].x+wr>=0&&en[1].y+wr>=0){var An=X.map(function(vn){return or.getTilePoint(vn)}),Cn=oe.map(function(vn){return or.getTilePoint(vn)});T.push({tile:Xt,tileID:or,queryGeometry:An,cameraQueryGeometry:Cn,scale:Pr})}}},Vt=0;Vt<le.length;Vt++)vt(Vt);return T},f.prototype.getVisibleCoordinates=function(c){for(var d=this,x=this.getRenderableIds(c).map(function(k){return d._tiles[k].tileID}),S=0,T=x;S<T.length;S+=1){var M=T[S];M.posMatrix=this.transform.calculatePosMatrix(M.toUnwrapped())}return x},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Dt(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,x){this._state.updateState(c=c||"_geojsonTileLayer",d,x)},f.prototype.removeFeatureState=function(c,d,x){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,x)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,x){var S=this._tiles[c];S&&S.setDependencies(d,x)},f.prototype.reloadTilesForDependencies=function(c,d){for(var x in this._tiles)this._tiles[x].hasDependency(c,d)&&this._reloadTile(x,"reloading");this._cache.filter(function(S){return!S.hasDependency(c,d)})},f}(v.Evented);function ut(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function Dt(l){return l==="raster"||l==="image"||l==="video"}function ir(){return new v.window.Worker(sc.workerUrl)}be.maxOverzooming=10,be.maxUnderzooming=3;var Ct="mapboxgl_preloaded_worker_pool",tr=function(){this.active={}};tr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<tr.workerCount;)this.workers.push(new ir);return this.active[l]=!0,this.workers.slice()},tr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},tr.prototype.isPreloaded=function(){return!!this.active[Ct]},tr.prototype.numActive=function(){return Object.keys(this.active).length};var Br,Nr=Math.floor(v.browser.hardwareConcurrency/2);function Bt(){return Br||(Br=new tr),Br}function Fr(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return v.refProperties.forEach(function(x){x in f&&(c[x]=f[x])}),c}function Cr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=Fr(l[d],f[l[d].ref]));return l}tr.workerCount=Math.max(Math.min(Nr,6),1);var Ir={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Zn(l,f,c){c.push({command:Ir.addSource,args:[l,f[l]]})}function Gr(l,f,c){f.push({command:Ir.removeSource,args:[l]}),c[l]=!0}function Kn(l,f,c,d){Gr(l,c,d),Zn(l,f,c)}function Di(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;return!0}function oi(l,f,c,d,x,S){var T;for(T in f=f||{},l=l||{})l.hasOwnProperty(T)&&(v.deepEqual(l[T],f[T])||c.push({command:S,args:[d,T,f[T],x]}));for(T in f)f.hasOwnProperty(T)&&!l.hasOwnProperty(T)&&(v.deepEqual(l[T],f[T])||c.push({command:S,args:[d,T,f[T],x]}))}function Ti(l){return l.id}function di(l,f){return l[f.id]=f,l}var Aa=function(l,f){this.reset(l,f)};Aa.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Aa.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var x=f-1,S=this._distances[x],T=c-S,M=T>0?(d-S)/T:0;return this.points[x].mult(1-M).add(this.points[f].mult(M))};var Ni=function(l,f,c){var d=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var S=0;S<this.xCellCount*this.yCellCount;S++)d.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function oo(l,f,c,d,x){var S=v.create();return f?(v.scale(S,S,[1/x,1/x,1]),c||v.rotateZ(S,S,d.angle)):v.multiply(S,d.labelPlaneMatrix,l),S}function mi(l,f,c,d,x){if(f){var S=v.clone(l);return v.scale(S,S,[x,x,1]),c||v.rotateZ(S,S,-d.angle),S}return d.glCoordMatrix}function Jn(l,f){var c=[l.x,l.y,0,1];So(c,c,f);var d=c[3];return{point:new v.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function ui(l,f){return .5+l/f*.5}function To(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function Ls(l,f,c,d,x,S,T,M){var k=d?l.textSizeData:l.iconSizeData,X=v.evaluateSizeForZoom(k,c.transform.zoom),oe=[256/c.width*2+1,256/c.height*2+1],le=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;le.clear();for(var he=l.lineVertexArray,Pe=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,we=c.transform.width/c.transform.height,Xe=!1,Ae=0;Ae<Pe.length;Ae++){var We=Pe.get(Ae);if(We.hidden||We.writingMode===v.WritingMode.vertical&&!Xe)ao(We.numGlyphs,le);else{Xe=!1;var nt=[We.anchorX,We.anchorY,0,1];if(v.transformMat4(nt,nt,f),To(nt,oe)){var vt=ui(c.transform.cameraToCenterDistance,nt[3]),Vt=v.evaluateSizeForFeature(k,X,We),Rt=T?Vt/vt:Vt*vt,Xt=new v.Point(We.anchorX,We.anchorY),or=Jn(Xt,x).point,Pr={},wr=_u(We,Rt,!1,M,f,x,S,l.glyphOffsetArray,he,le,or,Xt,Pr,we);Xe=wr.useVertical,(wr.notEnoughRoom||Xe||wr.needsFlipping&&_u(We,Rt,!0,M,f,x,S,l.glyphOffsetArray,he,le,or,Xt,Pr,we).notEnoughRoom)&&ao(We.numGlyphs,le)}else ao(We.numGlyphs,le)}}d?l.text.dynamicLayoutVertexBuffer.updateData(le):l.icon.dynamicLayoutVertexBuffer.updateData(le)}function ro(l,f,c,d,x,S,T,M,k,X,oe){var le=M.glyphStartIndex+M.numGlyphs,he=M.lineStartIndex,Pe=M.lineStartIndex+M.lineLength,we=f.getoffsetX(M.glyphStartIndex),Xe=f.getoffsetX(le-1),Ae=Yi(l*we,c,d,x,S,T,M.segment,he,Pe,k,X,oe);if(!Ae)return null;var We=Yi(l*Xe,c,d,x,S,T,M.segment,he,Pe,k,X,oe);return We?{first:Ae,last:We}:null}function po(l,f,c,d){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function _u(l,f,c,d,x,S,T,M,k,X,oe,le,he,Pe){var we,Xe=f/24,Ae=l.lineOffsetX*Xe,We=l.lineOffsetY*Xe;if(l.numGlyphs>1){var nt=l.glyphStartIndex+l.numGlyphs,vt=l.lineStartIndex,Vt=l.lineStartIndex+l.lineLength,Rt=ro(Xe,M,Ae,We,c,oe,le,l,k,S,he);if(!Rt)return{notEnoughRoom:!0};var Xt=Jn(Rt.first.point,T).point,or=Jn(Rt.last.point,T).point;if(d&&!c){var Pr=po(l.writingMode,Xt,or,Pe);if(Pr)return Pr}we=[Rt.first];for(var wr=l.glyphStartIndex+1;wr<nt-1;wr++)we.push(Yi(Xe*M.getoffsetX(wr),Ae,We,c,oe,le,l.segment,vt,Vt,k,S,he));we.push(Rt.last)}else{if(d&&!c){var en=Jn(le,x).point,An=l.lineStartIndex+l.segment+1,Cn=new v.Point(k.getx(An),k.gety(An)),vn=Jn(Cn,x),wi=vn.signedDistanceFromCamera>0?vn.point:ms(le,Cn,en,1,x),Kr=po(l.writingMode,en,wi,Pe);if(Kr)return Kr}var Hn=Yi(Xe*M.getoffsetX(l.glyphStartIndex),Ae,We,c,oe,le,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,k,S,he);if(!Hn)return{notEnoughRoom:!0};we=[Hn]}for(var si=0,jn=we;si<jn.length;si+=1){var Un=jn[si];v.addDynamicAttributes(X,Un.point,Un.angle)}return{}}function ms(l,f,c,d,x){var S=Jn(l.add(l.sub(f)._unit()),x).point,T=c.sub(S);return c.add(T._mult(d/T.mag()))}function Yi(l,f,c,d,x,S,T,M,k,X,oe,le){var he=d?l-f:l+f,Pe=he>0?1:-1,we=0;d&&(Pe*=-1,we=Math.PI),Pe<0&&(we+=Math.PI);for(var Xe=Pe>0?M+T:M+T+1,Ae=x,We=x,nt=0,vt=0,Vt=Math.abs(he),Rt=[];nt+vt<=Vt;){if((Xe+=Pe)<M||Xe>=k)return null;if(We=Ae,Rt.push(Ae),(Ae=le[Xe])===void 0){var Xt=new v.Point(X.getx(Xe),X.gety(Xe)),or=Jn(Xt,oe);if(or.signedDistanceFromCamera>0)Ae=le[Xe]=or.point;else{var Pr=Xe-Pe;Ae=ms(nt===0?S:new v.Point(X.getx(Pr),X.gety(Pr)),Xt,We,Vt-nt+1,oe)}}nt+=vt,vt=We.dist(Ae)}var wr=(Vt-nt)/vt,en=Ae.sub(We),An=en.mult(wr)._add(We);An._add(en._unit()._perp()._mult(c*Pe));var Cn=we+Math.atan2(Ae.y-We.y,Ae.x-We.x);return Rt.push(An),{point:An,angle:Cn,path:Rt}}Ni.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ni.prototype.insert=function(l,f,c,d,x){this._forEachCell(f,c,d,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(x)},Ni.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Ni.prototype._insertBoxCell=function(l,f,c,d,x,S){this.boxCells[x].push(S)},Ni.prototype._insertCircleCell=function(l,f,c,d,x,S){this.circleCells[x].push(S)},Ni.prototype._query=function(l,f,c,d,x,S){if(c<0||l>this.width||d<0||f>this.height)return!x&&[];var T=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(x)return!0;for(var M=0;M<this.boxKeys.length;M++)T.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(var k=0;k<this.circleKeys.length;k++){var X=this.circles[3*k],oe=this.circles[3*k+1],le=this.circles[3*k+2];T.push({key:this.circleKeys[k],x1:X-le,y1:oe-le,x2:X+le,y2:oe+le})}return S?T.filter(S):T}return this._forEachCell(l,f,c,d,this._queryCell,T,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?T.length>0:T},Ni.prototype._queryCircle=function(l,f,c,d,x){var S=l-c,T=l+c,M=f-c,k=f+c;if(T<0||S>this.width||k<0||M>this.height)return!d&&[];var X=[];return this._forEachCell(S,M,T,k,this._queryCellCircle,X,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},x),d?X.length>0:X},Ni.prototype.query=function(l,f,c,d,x){return this._query(l,f,c,d,!1,x)},Ni.prototype.hitTest=function(l,f,c,d,x){return this._query(l,f,c,d,!0,x)},Ni.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Ni.prototype._queryCell=function(l,f,c,d,x,S,T,M){var k=T.seenUids,X=this.boxCells[x];if(X!==null)for(var oe=this.bboxes,le=0,he=X;le<he.length;le+=1){var Pe=he[le];if(!k.box[Pe]){k.box[Pe]=!0;var we=4*Pe;if(l<=oe[we+2]&&f<=oe[we+3]&&c>=oe[we+0]&&d>=oe[we+1]&&(!M||M(this.boxKeys[Pe]))){if(T.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Pe],x1:oe[we],y1:oe[we+1],x2:oe[we+2],y2:oe[we+3]})}}}var Xe=this.circleCells[x];if(Xe!==null)for(var Ae=this.circles,We=0,nt=Xe;We<nt.length;We+=1){var vt=nt[We];if(!k.circle[vt]){k.circle[vt]=!0;var Vt=3*vt;if(this._circleAndRectCollide(Ae[Vt],Ae[Vt+1],Ae[Vt+2],l,f,c,d)&&(!M||M(this.circleKeys[vt]))){if(T.hitTest)return S.push(!0),!0;var Rt=Ae[Vt],Xt=Ae[Vt+1],or=Ae[Vt+2];S.push({key:this.circleKeys[vt],x1:Rt-or,y1:Xt-or,x2:Rt+or,y2:Xt+or})}}}},Ni.prototype._queryCellCircle=function(l,f,c,d,x,S,T,M){var k=T.circle,X=T.seenUids,oe=this.boxCells[x];if(oe!==null)for(var le=this.bboxes,he=0,Pe=oe;he<Pe.length;he+=1){var we=Pe[he];if(!X.box[we]){X.box[we]=!0;var Xe=4*we;if(this._circleAndRectCollide(k.x,k.y,k.radius,le[Xe+0],le[Xe+1],le[Xe+2],le[Xe+3])&&(!M||M(this.boxKeys[we])))return S.push(!0),!0}}var Ae=this.circleCells[x];if(Ae!==null)for(var We=this.circles,nt=0,vt=Ae;nt<vt.length;nt+=1){var Vt=vt[nt];if(!X.circle[Vt]){X.circle[Vt]=!0;var Rt=3*Vt;if(this._circlesCollide(We[Rt],We[Rt+1],We[Rt+2],k.x,k.y,k.radius)&&(!M||M(this.circleKeys[Vt])))return S.push(!0),!0}}},Ni.prototype._forEachCell=function(l,f,c,d,x,S,T,M){for(var k=this._convertToXCellCoord(l),X=this._convertToYCellCoord(f),oe=this._convertToXCellCoord(c),le=this._convertToYCellCoord(d),he=k;he<=oe;he++)for(var Pe=X;Pe<=le;Pe++)if(x.call(this,l,f,c,d,this.xCellCount*Pe+he,S,T,M))return},Ni.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Ni.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Ni.prototype._circlesCollide=function(l,f,c,d,x,S){var T=d-l,M=x-f,k=c+S;return k*k>T*T+M*M},Ni.prototype._circleAndRectCollide=function(l,f,c,d,x,S,T){var M=(S-d)/2,k=Math.abs(l-(d+M));if(k>M+c)return!1;var X=(T-x)/2,oe=Math.abs(f-(x+X));if(oe>X+c)return!1;if(k<=M||oe<=X)return!0;var le=k-M,he=oe-X;return le*le+he*he<=c*c};var ra=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ao(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(ra,3*d)}}function So(l,f,c){var d=f[0],x=f[1];return l[0]=c[0]*d+c[4]*x+c[12],l[1]=c[1]*d+c[5]*x+c[13],l[3]=c[3]*d+c[7]*x+c[15],l}var Fa=function(l,f,c){f===void 0&&(f=new Ni(l.width+200,l.height+200,25)),c===void 0&&(c=new Ni(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Qi(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Fa.prototype.placeCollisionBox=function(l,f,c,d,x){var S=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),T=c*S.perspectiveRatio,M=l.x1*T+S.point.x,k=l.y1*T+S.point.y,X=l.x2*T+S.point.x,oe=l.y2*T+S.point.y;return!this.isInsideGrid(M,k,X,oe)||!f&&this.grid.hitTest(M,k,X,oe,x)?{box:[],offscreen:!1}:{box:[M,k,X,oe],offscreen:this.isOffscreen(M,k,X,oe)}},Fa.prototype.placeCollisionCircles=function(l,f,c,d,x,S,T,M,k,X,oe,le,he){var Pe=[],we=new v.Point(f.anchorX,f.anchorY),Xe=Jn(we,S),Ae=ui(this.transform.cameraToCenterDistance,Xe.signedDistanceFromCamera),We=(X?x/Ae:x*Ae)/v.ONE_EM,nt=Jn(we,T).point,vt=ro(We,d,f.lineOffsetX*We,f.lineOffsetY*We,!1,nt,we,f,c,T,{}),Vt=!1,Rt=!1,Xt=!0;if(vt){for(var or=.5*le*Ae+he,Pr=new v.Point(-100,-100),wr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),en=new Aa,An=vt.first,Cn=vt.last,vn=[],wi=An.path.length-1;wi>=1;wi--)vn.push(An.path[wi]);for(var Kr=1;Kr<Cn.path.length;Kr++)vn.push(Cn.path[Kr]);var Hn=2.5*or;if(M){var si=vn.map(function(Cs){return Jn(Cs,M)});vn=si.some(function(Cs){return Cs.signedDistanceFromCamera<=0})?[]:si.map(function(Cs){return Cs.point})}var jn=[];if(vn.length>0){for(var Un=vn[0].clone(),ei=vn[0].clone(),Bn=1;Bn<vn.length;Bn++)Un.x=Math.min(Un.x,vn[Bn].x),Un.y=Math.min(Un.y,vn[Bn].y),ei.x=Math.max(ei.x,vn[Bn].x),ei.y=Math.max(ei.y,vn[Bn].y);jn=Un.x>=Pr.x&&ei.x<=wr.x&&Un.y>=Pr.y&&ei.y<=wr.y?[vn]:ei.x<Pr.x||Un.x>wr.x||ei.y<Pr.y||Un.y>wr.y?[]:v.clipLine([vn],Pr.x,Pr.y,wr.x,wr.y)}for(var On=0,Oo=jn;On<Oo.length;On+=1){var Do;en.reset(Oo[On],.25*or),Do=en.length<=.5*or?1:Math.ceil(en.paddedLength/Hn)+1;for(var Ra=0;Ra<Do;Ra++){var va=Ra/Math.max(Do-1,1),Ao=en.lerp(va),Lo=Ao.x+100,Ja=Ao.y+100;Pe.push(Lo,Ja,or,0);var Na=Lo-or,lu=Ja-or,Ya=Lo+or,Zs=Ja+or;if(Xt=Xt&&this.isOffscreen(Na,lu,Ya,Zs),Rt=Rt||this.isInsideGrid(Na,lu,Ya,Zs),!l&&this.grid.hitTestCircle(Lo,Ja,or,oe)&&(Vt=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Vt}}}}return{circles:!k&&Vt||!Rt?[]:Pe,offscreen:Xt,collisionDetected:Vt}},Fa.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,x=-1/0,S=-1/0,T=0,M=l;T<M.length;T+=1){var k=M[T],X=new v.Point(k.x+100,k.y+100);c=Math.min(c,X.x),d=Math.min(d,X.y),x=Math.max(x,X.x),S=Math.max(S,X.y),f.push(X)}for(var oe={},le={},he=0,Pe=this.grid.query(c,d,x,S).concat(this.ignoredGrid.query(c,d,x,S));he<Pe.length;he+=1){var we=Pe[he],Xe=we.key;if(oe[Xe.bucketInstanceId]===void 0&&(oe[Xe.bucketInstanceId]={}),!oe[Xe.bucketInstanceId][Xe.featureIndex]){var Ae=[new v.Point(we.x1,we.y1),new v.Point(we.x2,we.y1),new v.Point(we.x2,we.y2),new v.Point(we.x1,we.y2)];v.polygonIntersectsPolygon(f,Ae)&&(oe[Xe.bucketInstanceId][Xe.featureIndex]=!0,le[Xe.bucketInstanceId]===void 0&&(le[Xe.bucketInstanceId]=[]),le[Xe.bucketInstanceId].push(Xe.featureIndex))}}return le},Fa.prototype.insertCollisionBox=function(l,f,c,d,x){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:x},l[0],l[1],l[2],l[3])},Fa.prototype.insertCollisionCircles=function(l,f,c,d,x){for(var S=f?this.ignoredGrid:this.grid,T={bucketInstanceId:c,featureIndex:d,collisionGroupID:x},M=0;M<l.length;M+=4)S.insertCircle(T,l[M],l[M+1],l[M+2])},Fa.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return So(d,d,l),{point:new v.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Fa.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},Fa.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},Fa.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var Wa=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};Wa.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ba=function(l,f,c,d,x){this.text=new Wa(l?l.text:null,f,c,x),this.icon=new Wa(l?l.icon:null,f,d,x)};Ba.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var gu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},vs=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Rc=function(l,f,c,d,x){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=x},Zo=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function qi(l,f,c,d,x){var S=v.getAnchorAlignment(l),T=-(S.horizontalAlign-.5)*f,M=-(S.verticalAlign-.5)*c,k=v.evaluateVariableOffset(l,d);return new v.Point(T+k[0]*x,M+k[1]*x)}function Qa(l,f,c,d,x,S){var T=l.x1,M=l.x2,k=l.y1,X=l.y2,oe=l.anchorPointX,le=l.anchorPointY,he=new v.Point(f,c);return d&&he._rotate(x?S:-S),{x1:T+he.x,y1:k+he.y,x2:M+he.x,y2:X+he.y,anchorPointX:oe,anchorPointY:le}}Zo.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var na=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new Fa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Zo(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function ie(l,f,c,d,x){l.emplaceBack(f?1:0,c?1:0,d||0,x||0),l.emplaceBack(f?1:0,c?1:0,d||0,x||0),l.emplaceBack(f?1:0,c?1:0,d||0,x||0),l.emplaceBack(f?1:0,c?1:0,d||0,x||0)}na.prototype.getBucketParts=function(l,f,c,d){var x=c.getBucket(f),S=c.latestFeatureIndex;if(x&&S&&f.id===x.layerIds[0]){var T=c.collisionBoxArray,M=x.layers[0].layout,k=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),X=c.tileSize/v.EXTENT,oe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),le=M.get("text-pitch-alignment")==="map",he=M.get("text-rotation-alignment")==="map",Pe=Qi(c,1,this.transform.zoom),we=oo(oe,le,he,this.transform,Pe),Xe=null;if(le){var Ae=mi(oe,le,he,this.transform,Pe);Xe=v.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[x.bucketInstanceId]=new Rc(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,c.tileID);var We={bucket:x,layout:M,posMatrix:oe,textLabelPlaneMatrix:we,labelToScreenMatrix:Xe,scale:k,textPixelRatio:X,holdingForFade:c.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(d)for(var nt=0,vt=x.sortKeyRanges;nt<vt.length;nt+=1){var Vt=vt[nt];l.push({sortKey:Vt.sortKey,symbolInstanceStart:Vt.symbolInstanceStart,symbolInstanceEnd:Vt.symbolInstanceEnd,parameters:We})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:We})}},na.prototype.attemptAnchorPlacement=function(l,f,c,d,x,S,T,M,k,X,oe,le,he,Pe,we){var Xe,Ae=[le.textOffset0,le.textOffset1],We=qi(l,c,d,Ae,x),nt=this.collisionIndex.placeCollisionBox(Qa(f,We.x,We.y,S,T,this.transform.angle),oe,M,k,X.predicate);if(!we||this.collisionIndex.placeCollisionBox(Qa(we,We.x,We.y,S,T,this.transform.angle),oe,M,k,X.predicate).box.length!==0)return nt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID].text&&(Xe=this.prevPlacement.variableOffsets[le.crossTileID].anchor),this.variableOffsets[le.crossTileID]={textOffset:Ae,width:c,height:d,anchor:l,textBoxScale:x,prevAnchor:Xe},this.markUsedJustification(he,l,le,Pe),he.allowVerticalPlacement&&(this.markUsedOrientation(he,Pe,le),this.placedOrientations[le.crossTileID]=Pe),{shift:We,placedGlyphBoxes:nt}):void 0},na.prototype.placeLayerBucketPart=function(l,f,c){var d=this,x=l.parameters,S=x.bucket,T=x.layout,M=x.posMatrix,k=x.textLabelPlaneMatrix,X=x.labelToScreenMatrix,oe=x.textPixelRatio,le=x.holdingForFade,he=x.collisionBoxArray,Pe=x.partiallyEvaluatedTextSize,we=x.collisionGroup,Xe=T.get("text-optional"),Ae=T.get("icon-optional"),We=T.get("text-allow-overlap"),nt=T.get("icon-allow-overlap"),vt=T.get("text-rotation-alignment")==="map",Vt=T.get("text-pitch-alignment")==="map",Rt=T.get("icon-text-fit")!=="none",Xt=T.get("symbol-z-order")==="viewport-y",or=We&&(nt||!S.hasIconData()||Ae),Pr=nt&&(We||!S.hasTextData()||Xe);!S.collisionArrays&&he&&S.deserializeCollisionBoxes(he);var wr=function(Kr,Hn){if(!f[Kr.crossTileID])if(le)d.placements[Kr.crossTileID]=new gu(!1,!1,!1);else{var si,jn=!1,Un=!1,ei=!0,Bn=null,On={box:null,offscreen:null},Oo={box:null,offscreen:null},Do=null,Ra=null,va=0,Ao=0,Lo=0;Hn.textFeatureIndex?va=Hn.textFeatureIndex:Kr.useRuntimeCollisionCircles&&(va=Kr.featureIndex),Hn.verticalTextFeatureIndex&&(Ao=Hn.verticalTextFeatureIndex);var Ja=Hn.textBox;if(Ja){var Na=function(yi){var Ma=v.WritingMode.horizontal;if(S.allowVerticalPlacement&&!yi&&d.prevPlacement){var Fo=d.prevPlacement.placedOrientations[Kr.crossTileID];Fo&&(d.placedOrientations[Kr.crossTileID]=Fo,d.markUsedOrientation(S,Ma=Fo,Kr))}return Ma},lu=function(yi,Ma){if(S.allowVerticalPlacement&&Kr.numVerticalGlyphVertices>0&&Hn.verticalTextBox)for(var Fo=0,Mu=S.writingModes;Fo<Mu.length&&(Mu[Fo]===v.WritingMode.vertical?(On=Ma(),Oo=On):On=yi(),!(On&&On.box&&On.box.length));Fo+=1);else On=yi()};if(T.get("text-variable-anchor")){var Ya=T.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[Kr.crossTileID]){var Zs=d.prevPlacement.variableOffsets[Kr.crossTileID];Ya.indexOf(Zs.anchor)>0&&(Ya=Ya.filter(function(yi){return yi!==Zs.anchor})).unshift(Zs.anchor)}var Cs=function(yi,Ma,Fo){for(var Mu=yi.x2-yi.x1,lc=yi.y2-yi.y1,hl=Kr.textBoxScale,cc=Rt&&!nt?Ma:null,pl={box:[],offscreen:!1},qu=We?2*Ya.length:Ya.length,js=0;js<qu;++js){var jc=d.attemptAnchorPlacement(Ya[js%Ya.length],yi,Mu,lc,hl,vt,Vt,oe,M,we,js>=Ya.length,Kr,S,Fo,cc);if(jc&&(pl=jc.placedGlyphBoxes)&&pl.box&&pl.box.length){jn=!0,Bn=jc.shift;break}}return pl};lu(function(){return Cs(Ja,Hn.iconBox,v.WritingMode.horizontal)},function(){var yi=Hn.verticalTextBox;return S.allowVerticalPlacement&&!(On&&On.box&&On.box.length)&&Kr.numVerticalGlyphVertices>0&&yi?Cs(yi,Hn.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),On&&(jn=On.box,ei=On.offscreen);var uc=Na(On&&On.box);if(!jn&&d.prevPlacement){var Fl=d.prevPlacement.variableOffsets[Kr.crossTileID];Fl&&(d.variableOffsets[Kr.crossTileID]=Fl,d.markUsedJustification(S,Fl.anchor,Kr,uc))}}else{var Ru=function(yi,Ma){var Fo=d.collisionIndex.placeCollisionBox(yi,We,oe,M,we.predicate);return Fo&&Fo.box&&Fo.box.length&&(d.markUsedOrientation(S,Ma,Kr),d.placedOrientations[Kr.crossTileID]=Ma),Fo};lu(function(){return Ru(Ja,v.WritingMode.horizontal)},function(){var yi=Hn.verticalTextBox;return S.allowVerticalPlacement&&Kr.numVerticalGlyphVertices>0&&yi?Ru(yi,v.WritingMode.vertical):{box:null,offscreen:null}}),Na(On&&On.box&&On.box.length)}}if(jn=(si=On)&&si.box&&si.box.length>0,ei=si&&si.offscreen,Kr.useRuntimeCollisionCircles){var Gu=S.text.placedSymbolArray.get(Kr.centerJustifiedTextSymbolIndex),Xu=v.evaluateSizeForFeature(S.textSizeData,Pe,Gu),cu=T.get("text-padding");Do=d.collisionIndex.placeCollisionCircles(We,Gu,S.lineVertexArray,S.glyphOffsetArray,Xu,M,k,X,c,Vt,we.predicate,Kr.collisionCircleDiameter,cu),jn=We||Do.circles.length>0&&!Do.collisionDetected,ei=ei&&Do.offscreen}if(Hn.iconFeatureIndex&&(Lo=Hn.iconFeatureIndex),Hn.iconBox){var Yu=function(yi){var Ma=Rt&&Bn?Qa(yi,Bn.x,Bn.y,vt,Vt,d.transform.angle):yi;return d.collisionIndex.placeCollisionBox(Ma,nt,oe,M,we.predicate)};Un=Oo&&Oo.box&&Oo.box.length&&Hn.verticalIconBox?(Ra=Yu(Hn.verticalIconBox)).box.length>0:(Ra=Yu(Hn.iconBox)).box.length>0,ei=ei&&Ra.offscreen}var ka=Xe||Kr.numHorizontalGlyphVertices===0&&Kr.numVerticalGlyphVertices===0,Ho=Ae||Kr.numIconVertices===0;if(ka||Ho?Ho?ka||(Un=Un&&jn):jn=Un&&jn:Un=jn=Un&&jn,jn&&si&&si.box&&d.collisionIndex.insertCollisionBox(si.box,T.get("text-ignore-placement"),S.bucketInstanceId,Oo&&Oo.box&&Ao?Ao:va,we.ID),Un&&Ra&&d.collisionIndex.insertCollisionBox(Ra.box,T.get("icon-ignore-placement"),S.bucketInstanceId,Lo,we.ID),Do&&(jn&&d.collisionIndex.insertCollisionCircles(Do.circles,T.get("text-ignore-placement"),S.bucketInstanceId,va,we.ID),c)){var ls=S.bucketInstanceId,tu=d.collisionCircleArrays[ls];tu===void 0&&(tu=d.collisionCircleArrays[ls]=new vs);for(var fu=0;fu<Do.circles.length;fu+=4)tu.circles.push(Do.circles[fu+0]),tu.circles.push(Do.circles[fu+1]),tu.circles.push(Do.circles[fu+2]),tu.circles.push(Do.collisionDetected?1:0)}d.placements[Kr.crossTileID]=new gu(jn||or,Un||Pr,ei||S.justReloaded),f[Kr.crossTileID]=!0}};if(Xt)for(var en=S.getSortedSymbolIndexes(this.transform.angle),An=en.length-1;An>=0;--An){var Cn=en[An];wr(S.symbolInstances.get(Cn),S.collisionArrays[Cn])}else for(var vn=l.symbolInstanceStart;vn<l.symbolInstanceEnd;vn++)wr(S.symbolInstances.get(vn),S.collisionArrays[vn]);if(c&&S.bucketInstanceId in this.collisionCircleArrays){var wi=this.collisionCircleArrays[S.bucketInstanceId];v.invert(wi.invProjMatrix,M),wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1},na.prototype.markUsedJustification=function(l,f,c,d){var x;x=d===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var S=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];S<T.length;S+=1){var M=T[S];M>=0&&(l.text.placedSymbolArray.get(M).crossTileID=x>=0&&M!==x?0:c.crossTileID)}},na.prototype.markUsedOrientation=function(l,f,c){for(var d=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,x=f===v.WritingMode.vertical?f:0,S=0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];S<T.length;S+=1)l.text.placedSymbolArray.get(T[S]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=x)},na.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,x=f?f.opacities:{},S=f?f.variableOffsets:{},T=f?f.placedOrientations:{};for(var M in this.placements){var k=this.placements[M],X=x[M];X?(this.opacities[M]=new Ba(X,d,k.text,k.icon),c=c||k.text!==X.text.placed||k.icon!==X.icon.placed):(this.opacities[M]=new Ba(null,d,k.text,k.icon,k.skipFade),c=c||k.text||k.icon)}for(var oe in x){var le=x[oe];if(!this.opacities[oe]){var he=new Ba(le,d,!1,!1);he.isHidden()||(this.opacities[oe]=he,c=c||le.text.placed||le.icon.placed)}}for(var Pe in S)this.variableOffsets[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.variableOffsets[Pe]=S[Pe]);for(var we in T)this.placedOrientations[we]||!this.opacities[we]||this.opacities[we].isHidden()||(this.placedOrientations[we]=T[we]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},na.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,x=f;d<x.length;d+=1){var S=x[d],T=S.getBucket(l);T&&S.latestFeatureIndex&&l.id===T.layerIds[0]&&this.updateBucketOpacities(T,c,S.collisionBoxArray)}},na.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var x=l.layers[0].layout,S=new Ba(null,0,!1,!1,!0),T=x.get("text-allow-overlap"),M=x.get("icon-allow-overlap"),k=x.get("text-variable-anchor"),X=x.get("text-rotation-alignment")==="map",oe=x.get("text-pitch-alignment")==="map",le=x.get("icon-text-fit")!=="none",he=new Ba(null,0,T&&(M||!l.hasIconData()||x.get("icon-optional")),M&&(T||!l.hasTextData()||x.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Pe=function(We,nt,vt){for(var Vt=0;Vt<nt/4;Vt++)We.opacityVertexArray.emplaceBack(vt)},we=function(We){var nt=l.symbolInstances.get(We),vt=nt.numHorizontalGlyphVertices,Vt=nt.numVerticalGlyphVertices,Rt=nt.crossTileID,Xt=d.opacities[Rt];f[Rt]?Xt=S:Xt||(d.opacities[Rt]=Xt=he),f[Rt]=!0;var or=nt.numIconVertices>0,Pr=d.placedOrientations[nt.crossTileID],wr=Pr===v.WritingMode.vertical,en=Pr===v.WritingMode.horizontal||Pr===v.WritingMode.horizontalOnly;if(vt>0||Vt>0){var An=ia(Xt.text);Pe(l.text,vt,wr?qo:An),Pe(l.text,Vt,en?qo:An);var Cn=Xt.text.isHidden();[nt.rightJustifiedTextSymbolIndex,nt.centerJustifiedTextSymbolIndex,nt.leftJustifiedTextSymbolIndex].forEach(function(On){On>=0&&(l.text.placedSymbolArray.get(On).hidden=Cn||wr?1:0)}),nt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(nt.verticalPlacedTextSymbolIndex).hidden=Cn||en?1:0);var vn=d.variableOffsets[nt.crossTileID];vn&&d.markUsedJustification(l,vn.anchor,nt,Pr);var wi=d.placedOrientations[nt.crossTileID];wi&&(d.markUsedJustification(l,"left",nt,wi),d.markUsedOrientation(l,wi,nt))}if(or){var Kr=ia(Xt.icon),Hn=!(le&&nt.verticalPlacedIconSymbolIndex&&wr);nt.placedIconSymbolIndex>=0&&(Pe(l.icon,nt.numIconVertices,Hn?Kr:qo),l.icon.placedSymbolArray.get(nt.placedIconSymbolIndex).hidden=Xt.icon.isHidden()),nt.verticalPlacedIconSymbolIndex>=0&&(Pe(l.icon,nt.numVerticalIconVertices,Hn?qo:Kr),l.icon.placedSymbolArray.get(nt.verticalPlacedIconSymbolIndex).hidden=Xt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var si=l.collisionArrays[We];if(si){var jn=new v.Point(0,0);if(si.textBox||si.verticalTextBox){var Un=!0;if(k){var ei=d.variableOffsets[Rt];ei?(jn=qi(ei.anchor,ei.width,ei.height,ei.textOffset,ei.textBoxScale),X&&jn._rotate(oe?d.transform.angle:-d.transform.angle)):Un=!1}si.textBox&&ie(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Un||wr,jn.x,jn.y),si.verticalTextBox&&ie(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Un||en,jn.x,jn.y)}var Bn=!!(!en&&si.verticalIconBox);si.iconBox&&ie(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,Bn,le?jn.x:0,le?jn.y:0),si.verticalIconBox&&ie(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,!Bn,le?jn.x:0,le?jn.y:0)}}},Xe=0;Xe<l.symbolInstances.length;Xe++)we(Xe);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},na.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},na.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},na.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},na.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},na.prototype.setStale=function(){this.stale=!0};var ye=Math.pow(2,25),Je=Math.pow(2,24),Gt=Math.pow(2,17),Er=Math.pow(2,16),mn=Math.pow(2,9),Ci=Math.pow(2,8),Yo=Math.pow(2,1);function ia(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*ye+f*Je+c*Gt+f*Er+c*mn+f*Ci+c*Yo+f}var qo=0,_s=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};_s.prototype.continuePlacement=function(l,f,c,d,x){for(var S=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(S,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(function(T,M){return T.sortKey-M.sortKey}));this._currentPartIndex<S.length;)if(f.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,x())return!0;return!1};var gs=function(l,f,c,d,x,S,T){this.placement=new na(l,x,S,T),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};gs.prototype.isDone=function(){return this._done},gs.prototype.continuePlacement=function(l,f,c){for(var d=this,x=v.browser.now(),S=function(){var k=v.browser.now()-x;return!d._forceFullPlacement&&k>2};this._currentPlacementIndex>=0;){var T=f[l[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=M)&&(!T.maxzoom||T.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new _s(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},gs.prototype.commit=function(l){return this.placement.commit(l),this.placement};var of=512/v.EXTENT/2,Rf=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var x=f.get(d),S=x.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,l)})}};Rf.prototype.getScaledCoordinates=function(l,f){var c=of/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},Rf.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),x=0;x<l.length;x++){var S=l.get(x);if(!S.crossTileID){var T=this.indexedSymbolInstances[S.key];if(T)for(var M=this.getScaledCoordinates(S,f),k=0,X=T;k<X.length;k+=1){var oe=X[k];if(Math.abs(oe.coord.x-M.x)<=d&&Math.abs(oe.coord.y-M.y)<=d&&!c[oe.crossTileID]){c[oe.crossTileID]=!0,S.crossTileID=oe.crossTileID;break}}}}};var ai=function(){this.maxCrossTileID=0};ai.prototype.generate=function(){return++this.maxCrossTileID};var ys=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ys.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],x={};for(var S in d){var T=d[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+f),x[T.tileID.key]=T}this.indexes[c]=x}this.lng=l},ys.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var x=this.usedCrossTileIDs[l.overscaledZ];for(var S in this.indexes){var T=this.indexes[S];if(Number(S)>l.overscaledZ)for(var M in T){var k=T[M];k.tileID.isChildOf(l)&&k.findMatches(f.symbolInstances,l,x)}else{var X=T[l.scaledTo(Number(S)).key];X&&X.findMatches(f.symbolInstances,l,x)}}for(var oe=0;oe<f.symbolInstances.length;oe++){var le=f.symbolInstances.get(oe);le.crossTileID||(le.crossTileID=c.generate(),x[le.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Rf(l,f.symbolInstances,f.bucketInstanceId),!0},ys.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,x=f.indexedSymbolInstances[c];d<x.length;d+=1)delete this.usedCrossTileIDs[l][x[d].crossTileID]},ys.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var x in d)l[d[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[x]),delete d[x],f=!0)}return f};var Fs=function(){this.layerIndexes={},this.crossTileIDs=new ai,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Fs.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new ys);var x=!1,S={};d.handleWrapJump(c);for(var T=0,M=f;T<M.length;T+=1){var k=M[T],X=k.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(k.tileID,X,this.crossTileIDs)&&(x=!0),S[X.bucketInstanceId]=!0)}return d.removeStaleBuckets(S)&&(x=!0),x},Fs.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var au=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},yu=v.pick(Ir,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Nu=v.pick(Ir,["setCenter","setZoom","setBearing","setPitch"]),Mc=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var d,x=v.styleSpec.$root[c];x.required&&(d=c==="version"?f:x.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),xs=function(l){function f(c,d){var x=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new nr(Bt(),this),this.imageManager=new At,this.imageManager.setEventedParent(this),this.glyphManager=new $n(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new ct(256,512),this.crossTileSymbolIndex=new Fs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var S=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(T){S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(M,k){if(v.triggerPluginCompletionEvent(M),k&&k.every(function(oe){return oe}))for(var X in S.sourceCaches)S.sourceCaches[X].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var M=x.sourceCaches[T.sourceId];if(M){var k=M.getSource();if(k&&k.vectorLayerIds)for(var X in x._layers){var oe=x._layers[X];oe.source===k.id&&x._validateLayer(oe)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var x=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var S=typeof d.validate=="boolean"?d.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var T=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(T,function(M,k){x._request=null,M?x.fire(new v.ErrorEvent(M)):k&&x._load(k,S)})},f.prototype.loadJSON=function(c,d){var x=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){x._request=null,x._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(Mc,!1)},f.prototype._load=function(c,d){if(!d||!au(this,v.validateStyle(c))){for(var x in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(x,c.sources[x],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var S=Cr(this.stylesheet.layers);this._order=S.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var T=0,M=S;T<M.length;T+=1){var k=M[T];(k=v.createStyleLayer(k)).setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Wt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(x,S,T){var M,k,X,oe=v.browser.devicePixelRatio>1?"@2x":"",le=v.getJSON(S.transformRequest(S.normalizeSpriteURL(x,oe,".json"),v.ResourceType.SpriteJSON),function(we,Xe){le=null,X||(X=we,M=Xe,Pe())}),he=v.getImage(S.transformRequest(S.normalizeSpriteURL(x,oe,".png"),v.ResourceType.SpriteImage),function(we,Xe){he=null,X||(X=we,k=Xe,Pe())});function Pe(){if(X)T(X);else if(M&&k){var we=v.browser.getImageData(k),Xe={};for(var Ae in M){var We=M[Ae],nt=We.width,vt=We.height,Vt=We.x,Rt=We.y,Xt=We.sdf,or=We.pixelRatio,Pr=We.stretchX,wr=We.stretchY,en=We.content,An=new v.RGBAImage({width:nt,height:vt});v.RGBAImage.copy(we,An,{x:Vt,y:Rt},{x:0,y:0},{width:nt,height:vt}),Xe[Ae]={data:An,pixelRatio:or,sdf:Xt,stretchX:Pr,stretchY:wr,content:en}}T(null,Xe)}}return{cancel:function(){le&&(le.cancel(),le=null),he&&(he.cancel(),he=null)}}}(c,this.map._requestManager,function(x,S){if(d._spriteRequest=null,x)d.fire(new v.ErrorEvent(x));else if(S)for(var T in S)d.imageManager.addImage(T,S[T]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var x=c.sourceLayer;if(x){var S=d.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(x)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+x+'" does not exist on source "'+S.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],x=0,S=c;x<S.length;x+=1){var T=this._layers[S[x]];T.type!=="custom"&&d.push(T.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);for(var T in(x.length||S.length)&&this._updateWorkerLayers(x,S),this._updatedSources){var M=this._updatedSources[T];M==="reload"?this._reloadSource(T):M==="clear"&&this._clearSource(T)}for(var k in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[k].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var X={};for(var oe in this.sourceCaches){var le=this.sourceCaches[oe];X[oe]=le.used,le.used=!1}for(var he=0,Pe=this._order;he<Pe.length;he+=1){var we=this._layers[Pe[he]];we.recalculate(c,this._availableImages),!we.isHidden(c.zoom)&&we.source&&(this.sourceCaches[we.source].used=!0)}for(var Xe in X){var Ae=this.sourceCaches[Xe];X[Xe]!==Ae.used&&Ae.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Xe}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),au(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Cr(c.layers);var x=function(T,M){if(!T)return[{command:Ir.setStyle,args:[M]}];var k=[];try{if(!v.deepEqual(T.version,M.version))return[{command:Ir.setStyle,args:[M]}];v.deepEqual(T.center,M.center)||k.push({command:Ir.setCenter,args:[M.center]}),v.deepEqual(T.zoom,M.zoom)||k.push({command:Ir.setZoom,args:[M.zoom]}),v.deepEqual(T.bearing,M.bearing)||k.push({command:Ir.setBearing,args:[M.bearing]}),v.deepEqual(T.pitch,M.pitch)||k.push({command:Ir.setPitch,args:[M.pitch]}),v.deepEqual(T.sprite,M.sprite)||k.push({command:Ir.setSprite,args:[M.sprite]}),v.deepEqual(T.glyphs,M.glyphs)||k.push({command:Ir.setGlyphs,args:[M.glyphs]}),v.deepEqual(T.transition,M.transition)||k.push({command:Ir.setTransition,args:[M.transition]}),v.deepEqual(T.light,M.light)||k.push({command:Ir.setLight,args:[M.light]});var X={},oe=[];(function(he,Pe,we,Xe){var Ae;for(Ae in Pe=Pe||{},he=he||{})he.hasOwnProperty(Ae)&&(Pe.hasOwnProperty(Ae)||Gr(Ae,we,Xe));for(Ae in Pe)Pe.hasOwnProperty(Ae)&&(he.hasOwnProperty(Ae)?v.deepEqual(he[Ae],Pe[Ae])||(he[Ae].type==="geojson"&&Pe[Ae].type==="geojson"&&Di(he,Pe,Ae)?we.push({command:Ir.setGeoJSONSourceData,args:[Ae,Pe[Ae].data]}):Kn(Ae,Pe,we,Xe)):Zn(Ae,Pe,we))})(T.sources,M.sources,oe,X);var le=[];T.layers&&T.layers.forEach(function(he){X[he.source]?k.push({command:Ir.removeLayer,args:[he.id]}):le.push(he)}),k=k.concat(oe),function(he,Pe,we){Pe=Pe||[];var Xe,Ae,We,nt,vt,Vt,Rt,Xt=(he=he||[]).map(Ti),or=Pe.map(Ti),Pr=he.reduce(di,{}),wr=Pe.reduce(di,{}),en=Xt.slice(),An=Object.create(null);for(Xe=0,Ae=0;Xe<Xt.length;Xe++)wr.hasOwnProperty(We=Xt[Xe])?Ae++:(we.push({command:Ir.removeLayer,args:[We]}),en.splice(en.indexOf(We,Ae),1));for(Xe=0,Ae=0;Xe<or.length;Xe++)en[en.length-1-Xe]!==(We=or[or.length-1-Xe])&&(Pr.hasOwnProperty(We)?(we.push({command:Ir.removeLayer,args:[We]}),en.splice(en.lastIndexOf(We,en.length-Ae),1)):Ae++,we.push({command:Ir.addLayer,args:[wr[We],Vt=en[en.length-Xe]]}),en.splice(en.length-Xe,0,We),An[We]=!0);for(Xe=0;Xe<or.length;Xe++)if(nt=Pr[We=or[Xe]],vt=wr[We],!An[We]&&!v.deepEqual(nt,vt))if(v.deepEqual(nt.source,vt.source)&&v.deepEqual(nt["source-layer"],vt["source-layer"])&&v.deepEqual(nt.type,vt.type)){for(Rt in oi(nt.layout,vt.layout,we,We,null,Ir.setLayoutProperty),oi(nt.paint,vt.paint,we,We,null,Ir.setPaintProperty),v.deepEqual(nt.filter,vt.filter)||we.push({command:Ir.setFilter,args:[We,vt.filter]}),v.deepEqual(nt.minzoom,vt.minzoom)&&v.deepEqual(nt.maxzoom,vt.maxzoom)||we.push({command:Ir.setLayerZoomRange,args:[We,vt.minzoom,vt.maxzoom]}),nt)nt.hasOwnProperty(Rt)&&Rt!=="layout"&&Rt!=="paint"&&Rt!=="filter"&&Rt!=="metadata"&&Rt!=="minzoom"&&Rt!=="maxzoom"&&(Rt.indexOf("paint.")===0?oi(nt[Rt],vt[Rt],we,We,Rt.slice(6),Ir.setPaintProperty):v.deepEqual(nt[Rt],vt[Rt])||we.push({command:Ir.setLayerProperty,args:[We,Rt,vt[Rt]]}));for(Rt in vt)vt.hasOwnProperty(Rt)&&!nt.hasOwnProperty(Rt)&&Rt!=="layout"&&Rt!=="paint"&&Rt!=="filter"&&Rt!=="metadata"&&Rt!=="minzoom"&&Rt!=="maxzoom"&&(Rt.indexOf("paint.")===0?oi(nt[Rt],vt[Rt],we,We,Rt.slice(6),Ir.setPaintProperty):v.deepEqual(nt[Rt],vt[Rt])||we.push({command:Ir.setLayerProperty,args:[We,Rt,vt[Rt]]}))}else we.push({command:Ir.removeLayer,args:[We]}),Vt=en[en.lastIndexOf(We)+1],we.push({command:Ir.addLayer,args:[vt,Vt]})}(le,M.layers,k)}catch(he){console.warn("Unable to compute style diff:",he),k=[{command:Ir.setStyle,args:[M]}]}return k}(this.serialize(),c).filter(function(T){return!(T.command in Nu)});if(x.length===0)return!1;var S=x.filter(function(T){return!(T.command in yu)});if(S.length>0)throw new Error("Unimplemented: "+S.map(function(T){return T.command}).join(", ")+".");return x.forEach(function(T){T.command!=="setTransition"&&d[T.command].apply(d,T.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,x){var S=this;if(x===void 0&&(x={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,d,null,x))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var T=this.sourceCaches[c]=new be(c,d,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:S.loaded(),source:T.serialize(),sourceId:c}}),T.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var x=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],x.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),x.setEventedParent(null),x.clearTiles(),x.onRemove&&x.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,x){x===void 0&&(x={}),this._checkLoaded();var S=c.id;if(this.getLayer(S))this.fire(new v.ErrorEvent(new Error('Layer with id "'+S+'" already exists on this map')));else{var T;if(c.type==="custom"){if(au(this,v.validateCustomStyleLayer(c)))return;T=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(S,c.source),c=v.clone$1(c),c=v.extend(c,{source:S})),this._validate(v.validateStyle.layer,"layers."+S,c,{arrayIndex:-1},x))return;T=v.createStyleLayer(c),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize()}var M=d?this._order.indexOf(d):this._order.length;if(d&&M===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(M,0,S),this._layerOrderChanged=!0,this._layers[S]=T,this._removedLayers[S]&&T.source&&T.type!=="custom"){var k=this._removedLayers[S];delete this._removedLayers[S],k.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var x=this._order.indexOf(c);this._order.splice(x,1);var S=d?this._order.indexOf(d):this._order.length;d&&S===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(S,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var x=this._order.indexOf(c);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,x){this._checkLoaded();var S=this.getLayer(c);S?S.minzoom===d&&S.maxzoom===x||(d!=null&&(S.minzoom=d),x!=null&&(S.maxzoom=x),this._updateLayer(S)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,x){x===void 0&&(x={}),this._checkLoaded();var S=this.getLayer(c);if(S){if(!v.deepEqual(S.filter,d))return d==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(v.validateStyle.filter,"layers."+S.id+".filter",d,null,x)||(S.filter=v.clone$1(d),this._updateLayer(S)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,x,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(c);T?v.deepEqual(T.getLayoutProperty(d),x)||(T.setLayoutProperty(d,x,S),this._updateLayer(T)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var x=this.getLayer(c);if(x)return x.getLayoutProperty(d);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,x,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(c);T?v.deepEqual(T.getPaintProperty(d),x)||(T.setPaintProperty(d,x,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var x=c.source,S=c.sourceLayer,T=this.sourceCaches[x];if(T!==void 0){var M=T.getSource().type;M==="geojson"&&S?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||S?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(S,c.id,d)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var x=c.source,S=this.sourceCaches[x];if(S!==void 0){var T=S.getSource().type,M=T==="vector"?c.sourceLayer:void 0;T!=="vector"||M?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(M,c.id,d):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,x=c.sourceLayer,S=this.sourceCaches[d];if(S!==void 0){if(S.getSource().type!=="vector"||x)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(x,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,x=function(Pr){return d._layers[Pr].type==="fill-extrusion"},S={},T=[],M=this._order.length-1;M>=0;M--){var k=this._order[M];if(x(k)){S[k]=M;for(var X=0,oe=c;X<oe.length;X+=1){var le=oe[X][k];if(le)for(var he=0,Pe=le;he<Pe.length;he+=1)T.push(Pe[he])}}}T.sort(function(Pr,wr){return wr.intersectionZ-Pr.intersectionZ});for(var we=[],Xe=this._order.length-1;Xe>=0;Xe--){var Ae=this._order[Xe];if(x(Ae))for(var We=T.length-1;We>=0;We--){var nt=T[We].feature;if(S[nt.layer.id]<Xe)break;we.push(nt),T.pop()}else for(var vt=0,Vt=c;vt<Vt.length;vt+=1){var Rt=Vt[vt][Ae];if(Rt)for(var Xt=0,or=Rt;Xt<or.length;Xt+=1)we.push(or[Xt].feature)}}return we},f.prototype.queryRenderedFeatures=function(c,d,x){d&&d.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var S={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,M=d.layers;T<M.length;T+=1){var k=M[T],X=this._layers[k];if(!X)return this.fire(new v.ErrorEvent(new Error("The layer '"+k+"' does not exist in the map's style and cannot be queried for features."))),[];S[X.source]=!0}}var oe=[];for(var le in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!S[le]||oe.push(zr(this.sourceCaches[le],this._layers,this._serializedLayers,c,d,x));return this.placement&&oe.push(function(he,Pe,we,Xe,Ae,We,nt){for(var vt={},Vt=We.queryRenderedSymbols(Xe),Rt=[],Xt=0,or=Object.keys(Vt).map(Number);Xt<or.length;Xt+=1)Rt.push(nt[or[Xt]]);Rt.sort(gn);for(var Pr=function(){var vn=en[wr],wi=vn.featureIndex.lookupSymbolFeatures(Vt[vn.bucketInstanceId],Pe,vn.bucketIndex,vn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,he);for(var Kr in wi){var Hn=vt[Kr]=vt[Kr]||[],si=wi[Kr];si.sort(function(ei,Bn){var On=vn.featureSortOrder;if(On){var Oo=On.indexOf(ei.featureIndex);return On.indexOf(Bn.featureIndex)-Oo}return Bn.featureIndex-ei.featureIndex});for(var jn=0,Un=si;jn<Un.length;jn+=1)Hn.push(Un[jn])}},wr=0,en=Rt;wr<en.length;wr+=1)Pr();var An=function(vn){vt[vn].forEach(function(wi){var Kr=wi.feature,Hn=we[he[vn].source].getFeatureState(Kr.layer["source-layer"],Kr.id);Kr.source=Kr.layer.source,Kr.layer["source-layer"]&&(Kr.sourceLayer=Kr.layer["source-layer"]),Kr.state=Hn})};for(var Cn in vt)An(Cn);return vt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var x=this.sourceCaches[c];return x?function(S,T){for(var M=S.getRenderableIds().map(function(Pe){return S.getTileByID(Pe)}),k=[],X={},oe=0;oe<M.length;oe++){var le=M[oe],he=le.tileID.canonical.key;X[he]||(X[he]=!0,le.querySourceFeatures(k,T))}return k}(x,d):[]},f.prototype.addSourceType=function(c,d,x){return f.getSourceType(c)?x(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},x):x(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var x=this.light.getLight(),S=!1;for(var T in c)if(!v.deepEqual(c[T],x[T])){S=!0;break}if(S){var M={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(M)}},f.prototype._validate=function(c,d,x,S,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&au(this,c.call(v.validateStyle,v.extend({key:d,style:this.serialize(),value:x,styleSpec:v.styleSpec},S)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,x,S,T){T===void 0&&(T=!1);for(var M=!1,k=!1,X={},oe=0,le=this._order;oe<le.length;oe+=1){var he=this._layers[le[oe]];if(he.type==="symbol"){if(!X[he.source]){var Pe=this.sourceCaches[he.source];X[he.source]=Pe.getRenderableIds(!0).map(function(nt){return Pe.getTileByID(nt)}).sort(function(nt,vt){return vt.tileID.overscaledZ-nt.tileID.overscaledZ||(nt.tileID.isLessThan(vt.tileID)?-1:1)})}var we=this.crossTileSymbolIndex.addLayer(he,X[he.source],c.center.lng);M=M||we}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new gs(c,this._order,T,d,x,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),k=!0),M&&this.pauseablePlacement.placement.setStale()),k||M)for(var Xe=0,Ae=this._order;Xe<Ae.length;Xe+=1){var We=this._layers[Ae[Xe]];We.type==="symbol"&&this.placement.updateLayerOpacities(We,X[We.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,x){this.imageManager.getImages(d.icons,x),this._updateTilesForChangedImages();var S=this.sourceCaches[d.source];S&&S.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,x){this.glyphManager.getGlyphs(d.stacks,x)},f.prototype.getResource=function(c,d,x){return v.makeRequest(d,x)},f}(v.Evented);xs.getSourceType=function(l){return Pt[l]},xs.setSourceType=function(l,f){Pt[l]=f},xs.registerForPluginStateChange=v.registerForPluginStateChange;var Co=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),xu=Ji(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),is=Ji(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Al=Ji(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),ch=Ji(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),af=Ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Mf=Ji(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),If=Ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Pf=Ji("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),fh=Ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),hh=Ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),rp=Ji(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Ic=Ji(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Eu=Ji(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ph=Ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),_o=Ji(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Tl=Ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ju=Ji(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Bs=Ji(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),el=Ji(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ys=Ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ku=Ji(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ns=Ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Uu=Ji(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),tl=Ji(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),dh=Ji(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),mh=Ji(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ji(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),x=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=S?S.concat(x):x,M={};return{fragmentSource:l=l.replace(c,function(k,X,oe,le,he){return M[he]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+he+`
varying `+oe+" "+le+" "+he+`;
#else
uniform `+oe+" "+le+" u_"+he+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+he+`
    `+oe+" "+le+" "+he+" = u_"+he+`;
#endif
`}),vertexSource:f=f.replace(c,function(k,X,oe,le,he){var Pe=le==="float"?"vec2":"vec4",we=he.match(/color/)?"color":Pe;return M[he]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+he+`
uniform lowp float u_`+he+`_t;
attribute `+oe+" "+Pe+" a_"+he+`;
varying `+oe+" "+le+" "+he+`;
#else
uniform `+oe+" "+le+" u_"+he+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+he+`
    `+he+" = a_"+he+`;
#else
    `+oe+" "+le+" "+he+" = u_"+he+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+he+`
    `+he+" = unpack_mix_"+we+"(a_"+he+", u_"+he+`_t);
#else
    `+oe+" "+le+" "+he+" = u_"+he+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+he+`
uniform lowp float u_`+he+`_t;
attribute `+oe+" "+Pe+" a_"+he+`;
#else
uniform `+oe+" "+le+" u_"+he+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+he+`
    `+oe+" "+le+" "+he+" = a_"+he+`;
#else
    `+oe+" "+le+" "+he+" = u_"+he+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+he+`
    `+oe+" "+le+" "+he+" = unpack_mix_"+we+"(a_"+he+", u_"+he+`_t);
#else
    `+oe+" "+le+" "+he+" = u_"+he+`;
#endif
`}),staticAttributes:d,staticUniforms:T}}var np=Object.freeze({__proto__:null,prelude:xu,background:is,backgroundPattern:Al,circle:ch,clippingMask:af,heatmap:Mf,heatmapTexture:If,collisionBox:Pf,collisionCircle:fh,debug:hh,fill:rp,fillOutline:Ic,fillOutlinePattern:Eu,fillPattern:ph,fillExtrusion:_o,fillExtrusionPattern:Tl,hillshadePrepare:Ju,hillshade:Bs,line:el,lineGradient:Ys,linePattern:ku,lineSDF:Ns,raster:Uu,symbolIcon:tl,symbolSDF:dh,symbolTextAndIcon:mh}),sf=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Of(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}sf.prototype.bind=function(l,f,c,d,x,S,T,M){this.context=l;for(var k=this.boundPaintVertexBuffers.length!==d.length,X=0;!k&&X<d.length;X++)this.boundPaintVertexBuffers[X]!==d[X]&&(k=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!k&&this.boundIndexBuffer===x&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===M?(l.bindVertexArrayOES.set(this.vao),T&&T.bind(),x&&x.dynamicDraw&&x.bind(),M&&M.bind()):this.freshBind(f,c,d,x,S,T,M)},sf.prototype.freshBind=function(l,f,c,d,x,S,T){var M,k=l.numAttributes,X=this.context,oe=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T;else{M=X.currentNumAttributes||0;for(var le=k;le<M;le++)oe.disableVertexAttribArray(le)}f.enableAttributes(oe,l);for(var he=0,Pe=c;he<Pe.length;he+=1)Pe[he].enableAttributes(oe,l);S&&S.enableAttributes(oe,l),T&&T.enableAttributes(oe,l),f.bind(),f.setVertexAttribPointers(oe,l,x);for(var we=0,Xe=c;we<Xe.length;we+=1){var Ae=Xe[we];Ae.bind(),Ae.setVertexAttribPointers(oe,l,x)}S&&(S.bind(),S.setVertexAttribPointers(oe,l,x)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(oe,l,x)),X.currentNumAttributes=k},sf.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var jo=function(l,f,c,d,x,S){var T=l.gl;this.program=T.createProgram();for(var M=Of(c.staticAttributes),k=d?d.getBinderAttributes():[],X=M.concat(k),oe=c.staticUniforms?Of(c.staticUniforms):[],le=d?d.getBinderUniforms():[],he=[],Pe=0,we=oe.concat(le);Pe<we.length;Pe+=1){var Xe=we[Pe];he.indexOf(Xe)<0&&he.push(Xe)}var Ae=d?d.defines():[];S&&Ae.push("#define OVERDRAW_INSPECTOR;");var We=Ae.concat(xu.fragmentSource,c.fragmentSource).join(`
`),nt=Ae.concat(xu.vertexSource,c.vertexSource).join(`
`),vt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(vt,We),T.compileShader(vt),T.attachShader(this.program,vt);var Vt=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Vt,nt),T.compileShader(Vt),T.attachShader(this.program,Vt),this.attributes={};var Rt={};this.numAttributes=X.length;for(var Xt=0;Xt<this.numAttributes;Xt++)X[Xt]&&(T.bindAttribLocation(this.program,Xt,X[Xt]),this.attributes[X[Xt]]=Xt);T.linkProgram(this.program),T.deleteShader(Vt),T.deleteShader(vt);for(var or=0;or<he.length;or++){var Pr=he[or];if(Pr&&!Rt[Pr]){var wr=T.getUniformLocation(this.program,Pr);wr&&(Rt[Pr]=wr)}}this.fixedUniforms=x(l,Rt),this.binderUniforms=d?d.getUniforms(l,Rt):[]}}};function Df(l,f,c){var d=1/Qi(c,1,f.transform.tileZoom),x=Math.pow(2,c.tileID.overscaledZ),S=c.tileSize*Math.pow(2,f.transform.tileZoom)/x,T=S*(c.tileID.canonical.x+c.tileID.wrap*x),M=S*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[T>>16,M>>16],u_pixel_coord_lower:[65535&T,65535&M]}}jo.prototype.draw=function(l,f,c,d,x,S,T,M,k,X,oe,le,he,Pe,we,Xe){var Ae,We=l.gl;if(!this.failedToCreate){for(var nt in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(x),l.setCullFace(S),this.fixedUniforms)this.fixedUniforms[nt].set(T[nt]);Pe&&Pe.setUniforms(l,this.binderUniforms,le,{zoom:he});for(var vt=(Ae={},Ae[We.LINES]=2,Ae[We.TRIANGLES]=3,Ae[We.LINE_STRIP]=1,Ae)[f],Vt=0,Rt=oe.get();Vt<Rt.length;Vt+=1){var Xt=Rt[Vt],or=Xt.vaos||(Xt.vaos={});(or[M]||(or[M]=new sf)).bind(l,this,k,Pe?Pe.getPaintVertexBuffers():[],X,Xt.vertexOffset,we,Xe),We.drawElements(f,Xt.primitiveLength*vt,We.UNSIGNED_SHORT,Xt.primitiveOffset*vt*2)}}};var vh=function(l,f,c,d){var x=f.style.light,S=x.properties.get("position"),T=[S.x,S.y,S.z],M=v.create$1();x.properties.get("anchor")==="viewport"&&v.fromRotation(M,-f.transform.angle),v.transformMat3(T,T,M);var k=x.properties.get("color");return{u_matrix:l,u_lightpos:T,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+c,u_opacity:d}},os=function(l,f,c,d,x,S,T){return v.extend(vh(l,f,c,d),Df(S,f,T),{u_height_factor:-Math.pow(2,x.overscaledZ)/T.tileSize/8})},zu=function(l){return{u_matrix:l}},bu=function(l,f,c,d){return v.extend(zu(l),Df(c,f,d))},rl=function(l,f){return{u_matrix:l,u_world:f}},uf=function(l,f,c,d,x){return v.extend(bu(l,f,c,d),{u_world:x})},Xl=function(l,f,c,d){var x,S,T=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var M=Qi(c,1,T.zoom);x=!0,S=[M,M]}else x=!1,S=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:S}},su=function(l,f,c){var d=Qi(c,1,f.zoom),x=Math.pow(2,f.zoom-c.tileID.overscaledZ),S=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*x),f.pixelsToGLUnits[1]/(d*x)],u_overscale_factor:S}},Pc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},nl=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Vu=function(l){return{u_matrix:l}},Lf=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:Qi(f,1,c),u_intensity:d}},Oc=function(l,f,c){var d=l.transform;return{u_matrix:Yl(l,f,c),u_ratio:1/Qi(f,1,d.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Yn=function(l,f,c,d){return v.extend(Oc(l,f,c),{u_image:0,u_image_height:d})},lf=function(l,f,c,d){var x=l.transform,S=Zu(f,x);return{u_matrix:Yl(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/Qi(f,1,x.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[S,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},_h=function(l,f,c,d,x){var S=l.lineAtlas,T=Zu(f,l.transform),M=c.layout.get("line-cap")==="round",k=S.getDash(d.from,M),X=S.getDash(d.to,M),oe=k.width*x.fromScale,le=X.width*x.toScale;return v.extend(Oc(l,f,c),{u_patternscale_a:[T/oe,-k.height/2],u_patternscale_b:[T/le,-X.height/2],u_sdfgamma:S.width/(256*Math.min(oe,le)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:X.y,u_mix:x.t})};function Zu(l,f){return 1/Qi(l,1,f.tileZoom)}function Yl(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Ff=function(l,f,c,d,x){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(T=x.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Mi(x.paint.get("raster-hue-rotate"))};var S,T};function Mi(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var oa,Ta=function(l,f,c,d,x,S,T,M,k,X){var oe=x.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:oe.width/oe.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:M,u_is_text:+k,u_pitch_with_map:+d,u_texsize:X,u_texture:0}},Es=function(l,f,c,d,x,S,T,M,k,X,oe){var le=x.transform;return v.extend(Ta(l,f,c,d,x,S,T,M,k,X),{u_gamma_scale:d?Math.cos(le._pitch)*le.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+oe})},Cl=function(l,f,c,d,x,S,T,M,k,X){return v.extend(Es(l,f,c,d,x,S,T,M,!0,k,!0),{u_texsize_icon:X,u_texture_icon:1})},il=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},wl=function(l,f,c,d,x,S){return v.extend(function(T,M,k,X){var oe=k.imageManager.getPattern(T.from.toString()),le=k.imageManager.getPattern(T.to.toString()),he=k.imageManager.getPixelSize(),Pe=he.width,we=he.height,Xe=Math.pow(2,X.tileID.overscaledZ),Ae=X.tileSize*Math.pow(2,k.transform.tileZoom)/Xe,We=Ae*(X.tileID.canonical.x+X.tileID.wrap*Xe),nt=Ae*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:le.tl,u_pattern_br_b:le.br,u_texsize:[Pe,we],u_mix:M.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:le.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Qi(X,1,k.transform.tileZoom),u_pixel_coord_upper:[We>>16,nt>>16],u_pixel_coord_lower:[65535&We,65535&nt]}}(d,S,c,x),{u_matrix:l,u_opacity:f})},Dc={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function ql(l,f,c,d,x,S,T){for(var M=l.context,k=M.gl,X=l.useProgram("collisionBox"),oe=[],le=0,he=0,Pe=0;Pe<d.length;Pe++){var we=d[Pe],Xe=f.getTile(we),Ae=Xe.getBucket(c);if(Ae){var We=we.posMatrix;x[0]===0&&x[1]===0||(We=l.translatePosMatrix(we.posMatrix,Xe,x,S));var nt=T?Ae.textCollisionBox:Ae.iconCollisionBox,vt=Ae.collisionCircleArray;if(vt.length>0){var Vt=v.create(),Rt=We;v.mul(Vt,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Vt,Vt,Ae.placementViewportMatrix),oe.push({circleArray:vt,circleOffset:he,transform:Rt,invTransform:Vt}),he=le+=vt.length/4}nt&&X.draw(M,k.LINES,$.disabled,de.disabled,l.colorModeForRenderPass(),Ze.disabled,su(We,l.transform,Xe),c.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,l.transform.zoom,null,null,nt.collisionVertexBuffer)}}if(T&&oe.length){var Xt=l.useProgram("collisionCircle"),or=new v.StructArrayLayout2f1f2i16;or.resize(4*le),or._trim();for(var Pr=0,wr=0,en=oe;wr<en.length;wr+=1)for(var An=en[wr],Cn=0;Cn<An.circleArray.length/4;Cn++){var vn=4*Cn,wi=An.circleArray[vn+0],Kr=An.circleArray[vn+1],Hn=An.circleArray[vn+2],si=An.circleArray[vn+3];or.emplace(Pr++,wi,Kr,Hn,si,0),or.emplace(Pr++,wi,Kr,Hn,si,1),or.emplace(Pr++,wi,Kr,Hn,si,2),or.emplace(Pr++,wi,Kr,Hn,si,3)}(!oa||oa.length<2*le)&&(oa=function(Do){var Ra=2*Do,va=new v.StructArrayLayout3ui6;va.resize(Ra),va._trim();for(var Ao=0;Ao<Ra;Ao++){var Lo=6*Ao;va.uint16[Lo+0]=4*Ao+0,va.uint16[Lo+1]=4*Ao+1,va.uint16[Lo+2]=4*Ao+2,va.uint16[Lo+3]=4*Ao+2,va.uint16[Lo+4]=4*Ao+3,va.uint16[Lo+5]=4*Ao+0}return va}(le));for(var jn=M.createIndexBuffer(oa,!0),Un=M.createVertexBuffer(or,v.collisionCircleLayout.members,!0),ei=0,Bn=oe;ei<Bn.length;ei+=1){var On=Bn[ei],Oo=Pc(On.transform,On.invTransform,l.transform);Xt.draw(M,k.TRIANGLES,$.disabled,de.disabled,l.colorModeForRenderPass(),Ze.disabled,Oo,c.id,Un,jn,v.SegmentVector.simpleSegment(0,2*On.circleOffset,On.circleArray.length,On.circleArray.length/2),null,l.transform.zoom,null,null,null)}Un.destroy(),jn.destroy()}}var qs=v.identity(new Float32Array(16));function cf(l,f,c,d,x,S){var T=v.getAnchorAlignment(l),M=-(T.horizontalAlign-.5)*f,k=-(T.verticalAlign-.5)*c,X=v.evaluateVariableOffset(l,d);return new v.Point((M/x+X[0])*S,(k/x+X[1])*S)}function gh(l,f,c,d,x,S,T,M,k,X,oe){var le=l.text.placedSymbolArray,he=l.text.dynamicLayoutVertexArray,Pe=l.icon.dynamicLayoutVertexArray,we={};he.clear();for(var Xe=0;Xe<le.length;Xe++){var Ae=le.get(Xe),We=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:d[Ae.crossTileID];if(We){var nt=new v.Point(Ae.anchorX,Ae.anchorY),vt=Jn(nt,c?M:T),Vt=ui(S.cameraToCenterDistance,vt.signedDistanceFromCamera),Rt=x.evaluateSizeForFeature(l.textSizeData,X,Ae)*Vt/v.ONE_EM;c&&(Rt*=l.tilePixelRatio/k);for(var Xt=cf(We.anchor,We.width,We.height,We.textOffset,We.textBoxScale,Rt),or=c?Jn(nt.add(Xt),T).point:vt.point.add(f?Xt.rotate(-S.angle):Xt),Pr=l.allowVerticalPlacement&&Ae.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,wr=0;wr<Ae.numGlyphs;wr++)v.addDynamicAttributes(he,or,Pr);oe&&Ae.associatedIconIndex>=0&&(we[Ae.associatedIconIndex]={shiftedAnchor:or,angle:Pr})}else ao(Ae.numGlyphs,he)}if(oe){Pe.clear();for(var en=l.icon.placedSymbolArray,An=0;An<en.length;An++){var Cn=en.get(An);if(Cn.hidden)ao(Cn.numGlyphs,Pe);else{var vn=we[An];if(vn)for(var wi=0;wi<Cn.numGlyphs;wi++)v.addDynamicAttributes(Pe,vn.shiftedAnchor,vn.angle);else ao(Cn.numGlyphs,Pe)}}l.icon.dynamicLayoutVertexBuffer.updateData(Pe)}l.text.dynamicLayoutVertexBuffer.updateData(he)}function yh(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function ol(l,f,c,d,x,S,T,M,k,X,oe,le){for(var he=l.context,Pe=he.gl,we=l.transform,Xe=M==="map",Ae=k==="map",We=Xe&&c.layout.get("symbol-placement")!=="point",nt=Xe&&!Ae&&!We,vt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Vt=!1,Rt=l.depthModeForSublayer(0,$.ReadOnly),Xt=c.layout.get("text-variable-anchor"),or=[],Pr=0,wr=d;Pr<wr.length;Pr+=1){var en=wr[Pr],An=f.getTile(en),Cn=An.getBucket(c);if(Cn){var vn=x?Cn.text:Cn.icon;if(vn&&vn.segments.get().length){var wi=vn.programConfigurations.get(c.id),Kr=x||Cn.sdfIcons,Hn=x?Cn.textSizeData:Cn.iconSizeData,si=Ae||we.pitch!==0,jn=l.useProgram(yh(Kr,x,Cn),wi),Un=v.evaluateSizeForZoom(Hn,we.zoom),ei=void 0,Bn=[0,0],On=void 0,Oo=void 0,Do=null,Ra=void 0;if(x)On=An.glyphAtlasTexture,Oo=Pe.LINEAR,ei=An.glyphAtlasTexture.size,Cn.iconsInText&&(Bn=An.imageAtlasTexture.size,Do=An.imageAtlasTexture,Ra=si||l.options.rotating||l.options.zooming||Hn.kind==="composite"||Hn.kind==="camera"?Pe.LINEAR:Pe.NEAREST);else{var va=c.layout.get("icon-size").constantOr(0)!==1||Cn.iconsNeedLinear;On=An.imageAtlasTexture,Oo=Kr||l.options.rotating||l.options.zooming||va||si?Pe.LINEAR:Pe.NEAREST,ei=An.imageAtlasTexture.size}var Ao=Qi(An,1,l.transform.zoom),Lo=oo(en.posMatrix,Ae,Xe,l.transform,Ao),Ja=mi(en.posMatrix,Ae,Xe,l.transform,Ao),Na=Xt&&Cn.hasTextData(),lu=c.layout.get("icon-text-fit")!=="none"&&Na&&Cn.hasIconData();We&&Ls(Cn,en.posMatrix,l,x,Lo,Ja,Ae,X);var Ya=l.translatePosMatrix(en.posMatrix,An,S,T),Zs=We||x&&Xt||lu?qs:Lo,Cs=l.translatePosMatrix(Ja,An,S,T,!0),uc=Kr&&c.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Fl={program:jn,buffers:vn,uniformValues:Kr?Cn.iconsInText?Cl(Hn.kind,Un,nt,Ae,l,Ya,Zs,Cs,ei,Bn):Es(Hn.kind,Un,nt,Ae,l,Ya,Zs,Cs,x,ei,!0):Ta(Hn.kind,Un,nt,Ae,l,Ya,Zs,Cs,x,ei),atlasTexture:On,atlasTextureIcon:Do,atlasInterpolation:Oo,atlasInterpolationIcon:Ra,isSDF:Kr,hasHalo:uc};if(vt&&Cn.canOverlap){Vt=!0;for(var Ru=0,Gu=vn.segments.get();Ru<Gu.length;Ru+=1){var Xu=Gu[Ru];or.push({segments:new v.SegmentVector([Xu]),sortKey:Xu.sortKey,state:Fl})}}else or.push({segments:vn.segments,sortKey:0,state:Fl})}}}Vt&&or.sort(function(tu,fu){return tu.sortKey-fu.sortKey});for(var cu=0,Yu=or;cu<Yu.length;cu+=1){var ka=Yu[cu],Ho=ka.state;if(he.activeTexture.set(Pe.TEXTURE0),Ho.atlasTexture.bind(Ho.atlasInterpolation,Pe.CLAMP_TO_EDGE),Ho.atlasTextureIcon&&(he.activeTexture.set(Pe.TEXTURE1),Ho.atlasTextureIcon&&Ho.atlasTextureIcon.bind(Ho.atlasInterpolationIcon,Pe.CLAMP_TO_EDGE)),Ho.isSDF){var ls=Ho.uniformValues;Ho.hasHalo&&(ls.u_is_halo=1,Jo(Ho.buffers,ka.segments,c,l,Ho.program,Rt,oe,le,ls)),ls.u_is_halo=0}Jo(Ho.buffers,ka.segments,c,l,Ho.program,Rt,oe,le,Ho.uniformValues)}}function Jo(l,f,c,d,x,S,T,M,k){var X=d.context;x.draw(X,X.gl.TRIANGLES,S,T,M,Ze.disabled,k,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function al(l,f,c,d,x,S,T){var M,k,X,oe,le,he=l.context.gl,Pe=c.paint.get("fill-pattern"),we=Pe&&Pe.constantOr(1),Xe=c.getCrossfadeParameters();T?(k=we&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",M=he.LINES):(k=we?"fillPattern":"fill",M=he.TRIANGLES);for(var Ae=0,We=d;Ae<We.length;Ae+=1){var nt=We[Ae],vt=f.getTile(nt);if(!we||vt.patternsLoaded()){var Vt=vt.getBucket(c);if(Vt){var Rt=Vt.programConfigurations.get(c.id),Xt=l.useProgram(k,Rt);we&&(l.context.activeTexture.set(he.TEXTURE0),vt.imageAtlasTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Rt.updatePaintBuffers(Xe));var or=Pe.constantOr(null);if(or&&vt.imageAtlas){var Pr=vt.imageAtlas,wr=Pr.patternPositions[or.to.toString()],en=Pr.patternPositions[or.from.toString()];wr&&en&&Rt.setConstantPatternPositions(wr,en)}var An=l.translatePosMatrix(nt.posMatrix,vt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){oe=Vt.indexBuffer2,le=Vt.segments2;var Cn=[he.drawingBufferWidth,he.drawingBufferHeight];X=k==="fillOutlinePattern"&&we?uf(An,l,Xe,vt,Cn):rl(An,Cn)}else oe=Vt.indexBuffer,le=Vt.segments,X=we?bu(An,l,Xe,vt):zu(An);Xt.draw(l.context,M,x,l.stencilModeForClipping(nt),S,Ze.disabled,X,c.id,Vt.layoutVertexBuffer,oe,le,c.paint,l.transform.zoom,Rt)}}}}function Kl(l,f,c,d,x,S,T){for(var M=l.context,k=M.gl,X=c.paint.get("fill-extrusion-pattern"),oe=X.constantOr(1),le=c.getCrossfadeParameters(),he=c.paint.get("fill-extrusion-opacity"),Pe=0,we=d;Pe<we.length;Pe+=1){var Xe=we[Pe],Ae=f.getTile(Xe),We=Ae.getBucket(c);if(We){var nt=We.programConfigurations.get(c.id),vt=l.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",nt);oe&&(l.context.activeTexture.set(k.TEXTURE0),Ae.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),nt.updatePaintBuffers(le));var Vt=X.constantOr(null);if(Vt&&Ae.imageAtlas){var Rt=Ae.imageAtlas,Xt=Rt.patternPositions[Vt.to.toString()],or=Rt.patternPositions[Vt.from.toString()];Xt&&or&&nt.setConstantPatternPositions(Xt,or)}var Pr=l.translatePosMatrix(Xe.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),wr=c.paint.get("fill-extrusion-vertical-gradient"),en=oe?os(Pr,l,wr,he,Xe,le,Ae):vh(Pr,l,wr,he);vt.draw(M,M.gl.TRIANGLES,x,S,T,Ze.backCCW,en,c.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,c.paint,l.transform.zoom,nt)}}}function Rl(l,f,c,d,x,S){var T=l.context,M=T.gl,k=f.fbo;if(k){var X=l.useProgram("hillshade");T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get());var oe=function(le,he,Pe){var we=Pe.paint.get("hillshade-shadow-color"),Xe=Pe.paint.get("hillshade-highlight-color"),Ae=Pe.paint.get("hillshade-accent-color"),We=Pe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Pe.paint.get("hillshade-illumination-anchor")==="viewport"&&(We-=le.transform.angle);var nt,vt,Vt,Rt=!le.options.moving;return{u_matrix:le.transform.calculatePosMatrix(he.tileID.toUnwrapped(),Rt),u_image:0,u_latrange:(nt=he.tileID,vt=Math.pow(2,nt.canonical.z),Vt=nt.canonical.y,[new v.MercatorCoordinate(0,Vt/vt).toLngLat().lat,new v.MercatorCoordinate(0,(Vt+1)/vt).toLngLat().lat]),u_light:[Pe.paint.get("hillshade-exaggeration"),We],u_shadow:we,u_highlight:Xe,u_accent:Ae}}(l,f,c);X.draw(T,M.TRIANGLES,d,x,S,Ze.disabled,oe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function ip(l,f,c,d,x,S){var T=l.context,M=T.gl,k=f.dem;if(k&&k.data){var X=k.dim,oe=k.stride,le=k.getPixels();if(T.activeTexture.set(M.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(oe),f.demTexture){var he=f.demTexture;he.update(le,{premultiply:!1}),he.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(T,le,M.RGBA,{premultiply:!1}),f.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);T.activeTexture.set(M.TEXTURE0);var Pe=f.fbo;if(!Pe){var we=new v.Texture(T,{width:X,height:X,data:null},M.RGBA);we.bind(M.LINEAR,M.CLAMP_TO_EDGE),(Pe=f.fbo=T.createFramebuffer(X,X,!0)).colorAttachment.set(we.texture)}T.bindFramebuffer.set(Pe.framebuffer),T.viewport.set([0,0,X,X]),l.useProgram("hillshadePrepare").draw(T,M.TRIANGLES,d,x,S,Ze.disabled,function(Xe,Ae){var We=Ae.stride,nt=v.create();return v.ortho(nt,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(nt,nt,[0,-v.EXTENT,0]),{u_matrix:nt,u_image:1,u_dimension:[We,We],u_zoom:Xe.overscaledZ,u_unpack:Ae.getUnpackVector()}}(f.tileID,k),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function ff(l,f,c,d,x){var S=d.paint.get("raster-fade-duration");if(S>0){var T=v.browser.now(),M=(T-l.timeAdded)/S,k=f?(T-f.timeAdded)/S:-1,X=c.getSource(),oe=x.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),le=!f||Math.abs(f.tileID.overscaledZ-oe)>Math.abs(l.tileID.overscaledZ-oe),he=le&&l.refreshedUponExpiration?1:v.clamp(le?M:1-k,0,1);return l.refreshedUponExpiration&&M>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-he}:{opacity:he,mix:0}}return{opacity:1,mix:0}}var Lc=new v.Color(1,0,0,1),sl=new v.Color(0,1,0,1),Bf=new v.Color(0,0,1,1),Fc=new v.Color(1,0,1,1),Nf=new v.Color(0,1,1,1);function Bc(l,f,c,d){$l(l,0,f+c/2,l.transform.width,c,d)}function kf(l,f,c,d){$l(l,f-c/2,0,c,l.transform.height,d)}function $l(l,f,c,d,x,S){var T=l.context,M=T.gl;M.enable(M.SCISSOR_TEST),M.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,d*v.browser.devicePixelRatio,x*v.browser.devicePixelRatio),T.clear({color:S}),M.disable(M.SCISSOR_TEST)}function Ql(l,f,c){var d=l.context,x=d.gl,S=c.posMatrix,T=l.useProgram("debug"),M=$.disabled,k=de.disabled,X=l.colorModeForRenderPass();d.activeTexture.set(x.TEXTURE0),l.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T.draw(d,x.LINE_STRIP,M,k,X,Ze.disabled,nl(S,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var oe=f.getTileByID(c.key).latestRawTileData,le=Math.floor((oe&&oe.byteLength||0)/1024),he=f.getTile(c).tileSize,Pe=512/Math.min(he,512)*(c.overscaledZ/l.transform.zoom)*.5,we=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(we+=" => "+c.overscaledZ),function(Xe,Ae){Xe.initDebugOverlayCanvas();var We=Xe.debugOverlayCanvas,nt=Xe.context.gl,vt=Xe.debugOverlayCanvas.getContext("2d");vt.clearRect(0,0,We.width,We.height),vt.shadowColor="white",vt.shadowBlur=2,vt.lineWidth=1.5,vt.strokeStyle="white",vt.textBaseline="top",vt.font="bold 36px Open Sans, sans-serif",vt.fillText(Ae,5,5),vt.strokeText(Ae,5,5),Xe.debugOverlayTexture.update(We),Xe.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)}(l,we+" "+le+"kb"),T.draw(d,x.TRIANGLES,M,k,Ie.alphaBlended,Ze.disabled,nl(S,v.Color.transparent,Pe),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Ml={symbol:function(l,f,c,d,x){if(l.renderPass==="translucent"){var S=de.disabled,T=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(M,k,X,oe,le,he,Pe){for(var we=k.transform,Xe=le==="map",Ae=he==="map",We=0,nt=M;We<nt.length;We+=1){var vt=nt[We],Vt=oe.getTile(vt),Rt=Vt.getBucket(X);if(Rt&&Rt.text&&Rt.text.segments.get().length){var Xt=v.evaluateSizeForZoom(Rt.textSizeData,we.zoom),or=Qi(Vt,1,k.transform.zoom),Pr=oo(vt.posMatrix,Ae,Xe,k.transform,or),wr=X.layout.get("icon-text-fit")!=="none"&&Rt.hasIconData();if(Xt){var en=Math.pow(2,we.zoom-Vt.tileID.overscaledZ);gh(Rt,Xe,Ae,Pe,v.symbolSize,we,Pr,vt.posMatrix,en,Xt,wr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x),c.paint.get("icon-opacity").constantOr(1)!==0&&ol(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),S,T),c.paint.get("text-opacity").constantOr(1)!==0&&ol(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),S,T),f.map.showCollisionBoxes&&(ql(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ql(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var x=c.paint.get("circle-opacity"),S=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)!==0||S.constantOr(1)!==0&&T.constantOr(1)!==0){for(var k=l.context,X=k.gl,oe=l.depthModeForSublayer(0,$.ReadOnly),le=de.disabled,he=l.colorModeForRenderPass(),Pe=[],we=0;we<d.length;we++){var Xe=d[we],Ae=f.getTile(Xe),We=Ae.getBucket(c);if(We){var nt=We.programConfigurations.get(c.id),vt={programConfiguration:nt,program:l.useProgram("circle",nt),layoutVertexBuffer:We.layoutVertexBuffer,indexBuffer:We.indexBuffer,uniformValues:Xl(l,Xe,Ae,c)};if(M)for(var Vt=0,Rt=We.segments.get();Vt<Rt.length;Vt+=1){var Xt=Rt[Vt];Pe.push({segments:new v.SegmentVector([Xt]),sortKey:Xt.sortKey,state:vt})}else Pe.push({segments:We.segments,sortKey:0,state:vt})}}M&&Pe.sort(function(An,Cn){return An.sortKey-Cn.sortKey});for(var or=0,Pr=Pe;or<Pr.length;or+=1){var wr=Pr[or],en=wr.state;en.program.draw(k,X.TRIANGLES,oe,le,he,Ze.disabled,en.uniformValues,c.id,en.layoutVertexBuffer,en.indexBuffer,wr.segments,c.paint,l.transform.zoom,en.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var x=l.context,S=x.gl,T=de.disabled,M=new Ie([S.ONE,S.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Pe,we,Xe){var Ae=Pe.gl;Pe.activeTexture.set(Ae.TEXTURE1),Pe.viewport.set([0,0,we.width/4,we.height/4]);var We=Xe.heatmapFbo;if(We)Ae.bindTexture(Ae.TEXTURE_2D,We.colorAttachment.get()),Pe.bindFramebuffer.set(We.framebuffer);else{var nt=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,nt),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),We=Xe.heatmapFbo=Pe.createFramebuffer(we.width/4,we.height/4,!1),function(vt,Vt,Rt,Xt){var or=vt.gl;or.texImage2D(or.TEXTURE_2D,0,or.RGBA,Vt.width/4,Vt.height/4,0,or.RGBA,vt.extRenderToTextureHalfFloat?vt.extTextureHalfFloat.HALF_FLOAT_OES:or.UNSIGNED_BYTE,null),Xt.colorAttachment.set(Rt)}(Pe,we,nt,We)}})(x,l,c),x.clear({color:v.Color.transparent});for(var k=0;k<d.length;k++){var X=d[k];if(!f.hasRenderableParent(X)){var oe=f.getTile(X),le=oe.getBucket(c);if(le){var he=le.programConfigurations.get(c.id);l.useProgram("heatmap",he).draw(x,S.TRIANGLES,$.disabled,T,M,Ze.disabled,Lf(X.posMatrix,oe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,c.paint,l.transform.zoom,he)}}}x.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Pe,we){var Xe=Pe.context,Ae=Xe.gl,We=we.heatmapFbo;if(We){Xe.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,We.colorAttachment.get()),Xe.activeTexture.set(Ae.TEXTURE1);var nt=we.colorRampTexture;nt||(nt=we.colorRampTexture=new v.Texture(Xe,we.colorRamp,Ae.RGBA)),nt.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Pe.useProgram("heatmapTexture").draw(Xe,Ae.TRIANGLES,$.disabled,de.disabled,Pe.colorModeForRenderPass(),Ze.disabled,function(vt,Vt,Rt,Xt){var or=v.create();v.ortho(or,0,vt.width,vt.height,0,0,1);var Pr=vt.context.gl;return{u_matrix:or,u_world:[Pr.drawingBufferWidth,Pr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Vt.paint.get("heatmap-opacity")}}(Pe,we),we.id,Pe.viewportBuffer,Pe.quadTriangleIndexBuffer,Pe.viewportSegments,we.paint,Pe.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var x=c.paint.get("line-opacity"),S=c.paint.get("line-width");if(x.constantOr(1)!==0&&S.constantOr(1)!==0)for(var T=l.depthModeForSublayer(0,$.ReadOnly),M=l.colorModeForRenderPass(),k=c.paint.get("line-dasharray"),X=c.paint.get("line-pattern"),oe=X.constantOr(1),le=c.paint.get("line-gradient"),he=c.getCrossfadeParameters(),Pe=oe?"linePattern":k?"lineSDF":le?"lineGradient":"line",we=l.context,Xe=we.gl,Ae=!0,We=0,nt=d;We<nt.length;We+=1){var vt=nt[We],Vt=f.getTile(vt);if(!oe||Vt.patternsLoaded()){var Rt=Vt.getBucket(c);if(Rt){var Xt=Rt.programConfigurations.get(c.id),or=l.context.program.get(),Pr=l.useProgram(Pe,Xt),wr=Ae||Pr.program!==or,en=X.constantOr(null);if(en&&Vt.imageAtlas){var An=Vt.imageAtlas,Cn=An.patternPositions[en.to.toString()],vn=An.patternPositions[en.from.toString()];Cn&&vn&&Xt.setConstantPatternPositions(Cn,vn)}var wi=oe?lf(l,Vt,c,he):k?_h(l,Vt,c,k,he):le?Yn(l,Vt,c,Rt.lineClipsArray.length):Oc(l,Vt,c);if(oe)we.activeTexture.set(Xe.TEXTURE0),Vt.imageAtlasTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),Xt.updatePaintBuffers(he);else if(k&&(wr||l.lineAtlas.dirty))we.activeTexture.set(Xe.TEXTURE0),l.lineAtlas.bind(we);else if(le){var Kr=Rt.gradients[c.id],Hn=Kr.texture;if(c.gradientVersion!==Kr.version){var si=256;if(c.stepInterpolant){var jn=f.getSource().maxzoom,Un=vt.canonical.z===jn?Math.ceil(1<<l.transform.maxZoom-vt.canonical.z):1;si=v.clamp(v.nextPowerOfTwo(Rt.maxLineLength/v.EXTENT*1024*Un),256,we.maxTextureSize)}Kr.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:Kr.gradient||void 0,clips:Rt.lineClipsArray}),Kr.texture?Kr.texture.update(Kr.gradient):Kr.texture=new v.Texture(we,Kr.gradient,Xe.RGBA),Kr.version=c.gradientVersion,Hn=Kr.texture}we.activeTexture.set(Xe.TEXTURE0),Hn.bind(c.stepInterpolant?Xe.NEAREST:Xe.LINEAR,Xe.CLAMP_TO_EDGE)}Pr.draw(we,Xe.TRIANGLES,T,l.stencilModeForClipping(vt),M,Ze.disabled,wi,c.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,c.paint,l.transform.zoom,Xt,Rt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,f,c,d){var x=c.paint.get("fill-color"),S=c.paint.get("fill-opacity");if(S.constantOr(1)!==0){var T=l.colorModeForRenderPass(),M=c.paint.get("fill-pattern"),k=l.opaquePassEnabledForLayer()&&!M.constantOr(1)&&x.constantOr(v.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===k){var X=l.depthModeForSublayer(1,l.renderPass==="opaque"?$.ReadWrite:$.ReadOnly);al(l,f,c,d,X,T,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var oe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,$.ReadOnly);al(l,f,c,d,oe,T,!0)}}},"fill-extrusion":function(l,f,c,d){var x=c.paint.get("fill-extrusion-opacity");if(x!==0&&l.renderPass==="translucent"){var S=new $(l.context.gl.LEQUAL,$.ReadWrite,l.depthRangeFor3D);if(x!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Kl(l,f,c,d,S,de.disabled,Ie.disabled),Kl(l,f,c,d,S,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var T=l.colorModeForRenderPass();Kl(l,f,c,d,S,de.disabled,T)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var x=l.context,S=l.depthModeForSublayer(0,$.ReadOnly),T=l.colorModeForRenderPass(),M=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],k=M[0],X=0,oe=M[1];X<oe.length;X+=1){var le=oe[X],he=f.getTile(le);he.needsHillshadePrepare&&l.renderPass==="offscreen"?ip(l,he,c,S,de.disabled,T):l.renderPass==="translucent"&&Rl(l,he,c,S,k[le.overscaledZ],T)}x.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var x=l.context,S=x.gl,T=f.getSource(),M=l.useProgram("raster"),k=l.colorModeForRenderPass(),X=T instanceof at?[{},d]:l.stencilConfigForOverlap(d),oe=X[0],le=X[1],he=le[le.length-1].overscaledZ,Pe=!l.options.moving,we=0,Xe=le;we<Xe.length;we+=1){var Ae=Xe[we],We=l.depthModeForSublayer(Ae.overscaledZ-he,c.paint.get("raster-opacity")===1?$.ReadWrite:$.ReadOnly,S.LESS),nt=f.getTile(Ae),vt=l.transform.calculatePosMatrix(Ae.toUnwrapped(),Pe);nt.registerFadeDuration(c.paint.get("raster-fade-duration"));var Vt=f.findLoadedParent(Ae,0),Rt=ff(nt,Vt,f,c,l.transform),Xt=void 0,or=void 0,Pr=c.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;x.activeTexture.set(S.TEXTURE0),nt.texture.bind(Pr,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),x.activeTexture.set(S.TEXTURE1),Vt?(Vt.texture.bind(Pr,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),Xt=Math.pow(2,Vt.tileID.overscaledZ-nt.tileID.overscaledZ),or=[nt.tileID.canonical.x*Xt%1,nt.tileID.canonical.y*Xt%1]):nt.texture.bind(Pr,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);var wr=Ff(vt,or||[0,0],Xt||1,Rt,c);T instanceof at?M.draw(x,S.TRIANGLES,We,de.disabled,k,Ze.disabled,wr,c.id,T.boundsBuffer,l.quadTriangleIndexBuffer,T.boundsSegments):M.draw(x,S.TRIANGLES,We,oe[Ae.overscaledZ],k,Ze.disabled,wr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(x!==0){var S=l.context,T=S.gl,M=l.transform,k=M.tileSize,X=c.paint.get("background-pattern");if(!l.isPatternMissing(X)){var oe=!X&&d.a===1&&x===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===oe){var le=de.disabled,he=l.depthModeForSublayer(0,oe==="opaque"?$.ReadWrite:$.ReadOnly),Pe=l.colorModeForRenderPass(),we=l.useProgram(X?"backgroundPattern":"background"),Xe=M.coveringTiles({tileSize:k});X&&(S.activeTexture.set(T.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),We=0,nt=Xe;We<nt.length;We+=1){var vt=nt[We],Vt=l.transform.calculatePosMatrix(vt.toUnwrapped()),Rt=X?wl(Vt,x,l,X,{tileID:vt,tileSize:k},Ae):il(Vt,x,d);we.draw(S,T.TRIANGLES,he,le,Pe,Ze.disabled,Rt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Ql(l,f,c[d])},custom:function(l,f,c){var d=l.context,x=c.implementation;if(l.renderPass==="offscreen"){var S=x.prerender;S&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),S.call(x,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(de.disabled);var T=x.renderingMode==="3d"?new $(l.context.gl.LEQUAL,$.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,$.ReadOnly);d.setDepthMode(T),x.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},go=function(l,f){this.context=new ee(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=be.maxUnderzooming+be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Fs,this.gpuTimers={}};go.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},go.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,Co.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,Co.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var d=new v.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(v.EXTENT,0,v.EXTENT,0),d.emplaceBack(0,v.EXTENT,0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,He.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var x=new v.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,Co.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var S=new v.StructArrayLayout1ui2;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(S);var T=new v.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(T),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var M=this.context.gl;this.stencilClearMode=new de({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO)},go.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,$.disabled,this.stencilClearMode,Ie.disabled,Ze.disabled,Vu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},go.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ie.disabled),c.setDepthMode($.disabled);var x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var S=0,T=f;S<T.length;S+=1){var M=T[S],k=this._tileClippingMaskIDs[M.key]=this.nextStencilID++;x.draw(c,d.TRIANGLES,$.disabled,new de({func:d.ALWAYS,mask:0},k,255,d.KEEP,d.KEEP,d.REPLACE),Ie.disabled,Ze.disabled,Vu(M.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},go.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new de({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},go.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new de({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},go.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(k,X){return X.overscaledZ-k.overscaledZ}),x=d[d.length-1].overscaledZ,S=d[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();for(var T={},M=0;M<S;M++)T[M+x]=new de({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=S,[T,d]}return[(f={},f[x]=de.disabled,f),d]},go.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ie([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ie.unblended:Ie.alphaBlended},go.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return $.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new $(c||this.context.gl.LEQUAL,f,[d,d])},go.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},go.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var d=this.style._order,x=this.style.sourceCaches;for(var S in x){var T=x[S];T.used&&T.prepare(this.context)}var M,k,X={},oe={},le={};for(var he in x){var Pe=x[he];X[he]=Pe.getVisibleCoordinates(),oe[he]=X[he].slice().reverse(),le[he]=Pe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var we=0;we<d.length;we++)if(this.style._layers[d[we]].is3D()){this.opaquePassCutoff=we;break}this.renderPass="offscreen";for(var Xe=0,Ae=d;Xe<Ae.length;Xe+=1){var We=this.style._layers[Ae[Xe]];if(We.hasOffscreenPass()&&!We.isHidden(this.transform.zoom)){var nt=oe[We.source];(We.type==="custom"||nt.length)&&this.renderLayer(this,x[We.source],We,nt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var vt=this.style._layers[d[this.currentLayer]],Vt=x[vt.source],Rt=X[vt.source];this._renderTileClippingMasks(vt,Rt),this.renderLayer(this,Vt,vt,Rt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Xt=this.style._layers[d[this.currentLayer]],or=x[Xt.source],Pr=(Xt.type==="symbol"?le:oe)[Xt.source];this._renderTileClippingMasks(Xt,X[Xt.source]),this.renderLayer(this,or,Xt,Pr)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(wr){wr.source&&!wr.isHidden(c.transform.zoom)&&(wr.source!==(k&&k.id)&&(k=c.style.sourceCaches[wr.source]),(!M||M.getSource().maxzoom<k.getSource().maxzoom)&&(M=k))}),M&&Ml.debug(this,M,M.getVisibleCoordinates())),this.options.showPadding&&function(wr){var en=wr.transform.padding;Bc(wr,wr.transform.height-(en.top||0),3,Lc),Bc(wr,en.bottom||0,3,sl),kf(wr,en.left||0,3,Bf),kf(wr,wr.transform.width-(en.right||0),3,Fc);var An=wr.transform.centerPoint;(function(Cn,vn,wi,Kr){$l(Cn,vn-1,wi-10,2,20,Kr),$l(Cn,vn-10,wi-1,20,2,Kr)})(wr,An.x,wr.transform.height-An.y,Nf)}(this),this.context.setDefault()},go.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Ml[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},go.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},go.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},go.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},go.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],x=this.context.extTimerQuery,S=x.getQueryObjectEXT(d.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(d.query),f[c]=S}return f},go.prototype.translatePosMatrix=function(l,f,c,d,x){if(!c[0]&&!c[1])return l;var S=x?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(S){var T=Math.sin(S),M=Math.cos(S);c=[c[0]*M-c[1]*T,c[0]*T+c[1]*M]}var k=[x?c[0]:Qi(f,c[0],this.transform.zoom),x?c[1]:Qi(f,c[1],this.transform.zoom),0],X=new Float32Array(16);return v.translate(X,l,k),X},go.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},go.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},go.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},go.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new jo(this.context,l,np[l],f,Dc[l],this._showOverdrawInspector)),this.cache[c]},go.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},go.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},go.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},go.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var hf=function(l,f){this.points=l,this.planes=f};hf.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return v.transformMat4([],T,l)}).map(function(T){return v.scale$1([],T,1/T[3]/f*d)}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var M=v.sub([],x[T[0]],x[T[1]]),k=v.sub([],x[T[2]],x[T[1]]),X=v.normalize([],v.cross([],M,k)),oe=-v.dot(X,x[T[1]]);return X.concat(oe)});return new hf(x,S)};var Su=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Su.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),d=v.clone$2(this.max),x=0;x<f.length;x++)c[x]=f[x]?this.min[x]:this.center[x],d[x]=f[x]?this.center[x]:this.max[x];return d[2]=this.max[2],new Su(c,d)},Su.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Su.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Su.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var x=l.planes[d],S=0,T=0;T<f.length;T++)S+=v.dot$1(x,f[T])>=0;if(S===0)return 0;S!==f.length&&(c=!1)}if(c)return 2;for(var M=0;M<3;M++){for(var k=Number.MAX_VALUE,X=-Number.MAX_VALUE,oe=0;oe<l.points.length;oe++){var le=l.points[oe][M]-this.min[M];k=Math.min(k,le),X=Math.max(X,le)}if(X<0||k>this.max[M]-this.min[M])return 0}return 1};var Il=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Il.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},Il.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),d=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,d)},Il.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Il.prototype.clone=function(){return new Il(this.top,this.bottom,this.left,this.right)},Il.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ei=function(l,f,c,d,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||x,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Il,this._posMatrixCache={},this._alignedPosMatrixCache={}},mo={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ei.prototype.clone=function(){var l=new Ei(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},mo.minZoom.get=function(){return this._minZoom},mo.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},mo.maxZoom.get=function(){return this._maxZoom},mo.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},mo.minPitch.get=function(){return this._minPitch},mo.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},mo.maxPitch.get=function(){return this._maxPitch},mo.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},mo.renderWorldCopies.get=function(){return this._renderWorldCopies},mo.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},mo.worldSize.get=function(){return this.tileSize*this.scale},mo.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},mo.size.get=function(){return new v.Point(this.width,this.height)},mo.bearing.get=function(){return-this.angle/Math.PI*180},mo.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},mo.pitch.get=function(){return this._pitch/Math.PI*180},mo.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},mo.fov.get=function(){return this._fov/Math.PI*180},mo.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},mo.zoom.get=function(){return this._zoom},mo.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},mo.center.get=function(){return this._center},mo.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},mo.padding.get=function(){return this._edgeInsets.toJSON()},mo.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},mo.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ei.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Ei.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Ei.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Ei.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),d=this.pointCoordinate(new v.Point(this.width,0)),x=this.pointCoordinate(new v.Point(this.width,this.height)),S=this.pointCoordinate(new v.Point(0,this.height)),T=Math.floor(Math.min(c.x,d.x,x.x,S.x)),M=Math.floor(Math.max(c.x,d.x,x.x,S.x)),k=T-1;k<=M+1;k++)k!==0&&f.push(new v.UnwrappedTileID(k,l));return f},Ei.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=v.MercatorCoordinate.fromLngLat(this.center),x=Math.pow(2,f),S=[x*d.x,x*d.y,0],T=hf.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),M=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(M=f);var k=function(wr){return{aabb:new Su([wr*x,0,0],[(wr+1)*x,x,0]),zoom:0,x:0,y:0,wrap:wr,fullyVisible:!1}},X=[],oe=[],le=f,he=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Pe=1;Pe<=3;Pe++)X.push(k(-Pe)),X.push(k(Pe));for(X.push(k(0));X.length>0;){var we=X.pop(),Xe=we.x,Ae=we.y,We=we.fullyVisible;if(!We){var nt=we.aabb.intersects(T);if(nt===0)continue;We=nt===2}var vt=we.aabb.distanceX(S),Vt=we.aabb.distanceY(S),Rt=Math.max(Math.abs(vt),Math.abs(Vt));if(we.zoom===le||Rt>3+(1<<le-we.zoom)-2&&we.zoom>=M)oe.push({tileID:new v.OverscaledTileID(we.zoom===le?he:we.zoom,we.wrap,we.zoom,Xe,Ae),distanceSq:v.sqrLen([S[0]-.5-Xe,S[1]-.5-Ae])});else for(var Xt=0;Xt<4;Xt++){var or=(Xe<<1)+Xt%2,Pr=(Ae<<1)+(Xt>>1);X.push({aabb:we.aabb.quadrant(Xt),zoom:we.zoom+1,x:or,y:Pr,wrap:we.wrap,fullyVisible:We})}}return oe.sort(function(wr,en){return wr.distanceSq-en.distanceSq}).map(function(wr){return wr.tileID})},Ei.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},mo.unmodified.get=function(){return this._unmodified},Ei.prototype.zoomScale=function(l){return Math.pow(2,l)},Ei.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Ei.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Ei.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},mo.point.get=function(){return this.project(this.center)},Ei.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(l),S=new v.MercatorCoordinate(x.x-(c.x-d.x),x.y-(c.y-d.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())},Ei.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Ei.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Ei.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Ei.prototype.coordinateLocation=function(l){return l.toLngLat()},Ei.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],x=c[3],S=f[1]/d,T=c[1]/x,M=f[2]/d,k=c[2]/x,X=M===k?0:(0-M)/(k-M);return new v.MercatorCoordinate(v.number(f[0]/d,c[0]/x,X)/this.worldSize,v.number(S,T,X)/this.worldSize)},Ei.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Ei.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Ei.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ei.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ei.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var x=l.canonical,S=this.worldSize/this.zoomScale(x.z),T=x.x+Math.pow(2,x.z)*l.wrap,M=v.identity(new Float64Array(16));return v.translate(M,M,[T*S,x.y*S,0]),v.scale(M,M,[S/v.EXTENT,S/v.EXTENT,1]),v.multiply(M,f?this.alignedProjMatrix:this.projMatrix,M),d[c]=new Float32Array(M),d[c]},Ei.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ei.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,x=-90,S=90,T=-180,M=180,k=this.size,X=this._unmodified;if(this.latRange){var oe=this.latRange;x=v.mercatorYfromLat(oe[1])*this.worldSize,l=(S=v.mercatorYfromLat(oe[0])*this.worldSize)-x<k.y?k.y/(S-x):0}if(this.lngRange){var le=this.lngRange;T=v.mercatorXfromLng(le[0])*this.worldSize,f=(M=v.mercatorXfromLng(le[1])*this.worldSize)-T<k.x?k.x/(M-T):0}var he=this.point,Pe=Math.max(f||0,l||0);if(Pe)return this.center=this.unproject(new v.Point(f?(M+T)/2:he.x,l?(S+x)/2:he.y)),this.zoom+=this.scaleZoom(Pe),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var we=he.y,Xe=k.y/2;we-Xe<x&&(d=x+Xe),we+Xe>S&&(d=S-Xe)}if(this.lngRange){var Ae=he.x,We=k.x/2;Ae-We<T&&(c=T+We),Ae+We>M&&(c=M-We)}c===void 0&&d===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:he.x,d!==void 0?d:he.y))),this._unmodified=X,this._constraining=!1}},Ei.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),x=this.point,S=x.x,T=x.y,M=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),k=this.height/50,X=new Float64Array(16);v.perspective(X,this._fov,this.width/this.height,k,M),X[8]=2*-l.x/this.width,X[9]=2*l.y/this.height,v.scale(X,X,[1,-1,1]),v.translate(X,X,[0,0,-this.cameraToCenterDistance]),v.rotateX(X,X,this._pitch),v.rotateZ(X,X,this.angle),v.translate(X,X,[-S,-T,0]),this.mercatorMatrix=v.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),v.scale(X,X,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=v.invert([],this.projMatrix);var oe=this.width%2/2,le=this.height%2/2,he=Math.cos(this.angle),Pe=Math.sin(this.angle),we=S-Math.round(S)+he*oe+Pe*le,Xe=T-Math.round(T)+he*le+Pe*oe,Ae=new Float64Array(X);if(v.translate(Ae,Ae,[we>.5?we-1:we,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=Ae,X=v.create(),v.scale(X,X,[this.width/2,-this.height/2,1]),v.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=v.create(),v.scale(X,X,[1,-1,1]),v.translate(X,X,[-1,-1,0]),v.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ei.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ei.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Ei.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,x=f.x,S=f.y,T=0,M=l;T<M.length;T+=1){var k=M[T];c=Math.min(c,k.x),d=Math.min(d,k.y),x=Math.max(x,k.x),S=Math.max(S,k.y)}return[new v.Point(c,d),new v.Point(x,d),new v.Point(x,S),new v.Point(c,S),new v.Point(c,d)]},Object.defineProperties(Ei.prototype,mo);var as=function(l){var f,c,d,x;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,x=function(){d=null,c&&(f(),d=setTimeout(x,300),c=!1)},function(){return c=!0,d||x(),d})};as.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},as.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},as.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,d),S=Math.round(f.lng*x)/x,T=Math.round(f.lat*x)/x,M=this._map.getBearing(),k=this._map.getPitch(),X="";if(X+=l?"/"+S+"/"+T+"/"+c:c+"/"+T+"/"+S,(M||k)&&(X+="/"+Math.round(10*M)/10),k&&(X+="/"+Math.round(k)),this._hashName){var oe=this._hashName,le=!1,he=v.window.location.hash.slice(1).split("&").map(function(Pe){var we=Pe.split("=")[0];return we===oe?(le=!0,we+"="+X):Pe}).filter(function(Pe){return Pe});return le||he.push(oe+"="+X),"#"+he.join("&")}return"#"+X},as.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},as.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},as.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var ul={linearity:.3,easing:v.bezier(0,0,.3,1)},Jl=v.extend({deceleration:2500,maxSpeed:1400},ul),Nc=v.extend({deceleration:20,maxSpeed:1400},ul),Uf=v.extend({deceleration:1e3,maxSpeed:360},ul),zf=v.extend({deceleration:1e3,maxSpeed:90},ul),ec=function(l){this._map=l,this.clear()};function Au(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Ca(l,f,c){var d=c.maxSpeed,x=c.linearity,S=c.deceleration,T=v.clamp(l*x/(f/1e3),-d,d),M=Math.abs(T)/(S*x);return{easing:c.easing,duration:1e3*M,amount:T*(M/2)}}ec.prototype.clear=function(){this._inertiaBuffer=[]},ec.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},ec.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},ec.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var x=d[c].settings;f.zoom+=x.zoomDelta||0,f.bearing+=x.bearingDelta||0,f.pitch+=x.pitchDelta||0,x.panDelta&&f.pan._add(x.panDelta),x.around&&(f.around=x.around),x.pinchAround&&(f.pinchAround=x.pinchAround)}var S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(f.pan.mag()){var M=Ca(f.pan.mag(),S,v.extend({},Jl,l||{}));T.offset=f.pan.mult(M.amount/f.pan.mag()),T.center=this._map.transform.center,Au(T,M)}if(f.zoom){var k=Ca(f.zoom,S,Nc);T.zoom=this._map.transform.zoom+k.amount,Au(T,k)}if(f.bearing){var X=Ca(f.bearing,S,Uf);T.bearing=this._map.transform.bearing+v.clamp(X.amount,-179,179),Au(T,X)}if(f.pitch){var oe=Ca(f.pitch,S,zf);T.pitch=this._map.transform.pitch+oe.amount,Au(T,oe)}if(T.zoom||T.bearing){var le=f.pinchAround===void 0?f.around:f.pinchAround;T.around=le?this._map.unproject(le):this._map.getCenter()}return this.clear(),v.extend(T,{noMoveStart:!0})}};var wo=function(l){function f(d,x,S,T){T===void 0&&(T={});var M=V.mousePos(x.getCanvasContainer(),S),k=x.unproject(M);l.call(this,d,v.extend({point:M,lngLat:k,originalEvent:S},T)),this._defaultPrevented=!1,this.target=x}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),tc=function(l){function f(d,x,S){var T=d==="touchend"?S.changedTouches:S.touches,M=V.touchPos(x.getCanvasContainer(),T),k=M.map(function(le){return x.unproject(le)}),X=M.reduce(function(le,he,Pe,we){return le.add(he.div(we.length))},new v.Point(0,0)),oe=x.unproject(X);l.call(this,d,{points:M,point:X,lngLats:k,lngLat:oe,originalEvent:S}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Vf=function(l){function f(d,x,S){l.call(this,d,{originalEvent:S}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),zi=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};zi.prototype.reset=function(){delete this._mousedownPos},zi.prototype.wheel=function(l){return this._firePreventable(new Vf(l.type,this._map,l))},zi.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new wo(l.type,this._map,l))},zi.prototype.mouseup=function(l){this._map.fire(new wo(l.type,this._map,l))},zi.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new wo(l.type,this._map,l))},zi.prototype.dblclick=function(l){return this._firePreventable(new wo(l.type,this._map,l))},zi.prototype.mouseover=function(l){this._map.fire(new wo(l.type,this._map,l))},zi.prototype.mouseout=function(l){this._map.fire(new wo(l.type,this._map,l))},zi.prototype.touchstart=function(l){return this._firePreventable(new tc(l.type,this._map,l))},zi.prototype.touchmove=function(l){this._map.fire(new tc(l.type,this._map,l))},zi.prototype.touchend=function(l){this._map.fire(new tc(l.type,this._map,l))},zi.prototype.touchcancel=function(l){this._map.fire(new tc(l.type,this._map,l))},zi.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},zi.prototype.isEnabled=function(){return!0},zi.prototype.isActive=function(){return!1},zi.prototype.enable=function(){},zi.prototype.disable=function(){};var cn=function(l){this._map=l};cn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},cn.prototype.mousemove=function(l){this._map.fire(new wo(l.type,this._map,l))},cn.prototype.mousedown=function(){this._delayContextMenu=!0},cn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},cn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new wo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},cn.prototype.isEnabled=function(){return!0},cn.prototype.isActive=function(){return!1},cn.prototype.enable=function(){},cn.prototype.disable=function(){};var bs=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function pf(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}bs.prototype.isEnabled=function(){return!!this._enabled},bs.prototype.isActive=function(){return!!this._active},bs.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},bs.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},bs.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(V.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},bs.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=V.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var x=Math.min(d.x,c.x),S=Math.max(d.x,c.x),T=Math.min(d.y,c.y),M=Math.max(d.y,c.y);V.setTransform(this._box,"translate("+x+"px,"+T+"px)"),this._box.style.width=S-x+"px",this._box.style.height=M-T+"px"}}},bs.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,x=f;if(this.reset(),V.suppressClick(),d.x!==x.x||d.y!==x.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(S){return S.fitScreenCoordinates(d,x,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},bs.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},bs.prototype.blur=function(){this.reset()},bs.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos},bs.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var rc=function(l){this.reset(),this.numTouches=l.numTouches};rc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},rc.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var x=new v.Point(0,0),S=0,T=d;S<T.length;S+=1)x._add(T[S]);return x.div(d.length)}(f),this.touches=pf(c,f)))},rc.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=pf(c,f);for(var x in this.touches){var S=d[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}},rc.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var ss=function(l){this.singleTap=new rc(l),this.numTaps=l.numTaps,this.reset()};ss.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ss.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},ss.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},ss.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var x=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(d)<30;if(x&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ki=function(){this._zoomIn=new ss({numTouches:1,numTaps:2}),this._zoomOut=new ss({numTouches:2,numTaps:1}),this.reset()};Ki.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ki.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ki.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ki.prototype.touchend=function(l,f,c){var d=this,x=this._zoomIn.touchend(l,f,c),S=this._zoomOut.touchend(l,f,c);return x?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:l})}}):S?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:l})}}):void 0},Ki.prototype.touchcancel=function(){this.reset()},Ki.prototype.enable=function(){this._enabled=!0},Ki.prototype.disable=function(){this._enabled=!1,this.reset()},Ki.prototype.isEnabled=function(){return this._enabled},Ki.prototype.isActive=function(){return this._active};var kc={0:1,2:2},Ur=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Ur.prototype.blur=function(){this.reset()},Ur.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ur.prototype._correctButton=function(l,f){return!1},Ur.prototype._move=function(l,f){return{}},Ur.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=V.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Ur.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,x){var S=kc[x];return d.buttons===void 0||(d.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Ur.prototype.mouseupWindow=function(l){this._lastPoint&&V.mouseButton(l)===this._eventButton&&(this._moved&&V.suppressClick(),this.reset())},Ur.prototype.enable=function(){this._enabled=!0},Ur.prototype.disable=function(){this._enabled=!1,this.reset()},Ur.prototype.isEnabled=function(){return this._enabled},Ur.prototype.isActive=function(){return this._active};var ju=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Ur),nc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var x=.8*(d.x-c.x);if(x)return this._active=!0,{bearingDelta:x}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Ur),df=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var x=-.5*(d.y-c.y);if(x)return this._active=!0,{pitchDelta:x}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Ur),ks=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};ks.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},ks.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},ks.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},ks.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},ks.prototype.touchcancel=function(){this.reset()},ks.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=pf(c,f),x=new v.Point(0,0),S=new v.Point(0,0),T=0;for(var M in d){var k=d[M],X=this._touches[M];X&&(x._add(k),S._add(k.sub(X)),T++,d[M]=k)}if(this._touches=d,!(T<this._minTouches)&&S.mag()){var oe=S.div(T);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:x.div(T),panDelta:oe}}},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var Us=function(){this.reset()};function mf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Zf(l,f){return Math.log(l/f)/Math.LN2}Us.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Us.prototype._start=function(l){},Us.prototype._move=function(l,f,c){return{}},Us.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Us.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,x=d[1],S=mf(c,f,d[0]),T=mf(c,f,x);if(S&&T){var M=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],M,l)}}},Us.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,x=d[1],S=mf(c,f,d[0]),T=mf(c,f,x);S&&T||(this._active&&V.suppressClick(),this.reset())}},Us.prototype.touchcancel=function(){this.reset()},Us.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Us.prototype.disable=function(){this._enabled=!1,this.reset()},Us.prototype.isEnabled=function(){return this._enabled},Us.prototype.isActive=function(){return this._active};var Ko=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var x=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Zf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zf(this._distance,x),pinchAround:d}},f}(Us);function Tu(l,f){return 180*l.angleWith(f)/Math.PI}var xh=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var x=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tu(this._vector,x),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,x=Tu(c,this._startVector);return Math.abs(x)<d},f}(Us);function Uc(l){return Math.abs(l.y)>Math.abs(l.x)}var jf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,Uc(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,x){var S=c[0].sub(this._lastPoints[0]),T=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,T,x.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,x){if(this._valid!==void 0)return this._valid;var S=c.mag()>=2,T=d.mag()>=2;if(S||T){if(!S||!T)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;var M=c.y>0==d.y>0;return Uc(c)&&Uc(d)&&M}},f}(Us),Hf={panStep:100,bearingStep:15,pitchStep:10},Ss=function(){var l=Hf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ks(l){return l*(2-l)}Ss.prototype.blur=function(){this.reset()},Ss.prototype.reset=function(){this._active=!1},Ss.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,x=0,S=0,T=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),S=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),S=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),T=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(d=0,x=0),{cameraAnimation:function(M){var k=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Ks,zoom:c?Math.round(k)+c*(l.shiftKey?2:1):k,bearing:M.getBearing()+d*f._bearingStep,pitch:M.getPitch()+x*f._pitchStep,offset:[-S*f._panStep,-T*f._panStep],center:M.getCenter()},{originalEvent:l})}}}},Ss.prototype.enable=function(){this._enabled=!0},Ss.prototype.disable=function(){this._enabled=!1,this.reset()},Ss.prototype.isEnabled=function(){return this._enabled},Ss.prototype.isActive=function(){return this._active},Ss.prototype.disableRotation=function(){this._rotationDisabled=!0},Ss.prototype.enableRotation=function(){this._rotationDisabled=!1};var qn=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};qn.prototype.setZoomRate=function(l){this._defaultZoomRate=l},qn.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},qn.prototype.isEnabled=function(){return!!this._enabled},qn.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},qn.prototype.isZooming=function(){return!!this._zooming},qn.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},qn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},qn.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},qn.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},qn.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=V.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},qn.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var x=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(x*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var S,T=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,M=this._startZoom,k=this._easing,X=!1;if(this._type==="wheel"&&M&&k){var oe=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),le=k(oe);S=v.number(M,T,le),oe<1?this._frameId||(this._frameId=!0):X=!0}else S=T,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:S-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},qn.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,d=(v.browser.now()-c.start)/c.duration,x=c.easing(d+.01)-c.easing(d),S=.27/Math.sqrt(x*x+1e-4)*.01,T=Math.sqrt(.0729-S*S);f=v.bezier(S,T,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},qn.prototype.blur=function(){this.reset()},qn.prototype.reset=function(){this._active=!1};var zs=function(l,f){this._clickZoom=l,this._tapZoom=f};zs.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},zs.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},zs.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},zs.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var As=function(){this.reset()};As.prototype.reset=function(){this._active=!1},As.prototype.blur=function(){this.reset()},As.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},As.prototype.enable=function(){this._enabled=!0},As.prototype.disable=function(){this._enabled=!1,this.reset()},As.prototype.isEnabled=function(){return this._enabled},As.prototype.isActive=function(){return this._active};var ma=function(){this._tap=new ss({numTouches:1,numTaps:1}),this.reset()};ma.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ma.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},ma.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],x=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(l,f,c)},ma.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},ma.prototype.touchcancel=function(){this.reset()},ma.prototype.enable=function(){this._enabled=!0},ma.prototype.disable=function(){this._enabled=!1,this.reset()},ma.prototype.isEnabled=function(){return this._enabled},ma.prototype.isActive=function(){return this._active};var Pl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};Pl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Pl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Pl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Pl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Hu=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};Hu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Hu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Hu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Hu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Vs=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Vs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Vs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Vs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Vs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Vs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Vs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ga=function(l){return l.zoom||l.drag||l.pitch||l.rotate},ic=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function Sn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var fn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ec(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var d=0,x=this._listeners;d<x.length;d+=1){var S=x[d],T=S[0];V.addEventListener(T,S[1],T===v.window.document?this.handleWindowEvent:this.handleEvent,S[2])}};fn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];V.removeEventListener(d,c[1],d===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},fn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new zi(f,l));var d=f.boxZoom=new bs(f,l);this._add("boxZoom",d);var x=new Ki,S=new As;f.doubleClickZoom=new zs(S,x),this._add("tapZoom",x),this._add("clickZoom",S);var T=new ma;this._add("tapDragZoom",T);var M=f.touchPitch=new jf;this._add("touchPitch",M);var k=new nc(l),X=new df(l);f.dragRotate=new Hu(l,k,X),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var oe=new ju(l),le=new ks(l);f.dragPan=new Pl(c,oe,le),this._add("mousePan",oe),this._add("touchPan",le,["touchZoom","touchRotate"]);var he=new xh,Pe=new Ko;f.touchZoomRotate=new Vs(c,Pe,he,T),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",Pe,["touchPan","touchRotate"]);var we=f.scrollZoom=new qn(f,this);this._add("scrollZoom",we,["mousePan"]);var Xe=f.keyboard=new Ss;this._add("keyboard",Xe),this._add("blockableMapEvent",new cn(f));for(var Ae=0,We=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<We.length;Ae+=1){var nt=We[Ae];l.interactive&&l[nt]&&f[nt].enable(l[nt])}},fn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},fn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},fn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},fn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},fn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},fn.prototype.isMoving=function(){return!!Ga(this._eventsInProgress)||this.isZooming()},fn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},fn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},fn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var x=d[c];this._el.contains(x.target)&&f.push(x)}return f},fn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},x={},S={},T=l.touches?this._getMapTouches(l.touches):void 0,M=T?V.touchPos(this._el,T):V.mousePos(this._el,l),k=0,X=this._handlers;k<X.length;k+=1){var oe=X[k],le=oe.handlerName,he=oe.handler,Pe=oe.allowed;if(he.isEnabled()){var we=void 0;this._blockedByActive(S,Pe,le)?he.reset():he[f||l.type]&&(we=he[f||l.type](l,M,T),this.mergeHandlerResult(d,x,we,le,c),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||he.isActive())&&(S[le]=he)}}var Xe={};for(var Ae in this._previousActiveHandlers)S[Ae]||(Xe[Ae]=c);this._previousActiveHandlers=S,(Object.keys(Xe).length||Sn(d))&&(this._changes.push([d,x,Xe]),this._triggerRenderFrame()),(Object.keys(S).length||Sn(d))&&this._map._stop(!0),this._updatingCamera=!1;var We=d.cameraAnimation;We&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],We(this._map))},fn.prototype.mergeHandlerResult=function(l,f,c,d,x){if(c){v.extend(l,c);var S={handlerName:d,originalEvent:c.originalEvent||x};c.zoomDelta!==void 0&&(f.zoom=S),c.panDelta!==void 0&&(f.drag=S),c.pitchDelta!==void 0&&(f.pitch=S),c.bearingDelta!==void 0&&(f.rotate=S)}},fn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,x=this._changes;d<x.length;d+=1){var S=x[d],T=S[0],M=S[1],k=S[2];T.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(l.around=T.around),T.pinchAround!==void 0&&(l.pinchAround=T.pinchAround),T.noInertia&&(l.noInertia=T.noInertia),v.extend(f,M),v.extend(c,k)}this._updateMapTransform(l,f,c),this._changes=[]},fn.prototype._updateMapTransform=function(l,f,c){var d=this._map,x=d.transform;if(!Sn(l))return this._fireEvents(f,c,!0);var S=l.panDelta,T=l.zoomDelta,M=l.bearingDelta,k=l.pitchDelta,X=l.around,oe=l.pinchAround;oe!==void 0&&(X=oe),d._stop(!0),X=X||d.transform.centerPoint;var le=x.pointLocation(S?X.sub(S):X);M&&(x.bearing+=M),k&&(x.pitch+=k),T&&(x.zoom+=T),x.setLocationAtPoint(le,X),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},fn.prototype._fireEvents=function(l,f,c){var d=this,x=Ga(this._eventsInProgress),S=Ga(l),T={};for(var M in l)this._eventsInProgress[M]||(T[M+"start"]=l[M].originalEvent),this._eventsInProgress[M]=l[M];for(var k in!x&&S&&this._fireEvent("movestart",S.originalEvent),T)this._fireEvent(k,T[k]);for(var X in S&&this._fireEvent("move",S.originalEvent),l)this._fireEvent(X,l[X].originalEvent);var oe,le={};for(var he in this._eventsInProgress){var Pe=this._eventsInProgress[he],we=Pe.handlerName,Xe=Pe.originalEvent;this._handlersById[we].isActive()||(delete this._eventsInProgress[he],le[he+"end"]=oe=f[we]||Xe)}for(var Ae in le)this._fireEvent(Ae,le[Ae]);var We=Ga(this._eventsInProgress);if(c&&(x||S)&&!We){this._updatingCamera=!0;var nt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),vt=function(Vt){return Vt!==0&&-d._bearingSnap<Vt&&Vt<d._bearingSnap};nt?(vt(nt.bearing||this._map.getBearing())&&(nt.bearing=0),this._map.easeTo(nt,{originalEvent:oe})):(this._map.fire(new v.Event("moveend",{originalEvent:oe})),vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},fn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},fn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new ic("renderFrame",{timeStamp:f})),l._applyChanges()})},fn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ts=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,x){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},d),x)},f.prototype.panTo=function(c,d,x){return this.easeTo(v.extend({center:c},d),x)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,x){return this.easeTo(v.extend({zoom:c},d),x)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,x){return this.easeTo(v.extend({bearing:c},d),x)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,v.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=v.LngLatBounds.convert(c);var x=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),x,d)},f.prototype._cameraForBoxAndBearing=function(c,d,x,S){var T={top:0,bottom:0,right:0,left:0};if(typeof(S=v.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){var M=S.padding;S.padding={top:M,bottom:M,right:M,left:M}}S.padding=v.extend(T,S.padding);var k=this.transform,X=k.padding,oe=k.project(v.LngLat.convert(c)),le=k.project(v.LngLat.convert(d)),he=oe.rotate(-x*Math.PI/180),Pe=le.rotate(-x*Math.PI/180),we=new v.Point(Math.max(he.x,Pe.x),Math.max(he.y,Pe.y)),Xe=new v.Point(Math.min(he.x,Pe.x),Math.min(he.y,Pe.y)),Ae=we.sub(Xe),We=(k.width-(X.left+X.right+S.padding.left+S.padding.right))/Ae.x,nt=(k.height-(X.top+X.bottom+S.padding.top+S.padding.bottom))/Ae.y;if(!(nt<0||We<0)){var vt=Math.min(k.scaleZoom(k.scale*Math.min(We,nt)),S.maxZoom),Vt=typeof S.offset.x=="number"?new v.Point(S.offset.x,S.offset.y):v.Point.convert(S.offset),Rt=new v.Point((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(x*Math.PI/180),Xt=Vt.add(Rt).mult(k.scale/k.zoomScale(vt));return{center:k.unproject(oe.add(le).div(2).sub(Xt)),zoom:vt,bearing:x}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,x){return this._fitInternal(this.cameraForBounds(c,d),d,x)},f.prototype.fitScreenCoordinates=function(c,d,x,S,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(d)),x,S),S,T)},f.prototype._fitInternal=function(c,d,x){return c?(delete(d=v.extend(c,d)).padding,d.linear?this.easeTo(d,x):this.flyTo(d,x)):this},f.prototype.jumpTo=function(c,d){this.stop();var x=this.transform,S=!1,T=!1,M=!1;return"zoom"in c&&x.zoom!==+c.zoom&&(S=!0,x.zoom=+c.zoom),c.center!==void 0&&(x.center=v.LngLat.convert(c.center)),"bearing"in c&&x.bearing!==+c.bearing&&(T=!0,x.bearing=+c.bearing),"pitch"in c&&x.pitch!==+c.pitch&&(M=!0,x.pitch=+c.pitch),c.padding==null||x.isPaddingEqual(c.padding)||(x.padding=c.padding),this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),S&&this.fire(new v.Event("zoomstart",d)).fire(new v.Event("zoom",d)).fire(new v.Event("zoomend",d)),T&&this.fire(new v.Event("rotatestart",d)).fire(new v.Event("rotate",d)).fire(new v.Event("rotateend",d)),M&&this.fire(new v.Event("pitchstart",d)).fire(new v.Event("pitch",d)).fire(new v.Event("pitchend",d)),this.fire(new v.Event("moveend",d))},f.prototype.easeTo=function(c,d){var x=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var S=this.transform,T=this.getZoom(),M=this.getBearing(),k=this.getPitch(),X=this.getPadding(),oe="zoom"in c?+c.zoom:T,le="bearing"in c?this._normalizeBearing(c.bearing,M):M,he="pitch"in c?+c.pitch:k,Pe="padding"in c?c.padding:S.padding,we=v.Point.convert(c.offset),Xe=S.centerPoint.add(we),Ae=S.pointLocation(Xe),We=v.LngLat.convert(c.center||Ae);this._normalizeCenter(We);var nt,vt,Vt=S.project(Ae),Rt=S.project(We).sub(Vt),Xt=S.zoomScale(oe-T);c.around&&(nt=v.LngLat.convert(c.around),vt=S.locationPoint(nt));var or={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==T,this._rotating=this._rotating||M!==le,this._pitching=this._pitching||he!==k,this._padding=!S.isPaddingEqual(Pe),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,or),this._ease(function(Pr){if(x._zooming&&(S.zoom=v.number(T,oe,Pr)),x._rotating&&(S.bearing=v.number(M,le,Pr)),x._pitching&&(S.pitch=v.number(k,he,Pr)),x._padding&&(S.interpolatePadding(X,Pe,Pr),Xe=S.centerPoint.add(we)),nt)S.setLocationAtPoint(nt,vt);else{var wr=S.zoomScale(S.zoom-T),en=oe>T?Math.min(2,Xt):Math.max(.5,Xt),An=Math.pow(en,1-Pr),Cn=S.unproject(Vt.add(Rt.mult(Pr*An)).mult(wr));S.setLocationAtPoint(S.renderWorldCopies?Cn.wrap():Cn,Xe)}x._fireMoveEvents(d)},function(Pr){x._afterEase(d,Pr)},c),this},f.prototype._prepareEase=function(c,d,x){x===void 0&&(x={}),this._moving=!0,d||x.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!x.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!x.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!x.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var x=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new v.Event("zoomend",c)),S&&this.fire(new v.Event("rotateend",c)),T&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var x=this;if(!c.essential&&v.browser.prefersReducedMotion){var S=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(S,d)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var T=this.transform,M=this.getZoom(),k=this.getBearing(),X=this.getPitch(),oe=this.getPadding(),le="zoom"in c?v.clamp(+c.zoom,T.minZoom,T.maxZoom):M,he="bearing"in c?this._normalizeBearing(c.bearing,k):k,Pe="pitch"in c?+c.pitch:X,we="padding"in c?c.padding:T.padding,Xe=T.zoomScale(le-M),Ae=v.Point.convert(c.offset),We=T.centerPoint.add(Ae),nt=T.pointLocation(We),vt=v.LngLat.convert(c.center||nt);this._normalizeCenter(vt);var Vt=T.project(nt),Rt=T.project(vt).sub(Vt),Xt=c.curve,or=Math.max(T.width,T.height),Pr=or/Xe,wr=Rt.mag();if("minZoom"in c){var en=v.clamp(Math.min(c.minZoom,M,le),T.minZoom,T.maxZoom),An=or/T.zoomScale(en-M);Xt=Math.sqrt(An/wr*2)}var Cn=Xt*Xt;function vn(Bn){var On=(Pr*Pr-or*or+(Bn?-1:1)*Cn*Cn*wr*wr)/(2*(Bn?Pr:or)*Cn*wr);return Math.log(Math.sqrt(On*On+1)-On)}function wi(Bn){return(Math.exp(Bn)-Math.exp(-Bn))/2}function Kr(Bn){return(Math.exp(Bn)+Math.exp(-Bn))/2}var Hn=vn(0),si=function(Bn){return Kr(Hn)/Kr(Hn+Xt*Bn)},jn=function(Bn){return or*((Kr(Hn)*(wi(On=Hn+Xt*Bn)/Kr(On))-wi(Hn))/Cn)/wr;var On},Un=(vn(1)-Hn)/Xt;if(Math.abs(wr)<1e-6||!isFinite(Un)){if(Math.abs(or-Pr)<1e-6)return this.easeTo(c,d);var ei=Pr<or?-1:1;Un=Math.abs(Math.log(Pr/or))/Xt,jn=function(){return 0},si=function(Bn){return Math.exp(ei*Xt*Bn)}}return c.duration="duration"in c?+c.duration:1e3*Un/("screenSpeed"in c?+c.screenSpeed/Xt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=k!==he,this._pitching=Pe!==X,this._padding=!T.isPaddingEqual(we),this._prepareEase(d,!1),this._ease(function(Bn){var On=Bn*Un,Oo=1/si(On);T.zoom=Bn===1?le:M+T.scaleZoom(Oo),x._rotating&&(T.bearing=v.number(k,he,Bn)),x._pitching&&(T.pitch=v.number(X,Pe,Bn)),x._padding&&(T.interpolatePadding(oe,we,Bn),We=T.centerPoint.add(Ae));var Do=Bn===1?vt:T.unproject(Vt.add(Rt.mult(jn(On))).mult(Oo));T.setLocationAtPoint(T.renderWorldCopies?Do.wrap():Do,We),x._fireMoveEvents(d)},function(){return x._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,d)}if(!c){var S=this.handlers;S&&S.stop(!1)}return this},f.prototype._ease=function(c,d,x){x.animate===!1||x.duration===0?(c(1),d()):(this._easeStart=v.browser.now(),this._easeOptions=x,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=v.wrap(c,-180,180);var x=Math.abs(c-d);return Math.abs(c-360-d)<x&&(c-=360),Math.abs(c+360-d)<x&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var x=c.lng-d.center.lng;c.lng+=x>180?-360:x<-180?360:0}},f}(v.Evented),Xa=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Xa.prototype.getDefaultPosition=function(){return"bottom-right"},Xa.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Xa.prototype.onRemove=function(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Xa.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},Xa.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Xa.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,x,S){return x.value&&(d+=x.key+"="+x.value+(S<f.length-1?"&":"")),d},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},Xa.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Xa.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(M){return typeof M!="string"?"":M})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var x=c[d];if(x.used){var S=x.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort(function(M,k){return M.length-k.length});var T=(l=l.filter(function(M,k){for(var X=k+1;X<l.length;X++)if(l[X].indexOf(M)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,l.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Xa.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var $s=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};$s.prototype.onAdd=function(l){this._map=l,this._container=V.create("div","mapboxgl-ctrl");var f=V.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},$s.prototype.onRemove=function(){V.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},$s.prototype.getDefaultPosition=function(){return"bottom-left"},$s.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},$s.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},$s.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Ro=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ro.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Ro.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var x=d[c];if(x.id===l)return void(x.cancelled=!0)}},Ro.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var x=d[c];if(!x.cancelled&&(x.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ro.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Qs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Cu=v.window.HTMLImageElement,ll=v.window.HTMLElement,Vi=v.window.ImageBitmap,wa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Wf=function(l){function f(d){var x=this;if((d=v.extend({},wa,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var S=new Ei(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,S,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Ro,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Qs,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new v.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=v.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof ll))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return x._update(!1)}),this.on("moveend",function(){return x._update(!1)}),this.on("zoom",function(){return x._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new fn(this,d),this._hash=d.hash&&new as(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,v.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Xa({customAttribution:d.customAttribution})),this.addControl(new $s,d.logoPosition),this.on("style.load",function(){x.transform.unmodified&&x.jumpTo(x.style.stylesheet)}),this.on("data",function(T){x._update(T.dataType==="style"),x.fire(new v.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){x.fire(new v.Event(T.dataType+"dataloading",T))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,x){if(x===void 0&&(x=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var S=d.onAdd(this);this._controls.push(d);var T=this._controlPositions[x];return x.indexOf("bottom")!==-1?T.insertBefore(S,T.firstChild):T.appendChild(S),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var x=this._controls.indexOf(d);return x>-1&&this._controls.splice(x,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var x=this._containerDimensions(),S=x[0],T=x[1];if(S===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(S,T),this.transform.resize(S,T),this.painter.resize(S,T);var M=!this._moving;return M&&this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),this.fire(new v.Event("resize",d)),M&&this.fire(new v.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(v.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(v.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(v.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,x,S){var T,M=this;if(d==="mouseenter"||d==="mouseover"){var k=!1;return{layer:x,listener:S,delegates:{mousemove:function(oe){var le=M.getLayer(x)?M.queryRenderedFeatures(oe.point,{layers:[x]}):[];le.length?k||(k=!0,S.call(M,new wo(d,M,oe.originalEvent,{features:le}))):k=!1},mouseout:function(){k=!1}}}}if(d==="mouseleave"||d==="mouseout"){var X=!1;return{layer:x,listener:S,delegates:{mousemove:function(oe){(M.getLayer(x)?M.queryRenderedFeatures(oe.point,{layers:[x]}):[]).length?X=!0:X&&(X=!1,S.call(M,new wo(d,M,oe.originalEvent)))},mouseout:function(oe){X&&(X=!1,S.call(M,new wo(d,M,oe.originalEvent)))}}}}return{layer:x,listener:S,delegates:(T={},T[d]=function(oe){var le=M.getLayer(x)?M.queryRenderedFeatures(oe.point,{layers:[x]}):[];le.length&&(oe.features=le,S.call(M,oe),delete oe.features)},T)}},f.prototype.on=function(d,x,S){if(S===void 0)return l.prototype.on.call(this,d,x);var T=this._createDelegatedListener(d,x,S);for(var M in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(T),T.delegates)this.on(M,T.delegates[M]);return this},f.prototype.once=function(d,x,S){if(S===void 0)return l.prototype.once.call(this,d,x);var T=this._createDelegatedListener(d,x,S);for(var M in T.delegates)this.once(M,T.delegates[M]);return this},f.prototype.off=function(d,x,S){var T=this;return S===void 0?l.prototype.off.call(this,d,x):(this._delegatedListeners&&this._delegatedListeners[d]&&function(M){for(var k=M[d],X=0;X<k.length;X++){var oe=k[X];if(oe.layer===x&&oe.listener===S){for(var le in oe.delegates)T.off(le,oe.delegates[le]);return k.splice(X,1),T}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,x){if(!this.style)return[];var S;if(x!==void 0||d===void 0||d instanceof v.Point||Array.isArray(d)||(x=d,d=void 0),x=x||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof d[0]=="number")S=[v.Point.convert(d)];else{var T=v.Point.convert(d[0]),M=v.Point.convert(d[1]);S=[T,new v.Point(M.x,T.y),M,new v.Point(T.x,M.y),T]}return this.style.queryRenderedFeatures(S,x,this.transform)},f.prototype.querySourceFeatures=function(d,x){return this.style.querySourceFeatures(d,x)},f.prototype.setStyle=function(d,x){return(x=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},x)).diff!==!1&&x.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,x),this):(this._localIdeographFontFamily=x.localIdeographFontFamily,this._updateStyle(d,x))},f.prototype._getUIString=function(d){var x=this._locale[d];if(x==null)throw new Error("Missing UI string '"+d+"'");return x},f.prototype._updateStyle=function(d,x){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new xs(this,x||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new xs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,x){var S=this;if(typeof d=="string"){var T=this._requestManager.normalizeStyleURL(d),M=this._requestManager.transformRequest(T,v.ResourceType.Style);v.getJSON(M,function(k,X){k?S.fire(new v.ErrorEvent(k)):X&&S._updateDiff(X,x)})}else typeof d=="object"&&this._updateDiff(d,x)},f.prototype._updateDiff=function(d,x){try{this.style.setState(d)&&this._update(!0)}catch(S){v.warnOnce("Unable to perform style diff: "+(S.message||S.error||S)+".  Rebuilding the style from scratch."),this._updateStyle(d,x)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,x){return this._lazyInitEmptyStyle(),this.style.addSource(d,x),this._update(!0)},f.prototype.isSourceLoaded=function(d){var x=this.style&&this.style.sourceCaches[d];if(x!==void 0)return x.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var x in d){var S=d[x]._tiles;for(var T in S){var M=S[T];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,x,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,x,S)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,x,S){S===void 0&&(S={});var T=S.pixelRatio;T===void 0&&(T=1);var M=S.sdf;M===void 0&&(M=!1);var k=S.stretchX,X=S.stretchY,oe=S.content;if(this._lazyInitEmptyStyle(),x instanceof Cu||Vi&&x instanceof Vi){var le=v.browser.getImageData(x);this.style.addImage(d,{data:new v.RGBAImage({width:le.width,height:le.height},le.data),pixelRatio:T,stretchX:k,stretchY:X,content:oe,sdf:M,version:0})}else{if(x.width===void 0||x.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var he=x;this.style.addImage(d,{data:new v.RGBAImage({width:x.width,height:x.height},new Uint8Array(x.data)),pixelRatio:T,stretchX:k,stretchY:X,content:oe,sdf:M,version:0,userImage:he}),he.onAdd&&he.onAdd(this,d)}},f.prototype.updateImage=function(d,x){var S=this.style.getImage(d);if(!S)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=x instanceof Cu||Vi&&x instanceof Vi?v.browser.getImageData(x):x,M=T.width,k=T.height,X=T.data;return M===void 0||k===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):M!==S.data.width||k!==S.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(X,!(x instanceof Cu||Vi&&x instanceof Vi)),void this.style.updateImage(d,S))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,x){v.getImage(this._requestManager.transformRequest(d,v.ResourceType.Image),x)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,x){return this._lazyInitEmptyStyle(),this.style.addLayer(d,x),this._update(!0)},f.prototype.moveLayer=function(d,x){return this.style.moveLayer(d,x),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,x,S){return this.style.setLayerZoomRange(d,x,S),this._update(!0)},f.prototype.setFilter=function(d,x,S){return S===void 0&&(S={}),this.style.setFilter(d,x,S),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,x,S,T){return T===void 0&&(T={}),this.style.setPaintProperty(d,x,S,T),this._update(!0)},f.prototype.getPaintProperty=function(d,x){return this.style.getPaintProperty(d,x)},f.prototype.setLayoutProperty=function(d,x,S,T){return T===void 0&&(T={}),this.style.setLayoutProperty(d,x,S,T),this._update(!0)},f.prototype.getLayoutProperty=function(d,x){return this.style.getLayoutProperty(d,x)},f.prototype.setLight=function(d,x){return x===void 0&&(x={}),this._lazyInitEmptyStyle(),this.style.setLight(d,x),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,x){return this.style.setFeatureState(d,x),this._update()},f.prototype.removeFeatureState=function(d,x){return this.style.removeFeatureState(d,x),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,x=0;return this._container&&(d=this._container.clientWidth||400,x=this._container.clientHeight||300),[d,x]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=V.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var x=this._canvasContainer=V.create("div","mapboxgl-canvas-container",d);this._interactive&&x.classList.add("mapboxgl-interactive"),this._canvas=V.create("canvas","mapboxgl-canvas",x),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var S=this._containerDimensions();this._resizeCanvas(S[0],S[1]);var T=this._controlContainer=V.create("div","mapboxgl-control-container",d),M=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(k){M[k]=V.create("div","mapboxgl-ctrl-"+k,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,x){var S=v.browser.devicePixelRatio||1;this._canvas.width=S*d,this._canvas.height=S*x,this._canvas.style.width=d+"px",this._canvas.style.height=x+"px"},f.prototype._setupPainter=function(){var d=v.extend({},it.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),x=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);x?(this.painter=new go(x,this.transform),v.webpSupported.testSupport(x)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var x,S=this,T=0,M=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(x=M.createQueryEXT(),M.beginQueryEXT(M.TIME_ELAPSED_EXT,x),T=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,oe=v.browser.now();this.style.zoomHistory.update(X,oe);var le=new v.EvaluationParameters(X,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),he=le.crossFadingFactor();he===1&&he===this._crossFadingFactor||(k=!0,this._crossFadingFactor=he),this.style.update(le)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Pe=v.browser.now()-T;M.endQueryEXT(M.TIME_ELAPSED_EXT,x),setTimeout(function(){var Ae=M.getQueryObjectEXT(x,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(x),S.fire(new v.Event("gpu-timing-frame",{cpuTime:Pe,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var we=this.painter.collectGpuTimers();setTimeout(function(){var Ae=S.painter.queryGpuTimers(we);S.fire(new v.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var Xe=this._sourcesDirty||this._styleDirty||this._placementDirty;return Xe||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||Xe||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,x=this._controls;d<x.length;d+=1)x[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var S=this.painter.context.gl.getExtension("WEBGL_lose_context");S&&S.loseContext(),cl(this._canvasContainer),cl(this._controlContainer),cl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(x){d._frame=null,d._render(x)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,x){v.setCacheLimits(d,x)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(Ts);function cl(l){l.parentNode&&l.parentNode.removeChild(l)}var vf={showCompass:!0,showZoom:!0,visualizePitch:!1},Wu=function(l){var f=this;this.options=v.extend({},vf,l),this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),V.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),V.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=V.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Wu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Wu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Wu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new us(this._map,this._compass,this.options.visualizePitch)),this._container},Wu.prototype.onRemove=function(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Wu.prototype._createButton=function(l,f){var c=V.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Wu.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var us=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new nc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new df({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),V.addEventListener(f,"mousedown",this.mousedown),V.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(f,"touchmove",this.touchmove),V.addEventListener(f,"touchend",this.touchend),V.addEventListener(f,"touchcancel",this.reset)};function oc(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var d=new v.LngLat(l.lng-360,l.lat),x=new v.LngLat(l.lng+360,l.lat),S=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<S?l=d:c.locationPoint(x).distSqr(f)<S&&(l=x)}for(;Math.abs(l.lng-c.center.lng)>180;){var T=c.locationPoint(l);if(T.x>=0&&T.y>=0&&T.x<=c.width&&T.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}us.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),V.disableDrag()},us.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var x=this.mousePitch.mousemoveWindow(l,f);x&&x.pitchDelta&&c.setPitch(c.getPitch()+x.pitchDelta)}},us.prototype.off=function(){var l=this.element;V.removeEventListener(l,"mousedown",this.mousedown),V.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(l,"touchmove",this.touchmove),V.removeEventListener(l,"touchend",this.touchend),V.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},us.prototype.offTemp=function(){V.enableDrag(),V.removeEventListener(v.window,"mousemove",this.mousemove),V.removeEventListener(v.window,"mouseup",this.mouseup)},us.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),V.mousePos(this.element,l)),V.addEventListener(v.window,"mousemove",this.mousemove),V.addEventListener(v.window,"mouseup",this.mouseup)},us.prototype.mousemove=function(l){this.move(l,V.mousePos(this.element,l))},us.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},us.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},us.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},us.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},us.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var wu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ac(l,f,c){var d=l.classList;for(var x in wu)d.remove("mapboxgl-"+c+"-anchor-"+x);d.add("mapboxgl-"+c+"-anchor-"+f)}var Ol,_f=function(l){function f(c,d){if(l.call(this),(c instanceof v.window.HTMLElement||d)&&(c=v.extend({element:c},d)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div"),this._element.setAttribute("aria-label","Map marker");var x=V.createNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","41px"),x.setAttributeNS(null,"width","27px"),x.setAttributeNS(null,"viewBox","0 0 27 41");var S=V.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var T=V.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var M=V.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");for(var k=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];k<X.length;k+=1){var oe=X[k],le=V.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",oe.rx),le.setAttributeNS(null,"ry",oe.ry),M.appendChild(le)}var he=V.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"fill",this._color);var Pe=V.createNS("http://www.w3.org/2000/svg","path");Pe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),he.appendChild(Pe);var we=V.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"fill","#000000");var Xe=V.createNS("http://www.w3.org/2000/svg","path");Xe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),we.appendChild(Xe);var Ae=V.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var We=V.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"transform","translate(8.0, 8.0)");var nt=V.createNS("http://www.w3.org/2000/svg","circle");nt.setAttributeNS(null,"fill","#000000"),nt.setAttributeNS(null,"opacity","0.25"),nt.setAttributeNS(null,"cx","5.5"),nt.setAttributeNS(null,"cy","5.5"),nt.setAttributeNS(null,"r","5.4999962");var vt=V.createNS("http://www.w3.org/2000/svg","circle");vt.setAttributeNS(null,"fill","#FFFFFF"),vt.setAttributeNS(null,"cx","5.5"),vt.setAttributeNS(null,"cy","5.5"),vt.setAttributeNS(null,"r","5.4999962"),We.appendChild(nt),We.appendChild(vt),T.appendChild(M),T.appendChild(he),T.appendChild(we),T.appendChild(Ae),T.appendChild(We),x.appendChild(T),x.setAttributeNS(null,"height",41*this._scale+"px"),x.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(x),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Vt){Vt.preventDefault()}),this._element.addEventListener("mousedown",function(Vt){Vt.preventDefault()}),ac(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,x=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&x!==32&&x!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,x=this._element;this._popup&&(d===x||x.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=oc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,wu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+x+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),gf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},fl=0,Dl=!1,Ll=function(l){function f(c){l.call(this),this.options=v.extend({},gf,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Ol!==void 0?d(Ol):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(x){d(Ol=x.state!=="denied")}):d(Ol=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,fl=0,Dl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),x=c.coords;return d&&(x.longitude<d.getWest()||x.longitude>d.getEast()||x.latitude<d.getSouth()||x.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude),x=c.coords.accuracy,S=this._map.getBearing(),T=v.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(x),T,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),x=this._map.unproject([1,c]),S=d.distanceTo(x),T=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Dl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=V.create("button","mapboxgl-ctrl-geolocate",this._container),V.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{var S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new _f(this._dotElement),this._circleElement=V.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _f({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||d._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":fl--,Dl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++fl>1?(c={maximumAge:6e5,timeout:0},Dl=!0):(c=this.options.positionOptions,Dl=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),aa={maxWidth:100,unit:"metric"},Js=function(l){this.options=v.extend({},aa,l),v.bindAll(["_onMove","setUnit"],this)};function zc(l,f,c){var d=c&&c.maxWidth||100,x=l._container.clientHeight/2,S=l.unproject([0,x]),T=l.unproject([d,x]),M=S.distanceTo(T);if(c&&c.unit==="imperial"){var k=3.2808*M;k>5280?uu(f,d,k/5280,l._getUIString("ScaleControl.Miles")):uu(f,d,k,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?uu(f,d,M/1852,l._getUIString("ScaleControl.NauticalMiles")):M>=1e3?uu(f,d,M/1e3,l._getUIString("ScaleControl.Kilometers")):uu(f,d,M,l._getUIString("ScaleControl.Meters"))}function uu(l,f,c,d){var x,S,T,M=(x=c,(S=Math.pow(10,(""+Math.floor(x)).length-1))*(T=(T=x/S)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(k){var X=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*X)/X}(T)));l.style.width=f*(M/c)+"px",l.innerHTML=M+"&nbsp;"+d}Js.prototype.getDefaultPosition=function(){return"bottom-left"},Js.prototype._onMove=function(){zc(this._map,this._container,this.options)},Js.prototype.onAdd=function(l){return this._map=l,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Js.prototype.onRemove=function(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Js.prototype.setUnit=function(l){this.options.unit=l,zc(this._map,this._container,this.options)};var eu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};eu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},eu.prototype.onRemove=function(){V.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},eu.prototype._setupUI=function(){var l=this._fullscreenButton=V.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},eu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},eu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},eu.prototype._isFullscreen=function(){return this._fullscreen},eu.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},eu.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Gf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Zc=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(Gf),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,x=v.window.document.createDocumentFragment(),S=v.window.document.createElement("body");for(S.innerHTML=c;d=S.firstChild;)x.appendChild(d);return this.setDOMContent(x)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=V.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=V.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=V.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(le){return d._container.classList.add(le)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=oc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var x=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),S=this.options.anchor,T=function le(he){if(he){if(typeof he=="number"){var Pe=Math.round(Math.sqrt(.5*Math.pow(he,2)));return{center:new v.Point(0,0),top:new v.Point(0,he),"top-left":new v.Point(Pe,Pe),"top-right":new v.Point(-Pe,Pe),bottom:new v.Point(0,-he),"bottom-left":new v.Point(Pe,-Pe),"bottom-right":new v.Point(-Pe,-Pe),left:new v.Point(he,0),right:new v.Point(-he,0)}}if(he instanceof v.Point||Array.isArray(he)){var we=v.Point.convert(he);return{center:we,top:we,"top-left":we,"top-right":we,bottom:we,"bottom-left":we,"bottom-right":we,left:we,right:we}}return{center:v.Point.convert(he.center||[0,0]),top:v.Point.convert(he.top||[0,0]),"top-left":v.Point.convert(he["top-left"]||[0,0]),"top-right":v.Point.convert(he["top-right"]||[0,0]),bottom:v.Point.convert(he.bottom||[0,0]),"bottom-left":v.Point.convert(he["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(he["bottom-right"]||[0,0]),left:v.Point.convert(he.left||[0,0]),right:v.Point.convert(he.right||[0,0])}}return le(new v.Point(0,0))}(this.options.offset);if(!S){var M,k=this._container.offsetWidth,X=this._container.offsetHeight;M=x.y+T.bottom.y<X?["top"]:x.y>this._map.transform.height-X?["bottom"]:[],x.x<k/2?M.push("left"):x.x>this._map.transform.width-k/2&&M.push("right"),S=M.length===0?"bottom":M.join("-")}var oe=x.add(T[S]).round();V.setTransform(this._container,wu[S]+" translate("+oe.x+"px,"+oe.y+"px)"),ac(this._container,S,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Vc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),sc={version:v.version,supported:it,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Wf,NavigationControl:Wu,GeolocateControl:Ll,AttributionControl:Xa,ScaleControl:Js,FullscreenControl:eu,Popup:Zc,Marker:_f,Style:xs,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Bt().acquire(Ct)},clearPrewarmedResources:function(){var l=Br;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ct),Br=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return tr.workerCount},set workerCount(l){tr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return sc}),Oe})},3614:function(hr,qt,N){"use strict";hr.exports=Qe;var Oe=N(80645);function Qe(K){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(K)?K:new Uint8Array(K||0),this.pos=0,this.type=0,this.length=this.buf.length}Qe.Varint=0,Qe.Fixed64=1,Qe.Bytes=2,Qe.Fixed32=5;var v=65536*65536,it=1/v,V=12,se=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Qe.prototype={destroy:function(){this.buf=null},readFields:function(K,_e,Y){for(Y=Y||this.length;this.pos<Y;){var ve=this.readVarint(),fe=ve>>3,He=this.pos;this.type=ve&7,K(fe,_e,this),this.pos===He&&this.skip(ve)}return _e},readMessage:function(K,_e){return this.readFields(K,_e,this.readVarint()+this.pos)},readFixed32:function(){var K=Mt(this.buf,this.pos);return this.pos+=4,K},readSFixed32:function(){var K=Wt(this.buf,this.pos);return this.pos+=4,K},readFixed64:function(){var K=Mt(this.buf,this.pos)+Mt(this.buf,this.pos+4)*v;return this.pos+=8,K},readSFixed64:function(){var K=Mt(this.buf,this.pos)+Wt(this.buf,this.pos+4)*v;return this.pos+=8,K},readFloat:function(){var K=Oe.read(this.buf,this.pos,!0,23,4);return this.pos+=4,K},readDouble:function(){var K=Oe.read(this.buf,this.pos,!0,52,8);return this.pos+=8,K},readVarint:function(K){var _e=this.buf,Y,ve;return ve=_e[this.pos++],Y=ve&127,ve<128||(ve=_e[this.pos++],Y|=(ve&127)<<7,ve<128)||(ve=_e[this.pos++],Y|=(ve&127)<<14,ve<128)||(ve=_e[this.pos++],Y|=(ve&127)<<21,ve<128)?Y:(ve=_e[this.pos],Y|=(ve&15)<<28,W(Y,K,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var K=this.readVarint();return K%2===1?(K+1)/-2:K/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var K=this.readVarint()+this.pos,_e=this.pos;return this.pos=K,K-_e>=V&&se?nr(this.buf,_e,K):ct(this.buf,_e,K)},readBytes:function(){var K=this.readVarint()+this.pos,_e=this.buf.subarray(this.pos,K);return this.pos=K,_e},readPackedVarint:function(K,_e){if(this.type!==Qe.Bytes)return K.push(this.readVarint(_e));var Y=ne(this);for(K=K||[];this.pos<Y;)K.push(this.readVarint(_e));return K},readPackedSVarint:function(K){if(this.type!==Qe.Bytes)return K.push(this.readSVarint());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readSVarint());return K},readPackedBoolean:function(K){if(this.type!==Qe.Bytes)return K.push(this.readBoolean());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readBoolean());return K},readPackedFloat:function(K){if(this.type!==Qe.Bytes)return K.push(this.readFloat());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readFloat());return K},readPackedDouble:function(K){if(this.type!==Qe.Bytes)return K.push(this.readDouble());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readDouble());return K},readPackedFixed32:function(K){if(this.type!==Qe.Bytes)return K.push(this.readFixed32());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readFixed32());return K},readPackedSFixed32:function(K){if(this.type!==Qe.Bytes)return K.push(this.readSFixed32());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readSFixed32());return K},readPackedFixed64:function(K){if(this.type!==Qe.Bytes)return K.push(this.readFixed64());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readFixed64());return K},readPackedSFixed64:function(K){if(this.type!==Qe.Bytes)return K.push(this.readSFixed64());var _e=ne(this);for(K=K||[];this.pos<_e;)K.push(this.readSFixed64());return K},skip:function(K){var _e=K&7;if(_e===Qe.Varint)for(;this.buf[this.pos++]>127;);else if(_e===Qe.Bytes)this.pos=this.readVarint()+this.pos;else if(_e===Qe.Fixed32)this.pos+=4;else if(_e===Qe.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+_e)},writeTag:function(K,_e){this.writeVarint(K<<3|_e)},realloc:function(K){for(var _e=this.length||16;_e<this.pos+K;)_e*=2;if(_e!==this.length){var Y=new Uint8Array(_e);Y.set(this.buf),this.buf=Y,this.length=_e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(K){this.realloc(4),ze(this.buf,K,this.pos),this.pos+=4},writeSFixed32:function(K){this.realloc(4),ze(this.buf,K,this.pos),this.pos+=4},writeFixed64:function(K){this.realloc(8),ze(this.buf,K&-1,this.pos),ze(this.buf,Math.floor(K*it),this.pos+4),this.pos+=8},writeSFixed64:function(K){this.realloc(8),ze(this.buf,K&-1,this.pos),ze(this.buf,Math.floor(K*it),this.pos+4),this.pos+=8},writeVarint:function(K){if(K=+K||0,K>268435455||K<0){Ke(K,this);return}this.realloc(4),this.buf[this.pos++]=K&127|(K>127?128:0),!(K<=127)&&(this.buf[this.pos++]=(K>>>=7)&127|(K>127?128:0),!(K<=127)&&(this.buf[this.pos++]=(K>>>=7)&127|(K>127?128:0),!(K<=127)&&(this.buf[this.pos++]=K>>>7&127)))},writeSVarint:function(K){this.writeVarint(K<0?-K*2-1:K*2)},writeBoolean:function(K){this.writeVarint(!!K)},writeString:function(K){K=String(K),this.realloc(K.length*4),this.pos++;var _e=this.pos;this.pos=Lr(this.buf,K,this.pos);var Y=this.pos-_e;Y>=128&&ht(_e,Y,this),this.pos=_e-1,this.writeVarint(Y),this.pos+=Y},writeFloat:function(K){this.realloc(4),Oe.write(this.buf,K,this.pos,!0,23,4),this.pos+=4},writeDouble:function(K){this.realloc(8),Oe.write(this.buf,K,this.pos,!0,52,8),this.pos+=8},writeBytes:function(K){var _e=K.length;this.writeVarint(_e),this.realloc(_e);for(var Y=0;Y<_e;Y++)this.buf[this.pos++]=K[Y]},writeRawMessage:function(K,_e){this.pos++;var Y=this.pos;K(_e,this);var ve=this.pos-Y;ve>=128&&ht(Y,ve,this),this.pos=Y-1,this.writeVarint(ve),this.pos+=ve},writeMessage:function(K,_e,Y){this.writeTag(K,Qe.Bytes),this.writeRawMessage(_e,Y)},writePackedVarint:function(K,_e){_e.length&&this.writeMessage(K,ae,_e)},writePackedSVarint:function(K,_e){_e.length&&this.writeMessage(K,At,_e)},writePackedBoolean:function(K,_e){_e.length&&this.writeMessage(K,mr,_e)},writePackedFloat:function(K,_e){_e.length&&this.writeMessage(K,wt,_e)},writePackedDouble:function(K,_e){_e.length&&this.writeMessage(K,et,_e)},writePackedFixed32:function(K,_e){_e.length&&this.writeMessage(K,pr,_e)},writePackedSFixed32:function(K,_e){_e.length&&this.writeMessage(K,yn,_e)},writePackedFixed64:function(K,_e){_e.length&&this.writeMessage(K,bi,_e)},writePackedSFixed64:function(K,_e){_e.length&&this.writeMessage(K,$n,_e)},writeBytesField:function(K,_e){this.writeTag(K,Qe.Bytes),this.writeBytes(_e)},writeFixed32Field:function(K,_e){this.writeTag(K,Qe.Fixed32),this.writeFixed32(_e)},writeSFixed32Field:function(K,_e){this.writeTag(K,Qe.Fixed32),this.writeSFixed32(_e)},writeFixed64Field:function(K,_e){this.writeTag(K,Qe.Fixed64),this.writeFixed64(_e)},writeSFixed64Field:function(K,_e){this.writeTag(K,Qe.Fixed64),this.writeSFixed64(_e)},writeVarintField:function(K,_e){this.writeTag(K,Qe.Varint),this.writeVarint(_e)},writeSVarintField:function(K,_e){this.writeTag(K,Qe.Varint),this.writeSVarint(_e)},writeStringField:function(K,_e){this.writeTag(K,Qe.Bytes),this.writeString(_e)},writeFloatField:function(K,_e){this.writeTag(K,Qe.Fixed32),this.writeFloat(_e)},writeDoubleField:function(K,_e){this.writeTag(K,Qe.Fixed64),this.writeDouble(_e)},writeBooleanField:function(K,_e){this.writeVarintField(K,!!_e)}};function W(K,_e,Y){var ve=Y.buf,fe,He;if(He=ve[Y.pos++],fe=(He&112)>>4,He<128||(He=ve[Y.pos++],fe|=(He&127)<<3,He<128)||(He=ve[Y.pos++],fe|=(He&127)<<10,He<128)||(He=ve[Y.pos++],fe|=(He&127)<<17,He<128)||(He=ve[Y.pos++],fe|=(He&127)<<24,He<128)||(He=ve[Y.pos++],fe|=(He&1)<<31,He<128))return G(K,fe,_e);throw new Error("Expected varint not more than 10 bytes")}function ne(K){return K.type===Qe.Bytes?K.readVarint()+K.pos:K.pos+1}function G(K,_e,Y){return Y?_e*4294967296+(K>>>0):(_e>>>0)*4294967296+(K>>>0)}function Ke(K,_e){var Y,ve;if(K>=0?(Y=K%4294967296|0,ve=K/4294967296|0):(Y=~(-K%4294967296),ve=~(-K/4294967296),Y^4294967295?Y=Y+1|0:(Y=0,ve=ve+1|0)),K>=18446744073709552e3||K<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");_e.realloc(10),De(Y,ve,_e),ge(ve,_e)}function De(K,_e,Y){Y.buf[Y.pos++]=K&127|128,K>>>=7,Y.buf[Y.pos++]=K&127|128,K>>>=7,Y.buf[Y.pos++]=K&127|128,K>>>=7,Y.buf[Y.pos++]=K&127|128,K>>>=7,Y.buf[Y.pos]=K&127}function ge(K,_e){var Y=(K&7)<<4;_e.buf[_e.pos++]|=Y|((K>>>=3)?128:0),K&&(_e.buf[_e.pos++]=K&127|((K>>>=7)?128:0),K&&(_e.buf[_e.pos++]=K&127|((K>>>=7)?128:0),K&&(_e.buf[_e.pos++]=K&127|((K>>>=7)?128:0),K&&(_e.buf[_e.pos++]=K&127|((K>>>=7)?128:0),K&&(_e.buf[_e.pos++]=K&127)))))}function ht(K,_e,Y){var ve=_e<=16383?1:_e<=2097151?2:_e<=268435455?3:Math.floor(Math.log(_e)/(Math.LN2*7));Y.realloc(ve);for(var fe=Y.pos-1;fe>=K;fe--)Y.buf[fe+ve]=Y.buf[fe]}function ae(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeVarint(K[Y])}function At(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeSVarint(K[Y])}function wt(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeFloat(K[Y])}function et(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeDouble(K[Y])}function mr(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeBoolean(K[Y])}function pr(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeFixed32(K[Y])}function yn(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeSFixed32(K[Y])}function bi(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeFixed64(K[Y])}function $n(K,_e){for(var Y=0;Y<K.length;Y++)_e.writeSFixed64(K[Y])}function Mt(K,_e){return(K[_e]|K[_e+1]<<8|K[_e+2]<<16)+K[_e+3]*16777216}function ze(K,_e,Y){K[Y]=_e,K[Y+1]=_e>>>8,K[Y+2]=_e>>>16,K[Y+3]=_e>>>24}function Wt(K,_e){return(K[_e]|K[_e+1]<<8|K[_e+2]<<16)+(K[_e+3]<<24)}function ct(K,_e,Y){for(var ve="",fe=_e;fe<Y;){var He=K[fe],at=null,_t=He>239?4:He>223?3:He>191?2:1;if(fe+_t>Y)break;var Tt,Pt,Xr;_t===1?He<128&&(at=He):_t===2?(Tt=K[fe+1],(Tt&192)===128&&(at=(He&31)<<6|Tt&63,at<=127&&(at=null))):_t===3?(Tt=K[fe+1],Pt=K[fe+2],(Tt&192)===128&&(Pt&192)===128&&(at=(He&15)<<12|(Tt&63)<<6|Pt&63,(at<=2047||at>=55296&&at<=57343)&&(at=null))):_t===4&&(Tt=K[fe+1],Pt=K[fe+2],Xr=K[fe+3],(Tt&192)===128&&(Pt&192)===128&&(Xr&192)===128&&(at=(He&15)<<18|(Tt&63)<<12|(Pt&63)<<6|Xr&63,(at<=65535||at>=1114112)&&(at=null))),at===null?(at=65533,_t=1):at>65535&&(at-=65536,ve+=String.fromCharCode(at>>>10&1023|55296),at=56320|at&1023),ve+=String.fromCharCode(at),fe+=_t}return ve}function nr(K,_e,Y){return se.decode(K.subarray(_e,Y))}function Lr(K,_e,Y){for(var ve=0,fe,He;ve<_e.length;ve++){if(fe=_e.charCodeAt(ve),fe>55295&&fe<57344)if(He)if(fe<56320){K[Y++]=239,K[Y++]=191,K[Y++]=189,He=fe;continue}else fe=He-55296<<10|fe-56320|65536,He=null;else{fe>56319||ve+1===_e.length?(K[Y++]=239,K[Y++]=191,K[Y++]=189):He=fe;continue}else He&&(K[Y++]=239,K[Y++]=191,K[Y++]=189,He=null);fe<128?K[Y++]=fe:(fe<2048?K[Y++]=fe>>6|192:(fe<65536?K[Y++]=fe>>12|224:(K[Y++]=fe>>18|240,K[Y++]=fe>>12&63|128),K[Y++]=fe>>6&63|128),K[Y++]=fe&63|128)}return Y}},32676:function(hr,qt,N){var Oe=N(34155);(function(Qe,v){hr.exports=v()})(this,function(){"use strict";function Qe(pt,Z){var Q={label:0,sent:function(){if(Le[0]&1)throw Le[1];return Le[1]},trys:[],ops:[]},Ee,Ve,Le,jt;return jt={next:Zt(0),throw:Zt(1),return:Zt(2)},typeof Symbol=="function"&&(jt[Symbol.iterator]=function(){return this}),jt;function Zt(Ft){return function(L){return ur([Ft,L])}}function ur(Ft){if(Ee)throw new TypeError("Generator is already executing.");for(;Q;)try{if(Ee=1,Ve&&(Le=Ft[0]&2?Ve.return:Ft[0]?Ve.throw||((Le=Ve.return)&&Le.call(Ve),0):Ve.next)&&!(Le=Le.call(Ve,Ft[1])).done)return Le;switch(Ve=0,Le&&(Ft=[Ft[0]&2,Le.value]),Ft[0]){case 0:case 1:Le=Ft;break;case 4:return Q.label++,{value:Ft[1],done:!1};case 5:Q.label++,Ve=Ft[1],Ft=[0];continue;case 7:Ft=Q.ops.pop(),Q.trys.pop();continue;default:if(Le=Q.trys,!(Le=Le.length>0&&Le[Le.length-1])&&(Ft[0]===6||Ft[0]===2)){Q=0;continue}if(Ft[0]===3&&(!Le||Ft[1]>Le[0]&&Ft[1]<Le[3])){Q.label=Ft[1];break}if(Ft[0]===6&&Q.label<Le[1]){Q.label=Le[1],Le=Ft;break}if(Le&&Q.label<Le[2]){Q.label=Le[2],Q.ops.push(Ft);break}Le[2]&&Q.ops.pop(),Q.trys.pop();continue}Ft=Z.call(pt,Q)}catch(L){Ft=[6,L],Ve=0}finally{Ee=Le=0}if(Ft[0]&5)throw Ft[1];return{value:Ft[0]?Ft[1]:void 0,done:!0}}}var v=function(){function pt(Z,Q){this.next=null,this.key=Z,this.data=Q,this.left=null,this.right=null}return pt}();function it(pt,Z){return pt>Z?1:pt<Z?-1:0}function V(pt,Z,Q){for(var Ee=new v(null,null),Ve=Ee,Le=Ee;;){var jt=Q(pt,Z.key);if(jt<0){if(Z.left===null)break;if(Q(pt,Z.left.key)<0){var Zt=Z.left;if(Z.left=Zt.right,Zt.right=Z,Z=Zt,Z.left===null)break}Le.left=Z,Le=Z,Z=Z.left}else if(jt>0){if(Z.right===null)break;if(Q(pt,Z.right.key)>0){var Zt=Z.right;if(Z.right=Zt.left,Zt.left=Z,Z=Zt,Z.right===null)break}Ve.right=Z,Ve=Z,Z=Z.right}else break}return Ve.right=Z.left,Le.left=Z.right,Z.left=Ee.right,Z.right=Ee.left,Z}function se(pt,Z,Q,Ee){var Ve=new v(pt,Z);if(Q===null)return Ve.left=Ve.right=null,Ve;Q=V(pt,Q,Ee);var Le=Ee(pt,Q.key);return Le<0?(Ve.left=Q.left,Ve.right=Q,Q.left=null):Le>=0&&(Ve.right=Q.right,Ve.left=Q,Q.right=null),Ve}function W(pt,Z,Q){var Ee=null,Ve=null;if(Z){Z=V(pt,Z,Q);var Le=Q(Z.key,pt);Le===0?(Ee=Z.left,Ve=Z.right):Le<0?(Ve=Z.right,Z.right=null,Ee=Z):(Ee=Z.left,Z.left=null,Ve=Z)}return{left:Ee,right:Ve}}function ne(pt,Z,Q){return Z===null?pt:(pt===null||(Z=V(pt.key,Z,Q),Z.left=pt),Z)}function G(pt,Z,Q,Ee,Ve){if(pt){Ee(""+Z+(Q?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ve(pt)+`
`);var Le=Z+(Q?"    ":"\u2502   ");pt.left&&G(pt.left,Le,!1,Ee,Ve),pt.right&&G(pt.right,Le,!0,Ee,Ve)}}var Ke=function(){function pt(Z){Z===void 0&&(Z=it),this._root=null,this._size=0,this._comparator=Z}return pt.prototype.insert=function(Z,Q){return this._size++,this._root=se(Z,Q,this._root,this._comparator)},pt.prototype.add=function(Z,Q){var Ee=new v(Z,Q);this._root===null&&(Ee.left=Ee.right=null,this._size++,this._root=Ee);var Ve=this._comparator,Le=V(Z,this._root,Ve),jt=Ve(Z,Le.key);return jt===0?this._root=Le:(jt<0?(Ee.left=Le.left,Ee.right=Le,Le.left=null):jt>0&&(Ee.right=Le.right,Ee.left=Le,Le.right=null),this._size++,this._root=Ee),this._root},pt.prototype.remove=function(Z){this._root=this._remove(Z,this._root,this._comparator)},pt.prototype._remove=function(Z,Q,Ee){var Ve;if(Q===null)return null;Q=V(Z,Q,Ee);var Le=Ee(Z,Q.key);return Le===0?(Q.left===null?Ve=Q.right:(Ve=V(Z,Q.left,Ee),Ve.right=Q.right),this._size--,Ve):Q},pt.prototype.pop=function(){var Z=this._root;if(Z){for(;Z.left;)Z=Z.left;return this._root=V(Z.key,this._root,this._comparator),this._root=this._remove(Z.key,this._root,this._comparator),{key:Z.key,data:Z.data}}return null},pt.prototype.findStatic=function(Z){for(var Q=this._root,Ee=this._comparator;Q;){var Ve=Ee(Z,Q.key);if(Ve===0)return Q;Ve<0?Q=Q.left:Q=Q.right}return null},pt.prototype.find=function(Z){return this._root&&(this._root=V(Z,this._root,this._comparator),this._comparator(Z,this._root.key)!==0)?null:this._root},pt.prototype.contains=function(Z){for(var Q=this._root,Ee=this._comparator;Q;){var Ve=Ee(Z,Q.key);if(Ve===0)return!0;Ve<0?Q=Q.left:Q=Q.right}return!1},pt.prototype.forEach=function(Z,Q){for(var Ee=this._root,Ve=[],Le=!1;!Le;)Ee!==null?(Ve.push(Ee),Ee=Ee.left):Ve.length!==0?(Ee=Ve.pop(),Z.call(Q,Ee),Ee=Ee.right):Le=!0;return this},pt.prototype.range=function(Z,Q,Ee,Ve){for(var Le=[],jt=this._comparator,Zt=this._root,ur;Le.length!==0||Zt;)if(Zt)Le.push(Zt),Zt=Zt.left;else{if(Zt=Le.pop(),ur=jt(Zt.key,Q),ur>0)break;if(jt(Zt.key,Z)>=0&&Ee.call(Ve,Zt))return this;Zt=Zt.right}return this},pt.prototype.keys=function(){var Z=[];return this.forEach(function(Q){var Ee=Q.key;return Z.push(Ee)}),Z},pt.prototype.values=function(){var Z=[];return this.forEach(function(Q){var Ee=Q.data;return Z.push(Ee)}),Z},pt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},pt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},pt.prototype.minNode=function(Z){if(Z===void 0&&(Z=this._root),Z)for(;Z.left;)Z=Z.left;return Z},pt.prototype.maxNode=function(Z){if(Z===void 0&&(Z=this._root),Z)for(;Z.right;)Z=Z.right;return Z},pt.prototype.at=function(Z){for(var Q=this._root,Ee=!1,Ve=0,Le=[];!Ee;)if(Q)Le.push(Q),Q=Q.left;else if(Le.length>0){if(Q=Le.pop(),Ve===Z)return Q;Ve++,Q=Q.right}else Ee=!0;return null},pt.prototype.next=function(Z){var Q=this._root,Ee=null;if(Z.right){for(Ee=Z.right;Ee.left;)Ee=Ee.left;return Ee}for(var Ve=this._comparator;Q;){var Le=Ve(Z.key,Q.key);if(Le===0)break;Le<0?(Ee=Q,Q=Q.left):Q=Q.right}return Ee},pt.prototype.prev=function(Z){var Q=this._root,Ee=null;if(Z.left!==null){for(Ee=Z.left;Ee.right;)Ee=Ee.right;return Ee}for(var Ve=this._comparator;Q;){var Le=Ve(Z.key,Q.key);if(Le===0)break;Le<0?Q=Q.left:(Ee=Q,Q=Q.right)}return Ee},pt.prototype.clear=function(){return this._root=null,this._size=0,this},pt.prototype.toList=function(){return ht(this._root)},pt.prototype.load=function(Z,Q,Ee){Q===void 0&&(Q=[]),Ee===void 0&&(Ee=!1);var Ve=Z.length,Le=this._comparator;if(Ee&&wt(Z,Q,0,Ve-1,Le),this._root===null)this._root=De(Z,Q,0,Ve),this._size=Ve;else{var jt=At(this.toList(),ge(Z,Q),Le);Ve=this._size+Ve,this._root=ae({head:jt},0,Ve)}return this},pt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(pt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(pt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),pt.prototype.toString=function(Z){Z===void 0&&(Z=function(Ee){return String(Ee.key)});var Q=[];return G(this._root,"",!0,function(Ee){return Q.push(Ee)},Z),Q.join("")},pt.prototype.update=function(Z,Q,Ee){var Ve=this._comparator,Le=W(Z,this._root,Ve),jt=Le.left,Zt=Le.right;Ve(Z,Q)<0?Zt=se(Q,Ee,Zt,Ve):jt=se(Q,Ee,jt,Ve),this._root=ne(jt,Zt,Ve)},pt.prototype.split=function(Z){return W(Z,this._root,this._comparator)},pt.prototype[Symbol.iterator]=function(){var Z,Q,Ee;return Qe(this,function(Ve){switch(Ve.label){case 0:Z=this._root,Q=[],Ee=!1,Ve.label=1;case 1:return Ee?[3,6]:Z===null?[3,2]:(Q.push(Z),Z=Z.left,[3,5]);case 2:return Q.length===0?[3,4]:(Z=Q.pop(),[4,Z]);case 3:return Ve.sent(),Z=Z.right,[3,5];case 4:Ee=!0,Ve.label=5;case 5:return[3,1];case 6:return[2]}})},pt}();function De(pt,Z,Q,Ee){var Ve=Ee-Q;if(Ve>0){var Le=Q+Math.floor(Ve/2),jt=pt[Le],Zt=Z[Le],ur=new v(jt,Zt);return ur.left=De(pt,Z,Q,Le),ur.right=De(pt,Z,Le+1,Ee),ur}return null}function ge(pt,Z){for(var Q=new v(null,null),Ee=Q,Ve=0;Ve<pt.length;Ve++)Ee=Ee.next=new v(pt[Ve],Z[Ve]);return Ee.next=null,Q.next}function ht(pt){for(var Z=pt,Q=[],Ee=!1,Ve=new v(null,null),Le=Ve;!Ee;)Z?(Q.push(Z),Z=Z.left):Q.length>0?(Z=Le=Le.next=Q.pop(),Z=Z.right):Ee=!0;return Le.next=null,Ve.next}function ae(pt,Z,Q){var Ee=Q-Z;if(Ee>0){var Ve=Z+Math.floor(Ee/2),Le=ae(pt,Z,Ve),jt=pt.head;return jt.left=Le,pt.head=pt.head.next,jt.right=ae(pt,Ve+1,Q),jt}return null}function At(pt,Z,Q){for(var Ee=new v(null,null),Ve=Ee,Le=pt,jt=Z;Le!==null&&jt!==null;)Q(Le.key,jt.key)<0?(Ve.next=Le,Le=Le.next):(Ve.next=jt,jt=jt.next),Ve=Ve.next;return Le!==null?Ve.next=Le:jt!==null&&(Ve.next=jt),Ee.next}function wt(pt,Z,Q,Ee,Ve){if(!(Q>=Ee)){for(var Le=pt[Q+Ee>>1],jt=Q-1,Zt=Ee+1;;){do jt++;while(Ve(pt[jt],Le)<0);do Zt--;while(Ve(pt[Zt],Le)>0);if(jt>=Zt)break;var ur=pt[jt];pt[jt]=pt[Zt],pt[Zt]=ur,ur=Z[jt],Z[jt]=Z[Zt],Z[Zt]=ur}wt(pt,Z,Q,Zt,Ve),wt(pt,Z,Zt+1,Ee,Ve)}}const et=(pt,Z)=>pt.ll.x<=Z.x&&Z.x<=pt.ur.x&&pt.ll.y<=Z.y&&Z.y<=pt.ur.y,mr=(pt,Z)=>{if(Z.ur.x<pt.ll.x||pt.ur.x<Z.ll.x||Z.ur.y<pt.ll.y||pt.ur.y<Z.ll.y)return null;const Q=pt.ll.x<Z.ll.x?Z.ll.x:pt.ll.x,Ee=pt.ur.x<Z.ur.x?pt.ur.x:Z.ur.x,Ve=pt.ll.y<Z.ll.y?Z.ll.y:pt.ll.y,Le=pt.ur.y<Z.ur.y?pt.ur.y:Z.ur.y;return{ll:{x:Q,y:Ve},ur:{x:Ee,y:Le}}};let pr=Number.EPSILON;pr===void 0&&(pr=Math.pow(2,-52));const yn=pr*pr,bi=(pt,Z)=>{if(-pr<pt&&pt<pr&&-pr<Z&&Z<pr)return 0;const Q=pt-Z;return Q*Q<yn*pt*Z?0:pt<Z?-1:1};class $n{constructor(){this.reset()}reset(){this.xRounder=new Mt,this.yRounder=new Mt}round(Z,Q){return{x:this.xRounder.round(Z),y:this.yRounder.round(Q)}}}class Mt{constructor(){this.tree=new Ke,this.round(0)}round(Z){const Q=this.tree.add(Z),Ee=this.tree.prev(Q);if(Ee!==null&&bi(Q.key,Ee.key)===0)return this.tree.remove(Z),Ee.key;const Ve=this.tree.next(Q);return Ve!==null&&bi(Q.key,Ve.key)===0?(this.tree.remove(Z),Ve.key):Z}}const ze=new $n,Wt=11102230246251565e-32,ct=134217729,nr=(3+8*Wt)*Wt;function Lr(pt,Z,Q,Ee,Ve){let Le,jt,Zt,ur,Ft=Z[0],L=Ee[0],O=0,j=0;L>Ft==L>-Ft?(Le=Ft,Ft=Z[++O]):(Le=L,L=Ee[++j]);let $=0;if(O<pt&&j<Q)for(L>Ft==L>-Ft?(jt=Ft+Le,Zt=Le-(jt-Ft),Ft=Z[++O]):(jt=L+Le,Zt=Le-(jt-L),L=Ee[++j]),Le=jt,Zt!==0&&(Ve[$++]=Zt);O<pt&&j<Q;)L>Ft==L>-Ft?(jt=Le+Ft,ur=jt-Le,Zt=Le-(jt-ur)+(Ft-ur),Ft=Z[++O]):(jt=Le+L,ur=jt-Le,Zt=Le-(jt-ur)+(L-ur),L=Ee[++j]),Le=jt,Zt!==0&&(Ve[$++]=Zt);for(;O<pt;)jt=Le+Ft,ur=jt-Le,Zt=Le-(jt-ur)+(Ft-ur),Ft=Z[++O],Le=jt,Zt!==0&&(Ve[$++]=Zt);for(;j<Q;)jt=Le+L,ur=jt-Le,Zt=Le-(jt-ur)+(L-ur),L=Ee[++j],Le=jt,Zt!==0&&(Ve[$++]=Zt);return(Le!==0||$===0)&&(Ve[$++]=Le),$}function K(pt,Z){let Q=Z[0];for(let Ee=1;Ee<pt;Ee++)Q+=Z[Ee];return Q}function _e(pt){return new Float64Array(pt)}const Y=(3+16*Wt)*Wt,ve=(2+12*Wt)*Wt,fe=(9+64*Wt)*Wt*Wt,He=_e(4),at=_e(8),_t=_e(12),Tt=_e(16),Pt=_e(4);function Xr(pt,Z,Q,Ee,Ve,Le,jt){let Zt,ur,Ft,L,O,j,$,de,Ie,Ze,ee,be,ut,Dt,ir,Ct,tr,Br;const Nr=pt-Ve,Bt=Q-Ve,Fr=Z-Le,Cr=Ee-Le;Dt=Nr*Cr,j=ct*Nr,$=j-(j-Nr),de=Nr-$,j=ct*Cr,Ie=j-(j-Cr),Ze=Cr-Ie,ir=de*Ze-(Dt-$*Ie-de*Ie-$*Ze),Ct=Fr*Bt,j=ct*Fr,$=j-(j-Fr),de=Fr-$,j=ct*Bt,Ie=j-(j-Bt),Ze=Bt-Ie,tr=de*Ze-(Ct-$*Ie-de*Ie-$*Ze),ee=ir-tr,O=ir-ee,He[0]=ir-(ee+O)+(O-tr),be=Dt+ee,O=be-Dt,ut=Dt-(be-O)+(ee-O),ee=ut-Ct,O=ut-ee,He[1]=ut-(ee+O)+(O-Ct),Br=be+ee,O=Br-be,He[2]=be-(Br-O)+(ee-O),He[3]=Br;let Ir=K(4,He),Zn=ve*jt;if(Ir>=Zn||-Ir>=Zn||(O=pt-Nr,Zt=pt-(Nr+O)+(O-Ve),O=Q-Bt,Ft=Q-(Bt+O)+(O-Ve),O=Z-Fr,ur=Z-(Fr+O)+(O-Le),O=Ee-Cr,L=Ee-(Cr+O)+(O-Le),Zt===0&&ur===0&&Ft===0&&L===0)||(Zn=fe*jt+nr*Math.abs(Ir),Ir+=Nr*L+Cr*Zt-(Fr*Ft+Bt*ur),Ir>=Zn||-Ir>=Zn))return Ir;Dt=Zt*Cr,j=ct*Zt,$=j-(j-Zt),de=Zt-$,j=ct*Cr,Ie=j-(j-Cr),Ze=Cr-Ie,ir=de*Ze-(Dt-$*Ie-de*Ie-$*Ze),Ct=ur*Bt,j=ct*ur,$=j-(j-ur),de=ur-$,j=ct*Bt,Ie=j-(j-Bt),Ze=Bt-Ie,tr=de*Ze-(Ct-$*Ie-de*Ie-$*Ze),ee=ir-tr,O=ir-ee,Pt[0]=ir-(ee+O)+(O-tr),be=Dt+ee,O=be-Dt,ut=Dt-(be-O)+(ee-O),ee=ut-Ct,O=ut-ee,Pt[1]=ut-(ee+O)+(O-Ct),Br=be+ee,O=Br-be,Pt[2]=be-(Br-O)+(ee-O),Pt[3]=Br;const Gr=Lr(4,He,4,Pt,at);Dt=Nr*L,j=ct*Nr,$=j-(j-Nr),de=Nr-$,j=ct*L,Ie=j-(j-L),Ze=L-Ie,ir=de*Ze-(Dt-$*Ie-de*Ie-$*Ze),Ct=Fr*Ft,j=ct*Fr,$=j-(j-Fr),de=Fr-$,j=ct*Ft,Ie=j-(j-Ft),Ze=Ft-Ie,tr=de*Ze-(Ct-$*Ie-de*Ie-$*Ze),ee=ir-tr,O=ir-ee,Pt[0]=ir-(ee+O)+(O-tr),be=Dt+ee,O=be-Dt,ut=Dt-(be-O)+(ee-O),ee=ut-Ct,O=ut-ee,Pt[1]=ut-(ee+O)+(O-Ct),Br=be+ee,O=Br-be,Pt[2]=be-(Br-O)+(ee-O),Pt[3]=Br;const Kn=Lr(Gr,at,4,Pt,_t);Dt=Zt*L,j=ct*Zt,$=j-(j-Zt),de=Zt-$,j=ct*L,Ie=j-(j-L),Ze=L-Ie,ir=de*Ze-(Dt-$*Ie-de*Ie-$*Ze),Ct=ur*Ft,j=ct*ur,$=j-(j-ur),de=ur-$,j=ct*Ft,Ie=j-(j-Ft),Ze=Ft-Ie,tr=de*Ze-(Ct-$*Ie-de*Ie-$*Ze),ee=ir-tr,O=ir-ee,Pt[0]=ir-(ee+O)+(O-tr),be=Dt+ee,O=be-Dt,ut=Dt-(be-O)+(ee-O),ee=ut-Ct,O=ut-ee,Pt[1]=ut-(ee+O)+(O-Ct),Br=be+ee,O=Br-be,Pt[2]=be-(Br-O)+(ee-O),Pt[3]=Br;const Di=Lr(Kn,_t,4,Pt,Tt);return Tt[Di-1]}function zr(pt,Z,Q,Ee,Ve,Le){const jt=(Z-Le)*(Q-Ve),Zt=(pt-Ve)*(Ee-Le),ur=jt-Zt,Ft=Math.abs(jt+Zt);return Math.abs(ur)>=Y*Ft?ur:-Xr(pt,Z,Q,Ee,Ve,Le,Ft)}const gn=(pt,Z)=>pt.x*Z.y-pt.y*Z.x,Qr=(pt,Z)=>pt.x*Z.x+pt.y*Z.y,Fn=(pt,Z,Q)=>{const Ee=zr(pt.x,pt.y,Z.x,Z.y,Q.x,Q.y);return Ee>0?-1:Ee<0?1:0},bn=pt=>Math.sqrt(Qr(pt,pt)),dn=(pt,Z,Q)=>{const Ee={x:Z.x-pt.x,y:Z.y-pt.y},Ve={x:Q.x-pt.x,y:Q.y-pt.y};return gn(Ve,Ee)/bn(Ve)/bn(Ee)},un=(pt,Z,Q)=>{const Ee={x:Z.x-pt.x,y:Z.y-pt.y},Ve={x:Q.x-pt.x,y:Q.y-pt.y};return Qr(Ve,Ee)/bn(Ve)/bn(Ee)},Qn=(pt,Z,Q)=>Z.y===0?null:{x:pt.x+Z.x/Z.y*(Q-pt.y),y:Q},Vr=(pt,Z,Q)=>Z.x===0?null:{x:Q,y:pt.y+Z.y/Z.x*(Q-pt.x)},Dn=(pt,Z,Q,Ee)=>{if(Z.x===0)return Vr(Q,Ee,pt.x);if(Ee.x===0)return Vr(pt,Z,Q.x);if(Z.y===0)return Qn(Q,Ee,pt.y);if(Ee.y===0)return Qn(pt,Z,Q.y);const Ve=gn(Z,Ee);if(Ve==0)return null;const Le={x:Q.x-pt.x,y:Q.y-pt.y},jt=gn(Le,Z)/Ve,Zt=gn(Le,Ee)/Ve,ur=pt.x+Zt*Z.x,Ft=Q.x+jt*Ee.x,L=pt.y+Zt*Z.y,O=Q.y+jt*Ee.y,j=(ur+Ft)/2,$=(L+O)/2;return{x:j,y:$}};class Wr{static compare(Z,Q){const Ee=Wr.comparePoints(Z.point,Q.point);return Ee!==0?Ee:(Z.point!==Q.point&&Z.link(Q),Z.isLeft!==Q.isLeft?Z.isLeft?1:-1:ji.compare(Z.segment,Q.segment))}static comparePoints(Z,Q){return Z.x<Q.x?-1:Z.x>Q.x?1:Z.y<Q.y?-1:Z.y>Q.y?1:0}constructor(Z,Q){Z.events===void 0?Z.events=[this]:Z.events.push(this),this.point=Z,this.isLeft=Q}link(Z){if(Z.point===this.point)throw new Error("Tried to link already linked events");const Q=Z.point.events;for(let Ee=0,Ve=Q.length;Ee<Ve;Ee++){const Le=Q[Ee];this.point.events.push(Le),Le.point=this.point}this.checkForConsuming()}checkForConsuming(){const Z=this.point.events.length;for(let Q=0;Q<Z;Q++){const Ee=this.point.events[Q];if(Ee.segment.consumedBy===void 0)for(let Ve=Q+1;Ve<Z;Ve++){const Le=this.point.events[Ve];Le.consumedBy===void 0&&Ee.otherSE.point.events===Le.otherSE.point.events&&Ee.segment.consume(Le.segment)}}}getAvailableLinkedEvents(){const Z=[];for(let Q=0,Ee=this.point.events.length;Q<Ee;Q++){const Ve=this.point.events[Q];Ve!==this&&!Ve.segment.ringOut&&Ve.segment.isInResult()&&Z.push(Ve)}return Z}getLeftmostComparator(Z){const Q=new Map,Ee=Ve=>{const Le=Ve.otherSE;Q.set(Ve,{sine:dn(this.point,Z.point,Le.point),cosine:un(this.point,Z.point,Le.point)})};return(Ve,Le)=>{Q.has(Ve)||Ee(Ve),Q.has(Le)||Ee(Le);const{sine:jt,cosine:Zt}=Q.get(Ve),{sine:ur,cosine:Ft}=Q.get(Le);return jt>=0&&ur>=0?Zt<Ft?1:Zt>Ft?-1:0:jt<0&&ur<0?Zt<Ft?-1:Zt>Ft?1:0:ur<jt?-1:ur>jt?1:0}}}let Jr=0;class ji{static compare(Z,Q){const Ee=Z.leftSE.point.x,Ve=Q.leftSE.point.x,Le=Z.rightSE.point.x,jt=Q.rightSE.point.x;if(jt<Ee)return 1;if(Le<Ve)return-1;const Zt=Z.leftSE.point.y,ur=Q.leftSE.point.y,Ft=Z.rightSE.point.y,L=Q.rightSE.point.y;if(Ee<Ve){if(ur<Zt&&ur<Ft)return 1;if(ur>Zt&&ur>Ft)return-1;const O=Z.comparePoint(Q.leftSE.point);if(O<0)return 1;if(O>0)return-1;const j=Q.comparePoint(Z.rightSE.point);return j!==0?j:-1}if(Ee>Ve){if(Zt<ur&&Zt<L)return-1;if(Zt>ur&&Zt>L)return 1;const O=Q.comparePoint(Z.leftSE.point);if(O!==0)return O;const j=Z.comparePoint(Q.rightSE.point);return j<0?1:j>0?-1:1}if(Zt<ur)return-1;if(Zt>ur)return 1;if(Le<jt){const O=Q.comparePoint(Z.rightSE.point);if(O!==0)return O}if(Le>jt){const O=Z.comparePoint(Q.rightSE.point);if(O<0)return 1;if(O>0)return-1}if(Le!==jt){const O=Ft-Zt,j=Le-Ee,$=L-ur,de=jt-Ve;if(O>j&&$<de)return 1;if(O<j&&$>de)return-1}return Le>jt?1:Le<jt||Ft<L?-1:Ft>L?1:Z.id<Q.id?-1:Z.id>Q.id?1:0}constructor(Z,Q,Ee,Ve){this.id=++Jr,this.leftSE=Z,Z.segment=this,Z.otherSE=Q,this.rightSE=Q,Q.segment=this,Q.otherSE=Z,this.rings=Ee,this.windings=Ve}static fromRing(Z,Q,Ee){let Ve,Le,jt;const Zt=Wr.comparePoints(Z,Q);if(Zt<0)Ve=Z,Le=Q,jt=1;else if(Zt>0)Ve=Q,Le=Z,jt=-1;else throw new Error(`Tried to create degenerate segment at [${Z.x}, ${Z.y}]`);const ur=new Wr(Ve,!0),Ft=new Wr(Le,!1);return new ji(ur,Ft,[Ee],[jt])}replaceRightSE(Z){this.rightSE=Z,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const Z=this.leftSE.point.y,Q=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:Z<Q?Z:Q},ur:{x:this.rightSE.point.x,y:Z>Q?Z:Q}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(Z){return Z.x===this.leftSE.point.x&&Z.y===this.leftSE.point.y||Z.x===this.rightSE.point.x&&Z.y===this.rightSE.point.y}comparePoint(Z){if(this.isAnEndpoint(Z))return 0;const Q=this.leftSE.point,Ee=this.rightSE.point,Ve=this.vector();if(Q.x===Ee.x)return Z.x===Q.x?0:Z.x<Q.x?1:-1;const Le=(Z.y-Q.y)/Ve.y,jt=Q.x+Le*Ve.x;if(Z.x===jt)return 0;const Zt=(Z.x-Q.x)/Ve.x,ur=Q.y+Zt*Ve.y;return Z.y===ur?0:Z.y<ur?-1:1}getIntersection(Z){const Q=this.bbox(),Ee=Z.bbox(),Ve=mr(Q,Ee);if(Ve===null)return null;const Le=this.leftSE.point,jt=this.rightSE.point,Zt=Z.leftSE.point,ur=Z.rightSE.point,Ft=et(Q,Zt)&&this.comparePoint(Zt)===0,L=et(Ee,Le)&&Z.comparePoint(Le)===0,O=et(Q,ur)&&this.comparePoint(ur)===0,j=et(Ee,jt)&&Z.comparePoint(jt)===0;if(L&&Ft)return j&&!O?jt:!j&&O?ur:null;if(L)return O&&Le.x===ur.x&&Le.y===ur.y?null:Le;if(Ft)return j&&jt.x===Zt.x&&jt.y===Zt.y?null:Zt;if(j&&O)return null;if(j)return jt;if(O)return ur;const $=Dn(Le,this.vector(),Zt,Z.vector());return $===null||!et(Ve,$)?null:ze.round($.x,$.y)}split(Z){const Q=[],Ee=Z.events!==void 0,Ve=new Wr(Z,!0),Le=new Wr(Z,!1),jt=this.rightSE;this.replaceRightSE(Le),Q.push(Le),Q.push(Ve);const Zt=new ji(Ve,jt,this.rings.slice(),this.windings.slice());return Wr.comparePoints(Zt.leftSE.point,Zt.rightSE.point)>0&&Zt.swapEvents(),Wr.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ee&&(Ve.checkForConsuming(),Le.checkForConsuming()),Q}swapEvents(){const Z=this.rightSE;this.rightSE=this.leftSE,this.leftSE=Z,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let Q=0,Ee=this.windings.length;Q<Ee;Q++)this.windings[Q]*=-1}consume(Z){let Q=this,Ee=Z;for(;Q.consumedBy;)Q=Q.consumedBy;for(;Ee.consumedBy;)Ee=Ee.consumedBy;const Ve=ji.compare(Q,Ee);if(Ve!==0){if(Ve>0){const Le=Q;Q=Ee,Ee=Le}if(Q.prev===Ee){const Le=Q;Q=Ee,Ee=Le}for(let Le=0,jt=Ee.rings.length;Le<jt;Le++){const Zt=Ee.rings[Le],ur=Ee.windings[Le],Ft=Q.rings.indexOf(Zt);Ft===-1?(Q.rings.push(Zt),Q.windings.push(ur)):Q.windings[Ft]+=ur}Ee.rings=null,Ee.windings=null,Ee.consumedBy=Q,Ee.leftSE.consumedBy=Q.leftSE,Ee.rightSE.consumedBy=Q.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const Z=this.prev.consumedBy||this.prev;this._beforeState=Z.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const Z=this.beforeState();this._afterState={rings:Z.rings.slice(0),windings:Z.windings.slice(0),multiPolys:[]};const Q=this._afterState.rings,Ee=this._afterState.windings,Ve=this._afterState.multiPolys;for(let Zt=0,ur=this.rings.length;Zt<ur;Zt++){const Ft=this.rings[Zt],L=this.windings[Zt],O=Q.indexOf(Ft);O===-1?(Q.push(Ft),Ee.push(L)):Ee[O]+=L}const Le=[],jt=[];for(let Zt=0,ur=Q.length;Zt<ur;Zt++){if(Ee[Zt]===0)continue;const Ft=Q[Zt],L=Ft.poly;if(jt.indexOf(L)===-1)if(Ft.isExterior)Le.push(L);else{jt.indexOf(L)===-1&&jt.push(L);const O=Le.indexOf(Ft.poly);O!==-1&&Le.splice(O,1)}}for(let Zt=0,ur=Le.length;Zt<ur;Zt++){const Ft=Le[Zt].multiPoly;Ve.indexOf(Ft)===-1&&Ve.push(Ft)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const Z=this.beforeState().multiPolys,Q=this.afterState().multiPolys;switch(Xo.type){case"union":{const Ee=Z.length===0,Ve=Q.length===0;this._isInResult=Ee!==Ve;break}case"intersection":{let Ee,Ve;Z.length<Q.length?(Ee=Z.length,Ve=Q.length):(Ee=Q.length,Ve=Z.length),this._isInResult=Ve===Xo.numMultiPolys&&Ee<Ve;break}case"xor":{const Ee=Math.abs(Z.length-Q.length);this._isInResult=Ee%2===1;break}case"difference":{const Ee=Ve=>Ve.length===1&&Ve[0].isSubject;this._isInResult=Ee(Z)!==Ee(Q);break}default:throw new Error(`Unrecognized operation type found ${Xo.type}`)}return this._isInResult}}class gi{constructor(Z,Q,Ee){if(!Array.isArray(Z)||Z.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=Q,this.isExterior=Ee,this.segments=[],typeof Z[0][0]!="number"||typeof Z[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Ve=ze.round(Z[0][0],Z[0][1]);this.bbox={ll:{x:Ve.x,y:Ve.y},ur:{x:Ve.x,y:Ve.y}};let Le=Ve;for(let jt=1,Zt=Z.length;jt<Zt;jt++){if(typeof Z[jt][0]!="number"||typeof Z[jt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let ur=ze.round(Z[jt][0],Z[jt][1]);ur.x===Le.x&&ur.y===Le.y||(this.segments.push(ji.fromRing(Le,ur,this)),ur.x<this.bbox.ll.x&&(this.bbox.ll.x=ur.x),ur.y<this.bbox.ll.y&&(this.bbox.ll.y=ur.y),ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ur.x),ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ur.y),Le=ur)}(Ve.x!==Le.x||Ve.y!==Le.y)&&this.segments.push(ji.fromRing(Le,Ve,this))}getSweepEvents(){const Z=[];for(let Q=0,Ee=this.segments.length;Q<Ee;Q++){const Ve=this.segments[Q];Z.push(Ve.leftSE),Z.push(Ve.rightSE)}return Z}}class Eo{constructor(Z,Q){if(!Array.isArray(Z))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new gi(Z[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let Ee=1,Ve=Z.length;Ee<Ve;Ee++){const Le=new gi(Z[Ee],this,!1);Le.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Le.bbox.ll.x),Le.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Le.bbox.ll.y),Le.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Le.bbox.ur.x),Le.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Le.bbox.ur.y),this.interiorRings.push(Le)}this.multiPoly=Q}getSweepEvents(){const Z=this.exteriorRing.getSweepEvents();for(let Q=0,Ee=this.interiorRings.length;Q<Ee;Q++){const Ve=this.interiorRings[Q].getSweepEvents();for(let Le=0,jt=Ve.length;Le<jt;Le++)Z.push(Ve[Le])}return Z}}class $i{constructor(Z,Q){if(!Array.isArray(Z))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof Z[0][0][0]=="number"&&(Z=[Z])}catch(Ee){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let Ee=0,Ve=Z.length;Ee<Ve;Ee++){const Le=new Eo(Z[Ee],this);Le.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Le.bbox.ll.x),Le.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Le.bbox.ll.y),Le.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Le.bbox.ur.x),Le.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Le.bbox.ur.y),this.polys.push(Le)}this.isSubject=Q}getSweepEvents(){const Z=[];for(let Q=0,Ee=this.polys.length;Q<Ee;Q++){const Ve=this.polys[Q].getSweepEvents();for(let Le=0,jt=Ve.length;Le<jt;Le++)Z.push(Ve[Le])}return Z}}class ue{static factory(Z){const Q=[];for(let Ee=0,Ve=Z.length;Ee<Ve;Ee++){const Le=Z[Ee];if(!Le.isInResult()||Le.ringOut)continue;let jt=null,Zt=Le.leftSE,ur=Le.rightSE;const Ft=[Zt],L=Zt.point,O=[];for(;jt=Zt,Zt=ur,Ft.push(Zt),Zt.point!==L;)for(;;){const j=Zt.getAvailableLinkedEvents();if(j.length===0){const Ie=Ft[0].point,Ze=Ft[Ft.length-1].point;throw new Error(`Unable to complete output ring starting at [${Ie.x}, ${Ie.y}]. Last matching segment found ends at [${Ze.x}, ${Ze.y}].`)}if(j.length===1){ur=j[0].otherSE;break}let $=null;for(let Ie=0,Ze=O.length;Ie<Ze;Ie++)if(O[Ie].point===Zt.point){$=Ie;break}if($!==null){const Ie=O.splice($)[0],Ze=Ft.splice(Ie.index);Ze.unshift(Ze[0].otherSE),Q.push(new ue(Ze.reverse()));continue}O.push({index:Ft.length,point:Zt.point});const de=Zt.getLeftmostComparator(jt);ur=j.sort(de)[0].otherSE;break}Q.push(new ue(Ft))}return Q}constructor(Z){this.events=Z;for(let Q=0,Ee=Z.length;Q<Ee;Q++)Z[Q].segment.ringOut=this;this.poly=null}getGeom(){let Z=this.events[0].point;const Q=[Z];for(let Ft=1,L=this.events.length-1;Ft<L;Ft++){const O=this.events[Ft].point,j=this.events[Ft+1].point;Fn(O,Z,j)!==0&&(Q.push(O),Z=O)}if(Q.length===1)return null;const Ee=Q[0],Ve=Q[1];Fn(Ee,Z,Ve)===0&&Q.shift(),Q.push(Q[0]);const Le=this.isExteriorRing()?1:-1,jt=this.isExteriorRing()?0:Q.length-1,Zt=this.isExteriorRing()?Q.length:-1,ur=[];for(let Ft=jt;Ft!=Zt;Ft+=Le)ur.push([Q[Ft].x,Q[Ft].y]);return ur}isExteriorRing(){if(this._isExteriorRing===void 0){const Z=this.enclosingRing();this._isExteriorRing=Z?!Z.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let Z=this.events[0];for(let Ve=1,Le=this.events.length;Ve<Le;Ve++){const jt=this.events[Ve];Wr.compare(Z,jt)>0&&(Z=jt)}let Q=Z.segment.prevInResult(),Ee=Q?Q.prevInResult():null;for(;;){if(!Q)return null;if(!Ee)return Q.ringOut;if(Ee.ringOut!==Q.ringOut)return Ee.ringOut.enclosingRing()!==Q.ringOut?Q.ringOut:Q.ringOut.enclosingRing();Q=Ee.prevInResult(),Ee=Q?Q.prevInResult():null}}}class Xi{constructor(Z){this.exteriorRing=Z,Z.poly=this,this.interiorRings=[]}addInterior(Z){this.interiorRings.push(Z),Z.poly=this}getGeom(){const Z=[this.exteriorRing.getGeom()];if(Z[0]===null)return null;for(let Q=0,Ee=this.interiorRings.length;Q<Ee;Q++){const Ve=this.interiorRings[Q].getGeom();Ve!==null&&Z.push(Ve)}return Z}}class co{constructor(Z){this.rings=Z,this.polys=this._composePolys(Z)}getGeom(){const Z=[];for(let Q=0,Ee=this.polys.length;Q<Ee;Q++){const Ve=this.polys[Q].getGeom();Ve!==null&&Z.push(Ve)}return Z}_composePolys(Z){const Q=[];for(let Ee=0,Ve=Z.length;Ee<Ve;Ee++){const Le=Z[Ee];if(!Le.poly)if(Le.isExteriorRing())Q.push(new Xi(Le));else{const jt=Le.enclosingRing();jt.poly||Q.push(new Xi(jt)),jt.poly.addInterior(Le)}}return Q}}class bo{constructor(Z){let Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ji.compare;this.queue=Z,this.tree=new Ke(Q),this.segments=[]}process(Z){const Q=Z.segment,Ee=[];if(Z.consumedBy)return Z.isLeft?this.queue.remove(Z.otherSE):this.tree.remove(Q),Ee;const Ve=Z.isLeft?this.tree.add(Q):this.tree.find(Q);if(!Ve)throw new Error(`Unable to find segment #${Q.id} [${Q.leftSE.point.x}, ${Q.leftSE.point.y}] -> [${Q.rightSE.point.x}, ${Q.rightSE.point.y}] in SweepLine tree.`);let Le=Ve,jt=Ve,Zt,ur;for(;Zt===void 0;)Le=this.tree.prev(Le),Le===null?Zt=null:Le.key.consumedBy===void 0&&(Zt=Le.key);for(;ur===void 0;)jt=this.tree.next(jt),jt===null?ur=null:jt.key.consumedBy===void 0&&(ur=jt.key);if(Z.isLeft){let Ft=null;if(Zt){const O=Zt.getIntersection(Q);if(O!==null&&(Q.isAnEndpoint(O)||(Ft=O),!Zt.isAnEndpoint(O))){const j=this._splitSafely(Zt,O);for(let $=0,de=j.length;$<de;$++)Ee.push(j[$])}}let L=null;if(ur){const O=ur.getIntersection(Q);if(O!==null&&(Q.isAnEndpoint(O)||(L=O),!ur.isAnEndpoint(O))){const j=this._splitSafely(ur,O);for(let $=0,de=j.length;$<de;$++)Ee.push(j[$])}}if(Ft!==null||L!==null){let O=null;Ft===null?O=L:L===null?O=Ft:O=Wr.comparePoints(Ft,L)<=0?Ft:L,this.queue.remove(Q.rightSE),Ee.push(Q.rightSE);const j=Q.split(O);for(let $=0,de=j.length;$<de;$++)Ee.push(j[$])}Ee.length>0?(this.tree.remove(Q),Ee.push(Z)):(this.segments.push(Q),Q.prev=Zt)}else{if(Zt&&ur){const Ft=Zt.getIntersection(ur);if(Ft!==null){if(!Zt.isAnEndpoint(Ft)){const L=this._splitSafely(Zt,Ft);for(let O=0,j=L.length;O<j;O++)Ee.push(L[O])}if(!ur.isAnEndpoint(Ft)){const L=this._splitSafely(ur,Ft);for(let O=0,j=L.length;O<j;O++)Ee.push(L[O])}}}this.tree.remove(Q)}return Ee}_splitSafely(Z,Q){this.tree.remove(Z);const Ee=Z.rightSE;this.queue.remove(Ee);const Ve=Z.split(Q);return Ve.push(Ee),Z.consumedBy===void 0&&this.tree.add(Z),Ve}}const Sa=typeof Oe!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,da=typeof Oe!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Ds{run(Z,Q,Ee){Xo.type=Z,ze.reset();const Ve=[new $i(Q,!0)];for(let O=0,j=Ee.length;O<j;O++)Ve.push(new $i(Ee[O],!1));if(Xo.numMultiPolys=Ve.length,Xo.type==="difference"){const O=Ve[0];let j=1;for(;j<Ve.length;)mr(Ve[j].bbox,O.bbox)!==null?j++:Ve.splice(j,1)}if(Xo.type==="intersection")for(let O=0,j=Ve.length;O<j;O++){const $=Ve[O];for(let de=O+1,Ie=Ve.length;de<Ie;de++)if(mr($.bbox,Ve[de].bbox)===null)return[]}const Le=new Ke(Wr.compare);for(let O=0,j=Ve.length;O<j;O++){const $=Ve[O].getSweepEvents();for(let de=0,Ie=$.length;de<Ie;de++)if(Le.insert($[de]),Le.size>Sa)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const jt=new bo(Le);let Zt=Le.size,ur=Le.pop();for(;ur;){const O=ur.key;if(Le.size===Zt){const $=O.segment;throw new Error(`Unable to pop() ${O.isLeft?"left":"right"} SweepEvent [${O.point.x}, ${O.point.y}] from segment #${$.id} [${$.leftSE.point.x}, ${$.leftSE.point.y}] -> [${$.rightSE.point.x}, ${$.rightSE.point.y}] from queue.`)}if(Le.size>Sa)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(jt.segments.length>da)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const j=jt.process(O);for(let $=0,de=j.length;$<de;$++){const Ie=j[$];Ie.consumedBy===void 0&&Le.insert(Ie)}Zt=Le.size,ur=Le.pop()}ze.reset();const Ft=ue.factory(jt.segments);return new co(Ft).getGeom()}}const Xo=new Ds;var ho={union:function(pt){for(var Z=arguments.length,Q=new Array(Z>1?Z-1:0),Ee=1;Ee<Z;Ee++)Q[Ee-1]=arguments[Ee];return Xo.run("union",pt,Q)},intersection:function(pt){for(var Z=arguments.length,Q=new Array(Z>1?Z-1:0),Ee=1;Ee<Z;Ee++)Q[Ee-1]=arguments[Ee];return Xo.run("intersection",pt,Q)},xor:function(pt){for(var Z=arguments.length,Q=new Array(Z>1?Z-1:0),Ee=1;Ee<Z;Ee++)Q[Ee-1]=arguments[Ee];return Xo.run("xor",pt,Q)},difference:function(pt){for(var Z=arguments.length,Q=new Array(Z>1?Z-1:0),Ee=1;Ee<Z;Ee++)Q[Ee-1]=arguments[Ee];return Xo.run("difference",pt,Q)}};return ho})},81550:function(hr){(function(qt,N){hr.exports=N()})(this,function(){"use strict";var qt=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},N=function(B,pe){for(var Ne=Object.keys(pe),It=0;It<Ne.length;++It)B[Ne[It]]=pe[Ne[It]];return B},Oe=`
`;function Qe(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function v(B){var pe=new Error("(regl) "+B);throw console.error(pe),pe}function it(B,pe){B||v(pe)}function V(B){return B?": "+B:""}function se(B,pe,Ne){B in pe||v("unknown parameter ("+B+")"+V(Ne)+". possible values: "+Object.keys(pe).join())}function W(B,pe){qt(B)||v("invalid parameter type"+V(pe)+". must be a typed array")}function ne(B,pe){switch(pe){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function G(B,pe,Ne){ne(B,pe)||v("invalid parameter type"+V(Ne)+". expected "+pe+", got "+typeof B)}function Ke(B,pe){B>=0&&(B|0)===B||v("invalid parameter type, ("+B+")"+V(pe)+". must be a nonnegative integer")}function De(B,pe,Ne){pe.indexOf(B)<0&&v("invalid value"+V(Ne)+". must be one of: "+pe)}var ge=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function ht(B){Object.keys(B).forEach(function(pe){ge.indexOf(pe)<0&&v('invalid regl constructor argument "'+pe+'". must be one of '+ge)})}function ae(B,pe){for(B=B+"";B.length<pe;)B=" "+B;return B}function At(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function wt(B,pe){this.number=B,this.line=pe,this.errors=[]}function et(B,pe,Ne){this.file=B,this.line=pe,this.message=Ne}function mr(){var B=new Error,pe=(B.stack||B).toString(),Ne=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(pe);if(Ne)return Ne[1];var It=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(pe);return It?It[1]:"unknown"}function pr(){var B=new Error,pe=(B.stack||B).toString(),Ne=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(pe);if(Ne)return Ne[1];var It=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(pe);return It?It[1]:"unknown"}function yn(B,pe){var Ne=B.split(`
`),It=1,$t=0,Lt={unknown:new At,0:new At};Lt.unknown.name=Lt[0].name=pe||mr(),Lt.unknown.lines.push(new wt(0,""));for(var yt=0;yt<Ne.length;++yt){var br=Ne[yt],_r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(br);if(_r)switch(_r[1]){case"line":var Mr=/(\d+)(\s+\d+)?/.exec(_r[2]);Mr&&(It=Mr[1]|0,Mr[2]&&($t=Mr[2]|0,$t in Lt||(Lt[$t]=new At)));break;case"define":var Sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(_r[2]);Sr&&(Lt[$t].name=Sr[1]?Qe(Sr[2]):Sr[2]);break}Lt[$t].lines.push(new wt(It++,br))}return Object.keys(Lt).forEach(function(Or){var kr=Lt[Or];kr.lines.forEach(function(gr){kr.index[gr.number]=gr})}),Lt}function bi(B){var pe=[];return B.split(`
`).forEach(function(Ne){if(!(Ne.length<5)){var It=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ne);It?pe.push(new et(It[1]|0,It[2]|0,It[3].trim())):Ne.length>0&&pe.push(new et("unknown",0,Ne))}}),pe}function $n(B,pe){pe.forEach(function(Ne){var It=B[Ne.file];if(It){var $t=It.index[Ne.line];if($t){$t.errors.push(Ne),It.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Ne)})}function Mt(B,pe,Ne,It,$t){if(!B.getShaderParameter(pe,B.COMPILE_STATUS)){var Lt=B.getShaderInfoLog(pe),yt=It===B.FRAGMENT_SHADER?"fragment":"vertex";_e(Ne,"string",yt+" shader source must be a string",$t);var br=yn(Ne,$t),_r=bi(Lt);$n(br,_r),Object.keys(br).forEach(function(Mr){var Sr=br[Mr];if(!Sr.hasErrors)return;var Or=[""],kr=[""];function gr(Dr,dt){Or.push(Dr),kr.push(dt||"")}gr("file number "+Mr+": "+Sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Sr.lines.forEach(function(Dr){if(Dr.errors.length>0){gr(ae(Dr.number,4)+"|  ","background-color:yellow; font-weight:bold"),gr(Dr.line+Oe,"color:red; background-color:yellow; font-weight:bold");var dt=0;Dr.errors.forEach(function(Ht){var Ar=Ht.message,Yr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Ar);if(Yr){var sr=Yr[1];switch(Ar=Yr[2],sr){case"assign":sr="=";break}dt=Math.max(Dr.line.indexOf(sr,dt),0)}else dt=0;gr(ae("| ",6)),gr(ae("^^^",dt+3)+Oe,"font-weight:bold"),gr(ae("| ",6)),gr(Ar+Oe,"font-weight:bold")}),gr(ae("| ",6)+Oe)}else gr(ae(Dr.number,4)+"|  "),gr(Dr.line+Oe,"color:red")}),typeof document!="undefined"&&!window.chrome?(kr[0]=Or.join("%c"),console.log.apply(console,kr)):console.log(Or.join(""))}),it.raise("Error compiling "+yt+" shader, "+br[0].name)}}function ze(B,pe,Ne,It,$t){if(!B.getProgramParameter(pe,B.LINK_STATUS)){var Lt=B.getProgramInfoLog(pe),yt=yn(Ne,$t),br=yn(It,$t),_r='Error linking program with vertex shader, "'+br[0].name+'", and fragment shader "'+yt[0].name+'"';typeof document!="undefined"?console.log("%c"+_r+Oe+"%c"+Lt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(_r+Oe+Lt),it.raise(_r)}}function Wt(B){B._commandRef=mr()}function ct(B,pe,Ne,It){Wt(B);function $t(_r){return _r?It.id(_r):0}B._fragId=$t(B.static.frag),B._vertId=$t(B.static.vert);function Lt(_r,Mr){Object.keys(Mr).forEach(function(Sr){_r[It.id(Sr)]=!0})}var yt=B._uniformSet={};Lt(yt,pe.static),Lt(yt,pe.dynamic);var br=B._attributeSet={};Lt(br,Ne.static),Lt(br,Ne.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function nr(B,pe){var Ne=pr();v(B+" in command "+(pe||mr())+(Ne==="unknown"?"":" called from "+Ne))}function Lr(B,pe,Ne){B||nr(pe,Ne||mr())}function K(B,pe,Ne,It){B in pe||nr("unknown parameter ("+B+")"+V(Ne)+". possible values: "+Object.keys(pe).join(),It||mr())}function _e(B,pe,Ne,It){ne(B,pe)||nr("invalid parameter type"+V(Ne)+". expected "+pe+", got "+typeof B,It||mr())}function Y(B){B()}function ve(B,pe,Ne){B.texture?De(B.texture._texture.internalformat,pe,"unsupported texture format for attachment"):De(B.renderbuffer._renderbuffer.format,Ne,"unsupported renderbuffer format for attachment")}var fe=33071,He=9728,at=9984,_t=9985,Tt=9986,Pt=9987,Xr=5120,zr=5121,gn=5122,Qr=5123,Fn=5124,bn=5125,dn=5126,un=32819,Qn=32820,Vr=33635,Dn=34042,Wr=36193,Jr={};Jr[Xr]=Jr[zr]=1,Jr[gn]=Jr[Qr]=Jr[Wr]=Jr[Vr]=Jr[un]=Jr[Qn]=2,Jr[Fn]=Jr[bn]=Jr[dn]=Jr[Dn]=4;function ji(B,pe){return B===Qn||B===un||B===Vr?2:B===Dn?4:Jr[B]*pe}function gi(B){return!(B&B-1)&&!!B}function Eo(B,pe,Ne){var It,$t=pe.width,Lt=pe.height,yt=pe.channels;it($t>0&&$t<=Ne.maxTextureSize&&Lt>0&&Lt<=Ne.maxTextureSize,"invalid texture shape"),(B.wrapS!==fe||B.wrapT!==fe)&&it(gi($t)&&gi(Lt),"incompatible wrap mode for texture, both width and height must be power of 2"),pe.mipmask===1?$t!==1&&Lt!==1&&it(B.minFilter!==at&&B.minFilter!==Tt&&B.minFilter!==_t&&B.minFilter!==Pt,"min filter requires mipmap"):(it(gi($t)&&gi(Lt),"texture must be a square power of 2 to support mipmapping"),it(pe.mipmask===($t<<1)-1,"missing or incomplete mipmap data")),pe.type===dn&&(Ne.extensions.indexOf("oes_texture_float_linear")<0&&it(B.minFilter===He&&B.magFilter===He,"filter not supported, must enable oes_texture_float_linear"),it(!B.genMipmaps,"mipmap generation not supported with float textures"));var br=pe.images;for(It=0;It<16;++It)if(br[It]){var _r=$t>>It,Mr=Lt>>It;it(pe.mipmask&1<<It,"missing mipmap data");var Sr=br[It];if(it(Sr.width===_r&&Sr.height===Mr,"invalid shape for mip images"),it(Sr.format===pe.format&&Sr.internalformat===pe.internalformat&&Sr.type===pe.type,"incompatible type for mip image"),!Sr.compressed)if(Sr.data){var Or=Math.ceil(ji(Sr.type,yt)*_r/Sr.unpackAlignment)*Sr.unpackAlignment;it(Sr.data.byteLength===Or*Mr,"invalid data for image, buffer size is inconsistent with image format")}else Sr.element||Sr.copy}else B.genMipmaps||it((pe.mipmask&1<<It)===0,"extra mipmap data");pe.compressed&&it(!B.genMipmaps,"mipmap generation for compressed images not supported")}function $i(B,pe,Ne,It){var $t=B.width,Lt=B.height,yt=B.channels;it($t>0&&$t<=It.maxTextureSize&&Lt>0&&Lt<=It.maxTextureSize,"invalid texture shape"),it($t===Lt,"cube map must be square"),it(pe.wrapS===fe&&pe.wrapT===fe,"wrap mode not supported by cube map");for(var br=0;br<Ne.length;++br){var _r=Ne[br];it(_r.width===$t&&_r.height===Lt,"inconsistent cube map face shape"),pe.genMipmaps&&(it(!_r.compressed,"can not generate mipmap for compressed textures"),it(_r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Mr=_r.images,Sr=0;Sr<16;++Sr){var Or=Mr[Sr];if(Or){var kr=$t>>Sr,gr=Lt>>Sr;it(_r.mipmask&1<<Sr,"missing mipmap data"),it(Or.width===kr&&Or.height===gr,"invalid shape for mip images"),it(Or.format===B.format&&Or.internalformat===B.internalformat&&Or.type===B.type,"incompatible type for mip image"),Or.compressed||(Or.data?it(Or.data.byteLength===kr*gr*Math.max(ji(Or.type,yt),Or.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Or.element||Or.copy)}}}}var ue=N(it,{optional:Y,raise:v,commandRaise:nr,command:Lr,parameter:se,commandParameter:K,constructor:ht,type:G,commandType:_e,isTypedArray:W,nni:Ke,oneOf:De,shaderError:Mt,linkError:ze,callSite:pr,saveCommandRef:Wt,saveDrawInfo:ct,framebufferFormat:ve,guessCommand:mr,texture2D:Eo,textureCube:$i}),Xi=0,co=0;function bo(B,pe){this.id=Xi++,this.type=B,this.data=pe}function Sa(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function da(B){if(B.length===0)return[];var pe=B.charAt(0),Ne=B.charAt(B.length-1);if(B.length>1&&pe===Ne&&(pe==='"'||pe==="'"))return['"'+Sa(B.substr(1,B.length-2))+'"'];var It=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(It)return da(B.substr(0,It.index)).concat(da(It[1])).concat(da(B.substr(It.index+It[0].length)));var $t=B.split(".");if($t.length===1)return['"'+Sa(B)+'"'];for(var Lt=[],yt=0;yt<$t.length;++yt)Lt=Lt.concat(da($t[yt]));return Lt}function Ds(B){return"["+da(B).join("][")+"]"}function Xo(B,pe){return new bo(B,Ds(pe+""))}function Xs(B){return typeof B=="function"&&!B._reglType||B instanceof bo}function vu(B,pe){return typeof B=="function"?new bo(co,B):B}var Vo={DynamicVariable:bo,define:Xo,isDynamic:Xs,unbox:vu,accessor:Ds},fo={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},ho=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function pt(){var B={"":0},pe=[""];return{id:function(Ne){var It=B[Ne];return It||(It=B[Ne]=pe.length,pe.push(Ne),It)},str:function(Ne){return pe[Ne]}}}function Z(B,pe,Ne){var It=document.createElement("canvas");N(It.style,{border:0,margin:0,padding:0,top:0,left:0}),B.appendChild(It),B===document.body&&(It.style.position="absolute",N(B.style,{margin:0,padding:0}));function $t(){var br=window.innerWidth,_r=window.innerHeight;if(B!==document.body){var Mr=B.getBoundingClientRect();br=Mr.right-Mr.left,_r=Mr.bottom-Mr.top}It.width=Ne*br,It.height=Ne*_r,N(It.style,{width:br+"px",height:_r+"px"})}var Lt;B!==document.body&&typeof ResizeObserver=="function"?(Lt=new ResizeObserver(function(){setTimeout($t)}),Lt.observe(B)):window.addEventListener("resize",$t,!1);function yt(){Lt?Lt.disconnect():window.removeEventListener("resize",$t),B.removeChild(It)}return $t(),{canvas:It,onDestroy:yt}}function Q(B,pe){function Ne(It){try{return B.getContext(It,pe)}catch($t){return null}}return Ne("webgl")||Ne("experimental-webgl")||Ne("webgl-experimental")}function Ee(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function Ve(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function Le(B){return typeof B=="string"?B.split():(ue(Array.isArray(B),"invalid extension array"),B)}function jt(B){return typeof B=="string"?(ue(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function Zt(B){var pe=B||{},Ne,It,$t,Lt,yt={},br=[],_r=[],Mr=typeof window=="undefined"?1:window.devicePixelRatio,Sr=!1,Or=function(Dr){Dr&&ue.raise(Dr)},kr=function(){};if(typeof pe=="string"?(ue(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ne=document.querySelector(pe),ue(Ne,"invalid query string for element")):typeof pe=="object"?Ee(pe)?Ne=pe:Ve(pe)?(Lt=pe,$t=Lt.canvas):(ue.constructor(pe),"gl"in pe?Lt=pe.gl:"canvas"in pe?$t=jt(pe.canvas):"container"in pe&&(It=jt(pe.container)),"attributes"in pe&&(yt=pe.attributes,ue.type(yt,"object","invalid context attributes")),"extensions"in pe&&(br=Le(pe.extensions)),"optionalExtensions"in pe&&(_r=Le(pe.optionalExtensions)),"onDone"in pe&&(ue.type(pe.onDone,"function","invalid or missing onDone callback"),Or=pe.onDone),"profile"in pe&&(Sr=!!pe.profile),"pixelRatio"in pe&&(Mr=+pe.pixelRatio,ue(Mr>0,"invalid pixel ratio"))):ue.raise("invalid arguments to regl"),Ne&&(Ne.nodeName.toLowerCase()==="canvas"?$t=Ne:It=Ne),!Lt){if(!$t){ue(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var gr=Z(It||document.body,Or,Mr);if(!gr)return null;$t=gr.canvas,kr=gr.onDestroy}yt.premultipliedAlpha===void 0&&(yt.premultipliedAlpha=!0),Lt=Q($t,yt)}return Lt?{gl:Lt,canvas:$t,container:It,extensions:br,optionalExtensions:_r,pixelRatio:Mr,profile:Sr,onDone:Or,onDestroy:kr}:(kr(),Or("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ur(B,pe){var Ne={};function It(yt){ue.type(yt,"string","extension name must be string");var br=yt.toLowerCase(),_r;try{_r=Ne[br]=B.getExtension(br)}catch(Mr){}return!!_r}for(var $t=0;$t<pe.extensions.length;++$t){var Lt=pe.extensions[$t];if(!It(Lt))return pe.onDestroy(),pe.onDone('"'+Lt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return pe.optionalExtensions.forEach(It),{extensions:Ne,restore:function(){Object.keys(Ne).forEach(function(yt){if(Ne[yt]&&!It(yt))throw new Error("(regl): error restoring extension "+yt)})}}}function Ft(B,pe){for(var Ne=Array(B),It=0;It<B;++It)Ne[It]=pe(It);return Ne}var L=5120,O=5121,j=5122,$=5123,de=5124,Ie=5125,Ze=5126;function ee(B){for(var pe=16;pe<=1<<28;pe*=16)if(B<=pe)return pe;return 0}function be(B){var pe,Ne;return pe=(B>65535)<<4,B>>>=pe,Ne=(B>255)<<3,B>>>=Ne,pe|=Ne,Ne=(B>15)<<2,B>>>=Ne,pe|=Ne,Ne=(B>3)<<1,B>>>=Ne,pe|=Ne,pe|B>>1}function ut(){var B=Ft(8,function(){return[]});function pe(Lt){var yt=ee(Lt),br=B[be(yt)>>2];return br.length>0?br.pop():new ArrayBuffer(yt)}function Ne(Lt){B[be(Lt.byteLength)>>2].push(Lt)}function It(Lt,yt){var br=null;switch(Lt){case L:br=new Int8Array(pe(yt),0,yt);break;case O:br=new Uint8Array(pe(yt),0,yt);break;case j:br=new Int16Array(pe(2*yt),0,yt);break;case $:br=new Uint16Array(pe(2*yt),0,yt);break;case de:br=new Int32Array(pe(4*yt),0,yt);break;case Ie:br=new Uint32Array(pe(4*yt),0,yt);break;case Ze:br=new Float32Array(pe(4*yt),0,yt);break;default:return null}return br.length!==yt?br.subarray(0,yt):br}function $t(Lt){Ne(Lt.buffer)}return{alloc:pe,free:Ne,allocType:It,freeType:$t}}var Dt=ut();Dt.zero=ut();var ir=3408,Ct=3410,tr=3411,Br=3412,Nr=3413,Bt=3414,Fr=3415,Cr=33901,Ir=33902,Zn=3379,Gr=3386,Kn=34921,Di=36347,oi=36348,Ti=35661,di=35660,Aa=34930,Ni=36349,oo=34076,mi=34024,Jn=7936,ui=7937,To=7938,Ls=35724,ro=34047,po=36063,_u=34852,ms=3553,Yi=34067,ra=34069,ao=33984,So=6408,Fa=5126,Qi=5121,Wa=36160,Ba=36053,gu=36064,vs=16384,Rc=function(B,pe){var Ne=1;pe.ext_texture_filter_anisotropic&&(Ne=B.getParameter(ro));var It=1,$t=1;pe.webgl_draw_buffers&&(It=B.getParameter(_u),$t=B.getParameter(po));var Lt=!!pe.oes_texture_float;if(Lt){var yt=B.createTexture();B.bindTexture(ms,yt),B.texImage2D(ms,0,So,1,1,0,So,Fa,null);var br=B.createFramebuffer();if(B.bindFramebuffer(Wa,br),B.framebufferTexture2D(Wa,gu,ms,yt,0),B.bindTexture(ms,null),B.checkFramebufferStatus(Wa)!==Ba)Lt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(vs);var _r=Dt.allocType(Fa,4);B.readPixels(0,0,1,1,So,Fa,_r),B.getError()?Lt=!1:(B.deleteFramebuffer(br),B.deleteTexture(yt),Lt=_r[0]===1),Dt.freeType(_r)}}var Mr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Sr=!0;if(!Mr){var Or=B.createTexture(),kr=Dt.allocType(Qi,36);B.activeTexture(ao),B.bindTexture(Yi,Or),B.texImage2D(ra,0,So,3,3,0,So,Qi,kr),Dt.freeType(kr),B.bindTexture(Yi,null),B.deleteTexture(Or),Sr=!B.getError()}return{colorBits:[B.getParameter(Ct),B.getParameter(tr),B.getParameter(Br),B.getParameter(Nr)],depthBits:B.getParameter(Bt),stencilBits:B.getParameter(Fr),subpixelBits:B.getParameter(ir),extensions:Object.keys(pe).filter(function(gr){return!!pe[gr]}),maxAnisotropic:Ne,maxDrawbuffers:It,maxColorAttachments:$t,pointSizeDims:B.getParameter(Cr),lineWidthDims:B.getParameter(Ir),maxViewportDims:B.getParameter(Gr),maxCombinedTextureUnits:B.getParameter(Ti),maxCubeMapSize:B.getParameter(oo),maxRenderbufferSize:B.getParameter(mi),maxTextureUnits:B.getParameter(Aa),maxTextureSize:B.getParameter(Zn),maxAttributes:B.getParameter(Kn),maxVertexUniforms:B.getParameter(Di),maxVertexTextureUnits:B.getParameter(di),maxVaryingVectors:B.getParameter(oi),maxFragmentUniforms:B.getParameter(Ni),glsl:B.getParameter(Ls),renderer:B.getParameter(ui),vendor:B.getParameter(Jn),version:B.getParameter(To),readFloat:Lt,npotTextureCube:Sr}};function Zo(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||qt(B.data))}var qi=function(B){return Object.keys(B).map(function(pe){return B[pe]})},Qa={shape:Er,flatten:Gt};function na(B,pe,Ne){for(var It=0;It<pe;++It)Ne[It]=B[It]}function ie(B,pe,Ne,It){for(var $t=0,Lt=0;Lt<pe;++Lt)for(var yt=B[Lt],br=0;br<Ne;++br)It[$t++]=yt[br]}function ye(B,pe,Ne,It,$t,Lt){for(var yt=Lt,br=0;br<pe;++br)for(var _r=B[br],Mr=0;Mr<Ne;++Mr)for(var Sr=_r[Mr],Or=0;Or<It;++Or)$t[yt++]=Sr[Or]}function Je(B,pe,Ne,It,$t){for(var Lt=1,yt=Ne+1;yt<pe.length;++yt)Lt*=pe[yt];var br=pe[Ne];if(pe.length-Ne===4){var _r=pe[Ne+1],Mr=pe[Ne+2],Sr=pe[Ne+3];for(yt=0;yt<br;++yt)ye(B[yt],_r,Mr,Sr,It,$t),$t+=Lt}else for(yt=0;yt<br;++yt)Je(B[yt],pe,Ne+1,It,$t),$t+=Lt}function Gt(B,pe,Ne,It){var $t=1;if(pe.length)for(var Lt=0;Lt<pe.length;++Lt)$t*=pe[Lt];else $t=0;var yt=It||Dt.allocType(Ne,$t);switch(pe.length){case 0:break;case 1:na(B,pe[0],yt);break;case 2:ie(B,pe[0],pe[1],yt);break;case 3:ye(B,pe[0],pe[1],pe[2],yt,0);break;default:Je(B,pe,0,yt,0)}return yt}function Er(B){for(var pe=[],Ne=B;Ne.length;Ne=Ne[0])pe.push(Ne.length);return pe}var mn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ci=5120,Yo=5122,ia=5124,qo=5121,_s=5123,gs=5125,of=5126,Rf=5126,ai={int8:Ci,int16:Yo,int32:ia,uint8:qo,uint16:_s,uint32:gs,float:of,float32:Rf},ys=35048,Fs=35040,au={dynamic:ys,stream:Fs,static:35044},yu=Qa.flatten,Nu=Qa.shape,Mc=35044,xs=35040,Co=5121,xu=5126,is=[];is[5120]=1,is[5122]=2,is[5124]=4,is[5121]=1,is[5123]=2,is[5125]=4,is[5126]=4;function Al(B){return mn[Object.prototype.toString.call(B)]|0}function ch(B,pe){for(var Ne=0;Ne<pe.length;++Ne)B[Ne]=pe[Ne]}function af(B,pe,Ne,It,$t,Lt,yt){for(var br=0,_r=0;_r<Ne;++_r)for(var Mr=0;Mr<It;++Mr)B[br++]=pe[$t*_r+Lt*Mr+yt]}function Mf(B,pe,Ne,It){var $t=0,Lt={};function yt(dt){this.id=$t++,this.buffer=B.createBuffer(),this.type=dt,this.usage=Mc,this.byteLength=0,this.dimension=1,this.dtype=Co,this.persistentData=null,Ne.profile&&(this.stats={size:0})}yt.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},yt.prototype.destroy=function(){kr(this)};var br=[];function _r(dt,Ht){var Ar=br.pop();return Ar||(Ar=new yt(dt)),Ar.bind(),Or(Ar,Ht,xs,0,1,!1),Ar}function Mr(dt){br.push(dt)}function Sr(dt,Ht,Ar){dt.byteLength=Ht.byteLength,B.bufferData(dt.type,Ht,Ar)}function Or(dt,Ht,Ar,Yr,sr,tn){var yr;if(dt.usage=Ar,Array.isArray(Ht)){if(dt.dtype=Yr||xu,Ht.length>0){var qr;if(Array.isArray(Ht[0])){yr=Nu(Ht);for(var fr=1,jr=1;jr<yr.length;++jr)fr*=yr[jr];dt.dimension=fr,qr=yu(Ht,yr,dt.dtype),Sr(dt,qr,Ar),tn?dt.persistentData=qr:Dt.freeType(qr)}else if(typeof Ht[0]=="number"){dt.dimension=sr;var wn=Dt.allocType(dt.dtype,Ht.length);ch(wn,Ht),Sr(dt,wn,Ar),tn?dt.persistentData=wn:Dt.freeType(wn)}else qt(Ht[0])?(dt.dimension=Ht[0].length,dt.dtype=Yr||Al(Ht[0])||xu,qr=yu(Ht,[Ht.length,Ht[0].length],dt.dtype),Sr(dt,qr,Ar),tn?dt.persistentData=qr:Dt.freeType(qr)):ue.raise("invalid buffer data")}}else if(qt(Ht))dt.dtype=Yr||Al(Ht),dt.dimension=sr,Sr(dt,Ht,Ar),tn&&(dt.persistentData=new Uint8Array(new Uint8Array(Ht.buffer)));else if(Zo(Ht)){yr=Ht.shape;var Wn=Ht.stride,Hr=Ht.offset,xr=0,Qt=0,Mn=0,lt=0;yr.length===1?(xr=yr[0],Qt=1,Mn=Wn[0],lt=0):yr.length===2?(xr=yr[0],Qt=yr[1],Mn=Wn[0],lt=Wn[1]):ue.raise("invalid shape"),dt.dtype=Yr||Al(Ht.data)||xu,dt.dimension=Qt;var P=Dt.allocType(dt.dtype,xr*Qt);af(P,Ht.data,xr,Qt,Mn,lt,Hr),Sr(dt,P,Ar),tn?dt.persistentData=P:Dt.freeType(P)}else Ht instanceof ArrayBuffer?(dt.dtype=Co,dt.dimension=sr,Sr(dt,Ht,Ar),tn&&(dt.persistentData=new Uint8Array(new Uint8Array(Ht)))):ue.raise("invalid buffer data")}function kr(dt){pe.bufferCount--,It(dt);var Ht=dt.buffer;ue(Ht,"buffer must not be deleted already"),B.deleteBuffer(Ht),dt.buffer=null,delete Lt[dt.id]}function gr(dt,Ht,Ar,Yr){pe.bufferCount++;var sr=new yt(Ht);Lt[sr.id]=sr;function tn(fr){var jr=Mc,wn=null,Wn=0,Hr=0,xr=1;return Array.isArray(fr)||qt(fr)||Zo(fr)||fr instanceof ArrayBuffer?wn=fr:typeof fr=="number"?Wn=fr|0:fr&&(ue.type(fr,"object","buffer arguments must be an object, a number or an array"),"data"in fr&&(ue(wn===null||Array.isArray(wn)||qt(wn)||Zo(wn),"invalid data for buffer"),wn=fr.data),"usage"in fr&&(ue.parameter(fr.usage,au,"invalid buffer usage"),jr=au[fr.usage]),"type"in fr&&(ue.parameter(fr.type,ai,"invalid buffer type"),Hr=ai[fr.type]),"dimension"in fr&&(ue.type(fr.dimension,"number","invalid dimension"),xr=fr.dimension|0),"length"in fr&&(ue.nni(Wn,"buffer length must be a nonnegative integer"),Wn=fr.length|0)),sr.bind(),wn?Or(sr,wn,jr,Hr,xr,Yr):(Wn&&B.bufferData(sr.type,Wn,jr),sr.dtype=Hr||Co,sr.usage=jr,sr.dimension=xr,sr.byteLength=Wn),Ne.profile&&(sr.stats.size=sr.byteLength*is[sr.dtype]),tn}function yr(fr,jr){ue(jr+fr.byteLength<=sr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+fr.byteLength+" starting from offset "+jr+" to a buffer of size "+sr.byteLength),B.bufferSubData(sr.type,jr,fr)}function qr(fr,jr){var wn=(jr||0)|0,Wn;if(sr.bind(),qt(fr)||fr instanceof ArrayBuffer)yr(fr,wn);else if(Array.isArray(fr)){if(fr.length>0)if(typeof fr[0]=="number"){var Hr=Dt.allocType(sr.dtype,fr.length);ch(Hr,fr),yr(Hr,wn),Dt.freeType(Hr)}else if(Array.isArray(fr[0])||qt(fr[0])){Wn=Nu(fr);var xr=yu(fr,Wn,sr.dtype);yr(xr,wn),Dt.freeType(xr)}else ue.raise("invalid buffer data")}else if(Zo(fr)){Wn=fr.shape;var Qt=fr.stride,Mn=0,lt=0,P=0,ti=0;Wn.length===1?(Mn=Wn[0],lt=1,P=Qt[0],ti=0):Wn.length===2?(Mn=Wn[0],lt=Wn[1],P=Qt[0],ti=Qt[1]):ue.raise("invalid shape");var F=Array.isArray(fr.data)?sr.dtype:Al(fr.data),zn=Dt.allocType(F,Mn*lt);af(zn,fr.data,Mn,lt,P,ti,fr.offset),yr(zn,wn),Dt.freeType(zn)}else ue.raise("invalid data for buffer subdata");return tn}return Ar||tn(dt),tn._reglType="buffer",tn._buffer=sr,tn.subdata=qr,Ne.profile&&(tn.stats=sr.stats),tn.destroy=function(){kr(sr)},tn}function Dr(){qi(Lt).forEach(function(dt){dt.buffer=B.createBuffer(),B.bindBuffer(dt.type,dt.buffer),B.bufferData(dt.type,dt.persistentData||dt.byteLength,dt.usage)})}return Ne.profile&&(pe.getTotalBufferSize=function(){var dt=0;return Object.keys(Lt).forEach(function(Ht){dt+=Lt[Ht].stats.size}),dt}),{create:gr,createStream:_r,destroyStream:Mr,clear:function(){qi(Lt).forEach(kr),br.forEach(kr)},getBuffer:function(dt){return dt&&dt._buffer instanceof yt?dt._buffer:null},restore:Dr,_initBuffer:Or}}var If=0,Pf=0,fh=1,hh=1,rp=4,Ic=4,Eu={points:If,point:Pf,lines:fh,line:hh,triangles:rp,triangle:Ic,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ph=0,_o=1,Tl=4,Ju=5120,Bs=5121,el=5122,Ys=5123,ku=5124,Ns=5125,Uu=34963,tl=35040,dh=35044;function mh(B,pe,Ne,It){var $t={},Lt=0,yt={uint8:Bs,uint16:Ys};pe.oes_element_index_uint&&(yt.uint32=Ns);function br(Dr){this.id=Lt++,$t[this.id]=this,this.buffer=Dr,this.primType=Tl,this.vertCount=0,this.type=0}br.prototype.bind=function(){this.buffer.bind()};var _r=[];function Mr(Dr){var dt=_r.pop();return dt||(dt=new br(Ne.create(null,Uu,!0,!1)._buffer)),Or(dt,Dr,tl,-1,-1,0,0),dt}function Sr(Dr){_r.push(Dr)}function Or(Dr,dt,Ht,Ar,Yr,sr,tn){Dr.buffer.bind();var yr;if(dt){var qr=tn;!tn&&(!qt(dt)||Zo(dt)&&!qt(dt.data))&&(qr=pe.oes_element_index_uint?Ns:Ys),Ne._initBuffer(Dr.buffer,dt,Ht,qr,3)}else B.bufferData(Uu,sr,Ht),Dr.buffer.dtype=yr||Bs,Dr.buffer.usage=Ht,Dr.buffer.dimension=3,Dr.buffer.byteLength=sr;if(yr=tn,!tn){switch(Dr.buffer.dtype){case Bs:case Ju:yr=Bs;break;case Ys:case el:yr=Ys;break;case Ns:case ku:yr=Ns;break;default:ue.raise("unsupported type for element array")}Dr.buffer.dtype=yr}Dr.type=yr,ue(yr!==Ns||!!pe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var fr=Yr;fr<0&&(fr=Dr.buffer.byteLength,yr===Ys?fr>>=1:yr===Ns&&(fr>>=2)),Dr.vertCount=fr;var jr=Ar;if(Ar<0){jr=Tl;var wn=Dr.buffer.dimension;wn===1&&(jr=ph),wn===2&&(jr=_o),wn===3&&(jr=Tl)}Dr.primType=jr}function kr(Dr){It.elementsCount--,ue(Dr.buffer!==null,"must not double destroy elements"),delete $t[Dr.id],Dr.buffer.destroy(),Dr.buffer=null}function gr(Dr,dt){var Ht=Ne.create(null,Uu,!0),Ar=new br(Ht._buffer);It.elementsCount++;function Yr(sr){if(!sr)Ht(),Ar.primType=Tl,Ar.vertCount=0,Ar.type=Bs;else if(typeof sr=="number")Ht(sr),Ar.primType=Tl,Ar.vertCount=sr|0,Ar.type=Bs;else{var tn=null,yr=dh,qr=-1,fr=-1,jr=0,wn=0;Array.isArray(sr)||qt(sr)||Zo(sr)?tn=sr:(ue.type(sr,"object","invalid arguments for elements"),"data"in sr&&(tn=sr.data,ue(Array.isArray(tn)||qt(tn)||Zo(tn),"invalid data for element buffer")),"usage"in sr&&(ue.parameter(sr.usage,au,"invalid element buffer usage"),yr=au[sr.usage]),"primitive"in sr&&(ue.parameter(sr.primitive,Eu,"invalid element buffer primitive"),qr=Eu[sr.primitive]),"count"in sr&&(ue(typeof sr.count=="number"&&sr.count>=0,"invalid vertex count for elements"),fr=sr.count|0),"type"in sr&&(ue.parameter(sr.type,yt,"invalid buffer type"),wn=yt[sr.type]),"length"in sr?jr=sr.length|0:(jr=fr,wn===Ys||wn===el?jr*=2:(wn===Ns||wn===ku)&&(jr*=4))),Or(Ar,tn,yr,qr,fr,jr,wn)}return Yr}return Yr(Dr),Yr._reglType="elements",Yr._elements=Ar,Yr.subdata=function(sr,tn){return Ht.subdata(sr,tn),Yr},Yr.destroy=function(){kr(Ar)},Yr}return{create:gr,createStream:Mr,destroyStream:Sr,getElements:function(Dr){return typeof Dr=="function"&&Dr._elements instanceof br?Dr._elements:null},clear:function(){qi($t).forEach(kr)}}}var Ji=new Float32Array(1),np=new Uint32Array(Ji.buffer),sf=5123;function Of(B){for(var pe=Dt.allocType(sf,B.length),Ne=0;Ne<B.length;++Ne)if(isNaN(B[Ne]))pe[Ne]=65535;else if(B[Ne]===1/0)pe[Ne]=31744;else if(B[Ne]===-1/0)pe[Ne]=64512;else{Ji[0]=B[Ne];var It=np[0],$t=It>>>31<<15,Lt=(It<<1>>>24)-127,yt=It>>13&1024-1;if(Lt<-24)pe[Ne]=$t;else if(Lt<-14){var br=-14-Lt;pe[Ne]=$t+(yt+1024>>br)}else Lt>15?pe[Ne]=$t+31744:pe[Ne]=$t+(Lt+15<<10)+yt}return pe}function jo(B){return Array.isArray(B)||qt(B)}var Df=function(B){return!(B&B-1)&&!!B},vh=34467,os=3553,zu=34067,bu=34069,rl=6408,uf=6406,Xl=6407,su=6409,Pc=6410,nl=32854,Vu=32855,Lf=36194,Oc=32819,Yn=32820,lf=33635,_h=34042,Zu=6402,Yl=34041,Ff=35904,Mi=35906,oa=36193,Ta=33776,Es=33777,Cl=33778,il=33779,wl=35986,Dc=35987,ql=34798,qs=35840,cf=35841,gh=35842,yh=35843,ol=36196,Jo=5121,al=5123,Kl=5125,Rl=5126,ip=10242,ff=10243,Lc=10497,sl=33071,Bf=33648,Fc=10240,Nf=10241,Bc=9728,kf=9729,$l=9984,Ql=9985,Ml=9986,go=9987,hf=33170,Su=4352,Il=4353,Ei=4354,mo=34046,as=3317,ul=37440,Jl=37441,Nc=37443,Uf=37444,zf=33984,ec=[$l,Ml,Ql,go],Au=[0,su,Pc,Xl,rl],Ca={};Ca[su]=Ca[uf]=Ca[Zu]=1,Ca[Yl]=Ca[Pc]=2,Ca[Xl]=Ca[Ff]=3,Ca[rl]=Ca[Mi]=4;function wo(B){return"[object "+B+"]"}var tc=wo("HTMLCanvasElement"),Vf=wo("OffscreenCanvas"),zi=wo("CanvasRenderingContext2D"),cn=wo("ImageBitmap"),bs=wo("HTMLImageElement"),pf=wo("HTMLVideoElement"),rc=Object.keys(mn).concat([tc,Vf,zi,cn,bs,pf]),ss=[];ss[Jo]=1,ss[Rl]=4,ss[oa]=2,ss[al]=2,ss[Kl]=4;var Ki=[];Ki[nl]=2,Ki[Vu]=2,Ki[Lf]=2,Ki[Yl]=4,Ki[Ta]=.5,Ki[Es]=.5,Ki[Cl]=1,Ki[il]=1,Ki[wl]=.5,Ki[Dc]=1,Ki[ql]=1,Ki[qs]=.5,Ki[cf]=.25,Ki[gh]=.5,Ki[yh]=.25,Ki[ol]=.5;function kc(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function Ur(B){if(!Array.isArray(B))return!1;var pe=B.length;return!(pe===0||!jo(B[0]))}function ju(B){return Object.prototype.toString.call(B)}function nc(B){return ju(B)===tc}function df(B){return ju(B)===Vf}function ks(B){return ju(B)===zi}function Us(B){return ju(B)===cn}function mf(B){return ju(B)===bs}function Zf(B){return ju(B)===pf}function Ko(B){if(!B)return!1;var pe=ju(B);return rc.indexOf(pe)>=0?!0:kc(B)||Ur(B)||Zo(B)}function Tu(B){return mn[Object.prototype.toString.call(B)]|0}function xh(B,pe){var Ne=pe.length;switch(B.type){case Jo:case al:case Kl:case Rl:var It=Dt.allocType(B.type,Ne);It.set(pe),B.data=It;break;case oa:B.data=Of(pe);break;default:ue.raise("unsupported texture type, must specify a typed array")}}function Uc(B,pe){return Dt.allocType(B.type===oa?Rl:B.type,pe)}function jf(B,pe){B.type===oa?(B.data=Of(pe),Dt.freeType(pe)):B.data=pe}function Hf(B,pe,Ne,It,$t,Lt){for(var yt=B.width,br=B.height,_r=B.channels,Mr=yt*br*_r,Sr=Uc(B,Mr),Or=0,kr=0;kr<br;++kr)for(var gr=0;gr<yt;++gr)for(var Dr=0;Dr<_r;++Dr)Sr[Or++]=pe[Ne*gr+It*kr+$t*Dr+Lt];jf(B,Sr)}function Ss(B,pe,Ne,It,$t,Lt){var yt;if(typeof Ki[B]!="undefined"?yt=Ki[B]:yt=Ca[B]*ss[pe],Lt&&(yt*=6),$t){for(var br=0,_r=Ne;_r>=1;)br+=yt*_r*_r,_r/=2;return br}else return yt*Ne*It}function Ks(B,pe,Ne,It,$t,Lt,yt){var br={"don't care":Su,"dont care":Su,nice:Ei,fast:Il},_r={repeat:Lc,clamp:sl,mirror:Bf},Mr={nearest:Bc,linear:kf},Sr=N({mipmap:go,"nearest mipmap nearest":$l,"linear mipmap nearest":Ql,"nearest mipmap linear":Ml,"linear mipmap linear":go},Mr),Or={none:0,browser:Uf},kr={uint8:Jo,rgba4:Oc,rgb565:lf,"rgb5 a1":Yn},gr={alpha:uf,luminance:su,"luminance alpha":Pc,rgb:Xl,rgba:rl,rgba4:nl,"rgb5 a1":Vu,rgb565:Lf},Dr={};pe.ext_srgb&&(gr.srgb=Ff,gr.srgba=Mi),pe.oes_texture_float&&(kr.float32=kr.float=Rl),pe.oes_texture_half_float&&(kr.float16=kr["half float"]=oa),pe.webgl_depth_texture&&(N(gr,{depth:Zu,"depth stencil":Yl}),N(kr,{uint16:al,uint32:Kl,"depth stencil":_h})),pe.webgl_compressed_texture_s3tc&&N(Dr,{"rgb s3tc dxt1":Ta,"rgba s3tc dxt1":Es,"rgba s3tc dxt3":Cl,"rgba s3tc dxt5":il}),pe.webgl_compressed_texture_atc&&N(Dr,{"rgb atc":wl,"rgba atc explicit alpha":Dc,"rgba atc interpolated alpha":ql}),pe.webgl_compressed_texture_pvrtc&&N(Dr,{"rgb pvrtc 4bppv1":qs,"rgb pvrtc 2bppv1":cf,"rgba pvrtc 4bppv1":gh,"rgba pvrtc 2bppv1":yh}),pe.webgl_compressed_texture_etc1&&(Dr["rgb etc1"]=ol);var dt=Array.prototype.slice.call(B.getParameter(vh));Object.keys(Dr).forEach(function(Me){var Ut=Dr[Me];dt.indexOf(Ut)>=0&&(gr[Me]=Ut)});var Ht=Object.keys(gr);Ne.textureFormats=Ht;var Ar=[];Object.keys(gr).forEach(function(Me){var Ut=gr[Me];Ar[Ut]=Me});var Yr=[];Object.keys(kr).forEach(function(Me){var Ut=kr[Me];Yr[Ut]=Me});var sr=[];Object.keys(Mr).forEach(function(Me){var Ut=Mr[Me];sr[Ut]=Me});var tn=[];Object.keys(Sr).forEach(function(Me){var Ut=Sr[Me];tn[Ut]=Me});var yr=[];Object.keys(_r).forEach(function(Me){var Ut=_r[Me];yr[Ut]=Me});var qr=Ht.reduce(function(Me,Ut){var bt=gr[Ut];return bt===su||bt===uf||bt===su||bt===Pc||bt===Zu||bt===Yl||pe.ext_srgb&&(bt===Ff||bt===Mi)?Me[bt]=bt:bt===Vu||Ut.indexOf("rgba")>=0?Me[bt]=rl:Me[bt]=Xl,Me},{});function fr(){this.internalformat=rl,this.format=rl,this.type=Jo,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Uf,this.width=0,this.height=0,this.channels=0}function jr(Me,Ut){Me.internalformat=Ut.internalformat,Me.format=Ut.format,Me.type=Ut.type,Me.compressed=Ut.compressed,Me.premultiplyAlpha=Ut.premultiplyAlpha,Me.flipY=Ut.flipY,Me.unpackAlignment=Ut.unpackAlignment,Me.colorSpace=Ut.colorSpace,Me.width=Ut.width,Me.height=Ut.height,Me.channels=Ut.channels}function wn(Me,Ut){if(!(typeof Ut!="object"||!Ut)){if("premultiplyAlpha"in Ut&&(ue.type(Ut.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Me.premultiplyAlpha=Ut.premultiplyAlpha),"flipY"in Ut&&(ue.type(Ut.flipY,"boolean","invalid texture flip"),Me.flipY=Ut.flipY),"alignment"in Ut&&(ue.oneOf(Ut.alignment,[1,2,4,8],"invalid texture unpack alignment"),Me.unpackAlignment=Ut.alignment),"colorSpace"in Ut&&(ue.parameter(Ut.colorSpace,Or,"invalid colorSpace"),Me.colorSpace=Or[Ut.colorSpace]),"type"in Ut){var bt=Ut.type;ue(pe.oes_texture_float||!(bt==="float"||bt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ue(pe.oes_texture_half_float||!(bt==="half float"||bt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ue(pe.webgl_depth_texture||!(bt==="uint16"||bt==="uint32"||bt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ue.parameter(bt,kr,"invalid texture type"),Me.type=kr[bt]}var on=Me.width,hi=Me.height,so=Me.channels,te=!1;"shape"in Ut?(ue(Array.isArray(Ut.shape)&&Ut.shape.length>=2,"shape must be an array"),on=Ut.shape[0],hi=Ut.shape[1],Ut.shape.length===3&&(so=Ut.shape[2],ue(so>0&&so<=4,"invalid number of channels"),te=!0),ue(on>=0&&on<=Ne.maxTextureSize,"invalid width"),ue(hi>=0&&hi<=Ne.maxTextureSize,"invalid height")):("radius"in Ut&&(on=hi=Ut.radius,ue(on>=0&&on<=Ne.maxTextureSize,"invalid radius")),"width"in Ut&&(on=Ut.width,ue(on>=0&&on<=Ne.maxTextureSize,"invalid width")),"height"in Ut&&(hi=Ut.height,ue(hi>=0&&hi<=Ne.maxTextureSize,"invalid height")),"channels"in Ut&&(so=Ut.channels,ue(so>0&&so<=4,"invalid number of channels"),te=!0)),Me.width=on|0,Me.height=hi|0,Me.channels=so|0;var xe=!1;if("format"in Ut){var Ue=Ut.format;ue(pe.webgl_depth_texture||!(Ue==="depth"||Ue==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ue.parameter(Ue,gr,"invalid texture format");var St=Me.internalformat=gr[Ue];Me.format=qr[St],Ue in kr&&("type"in Ut||(Me.type=kr[Ue])),Ue in Dr&&(Me.compressed=!0),xe=!0}!te&&xe?Me.channels=Ca[Me.format]:te&&!xe?Me.channels!==Au[Me.format]&&(Me.format=Me.internalformat=Au[Me.channels]):xe&&te&&ue(Me.channels===Ca[Me.format],"number of channels inconsistent with specified format")}}function Wn(Me){B.pixelStorei(ul,Me.flipY),B.pixelStorei(Jl,Me.premultiplyAlpha),B.pixelStorei(Nc,Me.colorSpace),B.pixelStorei(as,Me.unpackAlignment)}function Hr(){fr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function xr(Me,Ut){var bt=null;if(Ko(Ut)?bt=Ut:Ut&&(ue.type(Ut,"object","invalid pixel data type"),wn(Me,Ut),"x"in Ut&&(Me.xOffset=Ut.x|0),"y"in Ut&&(Me.yOffset=Ut.y|0),Ko(Ut.data)&&(bt=Ut.data)),ue(!Me.compressed||bt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ut.copy){ue(!bt,"can not specify copy and data field for the same texture");var on=$t.viewportWidth,hi=$t.viewportHeight;Me.width=Me.width||on-Me.xOffset,Me.height=Me.height||hi-Me.yOffset,Me.needsCopy=!0,ue(Me.xOffset>=0&&Me.xOffset<on&&Me.yOffset>=0&&Me.yOffset<hi&&Me.width>0&&Me.width<=on&&Me.height>0&&Me.height<=hi,"copy texture read out of bounds")}else if(!bt)Me.width=Me.width||1,Me.height=Me.height||1,Me.channels=Me.channels||4;else if(qt(bt))Me.channels=Me.channels||4,Me.data=bt,!("type"in Ut)&&Me.type===Jo&&(Me.type=Tu(bt));else if(kc(bt))Me.channels=Me.channels||4,xh(Me,bt),Me.alignment=1,Me.needsFree=!0;else if(Zo(bt)){var so=bt.data;!Array.isArray(so)&&Me.type===Jo&&(Me.type=Tu(so));var te=bt.shape,xe=bt.stride,Ue,St,xt,Ge,tt,ot;te.length===3?(xt=te[2],ot=xe[2]):(ue(te.length===2,"invalid ndarray pixel data, must be 2 or 3D"),xt=1,ot=1),Ue=te[0],St=te[1],Ge=xe[0],tt=xe[1],Me.alignment=1,Me.width=Ue,Me.height=St,Me.channels=xt,Me.format=Me.internalformat=Au[xt],Me.needsFree=!0,Hf(Me,so,Ge,tt,ot,bt.offset)}else if(nc(bt)||df(bt)||ks(bt))nc(bt)||df(bt)?Me.element=bt:Me.element=bt.canvas,Me.width=Me.element.width,Me.height=Me.element.height,Me.channels=4;else if(Us(bt))Me.element=bt,Me.width=bt.width,Me.height=bt.height,Me.channels=4;else if(mf(bt))Me.element=bt,Me.width=bt.naturalWidth,Me.height=bt.naturalHeight,Me.channels=4;else if(Zf(bt))Me.element=bt,Me.width=bt.videoWidth,Me.height=bt.videoHeight,Me.channels=4;else if(Ur(bt)){var Ce=Me.width||bt[0].length,Ye=Me.height||bt.length,me=Me.channels;jo(bt[0][0])?me=me||bt[0][0].length:me=me||1;for(var $e=Qa.shape(bt),Et=1,Nt=0;Nt<$e.length;++Nt)Et*=$e[Nt];var ar=Uc(Me,Et);Qa.flatten(bt,$e,"",ar),jf(Me,ar),Me.alignment=1,Me.width=Ce,Me.height=Ye,Me.channels=me,Me.format=Me.internalformat=Au[me],Me.needsFree=!0}Me.type===Rl?ue(Ne.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Me.type===oa&&ue(Ne.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Qt(Me,Ut,bt){var on=Me.element,hi=Me.data,so=Me.internalformat,te=Me.format,xe=Me.type,Ue=Me.width,St=Me.height;Wn(Me),on?B.texImage2D(Ut,bt,te,te,xe,on):Me.compressed?B.compressedTexImage2D(Ut,bt,so,Ue,St,0,hi):Me.needsCopy?(It(),B.copyTexImage2D(Ut,bt,te,Me.xOffset,Me.yOffset,Ue,St,0)):B.texImage2D(Ut,bt,te,Ue,St,0,te,xe,hi||null)}function Mn(Me,Ut,bt,on,hi){var so=Me.element,te=Me.data,xe=Me.internalformat,Ue=Me.format,St=Me.type,xt=Me.width,Ge=Me.height;Wn(Me),so?B.texSubImage2D(Ut,hi,bt,on,Ue,St,so):Me.compressed?B.compressedTexSubImage2D(Ut,hi,bt,on,xe,xt,Ge,te):Me.needsCopy?(It(),B.copyTexSubImage2D(Ut,hi,bt,on,Me.xOffset,Me.yOffset,xt,Ge)):B.texSubImage2D(Ut,hi,bt,on,xt,Ge,Ue,St,te)}var lt=[];function P(){return lt.pop()||new Hr}function ti(Me){Me.needsFree&&Dt.freeType(Me.data),Hr.call(Me),lt.push(Me)}function F(){fr.call(this),this.genMipmaps=!1,this.mipmapHint=Su,this.mipmask=0,this.images=Array(16)}function zn(Me,Ut,bt){var on=Me.images[0]=P();Me.mipmask=1,on.width=Me.width=Ut,on.height=Me.height=bt,on.channels=Me.channels=4}function ki(Me,Ut){var bt=null;if(Ko(Ut))bt=Me.images[0]=P(),jr(bt,Me),xr(bt,Ut),Me.mipmask=1;else if(wn(Me,Ut),Array.isArray(Ut.mipmap))for(var on=Ut.mipmap,hi=0;hi<on.length;++hi)bt=Me.images[hi]=P(),jr(bt,Me),bt.width>>=hi,bt.height>>=hi,xr(bt,on[hi]),Me.mipmask|=1<<hi;else bt=Me.images[0]=P(),jr(bt,Me),xr(bt,Ut),Me.mipmask=1;jr(Me,Me.images[0]),Me.compressed&&(Me.internalformat===Ta||Me.internalformat===Es||Me.internalformat===Cl||Me.internalformat===il)&&ue(Me.width%4===0&&Me.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function sa(Me,Ut){for(var bt=Me.images,on=0;on<bt.length;++on){if(!bt[on])return;Qt(bt[on],Ut,on)}}var Ua=[];function ri(){var Me=Ua.pop()||new F;fr.call(Me),Me.mipmask=0;for(var Ut=0;Ut<16;++Ut)Me.images[Ut]=null;return Me}function ua(Me){for(var Ut=Me.images,bt=0;bt<Ut.length;++bt)Ut[bt]&&ti(Ut[bt]),Ut[bt]=null;Ua.push(Me)}function vo(){this.minFilter=Bc,this.magFilter=Bc,this.wrapS=sl,this.wrapT=sl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Su}function la(Me,Ut){if("min"in Ut){var bt=Ut.min;ue.parameter(bt,Sr),Me.minFilter=Sr[bt],ec.indexOf(Me.minFilter)>=0&&!("faces"in Ut)&&(Me.genMipmaps=!0)}if("mag"in Ut){var on=Ut.mag;ue.parameter(on,Mr),Me.magFilter=Mr[on]}var hi=Me.wrapS,so=Me.wrapT;if("wrap"in Ut){var te=Ut.wrap;typeof te=="string"?(ue.parameter(te,_r),hi=so=_r[te]):Array.isArray(te)&&(ue.parameter(te[0],_r),ue.parameter(te[1],_r),hi=_r[te[0]],so=_r[te[1]])}else{if("wrapS"in Ut){var xe=Ut.wrapS;ue.parameter(xe,_r),hi=_r[xe]}if("wrapT"in Ut){var Ue=Ut.wrapT;ue.parameter(Ue,_r),so=_r[Ue]}}if(Me.wrapS=hi,Me.wrapT=so,"anisotropic"in Ut){var St=Ut.anisotropic;ue(typeof St=="number"&&St>=1&&St<=Ne.maxAnisotropic,"aniso samples must be between 1 and "),Me.anisotropic=Ut.anisotropic}if("mipmap"in Ut){var xt=!1;switch(typeof Ut.mipmap){case"string":ue.parameter(Ut.mipmap,br,"invalid mipmap hint"),Me.mipmapHint=br[Ut.mipmap],Me.genMipmaps=!0,xt=!0;break;case"boolean":xt=Me.genMipmaps=Ut.mipmap;break;case"object":ue(Array.isArray(Ut.mipmap),"invalid mipmap type"),Me.genMipmaps=!1,xt=!0;break;default:ue.raise("invalid mipmap type")}xt&&!("min"in Ut)&&(Me.minFilter=$l)}}function ea(Me,Ut){B.texParameteri(Ut,Nf,Me.minFilter),B.texParameteri(Ut,Fc,Me.magFilter),B.texParameteri(Ut,ip,Me.wrapS),B.texParameteri(Ut,ff,Me.wrapT),pe.ext_texture_filter_anisotropic&&B.texParameteri(Ut,mo,Me.anisotropic),Me.genMipmaps&&(B.hint(hf,Me.mipmapHint),B.generateMipmap(Ut))}var No=0,Ia={},hs=Ne.maxTextureUnits,ca=Array(hs).map(function(){return null});function li(Me){fr.call(this),this.mipmask=0,this.internalformat=rl,this.id=No++,this.refCount=1,this.target=Me,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new vo,yt.profile&&(this.stats={size:0})}function rs(Me){B.activeTexture(zf),B.bindTexture(Me.target,Me.texture)}function Hi(){var Me=ca[0];Me?B.bindTexture(Me.target,Me.texture):B.bindTexture(os,null)}function Nn(Me){var Ut=Me.texture;ue(Ut,"must not double destroy texture");var bt=Me.unit,on=Me.target;bt>=0&&(B.activeTexture(zf+bt),B.bindTexture(on,null),ca[bt]=null),B.deleteTexture(Ut),Me.texture=null,Me.params=null,Me.pixels=null,Me.refCount=0,delete Ia[Me.id],Lt.textureCount--}N(li.prototype,{bind:function(){var Me=this;Me.bindCount+=1;var Ut=Me.unit;if(Ut<0){for(var bt=0;bt<hs;++bt){var on=ca[bt];if(on){if(on.bindCount>0)continue;on.unit=-1}ca[bt]=Me,Ut=bt;break}Ut>=hs&&ue.raise("insufficient number of texture units"),yt.profile&&Lt.maxTextureUnits<Ut+1&&(Lt.maxTextureUnits=Ut+1),Me.unit=Ut,B.activeTexture(zf+Ut),B.bindTexture(Me.target,Me.texture)}return Ut},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Nn(this)}});function xi(Me,Ut){var bt=new li(os);Ia[bt.id]=bt,Lt.textureCount++;function on(te,xe){var Ue=bt.texInfo;vo.call(Ue);var St=ri();return typeof te=="number"?typeof xe=="number"?zn(St,te|0,xe|0):zn(St,te|0,te|0):te?(ue.type(te,"object","invalid arguments to regl.texture"),la(Ue,te),ki(St,te)):zn(St,1,1),Ue.genMipmaps&&(St.mipmask=(St.width<<1)-1),bt.mipmask=St.mipmask,jr(bt,St),ue.texture2D(Ue,St,Ne),bt.internalformat=St.internalformat,on.width=St.width,on.height=St.height,rs(bt),sa(St,os),ea(Ue,os),Hi(),ua(St),yt.profile&&(bt.stats.size=Ss(bt.internalformat,bt.type,St.width,St.height,Ue.genMipmaps,!1)),on.format=Ar[bt.internalformat],on.type=Yr[bt.type],on.mag=sr[Ue.magFilter],on.min=tn[Ue.minFilter],on.wrapS=yr[Ue.wrapS],on.wrapT=yr[Ue.wrapT],on}function hi(te,xe,Ue,St){ue(!!te,"must specify image data");var xt=xe|0,Ge=Ue|0,tt=St|0,ot=P();return jr(ot,bt),ot.width=0,ot.height=0,xr(ot,te),ot.width=ot.width||(bt.width>>tt)-xt,ot.height=ot.height||(bt.height>>tt)-Ge,ue(bt.type===ot.type&&bt.format===ot.format&&bt.internalformat===ot.internalformat,"incompatible format for texture.subimage"),ue(xt>=0&&Ge>=0&&xt+ot.width<=bt.width&&Ge+ot.height<=bt.height,"texture.subimage write out of bounds"),ue(bt.mipmask&1<<tt,"missing mipmap data"),ue(ot.data||ot.element||ot.needsCopy,"missing image data"),rs(bt),Mn(ot,os,xt,Ge,tt),Hi(),ti(ot),on}function so(te,xe){var Ue=te|0,St=xe|0||Ue;if(Ue===bt.width&&St===bt.height)return on;on.width=bt.width=Ue,on.height=bt.height=St,rs(bt);for(var xt=0;bt.mipmask>>xt;++xt){var Ge=Ue>>xt,tt=St>>xt;if(!Ge||!tt)break;B.texImage2D(os,xt,bt.format,Ge,tt,0,bt.format,bt.type,null)}return Hi(),yt.profile&&(bt.stats.size=Ss(bt.internalformat,bt.type,Ue,St,!1,!1)),on}return on(Me,Ut),on.subimage=hi,on.resize=so,on._reglType="texture2d",on._texture=bt,yt.profile&&(on.stats=bt.stats),on.destroy=function(){bt.decRef()},on}function Li(Me,Ut,bt,on,hi,so){var te=new li(zu);Ia[te.id]=te,Lt.cubeCount++;var xe=new Array(6);function Ue(Ge,tt,ot,Ce,Ye,me){var $e,Et=te.texInfo;for(vo.call(Et),$e=0;$e<6;++$e)xe[$e]=ri();if(typeof Ge=="number"||!Ge){var Nt=Ge|0||1;for($e=0;$e<6;++$e)zn(xe[$e],Nt,Nt)}else if(typeof Ge=="object")if(tt)ki(xe[0],Ge),ki(xe[1],tt),ki(xe[2],ot),ki(xe[3],Ce),ki(xe[4],Ye),ki(xe[5],me);else if(la(Et,Ge),wn(te,Ge),"faces"in Ge){var ar=Ge.faces;for(ue(Array.isArray(ar)&&ar.length===6,"cube faces must be a length 6 array"),$e=0;$e<6;++$e)ue(typeof ar[$e]=="object"&&!!ar[$e],"invalid input for cube map face"),jr(xe[$e],te),ki(xe[$e],ar[$e])}else for($e=0;$e<6;++$e)ki(xe[$e],Ge);else ue.raise("invalid arguments to cube map");for(jr(te,xe[0]),Ne.npotTextureCube||ue(Df(te.width)&&Df(te.height),"your browser does not support non power or two texture dimensions"),Et.genMipmaps?te.mipmask=(xe[0].width<<1)-1:te.mipmask=xe[0].mipmask,ue.textureCube(te,Et,xe,Ne),te.internalformat=xe[0].internalformat,Ue.width=xe[0].width,Ue.height=xe[0].height,rs(te),$e=0;$e<6;++$e)sa(xe[$e],bu+$e);for(ea(Et,zu),Hi(),yt.profile&&(te.stats.size=Ss(te.internalformat,te.type,Ue.width,Ue.height,Et.genMipmaps,!0)),Ue.format=Ar[te.internalformat],Ue.type=Yr[te.type],Ue.mag=sr[Et.magFilter],Ue.min=tn[Et.minFilter],Ue.wrapS=yr[Et.wrapS],Ue.wrapT=yr[Et.wrapT],$e=0;$e<6;++$e)ua(xe[$e]);return Ue}function St(Ge,tt,ot,Ce,Ye){ue(!!tt,"must specify image data"),ue(typeof Ge=="number"&&Ge===(Ge|0)&&Ge>=0&&Ge<6,"invalid face");var me=ot|0,$e=Ce|0,Et=Ye|0,Nt=P();return jr(Nt,te),Nt.width=0,Nt.height=0,xr(Nt,tt),Nt.width=Nt.width||(te.width>>Et)-me,Nt.height=Nt.height||(te.height>>Et)-$e,ue(te.type===Nt.type&&te.format===Nt.format&&te.internalformat===Nt.internalformat,"incompatible format for texture.subimage"),ue(me>=0&&$e>=0&&me+Nt.width<=te.width&&$e+Nt.height<=te.height,"texture.subimage write out of bounds"),ue(te.mipmask&1<<Et,"missing mipmap data"),ue(Nt.data||Nt.element||Nt.needsCopy,"missing image data"),rs(te),Mn(Nt,bu+Ge,me,$e,Et),Hi(),ti(Nt),Ue}function xt(Ge){var tt=Ge|0;if(tt!==te.width){Ue.width=te.width=tt,Ue.height=te.height=tt,rs(te);for(var ot=0;ot<6;++ot)for(var Ce=0;te.mipmask>>Ce;++Ce)B.texImage2D(bu+ot,Ce,te.format,tt>>Ce,tt>>Ce,0,te.format,te.type,null);return Hi(),yt.profile&&(te.stats.size=Ss(te.internalformat,te.type,Ue.width,Ue.height,!1,!0)),Ue}}return Ue(Me,Ut,bt,on,hi,so),Ue.subimage=St,Ue.resize=xt,Ue._reglType="textureCube",Ue._texture=te,yt.profile&&(Ue.stats=te.stats),Ue.destroy=function(){te.decRef()},Ue}function ga(){for(var Me=0;Me<hs;++Me)B.activeTexture(zf+Me),B.bindTexture(os,null),ca[Me]=null;qi(Ia).forEach(Nn),Lt.cubeCount=0,Lt.textureCount=0}yt.profile&&(Lt.getTotalTextureSize=function(){var Me=0;return Object.keys(Ia).forEach(function(Ut){Me+=Ia[Ut].stats.size}),Me});function _l(){for(var Me=0;Me<hs;++Me){var Ut=ca[Me];Ut&&(Ut.bindCount=0,Ut.unit=-1,ca[Me]=null)}qi(Ia).forEach(function(bt){bt.texture=B.createTexture(),B.bindTexture(bt.target,bt.texture);for(var on=0;on<32;++on)if(bt.mipmask&1<<on)if(bt.target===os)B.texImage2D(os,on,bt.internalformat,bt.width>>on,bt.height>>on,0,bt.internalformat,bt.type,null);else for(var hi=0;hi<6;++hi)B.texImage2D(bu+hi,on,bt.internalformat,bt.width>>on,bt.height>>on,0,bt.internalformat,bt.type,null);ea(bt.texInfo,bt.target)})}return{create2D:xi,createCube:Li,clear:ga,getTexture:function(Me){return null},restore:_l}}var qn=36161,zs=32854,As=32855,ma=36194,Pl=33189,Hu=36168,Vs=34041,Ga=35907,ic=34836,Sn=34842,fn=34843,Ts=[];Ts[zs]=2,Ts[As]=2,Ts[ma]=2,Ts[Pl]=2,Ts[Hu]=1,Ts[Vs]=4,Ts[Ga]=4,Ts[ic]=16,Ts[Sn]=8,Ts[fn]=6;function Xa(B,pe,Ne){return Ts[B]*pe*Ne}var $s=function(B,pe,Ne,It,$t){var Lt={rgba4:zs,rgb565:ma,"rgb5 a1":As,depth:Pl,stencil:Hu,"depth stencil":Vs};pe.ext_srgb&&(Lt.srgba=Ga),pe.ext_color_buffer_half_float&&(Lt.rgba16f=Sn,Lt.rgb16f=fn),pe.webgl_color_buffer_float&&(Lt.rgba32f=ic);var yt=[];Object.keys(Lt).forEach(function(gr){var Dr=Lt[gr];yt[Dr]=gr});var br=0,_r={};function Mr(gr){this.id=br++,this.refCount=1,this.renderbuffer=gr,this.format=zs,this.width=0,this.height=0,$t.profile&&(this.stats={size:0})}Mr.prototype.decRef=function(){--this.refCount<=0&&Sr(this)};function Sr(gr){var Dr=gr.renderbuffer;ue(Dr,"must not double destroy renderbuffer"),B.bindRenderbuffer(qn,null),B.deleteRenderbuffer(Dr),gr.renderbuffer=null,gr.refCount=0,delete _r[gr.id],It.renderbufferCount--}function Or(gr,Dr){var dt=new Mr(B.createRenderbuffer());_r[dt.id]=dt,It.renderbufferCount++;function Ht(Yr,sr){var tn=0,yr=0,qr=zs;if(typeof Yr=="object"&&Yr){var fr=Yr;if("shape"in fr){var jr=fr.shape;ue(Array.isArray(jr)&&jr.length>=2,"invalid renderbuffer shape"),tn=jr[0]|0,yr=jr[1]|0}else"radius"in fr&&(tn=yr=fr.radius|0),"width"in fr&&(tn=fr.width|0),"height"in fr&&(yr=fr.height|0);"format"in fr&&(ue.parameter(fr.format,Lt,"invalid renderbuffer format"),qr=Lt[fr.format])}else typeof Yr=="number"?(tn=Yr|0,typeof sr=="number"?yr=sr|0:yr=tn):Yr?ue.raise("invalid arguments to renderbuffer constructor"):tn=yr=1;if(ue(tn>0&&yr>0&&tn<=Ne.maxRenderbufferSize&&yr<=Ne.maxRenderbufferSize,"invalid renderbuffer size"),!(tn===dt.width&&yr===dt.height&&qr===dt.format))return Ht.width=dt.width=tn,Ht.height=dt.height=yr,dt.format=qr,B.bindRenderbuffer(qn,dt.renderbuffer),B.renderbufferStorage(qn,qr,tn,yr),ue(B.getError()===0,"invalid render buffer format"),$t.profile&&(dt.stats.size=Xa(dt.format,dt.width,dt.height)),Ht.format=yt[dt.format],Ht}function Ar(Yr,sr){var tn=Yr|0,yr=sr|0||tn;return tn===dt.width&&yr===dt.height||(ue(tn>0&&yr>0&&tn<=Ne.maxRenderbufferSize&&yr<=Ne.maxRenderbufferSize,"invalid renderbuffer size"),Ht.width=dt.width=tn,Ht.height=dt.height=yr,B.bindRenderbuffer(qn,dt.renderbuffer),B.renderbufferStorage(qn,dt.format,tn,yr),ue(B.getError()===0,"invalid render buffer format"),$t.profile&&(dt.stats.size=Xa(dt.format,dt.width,dt.height))),Ht}return Ht(gr,Dr),Ht.resize=Ar,Ht._reglType="renderbuffer",Ht._renderbuffer=dt,$t.profile&&(Ht.stats=dt.stats),Ht.destroy=function(){dt.decRef()},Ht}$t.profile&&(It.getTotalRenderbufferSize=function(){var gr=0;return Object.keys(_r).forEach(function(Dr){gr+=_r[Dr].stats.size}),gr});function kr(){qi(_r).forEach(function(gr){gr.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(qn,gr.renderbuffer),B.renderbufferStorage(qn,gr.format,gr.width,gr.height)}),B.bindRenderbuffer(qn,null)}return{create:Or,clear:function(){qi(_r).forEach(Sr)},restore:kr}},Ro=36160,Qs=36161,Cu=3553,ll=34069,Vi=36064,wa=36096,Wf=36128,cl=33306,vf=36053,Wu=36054,us=36055,oc=36057,wu=36061,ac=36193,Ol=5121,_f=5126,gf=6407,fl=6408,Dl=6402,Ll=[gf,fl],aa=[];aa[fl]=4,aa[gf]=3;var Js=[];Js[Ol]=1,Js[_f]=4,Js[ac]=2;var zc=32854,uu=32855,eu=36194,Gf=33189,Vc=36168,Zc=34041,sc=35907,l=34836,f=34842,c=34843,d=[zc,uu,eu,sc,f,c,l],x={};x[vf]="complete",x[Wu]="incomplete attachment",x[oc]="incomplete dimensions",x[us]="incomplete, missing attachment",x[wu]="unsupported";function S(B,pe,Ne,It,$t,Lt){var yt={cur:null,next:null,dirty:!1,setFBO:null},br=["rgba"],_r=["rgba4","rgb565","rgb5 a1"];pe.ext_srgb&&_r.push("srgba"),pe.ext_color_buffer_half_float&&_r.push("rgba16f","rgb16f"),pe.webgl_color_buffer_float&&_r.push("rgba32f");var Mr=["uint8"];pe.oes_texture_half_float&&Mr.push("half float","float16"),pe.oes_texture_float&&Mr.push("float","float32");function Sr(Hr,xr,Qt){this.target=Hr,this.texture=xr,this.renderbuffer=Qt;var Mn=0,lt=0;xr?(Mn=xr.width,lt=xr.height):Qt&&(Mn=Qt.width,lt=Qt.height),this.width=Mn,this.height=lt}function Or(Hr){Hr&&(Hr.texture&&Hr.texture._texture.decRef(),Hr.renderbuffer&&Hr.renderbuffer._renderbuffer.decRef())}function kr(Hr,xr,Qt){if(Hr)if(Hr.texture){var Mn=Hr.texture._texture,lt=Math.max(1,Mn.width),P=Math.max(1,Mn.height);ue(lt===xr&&P===Qt,"inconsistent width/height for supplied texture"),Mn.refCount+=1}else{var ti=Hr.renderbuffer._renderbuffer;ue(ti.width===xr&&ti.height===Qt,"inconsistent width/height for renderbuffer"),ti.refCount+=1}}function gr(Hr,xr){xr&&(xr.texture?B.framebufferTexture2D(Ro,Hr,xr.target,xr.texture._texture.texture,0):B.framebufferRenderbuffer(Ro,Hr,Qs,xr.renderbuffer._renderbuffer.renderbuffer))}function Dr(Hr){var xr=Cu,Qt=null,Mn=null,lt=Hr;typeof Hr=="object"&&(lt=Hr.data,"target"in Hr&&(xr=Hr.target|0)),ue.type(lt,"function","invalid attachment data");var P=lt._reglType;return P==="texture2d"?(Qt=lt,ue(xr===Cu)):P==="textureCube"?(Qt=lt,ue(xr>=ll&&xr<ll+6,"invalid cube map target")):P==="renderbuffer"?(Mn=lt,xr=Qs):ue.raise("invalid regl object for attachment"),new Sr(xr,Qt,Mn)}function dt(Hr,xr,Qt,Mn,lt){if(Qt){var P=It.create2D({width:Hr,height:xr,format:Mn,type:lt});return P._texture.refCount=0,new Sr(Cu,P,null)}else{var ti=$t.create({width:Hr,height:xr,format:Mn});return ti._renderbuffer.refCount=0,new Sr(Qs,null,ti)}}function Ht(Hr){return Hr&&(Hr.texture||Hr.renderbuffer)}function Ar(Hr,xr,Qt){Hr&&(Hr.texture?Hr.texture.resize(xr,Qt):Hr.renderbuffer&&Hr.renderbuffer.resize(xr,Qt),Hr.width=xr,Hr.height=Qt)}var Yr=0,sr={};function tn(){this.id=Yr++,sr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function yr(Hr){Hr.colorAttachments.forEach(Or),Or(Hr.depthAttachment),Or(Hr.stencilAttachment),Or(Hr.depthStencilAttachment)}function qr(Hr){var xr=Hr.framebuffer;ue(xr,"must not double destroy framebuffer"),B.deleteFramebuffer(xr),Hr.framebuffer=null,Lt.framebufferCount--,delete sr[Hr.id]}function fr(Hr){var xr;B.bindFramebuffer(Ro,Hr.framebuffer);var Qt=Hr.colorAttachments;for(xr=0;xr<Qt.length;++xr)gr(Vi+xr,Qt[xr]);for(xr=Qt.length;xr<Ne.maxColorAttachments;++xr)B.framebufferTexture2D(Ro,Vi+xr,Cu,null,0);B.framebufferTexture2D(Ro,cl,Cu,null,0),B.framebufferTexture2D(Ro,wa,Cu,null,0),B.framebufferTexture2D(Ro,Wf,Cu,null,0),gr(wa,Hr.depthAttachment),gr(Wf,Hr.stencilAttachment),gr(cl,Hr.depthStencilAttachment);var Mn=B.checkFramebufferStatus(Ro);!B.isContextLost()&&Mn!==vf&&ue.raise("framebuffer configuration not supported, status = "+x[Mn]),B.bindFramebuffer(Ro,yt.next?yt.next.framebuffer:null),yt.cur=yt.next,B.getError()}function jr(Hr,xr){var Qt=new tn;Lt.framebufferCount++;function Mn(P,ti){var F;ue(yt.next!==Qt,"can not update framebuffer which is currently in use");var zn=0,ki=0,sa=!0,Ua=!0,ri=null,ua=!0,vo="rgba",la="uint8",ea=1,No=null,Ia=null,hs=null,ca=!1;if(typeof P=="number")zn=P|0,ki=ti|0||zn;else if(!P)zn=ki=1;else{ue.type(P,"object","invalid arguments for framebuffer");var li=P;if("shape"in li){var rs=li.shape;ue(Array.isArray(rs)&&rs.length>=2,"invalid shape for framebuffer"),zn=rs[0],ki=rs[1]}else"radius"in li&&(zn=ki=li.radius),"width"in li&&(zn=li.width),"height"in li&&(ki=li.height);("color"in li||"colors"in li)&&(ri=li.color||li.colors,Array.isArray(ri)&&ue(ri.length===1||pe.webgl_draw_buffers,"multiple render targets not supported")),ri||("colorCount"in li&&(ea=li.colorCount|0,ue(ea>0,"invalid color buffer count")),"colorTexture"in li&&(ua=!!li.colorTexture,vo="rgba4"),"colorType"in li&&(la=li.colorType,ua?(ue(pe.oes_texture_float||!(la==="float"||la==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ue(pe.oes_texture_half_float||!(la==="half float"||la==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):la==="half float"||la==="float16"?(ue(pe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),vo="rgba16f"):(la==="float"||la==="float32")&&(ue(pe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),vo="rgba32f"),ue.oneOf(la,Mr,"invalid color type")),"colorFormat"in li&&(vo=li.colorFormat,br.indexOf(vo)>=0?ua=!0:_r.indexOf(vo)>=0?ua=!1:ua?ue.oneOf(li.colorFormat,br,"invalid color format for texture"):ue.oneOf(li.colorFormat,_r,"invalid color format for renderbuffer"))),("depthTexture"in li||"depthStencilTexture"in li)&&(ca=!!(li.depthTexture||li.depthStencilTexture),ue(!ca||pe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in li&&(typeof li.depth=="boolean"?sa=li.depth:(No=li.depth,Ua=!1)),"stencil"in li&&(typeof li.stencil=="boolean"?Ua=li.stencil:(Ia=li.stencil,sa=!1)),"depthStencil"in li&&(typeof li.depthStencil=="boolean"?sa=Ua=li.depthStencil:(hs=li.depthStencil,sa=!1,Ua=!1))}var Hi=null,Nn=null,xi=null,Li=null;if(Array.isArray(ri))Hi=ri.map(Dr);else if(ri)Hi=[Dr(ri)];else for(Hi=new Array(ea),F=0;F<ea;++F)Hi[F]=dt(zn,ki,ua,vo,la);ue(pe.webgl_draw_buffers||Hi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ue(Hi.length<=Ne.maxColorAttachments,"too many color attachments, not supported"),zn=zn||Hi[0].width,ki=ki||Hi[0].height,No?Nn=Dr(No):sa&&!Ua&&(Nn=dt(zn,ki,ca,"depth","uint32")),Ia?xi=Dr(Ia):Ua&&!sa&&(xi=dt(zn,ki,!1,"stencil","uint8")),hs?Li=Dr(hs):!No&&!Ia&&Ua&&sa&&(Li=dt(zn,ki,ca,"depth stencil","depth stencil")),ue(!!No+!!Ia+!!hs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ga=null;for(F=0;F<Hi.length;++F)if(kr(Hi[F],zn,ki),ue(!Hi[F]||Hi[F].texture&&Ll.indexOf(Hi[F].texture._texture.format)>=0||Hi[F].renderbuffer&&d.indexOf(Hi[F].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+F+" is invalid"),Hi[F]&&Hi[F].texture){var _l=aa[Hi[F].texture._texture.format]*Js[Hi[F].texture._texture.type];ga===null?ga=_l:ue(ga===_l,"all color attachments much have the same number of bits per pixel.")}return kr(Nn,zn,ki),ue(!Nn||Nn.texture&&Nn.texture._texture.format===Dl||Nn.renderbuffer&&Nn.renderbuffer._renderbuffer.format===Gf,"invalid depth attachment for framebuffer object"),kr(xi,zn,ki),ue(!xi||xi.renderbuffer&&xi.renderbuffer._renderbuffer.format===Vc,"invalid stencil attachment for framebuffer object"),kr(Li,zn,ki),ue(!Li||Li.texture&&Li.texture._texture.format===Zc||Li.renderbuffer&&Li.renderbuffer._renderbuffer.format===Zc,"invalid depth-stencil attachment for framebuffer object"),yr(Qt),Qt.width=zn,Qt.height=ki,Qt.colorAttachments=Hi,Qt.depthAttachment=Nn,Qt.stencilAttachment=xi,Qt.depthStencilAttachment=Li,Mn.color=Hi.map(Ht),Mn.depth=Ht(Nn),Mn.stencil=Ht(xi),Mn.depthStencil=Ht(Li),Mn.width=Qt.width,Mn.height=Qt.height,fr(Qt),Mn}function lt(P,ti){ue(yt.next!==Qt,"can not resize a framebuffer which is currently in use");var F=Math.max(P|0,1),zn=Math.max(ti|0||F,1);if(F===Qt.width&&zn===Qt.height)return Mn;for(var ki=Qt.colorAttachments,sa=0;sa<ki.length;++sa)Ar(ki[sa],F,zn);return Ar(Qt.depthAttachment,F,zn),Ar(Qt.stencilAttachment,F,zn),Ar(Qt.depthStencilAttachment,F,zn),Qt.width=Mn.width=F,Qt.height=Mn.height=zn,fr(Qt),Mn}return Mn(Hr,xr),N(Mn,{resize:lt,_reglType:"framebuffer",_framebuffer:Qt,destroy:function(){qr(Qt),yr(Qt)},use:function(P){yt.setFBO({framebuffer:Mn},P)}})}function wn(Hr){var xr=Array(6);function Qt(lt){var P;ue(xr.indexOf(yt.next)<0,"can not update framebuffer which is currently in use");var ti={color:null},F=0,zn=null,ki="rgba",sa="uint8",Ua=1;if(typeof lt=="number")F=lt|0;else if(!lt)F=1;else{ue.type(lt,"object","invalid arguments for framebuffer");var ri=lt;if("shape"in ri){var ua=ri.shape;ue(Array.isArray(ua)&&ua.length>=2,"invalid shape for framebuffer"),ue(ua[0]===ua[1],"cube framebuffer must be square"),F=ua[0]}else"radius"in ri&&(F=ri.radius|0),"width"in ri?(F=ri.width|0,"height"in ri&&ue(ri.height===F,"must be square")):"height"in ri&&(F=ri.height|0);("color"in ri||"colors"in ri)&&(zn=ri.color||ri.colors,Array.isArray(zn)&&ue(zn.length===1||pe.webgl_draw_buffers,"multiple render targets not supported")),zn||("colorCount"in ri&&(Ua=ri.colorCount|0,ue(Ua>0,"invalid color buffer count")),"colorType"in ri&&(ue.oneOf(ri.colorType,Mr,"invalid color type"),sa=ri.colorType),"colorFormat"in ri&&(ki=ri.colorFormat,ue.oneOf(ri.colorFormat,br,"invalid color format for texture"))),"depth"in ri&&(ti.depth=ri.depth),"stencil"in ri&&(ti.stencil=ri.stencil),"depthStencil"in ri&&(ti.depthStencil=ri.depthStencil)}var vo;if(zn)if(Array.isArray(zn))for(vo=[],P=0;P<zn.length;++P)vo[P]=zn[P];else vo=[zn];else{vo=Array(Ua);var la={radius:F,format:ki,type:sa};for(P=0;P<Ua;++P)vo[P]=It.createCube(la)}for(ti.color=Array(vo.length),P=0;P<vo.length;++P){var ea=vo[P];ue(typeof ea=="function"&&ea._reglType==="textureCube","invalid cube map"),F=F||ea.width,ue(ea.width===F&&ea.height===F,"invalid cube map shape"),ti.color[P]={target:ll,data:vo[P]}}for(P=0;P<6;++P){for(var No=0;No<vo.length;++No)ti.color[No].target=ll+P;P>0&&(ti.depth=xr[0].depth,ti.stencil=xr[0].stencil,ti.depthStencil=xr[0].depthStencil),xr[P]?xr[P](ti):xr[P]=jr(ti)}return N(Qt,{width:F,height:F,color:vo})}function Mn(lt){var P,ti=lt|0;if(ue(ti>0&&ti<=Ne.maxCubeMapSize,"invalid radius for cube fbo"),ti===Qt.width)return Qt;var F=Qt.color;for(P=0;P<F.length;++P)F[P].resize(ti);for(P=0;P<6;++P)xr[P].resize(ti);return Qt.width=Qt.height=ti,Qt}return Qt(Hr),N(Qt,{faces:xr,resize:Mn,_reglType:"framebufferCube",destroy:function(){xr.forEach(function(lt){lt.destroy()})}})}function Wn(){yt.cur=null,yt.next=null,yt.dirty=!0,qi(sr).forEach(function(Hr){Hr.framebuffer=B.createFramebuffer(),fr(Hr)})}return N(yt,{getFramebuffer:function(Hr){if(typeof Hr=="function"&&Hr._reglType==="framebuffer"){var xr=Hr._framebuffer;if(xr instanceof tn)return xr}return null},create:jr,createCube:wn,clear:function(){qi(sr).forEach(qr)},restore:Wn})}var T=5126,M=34962;function k(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=T,this.offset=0,this.stride=0,this.divisor=0}function X(B,pe,Ne,It,$t){for(var Lt=Ne.maxAttributes,yt=new Array(Lt),br=0;br<Lt;++br)yt[br]=new k;var _r=0,Mr={},Sr={Record:k,scope:{},state:yt,currentVAO:null,targetVAO:null,restore:kr()?sr:function(){},createVAO:tn,getVAO:Dr,destroyBuffer:Or,setVAO:kr()?dt:Ht,clear:kr()?Ar:function(){}};function Or(yr){for(var qr=0;qr<yt.length;++qr){var fr=yt[qr];fr.buffer===yr&&(B.disableVertexAttribArray(qr),fr.buffer=null)}}function kr(){return pe.oes_vertex_array_object}function gr(){return pe.angle_instanced_arrays}function Dr(yr){return typeof yr=="function"&&yr._vao?yr._vao:null}function dt(yr){if(yr!==Sr.currentVAO){var qr=kr();yr?qr.bindVertexArrayOES(yr.vao):qr.bindVertexArrayOES(null),Sr.currentVAO=yr}}function Ht(yr){if(yr!==Sr.currentVAO){if(yr)yr.bindAttrs();else for(var qr=gr(),fr=0;fr<yt.length;++fr){var jr=yt[fr];jr.buffer?(B.enableVertexAttribArray(fr),B.vertexAttribPointer(fr,jr.size,jr.type,jr.normalized,jr.stride,jr.offfset),qr&&qr.vertexAttribDivisorANGLE(fr,jr.divisor)):(B.disableVertexAttribArray(fr),B.vertexAttrib4f(fr,jr.x,jr.y,jr.z,jr.w))}Sr.currentVAO=yr}}function Ar(){qi(Mr).forEach(function(yr){yr.destroy()})}function Yr(){this.id=++_r,this.attributes=[];var yr=kr();yr?this.vao=yr.createVertexArrayOES():this.vao=null,Mr[this.id]=this,this.buffers=[]}Yr.prototype.bindAttrs=function(){for(var yr=gr(),qr=this.attributes,fr=0;fr<qr.length;++fr){var jr=qr[fr];jr.buffer?(B.enableVertexAttribArray(fr),B.bindBuffer(M,jr.buffer.buffer),B.vertexAttribPointer(fr,jr.size,jr.type,jr.normalized,jr.stride,jr.offset),yr&&yr.vertexAttribDivisorANGLE(fr,jr.divisor)):(B.disableVertexAttribArray(fr),B.vertexAttrib4f(fr,jr.x,jr.y,jr.z,jr.w))}for(var wn=qr.length;wn<Lt;++wn)B.disableVertexAttribArray(wn)},Yr.prototype.refresh=function(){var yr=kr();yr&&(yr.bindVertexArrayOES(this.vao),this.bindAttrs(),Sr.currentVAO=this)},Yr.prototype.destroy=function(){if(this.vao){var yr=kr();this===Sr.currentVAO&&(Sr.currentVAO=null,yr.bindVertexArrayOES(null)),yr.deleteVertexArrayOES(this.vao),this.vao=null}Mr[this.id]&&(delete Mr[this.id],It.vaoCount-=1)};function sr(){var yr=kr();yr&&qi(Mr).forEach(function(qr){qr.refresh()})}function tn(yr){var qr=new Yr;It.vaoCount+=1;function fr(jr){ue(Array.isArray(jr),"arguments to vertex array constructor must be an array"),ue(jr.length<Lt,"too many attributes"),ue(jr.length>0,"must specify at least one attribute");for(var wn=0;wn<qr.buffers.length;++wn)qr.buffers[wn].destroy();qr.buffers.length=0;var Wn=qr.attributes;Wn.length=jr.length;for(var Hr=0;Hr<jr.length;++Hr){var xr=jr[Hr],Qt=Wn[Hr]=new k;if(Array.isArray(xr)||qt(xr)||Zo(xr)){var Mn=$t.create(xr,M,!1,!0);Qt.buffer=$t.getBuffer(Mn),Qt.size=Qt.buffer.dimension|0,Qt.normalized=!1,Qt.type=Qt.buffer.dtype,Qt.offset=0,Qt.stride=0,Qt.divisor=0,Qt.state=1,qr.buffers.push(Mn)}else $t.getBuffer(xr)?(Qt.buffer=$t.getBuffer(xr),Qt.size=Qt.buffer.dimension|0,Qt.normalized=!1,Qt.type=Qt.buffer.dtype,Qt.offset=0,Qt.stride=0,Qt.divisor=0,Qt.state=1):$t.getBuffer(xr.buffer)?(Qt.buffer=$t.getBuffer(xr.buffer),Qt.size=(+xr.size||Qt.buffer.dimension)|0,Qt.normalized=!!xr.normalized||!1,"type"in xr?(ue.parameter(xr.type,ai,"invalid buffer type"),Qt.type=ai[xr.type]):Qt.type=Qt.buffer.dtype,Qt.offset=(xr.offset||0)|0,Qt.stride=(xr.stride||0)|0,Qt.divisor=(xr.divisor||0)|0,Qt.state=1,ue(Qt.size>=1&&Qt.size<=4,"size must be between 1 and 4"),ue(Qt.offset>=0,"invalid offset"),ue(Qt.stride>=0&&Qt.stride<=255,"stride must be between 0 and 255"),ue(Qt.divisor>=0,"divisor must be positive"),ue(!Qt.divisor||!!pe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in xr?(ue(Hr>0,"first attribute must not be a constant"),Qt.x=+xr.x||0,Qt.y=+xr.y||0,Qt.z=+xr.z||0,Qt.w=+xr.w||0,Qt.state=2):ue(!1,"invalid attribute spec for location "+Hr)}return qr.refresh(),fr}return fr.destroy=function(){qr.destroy()},fr._vao=qr,fr._reglType="vao",fr(yr)}return Sr}var oe=35632,le=35633,he=35718,Pe=35721;function we(B,pe,Ne,It){var $t={},Lt={};function yt(dt,Ht,Ar,Yr){this.name=dt,this.id=Ht,this.location=Ar,this.info=Yr}function br(dt,Ht){for(var Ar=0;Ar<dt.length;++Ar)if(dt[Ar].id===Ht.id){dt[Ar].location=Ht.location;return}dt.push(Ht)}function _r(dt,Ht,Ar){var Yr=dt===oe?$t:Lt,sr=Yr[Ht];if(!sr){var tn=pe.str(Ht);sr=B.createShader(dt),B.shaderSource(sr,tn),B.compileShader(sr),ue.shaderError(B,sr,tn,dt,Ar),Yr[Ht]=sr}return sr}var Mr={},Sr=[],Or=0;function kr(dt,Ht){this.id=Or++,this.fragId=dt,this.vertId=Ht,this.program=null,this.uniforms=[],this.attributes=[],It.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function gr(dt,Ht,Ar){var Yr,sr,tn=_r(oe,dt.fragId),yr=_r(le,dt.vertId),qr=dt.program=B.createProgram();if(B.attachShader(qr,tn),B.attachShader(qr,yr),Ar)for(Yr=0;Yr<Ar.length;++Yr){var fr=Ar[Yr];B.bindAttribLocation(qr,fr[0],fr[1])}B.linkProgram(qr),ue.linkError(B,qr,pe.str(dt.fragId),pe.str(dt.vertId),Ht);var jr=B.getProgramParameter(qr,he);It.profile&&(dt.stats.uniformsCount=jr);var wn=dt.uniforms;for(Yr=0;Yr<jr;++Yr)if(sr=B.getActiveUniform(qr,Yr),sr)if(sr.size>1)for(var Wn=0;Wn<sr.size;++Wn){var Hr=sr.name.replace("[0]","["+Wn+"]");br(wn,new yt(Hr,pe.id(Hr),B.getUniformLocation(qr,Hr),sr))}else br(wn,new yt(sr.name,pe.id(sr.name),B.getUniformLocation(qr,sr.name),sr));var xr=B.getProgramParameter(qr,Pe);It.profile&&(dt.stats.attributesCount=xr);var Qt=dt.attributes;for(Yr=0;Yr<xr;++Yr)sr=B.getActiveAttrib(qr,Yr),sr&&br(Qt,new yt(sr.name,pe.id(sr.name),B.getAttribLocation(qr,sr.name),sr))}It.profile&&(Ne.getMaxUniformsCount=function(){var dt=0;return Sr.forEach(function(Ht){Ht.stats.uniformsCount>dt&&(dt=Ht.stats.uniformsCount)}),dt},Ne.getMaxAttributesCount=function(){var dt=0;return Sr.forEach(function(Ht){Ht.stats.attributesCount>dt&&(dt=Ht.stats.attributesCount)}),dt});function Dr(){$t={},Lt={};for(var dt=0;dt<Sr.length;++dt)gr(Sr[dt],null,Sr[dt].attributes.map(function(Ht){return[Ht.location,Ht.name]}))}return{clear:function(){var dt=B.deleteShader.bind(B);qi($t).forEach(dt),$t={},qi(Lt).forEach(dt),Lt={},Sr.forEach(function(Ht){B.deleteProgram(Ht.program)}),Sr.length=0,Mr={},Ne.shaderCount=0},program:function(dt,Ht,Ar,Yr){ue.command(dt>=0,"missing vertex shader",Ar),ue.command(Ht>=0,"missing fragment shader",Ar);var sr=Mr[Ht];sr||(sr=Mr[Ht]={});var tn=sr[dt];if(tn&&!Yr)return tn;var yr=new kr(Ht,dt);return Ne.shaderCount++,gr(yr,Ar,Yr),tn||(sr[dt]=yr),Sr.push(yr),yr},restore:Dr,shader:_r,frag:-1,vert:-1}}var Xe=6408,Ae=5121,We=3333,nt=5126;function vt(B,pe,Ne,It,$t,Lt,yt){function br(Sr){var Or;pe.next===null?(ue($t.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Or=Ae):(ue(pe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Or=pe.next.colorAttachments[0].texture._texture.type,Lt.oes_texture_float?(ue(Or===Ae||Or===nt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Or===nt&&ue(yt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ue(Or===Ae,"Reading from a framebuffer is only allowed for the type 'uint8'"));var kr=0,gr=0,Dr=It.framebufferWidth,dt=It.framebufferHeight,Ht=null;qt(Sr)?Ht=Sr:Sr&&(ue.type(Sr,"object","invalid arguments to regl.read()"),kr=Sr.x|0,gr=Sr.y|0,ue(kr>=0&&kr<It.framebufferWidth,"invalid x offset for regl.read"),ue(gr>=0&&gr<It.framebufferHeight,"invalid y offset for regl.read"),Dr=(Sr.width||It.framebufferWidth-kr)|0,dt=(Sr.height||It.framebufferHeight-gr)|0,Ht=Sr.data||null),Ht&&(Or===Ae?ue(Ht instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Or===nt&&ue(Ht instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ue(Dr>0&&Dr+kr<=It.framebufferWidth,"invalid width for read pixels"),ue(dt>0&&dt+gr<=It.framebufferHeight,"invalid height for read pixels"),Ne();var Ar=Dr*dt*4;return Ht||(Or===Ae?Ht=new Uint8Array(Ar):Or===nt&&(Ht=Ht||new Float32Array(Ar))),ue.isTypedArray(Ht,"data buffer for regl.read() must be a typedarray"),ue(Ht.byteLength>=Ar,"data buffer for regl.read() too small"),B.pixelStorei(We,4),B.readPixels(kr,gr,Dr,dt,Xe,Or,Ht),Ht}function _r(Sr){var Or;return pe.setFBO({framebuffer:Sr.framebuffer},function(){Or=br(Sr)}),Or}function Mr(Sr){return!Sr||!("framebuffer"in Sr)?br(Sr):_r(Sr)}return Mr}function Vt(B){return Array.prototype.slice.call(B)}function Rt(B){return Vt(B).join("")}function Xt(){var B=0,pe=[],Ne=[];function It(Or){for(var kr=0;kr<Ne.length;++kr)if(Ne[kr]===Or)return pe[kr];var gr="g"+B++;return pe.push(gr),Ne.push(Or),gr}function $t(){var Or=[];function kr(){Or.push.apply(Or,Vt(arguments))}var gr=[];function Dr(){var dt="v"+B++;return gr.push(dt),arguments.length>0&&(Or.push(dt,"="),Or.push.apply(Or,Vt(arguments)),Or.push(";")),dt}return N(kr,{def:Dr,toString:function(){return Rt([gr.length>0?"var "+gr.join(",")+";":"",Rt(Or)])}})}function Lt(){var Or=$t(),kr=$t(),gr=Or.toString,Dr=kr.toString;function dt(Ht,Ar){kr(Ht,Ar,"=",Or.def(Ht,Ar),";")}return N(function(){Or.apply(Or,Vt(arguments))},{def:Or.def,entry:Or,exit:kr,save:dt,set:function(Ht,Ar,Yr){dt(Ht,Ar),Or(Ht,Ar,"=",Yr,";")},toString:function(){return gr()+Dr()}})}function yt(){var Or=Rt(arguments),kr=Lt(),gr=Lt(),Dr=kr.toString,dt=gr.toString;return N(kr,{then:function(){return kr.apply(kr,Vt(arguments)),this},else:function(){return gr.apply(gr,Vt(arguments)),this},toString:function(){var Ht=dt();return Ht&&(Ht="else{"+Ht+"}"),Rt(["if(",Or,"){",Dr(),"}",Ht])}})}var br=$t(),_r={};function Mr(Or,kr){var gr=[];function Dr(){var sr="a"+gr.length;return gr.push(sr),sr}kr=kr||0;for(var dt=0;dt<kr;++dt)Dr();var Ht=Lt(),Ar=Ht.toString,Yr=_r[Or]=N(Ht,{arg:Dr,toString:function(){return Rt(["function(",gr.join(),"){",Ar(),"}"])}});return Yr}function Sr(){var Or=['"use strict";',br,"return {"];Object.keys(_r).forEach(function(Dr){Or.push('"',Dr,'":',_r[Dr].toString(),",")}),Or.push("}");var kr=Rt(Or).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),gr=Function.apply(null,pe.concat(kr));return gr.apply(null,Ne)}return{global:br,link:It,block:$t,proc:Mr,scope:Lt,cond:yt,compile:Sr}}var or="xyzw".split(""),Pr=5121,wr=1,en=2,An=0,Cn=1,vn=2,wi=3,Kr=4,Hn="dither",si="blend.enable",jn="blend.color",Un="blend.equation",ei="blend.func",Bn="depth.enable",On="depth.func",Oo="depth.range",Do="depth.mask",Ra="colorMask",va="cull.enable",Ao="cull.face",Lo="frontFace",Ja="lineWidth",Na="polygonOffset.enable",lu="polygonOffset.offset",Ya="sample.alpha",Zs="sample.enable",Cs="sample.coverage",uc="stencil.enable",Fl="stencil.mask",Ru="stencil.func",Gu="stencil.opFront",Xu="stencil.opBack",cu="scissor.enable",Yu="scissor.box",ka="viewport",Ho="profile",ls="framebuffer",tu="vert",fu="frag",yi="elements",Ma="primitive",Fo="count",Mu="offset",lc="instances",hl="vao",cc="Width",pl="Height",qu=ls+cc,js=ls+pl,jc=ka+cc,Eh=ka+pl,ws="drawingBuffer",cs=ws+cc,op=ws+pl,ap=[ei,Un,Ru,Gu,Xu,Cs,ka,Yu,lu],fc=34962,sp=34963,Qd=35632,Jd=35633,bh=3553,Jp=34067,yf=2884,up=3042,Bl=3024,Xf=2960,em=2929,lp=3089,tm=32823,rm=32926,Sh=32928,Yf=5126,Ah=35664,dl=35665,Th=35666,hc=5124,Ch=35667,Bo=35668,Hc=35669,wh=35670,pc=35671,ml=35672,dc=35673,xf=35674,Ef=35675,Nl=35676,Wc=35678,Gc=35680,ed=4,kl=1028,Xc=1029,Rh=2304,cp=2305,fp=32775,hp=32776,Iu=519,mc=7680,td=0,pp=1,dp=32774,mp=513,vc=36160,nm=36064,vl={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},vp=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Yc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ul={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rd={frag:Qd,vert:Jd},_c={cw:Rh,ccw:cp};function qf(B){return Array.isArray(B)||qt(B)||Zo(B)}function Kf(B){return B.sort(function(pe,Ne){return pe===ka?-1:Ne===ka?1:pe<Ne?-1:1})}function es(B,pe,Ne,It){this.thisDep=B,this.contextDep=pe,this.propDep=Ne,this.append=It}function ts(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function _a(B){return new es(!1,!1,!1,B)}function ru(B,pe){var Ne=B.type;if(Ne===An){var It=B.data.length;return new es(!0,It>=1,It>=2,pe)}else if(Ne===Kr){var $t=B.data;return new es($t.thisDep,$t.contextDep,$t.propDep,pe)}else return new es(Ne===wi,Ne===vn,Ne===Cn,pe)}var nd=new es(!1,!1,!1,function(){});function $f(B,pe,Ne,It,$t,Lt,yt,br,_r,Mr,Sr,Or,kr,gr,Dr){var dt=Mr.Record,Ht={add:32774,subtract:32778,"reverse subtract":32779};Ne.ext_blend_minmax&&(Ht.min=fp,Ht.max=hp);var Ar=Ne.angle_instanced_arrays,Yr=Ne.webgl_draw_buffers,sr={dirty:!0,profile:Dr.profile},tn={},yr=[],qr={},fr={};function jr(te){return te.replace(".","_")}function wn(te,xe,Ue){var St=jr(te);yr.push(te),tn[St]=sr[St]=!!Ue,qr[St]=xe}function Wn(te,xe,Ue){var St=jr(te);yr.push(te),Array.isArray(Ue)?(sr[St]=Ue.slice(),tn[St]=Ue.slice()):sr[St]=tn[St]=Ue,fr[St]=xe}wn(Hn,Bl),wn(si,up),Wn(jn,"blendColor",[0,0,0,0]),Wn(Un,"blendEquationSeparate",[dp,dp]),Wn(ei,"blendFuncSeparate",[pp,td,pp,td]),wn(Bn,em,!0),Wn(On,"depthFunc",mp),Wn(Oo,"depthRange",[0,1]),Wn(Do,"depthMask",!0),Wn(Ra,Ra,[!0,!0,!0,!0]),wn(va,yf),Wn(Ao,"cullFace",Xc),Wn(Lo,Lo,cp),Wn(Ja,Ja,1),wn(Na,tm),Wn(lu,"polygonOffset",[0,0]),wn(Ya,rm),wn(Zs,Sh),Wn(Cs,"sampleCoverage",[1,!1]),wn(uc,Xf),Wn(Fl,"stencilMask",-1),Wn(Ru,"stencilFunc",[Iu,0,-1]),Wn(Gu,"stencilOpSeparate",[kl,mc,mc,mc]),Wn(Xu,"stencilOpSeparate",[Xc,mc,mc,mc]),wn(cu,lp),Wn(Yu,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Wn(ka,ka,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Hr={gl:B,context:kr,strings:pe,next:tn,current:sr,draw:Or,elements:Lt,buffer:$t,shader:Sr,attributes:Mr.state,vao:Mr,uniforms:_r,framebuffer:br,extensions:Ne,timer:gr,isBufferArgs:qf},xr={primTypes:Eu,compareFuncs:Yc,blendFuncs:vl,blendEquations:Ht,stencilOps:Ul,glTypes:ai,orientationType:_c};ue.optional(function(){Hr.isArrayLike=jo}),Yr&&(xr.backBuffer=[Xc],xr.drawBuffer=Ft(It.maxDrawbuffers,function(te){return te===0?[0]:Ft(te,function(xe){return nm+xe})}));var Qt=0;function Mn(){var te=Xt(),xe=te.link,Ue=te.global;te.id=Qt++,te.batchId="0";var St=xe(Hr),xt=te.shared={props:"a0"};Object.keys(Hr).forEach(function(Ye){xt[Ye]=Ue.def(St,".",Ye)}),ue.optional(function(){te.CHECK=xe(ue),te.commandStr=ue.guessCommand(),te.command=xe(te.commandStr),te.assert=function(Ye,me,$e){Ye("if(!(",me,"))",this.CHECK,".commandRaise(",xe($e),",",this.command,");")},xr.invalidBlendCombinations=vp});var Ge=te.next={},tt=te.current={};Object.keys(fr).forEach(function(Ye){Array.isArray(sr[Ye])&&(Ge[Ye]=Ue.def(xt.next,".",Ye),tt[Ye]=Ue.def(xt.current,".",Ye))});var ot=te.constants={};Object.keys(xr).forEach(function(Ye){ot[Ye]=Ue.def(JSON.stringify(xr[Ye]))}),te.invoke=function(Ye,me){switch(me.type){case An:var $e=["this",xt.context,xt.props,te.batchId];return Ye.def(xe(me.data),".call(",$e.slice(0,Math.max(me.data.length+1,4)),")");case Cn:return Ye.def(xt.props,me.data);case vn:return Ye.def(xt.context,me.data);case wi:return Ye.def("this",me.data);case Kr:return me.data.append(te,Ye),me.data.ref}},te.attribCache={};var Ce={};return te.scopeAttrib=function(Ye){var me=pe.id(Ye);if(me in Ce)return Ce[me];var $e=Mr.scope[me];$e||($e=Mr.scope[me]=new dt);var Et=Ce[me]=xe($e);return Et},te}function lt(te){var xe=te.static,Ue=te.dynamic,St;if(Ho in xe){var xt=!!xe[Ho];St=_a(function(tt,ot){return xt}),St.enable=xt}else if(Ho in Ue){var Ge=Ue[Ho];St=ru(Ge,function(tt,ot){return tt.invoke(ot,Ge)})}return St}function P(te,xe){var Ue=te.static,St=te.dynamic;if(ls in Ue){var xt=Ue[ls];return xt?(xt=br.getFramebuffer(xt),ue.command(xt,"invalid framebuffer object"),_a(function(tt,ot){var Ce=tt.link(xt),Ye=tt.shared;ot.set(Ye.framebuffer,".next",Ce);var me=Ye.context;return ot.set(me,"."+qu,Ce+".width"),ot.set(me,"."+js,Ce+".height"),Ce})):_a(function(tt,ot){var Ce=tt.shared;ot.set(Ce.framebuffer,".next","null");var Ye=Ce.context;return ot.set(Ye,"."+qu,Ye+"."+cs),ot.set(Ye,"."+js,Ye+"."+op),"null"})}else if(ls in St){var Ge=St[ls];return ru(Ge,function(tt,ot){var Ce=tt.invoke(ot,Ge),Ye=tt.shared,me=Ye.framebuffer,$e=ot.def(me,".getFramebuffer(",Ce,")");ue.optional(function(){tt.assert(ot,"!"+Ce+"||"+$e,"invalid framebuffer object")}),ot.set(me,".next",$e);var Et=Ye.context;return ot.set(Et,"."+qu,$e+"?"+$e+".width:"+Et+"."+cs),ot.set(Et,"."+js,$e+"?"+$e+".height:"+Et+"."+op),$e})}else return null}function ti(te,xe,Ue){var St=te.static,xt=te.dynamic;function Ge(Ce){if(Ce in St){var Ye=St[Ce];ue.commandType(Ye,"object","invalid "+Ce,Ue.commandStr);var me=!0,$e=Ye.x|0,Et=Ye.y|0,Nt,ar;return"width"in Ye?(Nt=Ye.width|0,ue.command(Nt>=0,"invalid "+Ce,Ue.commandStr)):me=!1,"height"in Ye?(ar=Ye.height|0,ue.command(ar>=0,"invalid "+Ce,Ue.commandStr)):me=!1,new es(!me&&xe&&xe.thisDep,!me&&xe&&xe.contextDep,!me&&xe&&xe.propDep,function($r,Tr){var ln=$r.shared.context,Kt=Nt;"width"in Ye||(Kt=Tr.def(ln,".",qu,"-",$e));var Gn=ar;return"height"in Ye||(Gn=Tr.def(ln,".",js,"-",Et)),[$e,Et,Kt,Gn]})}else if(Ce in xt){var Jt=xt[Ce],vr=ru(Jt,function($r,Tr){var ln=$r.invoke(Tr,Jt);ue.optional(function(){$r.assert(Tr,ln+"&&typeof "+ln+'==="object"',"invalid "+Ce)});var Kt=$r.shared.context,Gn=Tr.def(ln,".x|0"),Wi=Tr.def(ln,".y|0"),ya=Tr.def('"width" in ',ln,"?",ln,".width|0:","(",Kt,".",qu,"-",Gn,")"),Rs=Tr.def('"height" in ',ln,"?",ln,".height|0:","(",Kt,".",js,"-",Wi,")");return ue.optional(function(){$r.assert(Tr,ya+">=0&&"+Rs+">=0","invalid "+Ce)}),[Gn,Wi,ya,Rs]});return xe&&(vr.thisDep=vr.thisDep||xe.thisDep,vr.contextDep=vr.contextDep||xe.contextDep,vr.propDep=vr.propDep||xe.propDep),vr}else return xe?new es(xe.thisDep,xe.contextDep,xe.propDep,function($r,Tr){var ln=$r.shared.context;return[0,0,Tr.def(ln,".",qu),Tr.def(ln,".",js)]}):null}var tt=Ge(ka);if(tt){var ot=tt;tt=new es(tt.thisDep,tt.contextDep,tt.propDep,function(Ce,Ye){var me=ot.append(Ce,Ye),$e=Ce.shared.context;return Ye.set($e,"."+jc,me[2]),Ye.set($e,"."+Eh,me[3]),me})}return{viewport:tt,scissor_box:Ge(Yu)}}function F(te,xe){var Ue=te.static,St=typeof Ue[fu]=="string"&&typeof Ue[tu]=="string";if(St){if(Object.keys(xe.dynamic).length>0)return null;var xt=xe.static,Ge=Object.keys(xt);if(Ge.length>0&&typeof xt[Ge[0]]=="number"){for(var tt=[],ot=0;ot<Ge.length;++ot)ue(typeof xt[Ge[ot]]=="number","must specify all vertex attribute locations when using vaos"),tt.push([xt[Ge[ot]]|0,Ge[ot]]);return tt}}return null}function zn(te,xe,Ue){var St=te.static,xt=te.dynamic;function Ge(me){if(me in St){var $e=pe.id(St[me]);ue.optional(function(){Sr.shader(rd[me],$e,ue.guessCommand())});var Et=_a(function(){return $e});return Et.id=$e,Et}else if(me in xt){var Nt=xt[me];return ru(Nt,function(ar,Jt){var vr=ar.invoke(Jt,Nt),$r=Jt.def(ar.shared.strings,".id(",vr,")");return ue.optional(function(){Jt(ar.shared.shader,".shader(",rd[me],",",$r,",",ar.command,");")}),$r})}return null}var tt=Ge(fu),ot=Ge(tu),Ce=null,Ye;return ts(tt)&&ts(ot)?(Ce=Sr.program(ot.id,tt.id,null,Ue),Ye=_a(function(me,$e){return me.link(Ce)})):Ye=new es(tt&&tt.thisDep||ot&&ot.thisDep,tt&&tt.contextDep||ot&&ot.contextDep,tt&&tt.propDep||ot&&ot.propDep,function(me,$e){var Et=me.shared.shader,Nt;tt?Nt=tt.append(me,$e):Nt=$e.def(Et,".",fu);var ar;ot?ar=ot.append(me,$e):ar=$e.def(Et,".",tu);var Jt=Et+".program("+ar+","+Nt;return ue.optional(function(){Jt+=","+me.command}),$e.def(Jt+")")}),{frag:tt,vert:ot,progVar:Ye,program:Ce}}function ki(te,xe){var Ue=te.static,St=te.dynamic;function xt(){if(yi in Ue){var me=Ue[yi];qf(me)?me=Lt.getElements(Lt.create(me,!0)):me&&(me=Lt.getElements(me),ue.command(me,"invalid elements",xe.commandStr));var $e=_a(function(Nt,ar){if(me){var Jt=Nt.link(me);return Nt.ELEMENTS=Jt,Jt}return Nt.ELEMENTS=null,null});return $e.value=me,$e}else if(yi in St){var Et=St[yi];return ru(Et,function(Nt,ar){var Jt=Nt.shared,vr=Jt.isBufferArgs,$r=Jt.elements,Tr=Nt.invoke(ar,Et),ln=ar.def("null"),Kt=ar.def(vr,"(",Tr,")"),Gn=Nt.cond(Kt).then(ln,"=",$r,".createStream(",Tr,");").else(ln,"=",$r,".getElements(",Tr,");");return ue.optional(function(){Nt.assert(Gn.else,"!"+Tr+"||"+ln,"invalid elements")}),ar.entry(Gn),ar.exit(Nt.cond(Kt).then($r,".destroyStream(",ln,");")),Nt.ELEMENTS=ln,ln})}return null}var Ge=xt();function tt(){if(Ma in Ue){var me=Ue[Ma];return ue.commandParameter(me,Eu,"invalid primitve",xe.commandStr),_a(function(Et,Nt){return Eu[me]})}else if(Ma in St){var $e=St[Ma];return ru($e,function(Et,Nt){var ar=Et.constants.primTypes,Jt=Et.invoke(Nt,$e);return ue.optional(function(){Et.assert(Nt,Jt+" in "+ar,"invalid primitive, must be one of "+Object.keys(Eu))}),Nt.def(ar,"[",Jt,"]")})}else if(Ge)return ts(Ge)?Ge.value?_a(function(Et,Nt){return Nt.def(Et.ELEMENTS,".primType")}):_a(function(){return ed}):new es(Ge.thisDep,Ge.contextDep,Ge.propDep,function(Et,Nt){var ar=Et.ELEMENTS;return Nt.def(ar,"?",ar,".primType:",ed)});return null}function ot(me,$e){if(me in Ue){var Et=Ue[me]|0;return ue.command(!$e||Et>=0,"invalid "+me,xe.commandStr),_a(function(ar,Jt){return $e&&(ar.OFFSET=Et),Et})}else if(me in St){var Nt=St[me];return ru(Nt,function(ar,Jt){var vr=ar.invoke(Jt,Nt);return $e&&(ar.OFFSET=vr,ue.optional(function(){ar.assert(Jt,vr+">=0","invalid "+me)})),vr})}else if($e&&Ge)return _a(function(ar,Jt){return ar.OFFSET="0",0});return null}var Ce=ot(Mu,!0);function Ye(){if(Fo in Ue){var me=Ue[Fo]|0;return ue.command(typeof me=="number"&&me>=0,"invalid vertex count",xe.commandStr),_a(function(){return me})}else if(Fo in St){var $e=St[Fo];return ru($e,function(ar,Jt){var vr=ar.invoke(Jt,$e);return ue.optional(function(){ar.assert(Jt,"typeof "+vr+'==="number"&&'+vr+">=0&&"+vr+"===("+vr+"|0)","invalid vertex count")}),vr})}else if(Ge)if(ts(Ge)){if(Ge)return Ce?new es(Ce.thisDep,Ce.contextDep,Ce.propDep,function(ar,Jt){var vr=Jt.def(ar.ELEMENTS,".vertCount-",ar.OFFSET);return ue.optional(function(){ar.assert(Jt,vr+">=0","invalid vertex offset/element buffer too small")}),vr}):_a(function(ar,Jt){return Jt.def(ar.ELEMENTS,".vertCount")});var Et=_a(function(){return-1});return ue.optional(function(){Et.MISSING=!0}),Et}else{var Nt=new es(Ge.thisDep||Ce.thisDep,Ge.contextDep||Ce.contextDep,Ge.propDep||Ce.propDep,function(ar,Jt){var vr=ar.ELEMENTS;return ar.OFFSET?Jt.def(vr,"?",vr,".vertCount-",ar.OFFSET,":-1"):Jt.def(vr,"?",vr,".vertCount:-1")});return ue.optional(function(){Nt.DYNAMIC=!0}),Nt}return null}return{elements:Ge,primitive:tt(),count:Ye(),instances:ot(lc,!1),offset:Ce}}function sa(te,xe){var Ue=te.static,St=te.dynamic,xt={};return yr.forEach(function(Ge){var tt=jr(Ge);function ot(Ce,Ye){if(Ge in Ue){var me=Ce(Ue[Ge]);xt[tt]=_a(function(){return me})}else if(Ge in St){var $e=St[Ge];xt[tt]=ru($e,function(Et,Nt){return Ye(Et,Nt,Et.invoke(Nt,$e))})}}switch(Ge){case va:case si:case Hn:case uc:case Bn:case cu:case Na:case Ya:case Zs:case Do:return ot(function(Ce){return ue.commandType(Ce,"boolean",Ge,xe.commandStr),Ce},function(Ce,Ye,me){return ue.optional(function(){Ce.assert(Ye,"typeof "+me+'==="boolean"',"invalid flag "+Ge,Ce.commandStr)}),me});case On:return ot(function(Ce){return ue.commandParameter(Ce,Yc,"invalid "+Ge,xe.commandStr),Yc[Ce]},function(Ce,Ye,me){var $e=Ce.constants.compareFuncs;return ue.optional(function(){Ce.assert(Ye,me+" in "+$e,"invalid "+Ge+", must be one of "+Object.keys(Yc))}),Ye.def($e,"[",me,"]")});case Oo:return ot(function(Ce){return ue.command(jo(Ce)&&Ce.length===2&&typeof Ce[0]=="number"&&typeof Ce[1]=="number"&&Ce[0]<=Ce[1],"depth range is 2d array",xe.commandStr),Ce},function(Ce,Ye,me){ue.optional(function(){Ce.assert(Ye,Ce.shared.isArrayLike+"("+me+")&&"+me+".length===2&&typeof "+me+'[0]==="number"&&typeof '+me+'[1]==="number"&&'+me+"[0]<="+me+"[1]","depth range must be a 2d array")});var $e=Ye.def("+",me,"[0]"),Et=Ye.def("+",me,"[1]");return[$e,Et]});case ei:return ot(function(Ce){ue.commandType(Ce,"object","blend.func",xe.commandStr);var Ye="srcRGB"in Ce?Ce.srcRGB:Ce.src,me="srcAlpha"in Ce?Ce.srcAlpha:Ce.src,$e="dstRGB"in Ce?Ce.dstRGB:Ce.dst,Et="dstAlpha"in Ce?Ce.dstAlpha:Ce.dst;return ue.commandParameter(Ye,vl,tt+".srcRGB",xe.commandStr),ue.commandParameter(me,vl,tt+".srcAlpha",xe.commandStr),ue.commandParameter($e,vl,tt+".dstRGB",xe.commandStr),ue.commandParameter(Et,vl,tt+".dstAlpha",xe.commandStr),ue.command(vp.indexOf(Ye+", "+$e)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ye+", "+$e+")",xe.commandStr),[vl[Ye],vl[$e],vl[me],vl[Et]]},function(Ce,Ye,me){var $e=Ce.constants.blendFuncs;ue.optional(function(){Ce.assert(Ye,me+"&&typeof "+me+'==="object"',"invalid blend func, must be an object")});function Et(ln,Kt){var Gn=Ye.def('"',ln,Kt,'" in ',me,"?",me,".",ln,Kt,":",me,".",ln);return ue.optional(function(){Ce.assert(Ye,Gn+" in "+$e,"invalid "+Ge+"."+ln+Kt+", must be one of "+Object.keys(vl))}),Gn}var Nt=Et("src","RGB"),ar=Et("dst","RGB");ue.optional(function(){var ln=Ce.constants.invalidBlendCombinations;Ce.assert(Ye,ln+".indexOf("+Nt+'+", "+'+ar+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Jt=Ye.def($e,"[",Nt,"]"),vr=Ye.def($e,"[",Et("src","Alpha"),"]"),$r=Ye.def($e,"[",ar,"]"),Tr=Ye.def($e,"[",Et("dst","Alpha"),"]");return[Jt,$r,vr,Tr]});case Un:return ot(function(Ce){if(typeof Ce=="string")return ue.commandParameter(Ce,Ht,"invalid "+Ge,xe.commandStr),[Ht[Ce],Ht[Ce]];if(typeof Ce=="object")return ue.commandParameter(Ce.rgb,Ht,Ge+".rgb",xe.commandStr),ue.commandParameter(Ce.alpha,Ht,Ge+".alpha",xe.commandStr),[Ht[Ce.rgb],Ht[Ce.alpha]];ue.commandRaise("invalid blend.equation",xe.commandStr)},function(Ce,Ye,me){var $e=Ce.constants.blendEquations,Et=Ye.def(),Nt=Ye.def(),ar=Ce.cond("typeof ",me,'==="string"');return ue.optional(function(){function Jt(vr,$r,Tr){Ce.assert(vr,Tr+" in "+$e,"invalid "+$r+", must be one of "+Object.keys(Ht))}Jt(ar.then,Ge,me),Ce.assert(ar.else,me+"&&typeof "+me+'==="object"',"invalid "+Ge),Jt(ar.else,Ge+".rgb",me+".rgb"),Jt(ar.else,Ge+".alpha",me+".alpha")}),ar.then(Et,"=",Nt,"=",$e,"[",me,"];"),ar.else(Et,"=",$e,"[",me,".rgb];",Nt,"=",$e,"[",me,".alpha];"),Ye(ar),[Et,Nt]});case jn:return ot(function(Ce){return ue.command(jo(Ce)&&Ce.length===4,"blend.color must be a 4d array",xe.commandStr),Ft(4,function(Ye){return+Ce[Ye]})},function(Ce,Ye,me){return ue.optional(function(){Ce.assert(Ye,Ce.shared.isArrayLike+"("+me+")&&"+me+".length===4","blend.color must be a 4d array")}),Ft(4,function($e){return Ye.def("+",me,"[",$e,"]")})});case Fl:return ot(function(Ce){return ue.commandType(Ce,"number",tt,xe.commandStr),Ce|0},function(Ce,Ye,me){return ue.optional(function(){Ce.assert(Ye,"typeof "+me+'==="number"',"invalid stencil.mask")}),Ye.def(me,"|0")});case Ru:return ot(function(Ce){ue.commandType(Ce,"object",tt,xe.commandStr);var Ye=Ce.cmp||"keep",me=Ce.ref||0,$e="mask"in Ce?Ce.mask:-1;return ue.commandParameter(Ye,Yc,Ge+".cmp",xe.commandStr),ue.commandType(me,"number",Ge+".ref",xe.commandStr),ue.commandType($e,"number",Ge+".mask",xe.commandStr),[Yc[Ye],me,$e]},function(Ce,Ye,me){var $e=Ce.constants.compareFuncs;ue.optional(function(){function Jt(){Ce.assert(Ye,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Jt(me+"&&typeof ",me,'==="object"'),Jt('!("cmp" in ',me,")||(",me,".cmp in ",$e,")")});var Et=Ye.def('"cmp" in ',me,"?",$e,"[",me,".cmp]",":",mc),Nt=Ye.def(me,".ref|0"),ar=Ye.def('"mask" in ',me,"?",me,".mask|0:-1");return[Et,Nt,ar]});case Gu:case Xu:return ot(function(Ce){ue.commandType(Ce,"object",tt,xe.commandStr);var Ye=Ce.fail||"keep",me=Ce.zfail||"keep",$e=Ce.zpass||"keep";return ue.commandParameter(Ye,Ul,Ge+".fail",xe.commandStr),ue.commandParameter(me,Ul,Ge+".zfail",xe.commandStr),ue.commandParameter($e,Ul,Ge+".zpass",xe.commandStr),[Ge===Xu?Xc:kl,Ul[Ye],Ul[me],Ul[$e]]},function(Ce,Ye,me){var $e=Ce.constants.stencilOps;ue.optional(function(){Ce.assert(Ye,me+"&&typeof "+me+'==="object"',"invalid "+Ge)});function Et(Nt){return ue.optional(function(){Ce.assert(Ye,'!("'+Nt+'" in '+me+")||("+me+"."+Nt+" in "+$e+")","invalid "+Ge+"."+Nt+", must be one of "+Object.keys(Ul))}),Ye.def('"',Nt,'" in ',me,"?",$e,"[",me,".",Nt,"]:",mc)}return[Ge===Xu?Xc:kl,Et("fail"),Et("zfail"),Et("zpass")]});case lu:return ot(function(Ce){ue.commandType(Ce,"object",tt,xe.commandStr);var Ye=Ce.factor|0,me=Ce.units|0;return ue.commandType(Ye,"number",tt+".factor",xe.commandStr),ue.commandType(me,"number",tt+".units",xe.commandStr),[Ye,me]},function(Ce,Ye,me){ue.optional(function(){Ce.assert(Ye,me+"&&typeof "+me+'==="object"',"invalid "+Ge)});var $e=Ye.def(me,".factor|0"),Et=Ye.def(me,".units|0");return[$e,Et]});case Ao:return ot(function(Ce){var Ye=0;return Ce==="front"?Ye=kl:Ce==="back"&&(Ye=Xc),ue.command(!!Ye,tt,xe.commandStr),Ye},function(Ce,Ye,me){return ue.optional(function(){Ce.assert(Ye,me+'==="front"||'+me+'==="back"',"invalid cull.face")}),Ye.def(me,'==="front"?',kl,":",Xc)});case Ja:return ot(function(Ce){return ue.command(typeof Ce=="number"&&Ce>=It.lineWidthDims[0]&&Ce<=It.lineWidthDims[1],"invalid line width, must be a positive number between "+It.lineWidthDims[0]+" and "+It.lineWidthDims[1],xe.commandStr),Ce},function(Ce,Ye,me){return ue.optional(function(){Ce.assert(Ye,"typeof "+me+'==="number"&&'+me+">="+It.lineWidthDims[0]+"&&"+me+"<="+It.lineWidthDims[1],"invalid line width")}),me});case Lo:return ot(function(Ce){return ue.commandParameter(Ce,_c,tt,xe.commandStr),_c[Ce]},function(Ce,Ye,me){return ue.optional(function(){Ce.assert(Ye,me+'==="cw"||'+me+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ye.def(me+'==="cw"?'+Rh+":"+cp)});case Ra:return ot(function(Ce){return ue.command(jo(Ce)&&Ce.length===4,"color.mask must be length 4 array",xe.commandStr),Ce.map(function(Ye){return!!Ye})},function(Ce,Ye,me){return ue.optional(function(){Ce.assert(Ye,Ce.shared.isArrayLike+"("+me+")&&"+me+".length===4","invalid color.mask")}),Ft(4,function($e){return"!!"+me+"["+$e+"]"})});case Cs:return ot(function(Ce){ue.command(typeof Ce=="object"&&Ce,tt,xe.commandStr);var Ye="value"in Ce?Ce.value:1,me=!!Ce.invert;return ue.command(typeof Ye=="number"&&Ye>=0&&Ye<=1,"sample.coverage.value must be a number between 0 and 1",xe.commandStr),[Ye,me]},function(Ce,Ye,me){ue.optional(function(){Ce.assert(Ye,me+"&&typeof "+me+'==="object"',"invalid sample.coverage")});var $e=Ye.def('"value" in ',me,"?+",me,".value:1"),Et=Ye.def("!!",me,".invert");return[$e,Et]})}}),xt}function Ua(te,xe){var Ue=te.static,St=te.dynamic,xt={};return Object.keys(Ue).forEach(function(Ge){var tt=Ue[Ge],ot;if(typeof tt=="number"||typeof tt=="boolean")ot=_a(function(){return tt});else if(typeof tt=="function"){var Ce=tt._reglType;Ce==="texture2d"||Ce==="textureCube"?ot=_a(function(Ye){return Ye.link(tt)}):Ce==="framebuffer"||Ce==="framebufferCube"?(ue.command(tt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ge+'"',xe.commandStr),ot=_a(function(Ye){return Ye.link(tt.color[0])})):ue.commandRaise('invalid data for uniform "'+Ge+'"',xe.commandStr)}else jo(tt)?ot=_a(function(Ye){var me=Ye.global.def("[",Ft(tt.length,function($e){return ue.command(typeof tt[$e]=="number"||typeof tt[$e]=="boolean","invalid uniform "+Ge,Ye.commandStr),tt[$e]}),"]");return me}):ue.commandRaise('invalid or missing data for uniform "'+Ge+'"',xe.commandStr);ot.value=tt,xt[Ge]=ot}),Object.keys(St).forEach(function(Ge){var tt=St[Ge];xt[Ge]=ru(tt,function(ot,Ce){return ot.invoke(Ce,tt)})}),xt}function ri(te,xe){var Ue=te.static,St=te.dynamic,xt={};return Object.keys(Ue).forEach(function(Ge){var tt=Ue[Ge],ot=pe.id(Ge),Ce=new dt;if(qf(tt))Ce.state=wr,Ce.buffer=$t.getBuffer($t.create(tt,fc,!1,!0)),Ce.type=0;else{var Ye=$t.getBuffer(tt);if(Ye)Ce.state=wr,Ce.buffer=Ye,Ce.type=0;else if(ue.command(typeof tt=="object"&&tt,"invalid data for attribute "+Ge,xe.commandStr),"constant"in tt){var me=tt.constant;Ce.buffer="null",Ce.state=en,typeof me=="number"?Ce.x=me:(ue.command(jo(me)&&me.length>0&&me.length<=4,"invalid constant for attribute "+Ge,xe.commandStr),or.forEach(function($r,Tr){Tr<me.length&&(Ce[$r]=me[Tr])}))}else{qf(tt.buffer)?Ye=$t.getBuffer($t.create(tt.buffer,fc,!1,!0)):Ye=$t.getBuffer(tt.buffer),ue.command(!!Ye,'missing buffer for attribute "'+Ge+'"',xe.commandStr);var $e=tt.offset|0;ue.command($e>=0,'invalid offset for attribute "'+Ge+'"',xe.commandStr);var Et=tt.stride|0;ue.command(Et>=0&&Et<256,'invalid stride for attribute "'+Ge+'", must be integer betweeen [0, 255]',xe.commandStr);var Nt=tt.size|0;ue.command(!("size"in tt)||Nt>0&&Nt<=4,'invalid size for attribute "'+Ge+'", must be 1,2,3,4',xe.commandStr);var ar=!!tt.normalized,Jt=0;"type"in tt&&(ue.commandParameter(tt.type,ai,"invalid type for attribute "+Ge,xe.commandStr),Jt=ai[tt.type]);var vr=tt.divisor|0;"divisor"in tt&&(ue.command(vr===0||Ar,'cannot specify divisor for attribute "'+Ge+'", instancing not supported',xe.commandStr),ue.command(vr>=0,'invalid divisor for attribute "'+Ge+'"',xe.commandStr)),ue.optional(function(){var $r=xe.commandStr,Tr=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(tt).forEach(function(ln){ue.command(Tr.indexOf(ln)>=0,'unknown parameter "'+ln+'" for attribute pointer "'+Ge+'" (valid parameters are '+Tr+")",$r)})}),Ce.buffer=Ye,Ce.state=wr,Ce.size=Nt,Ce.normalized=ar,Ce.type=Jt||Ye.dtype,Ce.offset=$e,Ce.stride=Et,Ce.divisor=vr}}xt[Ge]=_a(function($r,Tr){var ln=$r.attribCache;if(ot in ln)return ln[ot];var Kt={isStream:!1};return Object.keys(Ce).forEach(function(Gn){Kt[Gn]=Ce[Gn]}),Ce.buffer&&(Kt.buffer=$r.link(Ce.buffer),Kt.type=Kt.type||Kt.buffer+".dtype"),ln[ot]=Kt,Kt})}),Object.keys(St).forEach(function(Ge){var tt=St[Ge];function ot(Ce,Ye){var me=Ce.invoke(Ye,tt),$e=Ce.shared,Et=Ce.constants,Nt=$e.isBufferArgs,ar=$e.buffer;ue.optional(function(){Ce.assert(Ye,me+"&&(typeof "+me+'==="object"||typeof '+me+'==="function")&&('+Nt+"("+me+")||"+ar+".getBuffer("+me+")||"+ar+".getBuffer("+me+".buffer)||"+Nt+"("+me+'.buffer)||("constant" in '+me+"&&(typeof "+me+'.constant==="number"||'+$e.isArrayLike+"("+me+".constant))))",'invalid dynamic attribute "'+Ge+'"')});var Jt={isStream:Ye.def(!1)},vr=new dt;vr.state=wr,Object.keys(vr).forEach(function(Kt){Jt[Kt]=Ye.def(""+vr[Kt])});var $r=Jt.buffer,Tr=Jt.type;Ye("if(",Nt,"(",me,")){",Jt.isStream,"=true;",$r,"=",ar,".createStream(",fc,",",me,");",Tr,"=",$r,".dtype;","}else{",$r,"=",ar,".getBuffer(",me,");","if(",$r,"){",Tr,"=",$r,".dtype;",'}else if("constant" in ',me,"){",Jt.state,"=",en,";","if(typeof "+me+'.constant === "number"){',Jt[or[0]],"=",me,".constant;",or.slice(1).map(function(Kt){return Jt[Kt]}).join("="),"=0;","}else{",or.map(function(Kt,Gn){return Jt[Kt]+"="+me+".constant.length>"+Gn+"?"+me+".constant["+Gn+"]:0;"}).join(""),"}}else{","if(",Nt,"(",me,".buffer)){",$r,"=",ar,".createStream(",fc,",",me,".buffer);","}else{",$r,"=",ar,".getBuffer(",me,".buffer);","}",Tr,'="type" in ',me,"?",Et.glTypes,"[",me,".type]:",$r,".dtype;",Jt.normalized,"=!!",me,".normalized;");function ln(Kt){Ye(Jt[Kt],"=",me,".",Kt,"|0;")}return ln("size"),ln("offset"),ln("stride"),ln("divisor"),Ye("}}"),Ye.exit("if(",Jt.isStream,"){",ar,".destroyStream(",$r,");","}"),Jt}xt[Ge]=ru(tt,ot)}),xt}function ua(te,xe){var Ue=te.static,St=te.dynamic;if(hl in Ue){var xt=Ue[hl];return xt!==null&&Mr.getVAO(xt)===null&&(xt=Mr.createVAO(xt)),_a(function(tt){return tt.link(Mr.getVAO(xt))})}else if(hl in St){var Ge=St[hl];return ru(Ge,function(tt,ot){var Ce=tt.invoke(ot,Ge);return ot.def(tt.shared.vao+".getVAO("+Ce+")")})}return null}function vo(te){var xe=te.static,Ue=te.dynamic,St={};return Object.keys(xe).forEach(function(xt){var Ge=xe[xt];St[xt]=_a(function(tt,ot){return typeof Ge=="number"||typeof Ge=="boolean"?""+Ge:tt.link(Ge)})}),Object.keys(Ue).forEach(function(xt){var Ge=Ue[xt];St[xt]=ru(Ge,function(tt,ot){return tt.invoke(ot,Ge)})}),St}function la(te,xe,Ue,St,xt){var Ge=te.static,tt=te.dynamic;ue.optional(function(){var ln=[ls,tu,fu,yi,Ma,Mu,Fo,lc,Ho,hl].concat(yr);function Kt(Gn){Object.keys(Gn).forEach(function(Wi){ue.command(ln.indexOf(Wi)>=0,'unknown parameter "'+Wi+'"',xt.commandStr)})}Kt(Ge),Kt(tt)});var ot=F(te,xe),Ce=P(te,xt),Ye=ti(te,Ce,xt),me=ki(te,xt),$e=sa(te,xt),Et=zn(te,xt,ot);function Nt(ln){var Kt=Ye[ln];Kt&&($e[ln]=Kt)}Nt(ka),Nt(jr(Yu));var ar=Object.keys($e).length>0,Jt={framebuffer:Ce,draw:me,shader:Et,state:$e,dirty:ar,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Jt.profile=lt(te,xt),Jt.uniforms=Ua(Ue,xt),Jt.drawVAO=Jt.scopeVAO=ua(te,xt),!Jt.drawVAO&&Et.program&&!ot&&Ne.angle_instanced_arrays){var vr=!0,$r=Et.program.attributes.map(function(ln){var Kt=xe.static[ln];return vr=vr&&!!Kt,Kt});if(vr&&$r.length>0){var Tr=Mr.getVAO(Mr.createVAO($r));Jt.drawVAO=new es(null,null,null,function(ln,Kt){return ln.link(Tr)}),Jt.useVAO=!0}}return ot?Jt.useVAO=!0:Jt.attributes=ri(xe,xt),Jt.context=vo(St,xt),Jt}function ea(te,xe,Ue){var St=te.shared,xt=St.context,Ge=te.scope();Object.keys(Ue).forEach(function(tt){xe.save(xt,"."+tt);var ot=Ue[tt];Ge(xt,".",tt,"=",ot.append(te,xe),";")}),xe(Ge)}function No(te,xe,Ue,St){var xt=te.shared,Ge=xt.gl,tt=xt.framebuffer,ot;Yr&&(ot=xe.def(xt.extensions,".webgl_draw_buffers"));var Ce=te.constants,Ye=Ce.drawBuffer,me=Ce.backBuffer,$e;Ue?$e=Ue.append(te,xe):$e=xe.def(tt,".next"),St||xe("if(",$e,"!==",tt,".cur){"),xe("if(",$e,"){",Ge,".bindFramebuffer(",vc,",",$e,".framebuffer);"),Yr&&xe(ot,".drawBuffersWEBGL(",Ye,"[",$e,".colorAttachments.length]);"),xe("}else{",Ge,".bindFramebuffer(",vc,",null);"),Yr&&xe(ot,".drawBuffersWEBGL(",me,");"),xe("}",tt,".cur=",$e,";"),St||xe("}")}function Ia(te,xe,Ue){var St=te.shared,xt=St.gl,Ge=te.current,tt=te.next,ot=St.current,Ce=St.next,Ye=te.cond(ot,".dirty");yr.forEach(function(me){var $e=jr(me);if(!($e in Ue.state)){var Et,Nt;if($e in tt){Et=tt[$e],Nt=Ge[$e];var ar=Ft(sr[$e].length,function(vr){return Ye.def(Et,"[",vr,"]")});Ye(te.cond(ar.map(function(vr,$r){return vr+"!=="+Nt+"["+$r+"]"}).join("||")).then(xt,".",fr[$e],"(",ar,");",ar.map(function(vr,$r){return Nt+"["+$r+"]="+vr}).join(";"),";"))}else{Et=Ye.def(Ce,".",$e);var Jt=te.cond(Et,"!==",ot,".",$e);Ye(Jt),$e in qr?Jt(te.cond(Et).then(xt,".enable(",qr[$e],");").else(xt,".disable(",qr[$e],");"),ot,".",$e,"=",Et,";"):Jt(xt,".",fr[$e],"(",Et,");",ot,".",$e,"=",Et,";")}}}),Object.keys(Ue.state).length===0&&Ye(ot,".dirty=false;"),xe(Ye)}function hs(te,xe,Ue,St){var xt=te.shared,Ge=te.current,tt=xt.current,ot=xt.gl;Kf(Object.keys(Ue)).forEach(function(Ce){var Ye=Ue[Ce];if(!(St&&!St(Ye))){var me=Ye.append(te,xe);if(qr[Ce]){var $e=qr[Ce];ts(Ye)?me?xe(ot,".enable(",$e,");"):xe(ot,".disable(",$e,");"):xe(te.cond(me).then(ot,".enable(",$e,");").else(ot,".disable(",$e,");")),xe(tt,".",Ce,"=",me,";")}else if(jo(me)){var Et=Ge[Ce];xe(ot,".",fr[Ce],"(",me,");",me.map(function(Nt,ar){return Et+"["+ar+"]="+Nt}).join(";"),";")}else xe(ot,".",fr[Ce],"(",me,");",tt,".",Ce,"=",me,";")}})}function ca(te,xe){Ar&&(te.instancing=xe.def(te.shared.extensions,".angle_instanced_arrays"))}function li(te,xe,Ue,St,xt){var Ge=te.shared,tt=te.stats,ot=Ge.current,Ce=Ge.timer,Ye=Ue.profile;function me(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var $e,Et;function Nt(ln){$e=xe.def(),ln($e,"=",me(),";"),typeof xt=="string"?ln(tt,".count+=",xt,";"):ln(tt,".count++;"),gr&&(St?(Et=xe.def(),ln(Et,"=",Ce,".getNumPendingQueries();")):ln(Ce,".beginQuery(",tt,");"))}function ar(ln){ln(tt,".cpuTime+=",me(),"-",$e,";"),gr&&(St?ln(Ce,".pushScopeStats(",Et,",",Ce,".getNumPendingQueries(),",tt,");"):ln(Ce,".endQuery();"))}function Jt(ln){var Kt=xe.def(ot,".profile");xe(ot,".profile=",ln,";"),xe.exit(ot,".profile=",Kt,";")}var vr;if(Ye){if(ts(Ye)){Ye.enable?(Nt(xe),ar(xe.exit),Jt("true")):Jt("false");return}vr=Ye.append(te,xe),Jt(vr)}else vr=xe.def(ot,".profile");var $r=te.block();Nt($r),xe("if(",vr,"){",$r,"}");var Tr=te.block();ar(Tr),xe.exit("if(",vr,"){",Tr,"}")}function rs(te,xe,Ue,St,xt){var Ge=te.shared;function tt(Ce){switch(Ce){case Ah:case Ch:case pc:return 2;case dl:case Bo:case ml:return 3;case Th:case Hc:case dc:return 4;default:return 1}}function ot(Ce,Ye,me){var $e=Ge.gl,Et=xe.def(Ce,".location"),Nt=xe.def(Ge.attributes,"[",Et,"]"),ar=me.state,Jt=me.buffer,vr=[me.x,me.y,me.z,me.w],$r=["buffer","normalized","offset","stride"];function Tr(){xe("if(!",Nt,".buffer){",$e,".enableVertexAttribArray(",Et,");}");var Kt=me.type,Gn;if(me.size?Gn=xe.def(me.size,"||",Ye):Gn=Ye,xe("if(",Nt,".type!==",Kt,"||",Nt,".size!==",Gn,"||",$r.map(function(ya){return Nt+"."+ya+"!=="+me[ya]}).join("||"),"){",$e,".bindBuffer(",fc,",",Jt,".buffer);",$e,".vertexAttribPointer(",[Et,Gn,Kt,me.normalized,me.stride,me.offset],");",Nt,".type=",Kt,";",Nt,".size=",Gn,";",$r.map(function(ya){return Nt+"."+ya+"="+me[ya]+";"}).join(""),"}"),Ar){var Wi=me.divisor;xe("if(",Nt,".divisor!==",Wi,"){",te.instancing,".vertexAttribDivisorANGLE(",[Et,Wi],");",Nt,".divisor=",Wi,";}")}}function ln(){xe("if(",Nt,".buffer){",$e,".disableVertexAttribArray(",Et,");",Nt,".buffer=null;","}if(",or.map(function(Kt,Gn){return Nt+"."+Kt+"!=="+vr[Gn]}).join("||"),"){",$e,".vertexAttrib4f(",Et,",",vr,");",or.map(function(Kt,Gn){return Nt+"."+Kt+"="+vr[Gn]+";"}).join(""),"}")}ar===wr?Tr():ar===en?ln():(xe("if(",ar,"===",wr,"){"),Tr(),xe("}else{"),ln(),xe("}"))}St.forEach(function(Ce){var Ye=Ce.name,me=Ue.attributes[Ye],$e;if(me){if(!xt(me))return;$e=me.append(te,xe)}else{if(!xt(nd))return;var Et=te.scopeAttrib(Ye);ue.optional(function(){te.assert(xe,Et+".state","missing attribute "+Ye)}),$e={},Object.keys(new dt).forEach(function(Nt){$e[Nt]=xe.def(Et,".",Nt)})}ot(te.link(Ce),tt(Ce.info.type),$e)})}function Hi(te,xe,Ue,St,xt){for(var Ge=te.shared,tt=Ge.gl,ot,Ce=0;Ce<St.length;++Ce){var Ye=St[Ce],me=Ye.name,$e=Ye.info.type,Et=Ue.uniforms[me],Nt=te.link(Ye),ar=Nt+".location",Jt;if(Et){if(!xt(Et))continue;if(ts(Et)){var vr=Et.value;if(ue.command(vr!==null&&typeof vr!="undefined",'missing uniform "'+me+'"',te.commandStr),$e===Wc||$e===Gc){ue.command(typeof vr=="function"&&($e===Wc&&(vr._reglType==="texture2d"||vr._reglType==="framebuffer")||$e===Gc&&(vr._reglType==="textureCube"||vr._reglType==="framebufferCube")),"invalid texture for uniform "+me,te.commandStr);var $r=te.link(vr._texture||vr.color[0]._texture);xe(tt,".uniform1i(",ar,",",$r+".bind());"),xe.exit($r,".unbind();")}else if($e===xf||$e===Ef||$e===Nl){ue.optional(function(){ue.command(jo(vr),"invalid matrix for uniform "+me,te.commandStr),ue.command($e===xf&&vr.length===4||$e===Ef&&vr.length===9||$e===Nl&&vr.length===16,"invalid length for matrix uniform "+me,te.commandStr)});var Tr=te.global.def("new Float32Array(["+Array.prototype.slice.call(vr)+"])"),ln=2;$e===Ef?ln=3:$e===Nl&&(ln=4),xe(tt,".uniformMatrix",ln,"fv(",ar,",false,",Tr,");")}else{switch($e){case Yf:ue.commandType(vr,"number","uniform "+me,te.commandStr),ot="1f";break;case Ah:ue.command(jo(vr)&&vr.length===2,"uniform "+me,te.commandStr),ot="2f";break;case dl:ue.command(jo(vr)&&vr.length===3,"uniform "+me,te.commandStr),ot="3f";break;case Th:ue.command(jo(vr)&&vr.length===4,"uniform "+me,te.commandStr),ot="4f";break;case wh:ue.commandType(vr,"boolean","uniform "+me,te.commandStr),ot="1i";break;case hc:ue.commandType(vr,"number","uniform "+me,te.commandStr),ot="1i";break;case pc:ue.command(jo(vr)&&vr.length===2,"uniform "+me,te.commandStr),ot="2i";break;case Ch:ue.command(jo(vr)&&vr.length===2,"uniform "+me,te.commandStr),ot="2i";break;case ml:ue.command(jo(vr)&&vr.length===3,"uniform "+me,te.commandStr),ot="3i";break;case Bo:ue.command(jo(vr)&&vr.length===3,"uniform "+me,te.commandStr),ot="3i";break;case dc:ue.command(jo(vr)&&vr.length===4,"uniform "+me,te.commandStr),ot="4i";break;case Hc:ue.command(jo(vr)&&vr.length===4,"uniform "+me,te.commandStr),ot="4i";break}xe(tt,".uniform",ot,"(",ar,",",jo(vr)?Array.prototype.slice.call(vr):vr,");")}continue}else Jt=Et.append(te,xe)}else{if(!xt(nd))continue;Jt=xe.def(Ge.uniforms,"[",pe.id(me),"]")}$e===Wc?xe("if(",Jt,"&&",Jt,'._reglType==="framebuffer"){',Jt,"=",Jt,".color[0];","}"):$e===Gc&&xe("if(",Jt,"&&",Jt,'._reglType==="framebufferCube"){',Jt,"=",Jt,".color[0];","}"),ue.optional(function(){function Rs(zl,Mh){te.assert(xe,zl,'bad data or missing for uniform "'+me+'".  '+Mh)}function bp(zl){Rs("typeof "+Jt+'==="'+zl+'"',"invalid type, expected "+zl)}function Ms(zl,Mh){Rs(Ge.isArrayLike+"("+Jt+")&&"+Jt+".length==="+zl,"invalid vector, should have length "+zl,te.commandStr)}function cd(zl){Rs("typeof "+Jt+'==="function"&&'+Jt+'._reglType==="texture'+(zl===bh?"2d":"Cube")+'"',"invalid texture type",te.commandStr)}switch($e){case hc:bp("number");break;case Ch:Ms(2,"number");break;case Bo:Ms(3,"number");break;case Hc:Ms(4,"number");break;case Yf:bp("number");break;case Ah:Ms(2,"number");break;case dl:Ms(3,"number");break;case Th:Ms(4,"number");break;case wh:bp("boolean");break;case pc:Ms(2,"boolean");break;case ml:Ms(3,"boolean");break;case dc:Ms(4,"boolean");break;case xf:Ms(4,"number");break;case Ef:Ms(9,"number");break;case Nl:Ms(16,"number");break;case Wc:cd(bh);break;case Gc:cd(Jp);break}});var Kt=1;switch($e){case Wc:case Gc:var Gn=xe.def(Jt,"._texture");xe(tt,".uniform1i(",ar,",",Gn,".bind());"),xe.exit(Gn,".unbind();");continue;case hc:case wh:ot="1i";break;case Ch:case pc:ot="2i",Kt=2;break;case Bo:case ml:ot="3i",Kt=3;break;case Hc:case dc:ot="4i",Kt=4;break;case Yf:ot="1f";break;case Ah:ot="2f",Kt=2;break;case dl:ot="3f",Kt=3;break;case Th:ot="4f",Kt=4;break;case xf:ot="Matrix2fv";break;case Ef:ot="Matrix3fv";break;case Nl:ot="Matrix4fv";break}if(xe(tt,".uniform",ot,"(",ar,","),ot.charAt(0)==="M"){var Wi=Math.pow($e-xf+2,2),ya=te.global.def("new Float32Array(",Wi,")");xe("false,(Array.isArray(",Jt,")||",Jt," instanceof Float32Array)?",Jt,":(",Ft(Wi,function(Rs){return ya+"["+Rs+"]="+Jt+"["+Rs+"]"}),",",ya,")")}else Kt>1?xe(Ft(Kt,function(Rs){return Jt+"["+Rs+"]"})):xe(Jt);xe(");")}}function Nn(te,xe,Ue,St){var xt=te.shared,Ge=xt.gl,tt=xt.draw,ot=St.draw;function Ce(){var Gn=ot.elements,Wi,ya=xe;return Gn?((Gn.contextDep&&St.contextDynamic||Gn.propDep)&&(ya=Ue),Wi=Gn.append(te,ya)):Wi=ya.def(tt,".",yi),Wi&&ya("if("+Wi+")"+Ge+".bindBuffer("+sp+","+Wi+".buffer.buffer);"),Wi}function Ye(){var Gn=ot.count,Wi,ya=xe;return Gn?((Gn.contextDep&&St.contextDynamic||Gn.propDep)&&(ya=Ue),Wi=Gn.append(te,ya),ue.optional(function(){Gn.MISSING&&te.assert(xe,"false","missing vertex count"),Gn.DYNAMIC&&te.assert(ya,Wi+">=0","missing vertex count")})):(Wi=ya.def(tt,".",Fo),ue.optional(function(){te.assert(ya,Wi+">=0","missing vertex count")})),Wi}var me=Ce();function $e(Gn){var Wi=ot[Gn];return Wi?Wi.contextDep&&St.contextDynamic||Wi.propDep?Wi.append(te,Ue):Wi.append(te,xe):xe.def(tt,".",Gn)}var Et=$e(Ma),Nt=$e(Mu),ar=Ye();if(typeof ar=="number"){if(ar===0)return}else Ue("if(",ar,"){"),Ue.exit("}");var Jt,vr;Ar&&(Jt=$e(lc),vr=te.instancing);var $r=me+".type",Tr=ot.elements&&ts(ot.elements);function ln(){function Gn(){Ue(vr,".drawElementsInstancedANGLE(",[Et,ar,$r,Nt+"<<(("+$r+"-"+Pr+")>>1)",Jt],");")}function Wi(){Ue(vr,".drawArraysInstancedANGLE(",[Et,Nt,ar,Jt],");")}me?Tr?Gn():(Ue("if(",me,"){"),Gn(),Ue("}else{"),Wi(),Ue("}")):Wi()}function Kt(){function Gn(){Ue(Ge+".drawElements("+[Et,ar,$r,Nt+"<<(("+$r+"-"+Pr+")>>1)"]+");")}function Wi(){Ue(Ge+".drawArrays("+[Et,Nt,ar]+");")}me?Tr?Gn():(Ue("if(",me,"){"),Gn(),Ue("}else{"),Wi(),Ue("}")):Wi()}Ar&&(typeof Jt!="number"||Jt>=0)?typeof Jt=="string"?(Ue("if(",Jt,">0){"),ln(),Ue("}else if(",Jt,"<0){"),Kt(),Ue("}")):ln():Kt()}function xi(te,xe,Ue,St,xt){var Ge=Mn(),tt=Ge.proc("body",xt);return ue.optional(function(){Ge.commandStr=xe.commandStr,Ge.command=Ge.link(xe.commandStr)}),Ar&&(Ge.instancing=tt.def(Ge.shared.extensions,".angle_instanced_arrays")),te(Ge,tt,Ue,St),Ge.compile().body}function Li(te,xe,Ue,St){ca(te,xe),Ue.useVAO?Ue.drawVAO?xe(te.shared.vao,".setVAO(",Ue.drawVAO.append(te,xe),");"):xe(te.shared.vao,".setVAO(",te.shared.vao,".targetVAO);"):(xe(te.shared.vao,".setVAO(null);"),rs(te,xe,Ue,St.attributes,function(){return!0})),Hi(te,xe,Ue,St.uniforms,function(){return!0}),Nn(te,xe,xe,Ue)}function ga(te,xe){var Ue=te.proc("draw",1);ca(te,Ue),ea(te,Ue,xe.context),No(te,Ue,xe.framebuffer),Ia(te,Ue,xe),hs(te,Ue,xe.state),li(te,Ue,xe,!1,!0);var St=xe.shader.progVar.append(te,Ue);if(Ue(te.shared.gl,".useProgram(",St,".program);"),xe.shader.program)Li(te,Ue,xe,xe.shader.program);else{Ue(te.shared.vao,".setVAO(null);");var xt=te.global.def("{}"),Ge=Ue.def(St,".id"),tt=Ue.def(xt,"[",Ge,"]");Ue(te.cond(tt).then(tt,".call(this,a0);").else(tt,"=",xt,"[",Ge,"]=",te.link(function(ot){return xi(Li,te,xe,ot,1)}),"(",St,");",tt,".call(this,a0);"))}Object.keys(xe.state).length>0&&Ue(te.shared.current,".dirty=true;")}function _l(te,xe,Ue,St){te.batchId="a1",ca(te,xe);function xt(){return!0}rs(te,xe,Ue,St.attributes,xt),Hi(te,xe,Ue,St.uniforms,xt),Nn(te,xe,xe,Ue)}function Me(te,xe,Ue,St){ca(te,xe);var xt=Ue.contextDep,Ge=xe.def(),tt="a0",ot="a1",Ce=xe.def();te.shared.props=Ce,te.batchId=Ge;var Ye=te.scope(),me=te.scope();xe(Ye.entry,"for(",Ge,"=0;",Ge,"<",ot,";++",Ge,"){",Ce,"=",tt,"[",Ge,"];",me,"}",Ye.exit);function $e($r){return $r.contextDep&&xt||$r.propDep}function Et($r){return!$e($r)}if(Ue.needsContext&&ea(te,me,Ue.context),Ue.needsFramebuffer&&No(te,me,Ue.framebuffer),hs(te,me,Ue.state,$e),Ue.profile&&$e(Ue.profile)&&li(te,me,Ue,!1,!0),St)Ue.useVAO?Ue.drawVAO?$e(Ue.drawVAO)?me(te.shared.vao,".setVAO(",Ue.drawVAO.append(te,me),");"):Ye(te.shared.vao,".setVAO(",Ue.drawVAO.append(te,Ye),");"):Ye(te.shared.vao,".setVAO(",te.shared.vao,".targetVAO);"):(Ye(te.shared.vao,".setVAO(null);"),rs(te,Ye,Ue,St.attributes,Et),rs(te,me,Ue,St.attributes,$e)),Hi(te,Ye,Ue,St.uniforms,Et),Hi(te,me,Ue,St.uniforms,$e),Nn(te,Ye,me,Ue);else{var Nt=te.global.def("{}"),ar=Ue.shader.progVar.append(te,me),Jt=me.def(ar,".id"),vr=me.def(Nt,"[",Jt,"]");me(te.shared.gl,".useProgram(",ar,".program);","if(!",vr,"){",vr,"=",Nt,"[",Jt,"]=",te.link(function($r){return xi(_l,te,Ue,$r,2)}),"(",ar,");}",vr,".call(this,a0[",Ge,"],",Ge,");")}}function Ut(te,xe){var Ue=te.proc("batch",2);te.batchId="0",ca(te,Ue);var St=!1,xt=!0;Object.keys(xe.context).forEach(function(Nt){St=St||xe.context[Nt].propDep}),St||(ea(te,Ue,xe.context),xt=!1);var Ge=xe.framebuffer,tt=!1;Ge?(Ge.propDep?St=tt=!0:Ge.contextDep&&St&&(tt=!0),tt||No(te,Ue,Ge)):No(te,Ue,null),xe.state.viewport&&xe.state.viewport.propDep&&(St=!0);function ot(Nt){return Nt.contextDep&&St||Nt.propDep}Ia(te,Ue,xe),hs(te,Ue,xe.state,function(Nt){return!ot(Nt)}),(!xe.profile||!ot(xe.profile))&&li(te,Ue,xe,!1,"a1"),xe.contextDep=St,xe.needsContext=xt,xe.needsFramebuffer=tt;var Ce=xe.shader.progVar;if(Ce.contextDep&&St||Ce.propDep)Me(te,Ue,xe,null);else{var Ye=Ce.append(te,Ue);if(Ue(te.shared.gl,".useProgram(",Ye,".program);"),xe.shader.program)Me(te,Ue,xe,xe.shader.program);else{Ue(te.shared.vao,".setVAO(null);");var me=te.global.def("{}"),$e=Ue.def(Ye,".id"),Et=Ue.def(me,"[",$e,"]");Ue(te.cond(Et).then(Et,".call(this,a0,a1);").else(Et,"=",me,"[",$e,"]=",te.link(function(Nt){return xi(Me,te,xe,Nt,2)}),"(",Ye,");",Et,".call(this,a0,a1);"))}}Object.keys(xe.state).length>0&&Ue(te.shared.current,".dirty=true;")}function bt(te,xe){var Ue=te.proc("scope",3);te.batchId="a2";var St=te.shared,xt=St.current;ea(te,Ue,xe.context),xe.framebuffer&&xe.framebuffer.append(te,Ue),Kf(Object.keys(xe.state)).forEach(function(tt){var ot=xe.state[tt],Ce=ot.append(te,Ue);jo(Ce)?Ce.forEach(function(Ye,me){Ue.set(te.next[tt],"["+me+"]",Ye)}):Ue.set(St.next,"."+tt,Ce)}),li(te,Ue,xe,!0,!0),[yi,Mu,Fo,lc,Ma].forEach(function(tt){var ot=xe.draw[tt];ot&&Ue.set(St.draw,"."+tt,""+ot.append(te,Ue))}),Object.keys(xe.uniforms).forEach(function(tt){Ue.set(St.uniforms,"["+pe.id(tt)+"]",xe.uniforms[tt].append(te,Ue))}),Object.keys(xe.attributes).forEach(function(tt){var ot=xe.attributes[tt].append(te,Ue),Ce=te.scopeAttrib(tt);Object.keys(new dt).forEach(function(Ye){Ue.set(Ce,"."+Ye,ot[Ye])})}),xe.scopeVAO&&Ue.set(St.vao,".targetVAO",xe.scopeVAO.append(te,Ue));function Ge(tt){var ot=xe.shader[tt];ot&&Ue.set(St.shader,"."+tt,ot.append(te,Ue))}Ge(tu),Ge(fu),Object.keys(xe.state).length>0&&(Ue(xt,".dirty=true;"),Ue.exit(xt,".dirty=true;")),Ue("a1(",te.shared.context,",a0,",te.batchId,");")}function on(te){if(!(typeof te!="object"||jo(te))){for(var xe=Object.keys(te),Ue=0;Ue<xe.length;++Ue)if(Vo.isDynamic(te[xe[Ue]]))return!0;return!1}}function hi(te,xe,Ue){var St=xe.static[Ue];if(!St||!on(St))return;var xt=te.global,Ge=Object.keys(St),tt=!1,ot=!1,Ce=!1,Ye=te.global.def("{}");Ge.forEach(function($e){var Et=St[$e];if(Vo.isDynamic(Et)){typeof Et=="function"&&(Et=St[$e]=Vo.unbox(Et));var Nt=ru(Et,null);tt=tt||Nt.thisDep,Ce=Ce||Nt.propDep,ot=ot||Nt.contextDep}else{switch(xt(Ye,".",$e,"="),typeof Et){case"number":xt(Et);break;case"string":xt('"',Et,'"');break;case"object":Array.isArray(Et)&&xt("[",Et.join(),"]");break;default:xt(te.link(Et));break}xt(";")}});function me($e,Et){Ge.forEach(function(Nt){var ar=St[Nt];if(Vo.isDynamic(ar)){var Jt=$e.invoke(Et,ar);Et(Ye,".",Nt,"=",Jt,";")}})}xe.dynamic[Ue]=new Vo.DynamicVariable(Kr,{thisDep:tt,contextDep:ot,propDep:Ce,ref:Ye,append:me}),delete xe.static[Ue]}function so(te,xe,Ue,St,xt){var Ge=Mn();Ge.stats=Ge.link(xt),Object.keys(xe.static).forEach(function(ot){hi(Ge,xe,ot)}),ap.forEach(function(ot){hi(Ge,te,ot)});var tt=la(te,xe,Ue,St,Ge);return ga(Ge,tt),bt(Ge,tt),Ut(Ge,tt),Ge.compile()}return{next:tn,current:sr,procs:function(){var te=Mn(),xe=te.proc("poll"),Ue=te.proc("refresh"),St=te.block();xe(St),Ue(St);var xt=te.shared,Ge=xt.gl,tt=xt.next,ot=xt.current;St(ot,".dirty=false;"),No(te,xe),No(te,Ue,null,!0);var Ce;Ar&&(Ce=te.link(Ar)),Ne.oes_vertex_array_object&&Ue(te.link(Ne.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ye=0;Ye<It.maxAttributes;++Ye){var me=Ue.def(xt.attributes,"[",Ye,"]"),$e=te.cond(me,".buffer");$e.then(Ge,".enableVertexAttribArray(",Ye,");",Ge,".bindBuffer(",fc,",",me,".buffer.buffer);",Ge,".vertexAttribPointer(",Ye,",",me,".size,",me,".type,",me,".normalized,",me,".stride,",me,".offset);").else(Ge,".disableVertexAttribArray(",Ye,");",Ge,".vertexAttrib4f(",Ye,",",me,".x,",me,".y,",me,".z,",me,".w);",me,".buffer=null;"),Ue($e),Ar&&Ue(Ce,".vertexAttribDivisorANGLE(",Ye,",",me,".divisor);")}return Ue(te.shared.vao,".currentVAO=null;",te.shared.vao,".setVAO(",te.shared.vao,".targetVAO);"),Object.keys(qr).forEach(function(Et){var Nt=qr[Et],ar=St.def(tt,".",Et),Jt=te.block();Jt("if(",ar,"){",Ge,".enable(",Nt,")}else{",Ge,".disable(",Nt,")}",ot,".",Et,"=",ar,";"),Ue(Jt),xe("if(",ar,"!==",ot,".",Et,"){",Jt,"}")}),Object.keys(fr).forEach(function(Et){var Nt=fr[Et],ar=sr[Et],Jt,vr,$r=te.block();if($r(Ge,".",Nt,"("),jo(ar)){var Tr=ar.length;Jt=te.global.def(tt,".",Et),vr=te.global.def(ot,".",Et),$r(Ft(Tr,function(ln){return Jt+"["+ln+"]"}),");",Ft(Tr,function(ln){return vr+"["+ln+"]="+Jt+"["+ln+"];"}).join("")),xe("if(",Ft(Tr,function(ln){return Jt+"["+ln+"]!=="+vr+"["+ln+"]"}).join("||"),"){",$r,"}")}else Jt=St.def(tt,".",Et),vr=St.def(ot,".",Et),$r(Jt,");",ot,".",Et,"=",Jt,";"),xe("if(",Jt,"!==",vr,"){",$r,"}");Ue($r)}),te.compile()}(),compile:so}}function id(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var im=34918,om=34919,od=35007,ad=function(B,pe){if(!pe.ext_disjoint_timer_query)return null;var Ne=[];function It(){return Ne.pop()||pe.ext_disjoint_timer_query.createQueryEXT()}function $t(Ar){Ne.push(Ar)}var Lt=[];function yt(Ar){var Yr=It();pe.ext_disjoint_timer_query.beginQueryEXT(od,Yr),Lt.push(Yr),gr(Lt.length-1,Lt.length,Ar)}function br(){pe.ext_disjoint_timer_query.endQueryEXT(od)}function _r(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Mr=[];function Sr(){return Mr.pop()||new _r}function Or(Ar){Mr.push(Ar)}var kr=[];function gr(Ar,Yr,sr){var tn=Sr();tn.startQueryIndex=Ar,tn.endQueryIndex=Yr,tn.sum=0,tn.stats=sr,kr.push(tn)}var Dr=[],dt=[];function Ht(){var Ar,Yr,sr=Lt.length;if(sr!==0){dt.length=Math.max(dt.length,sr+1),Dr.length=Math.max(Dr.length,sr+1),Dr[0]=0,dt[0]=0;var tn=0;for(Ar=0,Yr=0;Yr<Lt.length;++Yr){var yr=Lt[Yr];pe.ext_disjoint_timer_query.getQueryObjectEXT(yr,om)?(tn+=pe.ext_disjoint_timer_query.getQueryObjectEXT(yr,im),$t(yr)):Lt[Ar++]=yr,Dr[Yr+1]=tn,dt[Yr+1]=Ar}for(Lt.length=Ar,Ar=0,Yr=0;Yr<kr.length;++Yr){var qr=kr[Yr],fr=qr.startQueryIndex,jr=qr.endQueryIndex;qr.sum+=Dr[jr]-Dr[fr];var wn=dt[fr],Wn=dt[jr];Wn===wn?(qr.stats.gpuTime+=qr.sum/1e6,Or(qr)):(qr.startQueryIndex=wn,qr.endQueryIndex=Wn,kr[Ar++]=qr)}kr.length=Ar}}return{beginQuery:yt,endQuery:br,pushScopeStats:gr,update:Ht,getNumPendingQueries:function(){return Lt.length},clear:function(){Ne.push.apply(Ne,Lt);for(var Ar=0;Ar<Ne.length;Ar++)pe.ext_disjoint_timer_query.deleteQueryEXT(Ne[Ar]);Lt.length=0,Ne.length=0},restore:function(){Lt.length=0,Ne.length=0}}},sd=16384,fs=256,ud=1024,_p=34962,gp="webglcontextlost",yp="webglcontextrestored",xp=1,am=2,sm=3;function Ep(B,pe){for(var Ne=0;Ne<B.length;++Ne)if(B[Ne]===pe)return Ne;return-1}function ld(B){var pe=Zt(B);if(!pe)return null;var Ne=pe.gl,It=Ne.getContextAttributes(),$t=Ne.isContextLost(),Lt=ur(Ne,pe);if(!Lt)return null;var yt=pt(),br=id(),_r=Lt.extensions,Mr=ad(Ne,_r),Sr=ho(),Or=Ne.drawingBufferWidth,kr=Ne.drawingBufferHeight,gr={tick:0,time:0,viewportWidth:Or,viewportHeight:kr,framebufferWidth:Or,framebufferHeight:kr,drawingBufferWidth:Or,drawingBufferHeight:kr,pixelRatio:pe.pixelRatio},Dr={},dt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Ht=Rc(Ne,_r),Ar=Mf(Ne,br,pe,sr),Yr=X(Ne,_r,Ht,br,Ar);function sr(Nn){return Yr.destroyBuffer(Nn)}var tn=mh(Ne,_r,Ar,br),yr=we(Ne,yt,br,pe),qr=Ks(Ne,_r,Ht,function(){wn.procs.poll()},gr,br,pe),fr=$s(Ne,_r,Ht,br,pe),jr=S(Ne,_r,Ht,qr,fr,br),wn=$f(Ne,yt,_r,Ht,Ar,tn,qr,jr,Dr,Yr,yr,dt,gr,Mr,pe),Wn=vt(Ne,jr,wn.procs.poll,gr,It,_r,Ht),Hr=wn.next,xr=Ne.canvas,Qt=[],Mn=[],lt=[],P=[pe.onDestroy],ti=null;function F(){if(Qt.length===0){Mr&&Mr.update(),ti=null;return}ti=fo.next(F),hs();for(var Nn=Qt.length-1;Nn>=0;--Nn){var xi=Qt[Nn];xi&&xi(gr,null,0)}Ne.flush(),Mr&&Mr.update()}function zn(){!ti&&Qt.length>0&&(ti=fo.next(F))}function ki(){ti&&(fo.cancel(F),ti=null)}function sa(Nn){Nn.preventDefault(),$t=!0,ki(),Mn.forEach(function(xi){xi()})}function Ua(Nn){Ne.getError(),$t=!1,Lt.restore(),yr.restore(),Ar.restore(),qr.restore(),fr.restore(),jr.restore(),Yr.restore(),Mr&&Mr.restore(),wn.procs.refresh(),zn(),lt.forEach(function(xi){xi()})}xr&&(xr.addEventListener(gp,sa,!1),xr.addEventListener(yp,Ua,!1));function ri(){Qt.length=0,ki(),xr&&(xr.removeEventListener(gp,sa),xr.removeEventListener(yp,Ua)),yr.clear(),jr.clear(),fr.clear(),qr.clear(),tn.clear(),Ar.clear(),Yr.clear(),Mr&&Mr.clear(),P.forEach(function(Nn){Nn()})}function ua(Nn){ue(!!Nn,"invalid args to regl({...})"),ue.type(Nn,"object","invalid args to regl({...})");function xi(xt){var Ge=N({},xt);delete Ge.uniforms,delete Ge.attributes,delete Ge.context,delete Ge.vao,"stencil"in Ge&&Ge.stencil.op&&(Ge.stencil.opBack=Ge.stencil.opFront=Ge.stencil.op,delete Ge.stencil.op);function tt(ot){if(ot in Ge){var Ce=Ge[ot];delete Ge[ot],Object.keys(Ce).forEach(function(Ye){Ge[ot+"."+Ye]=Ce[Ye]})}}return tt("blend"),tt("depth"),tt("cull"),tt("stencil"),tt("polygonOffset"),tt("scissor"),tt("sample"),"vao"in xt&&(Ge.vao=xt.vao),Ge}function Li(xt){var Ge={},tt={};return Object.keys(xt).forEach(function(ot){var Ce=xt[ot];Vo.isDynamic(Ce)?tt[ot]=Vo.unbox(Ce,ot):Ge[ot]=Ce}),{dynamic:tt,static:Ge}}var ga=Li(Nn.context||{}),_l=Li(Nn.uniforms||{}),Me=Li(Nn.attributes||{}),Ut=Li(xi(Nn)),bt={gpuTime:0,cpuTime:0,count:0},on=wn.compile(Ut,Me,_l,ga,bt),hi=on.draw,so=on.batch,te=on.scope,xe=[];function Ue(xt){for(;xe.length<xt;)xe.push(null);return xe}function St(xt,Ge){var tt;if($t&&ue.raise("context lost"),typeof xt=="function")return te.call(this,null,xt,0);if(typeof Ge=="function")if(typeof xt=="number")for(tt=0;tt<xt;++tt)te.call(this,null,Ge,tt);else if(Array.isArray(xt))for(tt=0;tt<xt.length;++tt)te.call(this,xt[tt],Ge,tt);else return te.call(this,xt,Ge,0);else if(typeof xt=="number"){if(xt>0)return so.call(this,Ue(xt|0),xt|0)}else if(Array.isArray(xt)){if(xt.length)return so.call(this,xt,xt.length)}else return hi.call(this,xt)}return N(St,{stats:bt})}var vo=jr.setFBO=ua({framebuffer:Vo.define.call(null,xp,"framebuffer")});function la(Nn,xi){var Li=0;wn.procs.poll();var ga=xi.color;ga&&(Ne.clearColor(+ga[0]||0,+ga[1]||0,+ga[2]||0,+ga[3]||0),Li|=sd),"depth"in xi&&(Ne.clearDepth(+xi.depth),Li|=fs),"stencil"in xi&&(Ne.clearStencil(xi.stencil|0),Li|=ud),ue(!!Li,"called regl.clear with no buffer specified"),Ne.clear(Li)}function ea(Nn){if(ue(typeof Nn=="object"&&Nn,"regl.clear() takes an object as input"),"framebuffer"in Nn)if(Nn.framebuffer&&Nn.framebuffer_reglType==="framebufferCube")for(var xi=0;xi<6;++xi)vo(N({framebuffer:Nn.framebuffer.faces[xi]},Nn),la);else vo(Nn,la);else la(null,Nn)}function No(Nn){ue.type(Nn,"function","regl.frame() callback must be a function"),Qt.push(Nn);function xi(){var Li=Ep(Qt,Nn);ue(Li>=0,"cannot cancel a frame twice");function ga(){var _l=Ep(Qt,ga);Qt[_l]=Qt[Qt.length-1],Qt.length-=1,Qt.length<=0&&ki()}Qt[Li]=ga}return zn(),{cancel:xi}}function Ia(){var Nn=Hr.viewport,xi=Hr.scissor_box;Nn[0]=Nn[1]=xi[0]=xi[1]=0,gr.viewportWidth=gr.framebufferWidth=gr.drawingBufferWidth=Nn[2]=xi[2]=Ne.drawingBufferWidth,gr.viewportHeight=gr.framebufferHeight=gr.drawingBufferHeight=Nn[3]=xi[3]=Ne.drawingBufferHeight}function hs(){gr.tick+=1,gr.time=li(),Ia(),wn.procs.poll()}function ca(){Ia(),wn.procs.refresh(),Mr&&Mr.update()}function li(){return(ho()-Sr)/1e3}ca();function rs(Nn,xi){ue.type(xi,"function","listener callback must be a function");var Li;switch(Nn){case"frame":return No(xi);case"lost":Li=Mn;break;case"restore":Li=lt;break;case"destroy":Li=P;break;default:ue.raise("invalid event, must be one of frame,lost,restore,destroy")}return Li.push(xi),{cancel:function(){for(var ga=0;ga<Li.length;++ga)if(Li[ga]===xi){Li[ga]=Li[Li.length-1],Li.pop();return}}}}var Hi=N(ua,{clear:ea,prop:Vo.define.bind(null,xp),context:Vo.define.bind(null,am),this:Vo.define.bind(null,sm),draw:ua({}),buffer:function(Nn){return Ar.create(Nn,_p,!1,!1)},elements:function(Nn){return tn.create(Nn,!1)},texture:qr.create2D,cube:qr.createCube,renderbuffer:fr.create,framebuffer:jr.create,framebufferCube:jr.createCube,vao:Yr.createVAO,attributes:It,frame:No,on:rs,limits:Ht,hasExtension:function(Nn){return Ht.extensions.indexOf(Nn.toLowerCase())>=0},read:Wn,destroy:ri,_gl:Ne,_refresh:ca,poll:function(){hs(),Mr&&Mr.update()},now:li,stats:br});return pe.onDone(null,Hi),Hi}return ld})},69848:function(hr){(function(qt,N){hr.exports=N()})(this,function(){"use strict";function qt(Mt,ze,Wt,ct,nr,Lr){if(!(nr-ct<=Wt)){var K=ct+nr>>1;N(Mt,ze,K,ct,nr,Lr%2),qt(Mt,ze,Wt,ct,K-1,Lr+1),qt(Mt,ze,Wt,K+1,nr,Lr+1)}}function N(Mt,ze,Wt,ct,nr,Lr){for(;nr>ct;){if(nr-ct>600){var K=nr-ct+1,_e=Wt-ct+1,Y=Math.log(K),ve=.5*Math.exp(2*Y/3),fe=.5*Math.sqrt(Y*ve*(K-ve)/K)*(_e-K/2<0?-1:1),He=Math.max(ct,Math.floor(Wt-_e*ve/K+fe)),at=Math.min(nr,Math.floor(Wt+(K-_e)*ve/K+fe));N(Mt,ze,Wt,He,at,Lr)}var _t=ze[2*Wt+Lr],Tt=ct,Pt=nr;for(Oe(Mt,ze,ct,Wt),ze[2*nr+Lr]>_t&&Oe(Mt,ze,ct,nr);Tt<Pt;){for(Oe(Mt,ze,Tt,Pt),Tt++,Pt--;ze[2*Tt+Lr]<_t;)Tt++;for(;ze[2*Pt+Lr]>_t;)Pt--}ze[2*ct+Lr]===_t?Oe(Mt,ze,ct,Pt):(Pt++,Oe(Mt,ze,Pt,nr)),Pt<=Wt&&(ct=Pt+1),Wt<=Pt&&(nr=Pt-1)}}function Oe(Mt,ze,Wt,ct){Qe(Mt,Wt,ct),Qe(ze,2*Wt,2*ct),Qe(ze,2*Wt+1,2*ct+1)}function Qe(Mt,ze,Wt){var ct=Mt[ze];Mt[ze]=Mt[Wt],Mt[Wt]=ct}function v(Mt,ze,Wt,ct,nr,Lr,K){for(var _e=[0,Mt.length-1,0],Y=[],ve,fe;_e.length;){var He=_e.pop(),at=_e.pop(),_t=_e.pop();if(at-_t<=K){for(var Tt=_t;Tt<=at;Tt++)ve=ze[2*Tt],fe=ze[2*Tt+1],ve>=Wt&&ve<=nr&&fe>=ct&&fe<=Lr&&Y.push(Mt[Tt]);continue}var Pt=Math.floor((_t+at)/2);ve=ze[2*Pt],fe=ze[2*Pt+1],ve>=Wt&&ve<=nr&&fe>=ct&&fe<=Lr&&Y.push(Mt[Pt]);var Xr=(He+1)%2;(He===0?Wt<=ve:ct<=fe)&&(_e.push(_t),_e.push(Pt-1),_e.push(Xr)),(He===0?nr>=ve:Lr>=fe)&&(_e.push(Pt+1),_e.push(at),_e.push(Xr))}return Y}function it(Mt,ze,Wt,ct,nr,Lr){for(var K=[0,Mt.length-1,0],_e=[],Y=nr*nr;K.length;){var ve=K.pop(),fe=K.pop(),He=K.pop();if(fe-He<=Lr){for(var at=He;at<=fe;at++)V(ze[2*at],ze[2*at+1],Wt,ct)<=Y&&_e.push(Mt[at]);continue}var _t=Math.floor((He+fe)/2),Tt=ze[2*_t],Pt=ze[2*_t+1];V(Tt,Pt,Wt,ct)<=Y&&_e.push(Mt[_t]);var Xr=(ve+1)%2;(ve===0?Wt-nr<=Tt:ct-nr<=Pt)&&(K.push(He),K.push(_t-1),K.push(Xr)),(ve===0?Wt+nr>=Tt:ct+nr>=Pt)&&(K.push(_t+1),K.push(fe),K.push(Xr))}return _e}function V(Mt,ze,Wt,ct){var nr=Mt-Wt,Lr=ze-ct;return nr*nr+Lr*Lr}var se=function(Mt){return Mt[0]},W=function(Mt){return Mt[1]},ne=function(ze,Wt,ct,nr,Lr){Wt===void 0&&(Wt=se),ct===void 0&&(ct=W),nr===void 0&&(nr=64),Lr===void 0&&(Lr=Float64Array),this.nodeSize=nr,this.points=ze;for(var K=ze.length<65536?Uint16Array:Uint32Array,_e=this.ids=new K(ze.length),Y=this.coords=new Lr(ze.length*2),ve=0;ve<ze.length;ve++)_e[ve]=ve,Y[2*ve]=Wt(ze[ve]),Y[2*ve+1]=ct(ze[ve]);qt(_e,Y,nr,0,_e.length-1,0)};ne.prototype.range=function(ze,Wt,ct,nr){return v(this.ids,this.coords,ze,Wt,ct,nr,this.nodeSize)},ne.prototype.within=function(ze,Wt,ct){return it(this.ids,this.coords,ze,Wt,ct,this.nodeSize)};var G={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Mt){return Mt}},Ke=Math.fround||function(Mt){return function(ze){return Mt[0]=+ze,Mt[0]}}(new Float32Array(1)),De=function(ze){this.options=yn(Object.create(G),ze),this.trees=new Array(this.options.maxZoom+1)};De.prototype.load=function(ze){var Wt=this.options,ct=Wt.log,nr=Wt.minZoom,Lr=Wt.maxZoom,K=Wt.nodeSize;ct&&console.time("total time");var _e="prepare "+ze.length+" points";ct&&console.time(_e),this.points=ze;for(var Y=[],ve=0;ve<ze.length;ve++)ze[ve].geometry&&Y.push(ht(ze[ve],ve));this.trees[Lr+1]=new ne(Y,bi,$n,K,Float32Array),ct&&console.timeEnd(_e);for(var fe=Lr;fe>=nr;fe--){var He=+Date.now();Y=this._cluster(Y,fe),this.trees[fe]=new ne(Y,bi,$n,K,Float32Array),ct&&console.log("z%d: %d clusters in %dms",fe,Y.length,+Date.now()-He)}return ct&&console.timeEnd("total time"),this},De.prototype.getClusters=function(ze,Wt){var ct=((ze[0]+180)%360+360)%360-180,nr=Math.max(-90,Math.min(90,ze[1])),Lr=ze[2]===180?180:((ze[2]+180)%360+360)%360-180,K=Math.max(-90,Math.min(90,ze[3]));if(ze[2]-ze[0]>=360)ct=-180,Lr=180;else if(ct>Lr){var _e=this.getClusters([ct,nr,180,K],Wt),Y=this.getClusters([-180,nr,Lr,K],Wt);return _e.concat(Y)}for(var ve=this.trees[this._limitZoom(Wt)],fe=ve.range(wt(ct),et(K),wt(Lr),et(nr)),He=[],at=0,_t=fe;at<_t.length;at+=1){var Tt=_t[at],Pt=ve.points[Tt];He.push(Pt.numPoints?ae(Pt):this.points[Pt.index])}return He},De.prototype.getChildren=function(ze){var Wt=this._getOriginId(ze),ct=this._getOriginZoom(ze),nr="No cluster with the specified id.",Lr=this.trees[ct];if(!Lr)throw new Error(nr);var K=Lr.points[Wt];if(!K)throw new Error(nr);for(var _e=this.options.radius/(this.options.extent*Math.pow(2,ct-1)),Y=Lr.within(K.x,K.y,_e),ve=[],fe=0,He=Y;fe<He.length;fe+=1){var at=He[fe],_t=Lr.points[at];_t.parentId===ze&&ve.push(_t.numPoints?ae(_t):this.points[_t.index])}if(ve.length===0)throw new Error(nr);return ve},De.prototype.getLeaves=function(ze,Wt,ct){Wt=Wt||10,ct=ct||0;var nr=[];return this._appendLeaves(nr,ze,Wt,ct,0),nr},De.prototype.getTile=function(ze,Wt,ct){var nr=this.trees[this._limitZoom(ze)],Lr=Math.pow(2,ze),K=this.options,_e=K.extent,Y=K.radius,ve=Y/_e,fe=(ct-ve)/Lr,He=(ct+1+ve)/Lr,at={features:[]};return this._addTileFeatures(nr.range((Wt-ve)/Lr,fe,(Wt+1+ve)/Lr,He),nr.points,Wt,ct,Lr,at),Wt===0&&this._addTileFeatures(nr.range(1-ve/Lr,fe,1,He),nr.points,Lr,ct,Lr,at),Wt===Lr-1&&this._addTileFeatures(nr.range(0,fe,ve/Lr,He),nr.points,-1,ct,Lr,at),at.features.length?at:null},De.prototype.getClusterExpansionZoom=function(ze){for(var Wt=this._getOriginZoom(ze)-1;Wt<=this.options.maxZoom;){var ct=this.getChildren(ze);if(Wt++,ct.length!==1)break;ze=ct[0].properties.cluster_id}return Wt},De.prototype._appendLeaves=function(ze,Wt,ct,nr,Lr){for(var K=this.getChildren(Wt),_e=0,Y=K;_e<Y.length;_e+=1){var ve=Y[_e],fe=ve.properties;if(fe&&fe.cluster?Lr+fe.point_count<=nr?Lr+=fe.point_count:Lr=this._appendLeaves(ze,fe.cluster_id,ct,nr,Lr):Lr<nr?Lr++:ze.push(ve),ze.length===ct)break}return Lr},De.prototype._addTileFeatures=function(ze,Wt,ct,nr,Lr,K){for(var _e=0,Y=ze;_e<Y.length;_e+=1){var ve=Y[_e],fe=Wt[ve],He=fe.numPoints,at=void 0,_t=void 0,Tt=void 0;if(He)at=At(fe),_t=fe.x,Tt=fe.y;else{var Pt=this.points[fe.index];at=Pt.properties,_t=wt(Pt.geometry.coordinates[0]),Tt=et(Pt.geometry.coordinates[1])}var Xr={type:1,geometry:[[Math.round(this.options.extent*(_t*Lr-ct)),Math.round(this.options.extent*(Tt*Lr-nr))]],tags:at},zr=void 0;He?zr=fe.id:this.options.generateId?zr=fe.index:this.points[fe.index].id&&(zr=this.points[fe.index].id),zr!==void 0&&(Xr.id=zr),K.features.push(Xr)}},De.prototype._limitZoom=function(ze){return Math.max(this.options.minZoom,Math.min(Math.floor(+ze),this.options.maxZoom+1))},De.prototype._cluster=function(ze,Wt){for(var ct=[],nr=this.options,Lr=nr.radius,K=nr.extent,_e=nr.reduce,Y=nr.minPoints,ve=Lr/(K*Math.pow(2,Wt)),fe=0;fe<ze.length;fe++){var He=ze[fe];if(!(He.zoom<=Wt)){He.zoom=Wt;for(var at=this.trees[Wt+1],_t=at.within(He.x,He.y,ve),Tt=He.numPoints||1,Pt=Tt,Xr=0,zr=_t;Xr<zr.length;Xr+=1){var gn=zr[Xr],Qr=at.points[gn];Qr.zoom>Wt&&(Pt+=Qr.numPoints||1)}if(Pt>Tt&&Pt>=Y){for(var Fn=He.x*Tt,bn=He.y*Tt,dn=_e&&Tt>1?this._map(He,!0):null,un=(fe<<5)+(Wt+1)+this.points.length,Qn=0,Vr=_t;Qn<Vr.length;Qn+=1){var Dn=Vr[Qn],Wr=at.points[Dn];if(!(Wr.zoom<=Wt)){Wr.zoom=Wt;var Jr=Wr.numPoints||1;Fn+=Wr.x*Jr,bn+=Wr.y*Jr,Wr.parentId=un,_e&&(dn||(dn=this._map(He,!0)),_e(dn,this._map(Wr)))}}He.parentId=un,ct.push(ge(Fn/Pt,bn/Pt,un,Pt,dn))}else if(ct.push(He),Pt>1)for(var ji=0,gi=_t;ji<gi.length;ji+=1){var Eo=gi[ji],$i=at.points[Eo];$i.zoom<=Wt||($i.zoom=Wt,ct.push($i))}}}return ct},De.prototype._getOriginId=function(ze){return ze-this.points.length>>5},De.prototype._getOriginZoom=function(ze){return(ze-this.points.length)%32},De.prototype._map=function(ze,Wt){if(ze.numPoints)return Wt?yn({},ze.properties):ze.properties;var ct=this.points[ze.index].properties,nr=this.options.map(ct);return Wt&&nr===ct?yn({},nr):nr};function ge(Mt,ze,Wt,ct,nr){return{x:Ke(Mt),y:Ke(ze),zoom:1/0,id:Wt,parentId:-1,numPoints:ct,properties:nr}}function ht(Mt,ze){var Wt=Mt.geometry.coordinates,ct=Wt[0],nr=Wt[1];return{x:Ke(wt(ct)),y:Ke(et(nr)),zoom:1/0,index:ze,parentId:-1}}function ae(Mt){return{type:"Feature",id:Mt.id,properties:At(Mt),geometry:{type:"Point",coordinates:[mr(Mt.x),pr(Mt.y)]}}}function At(Mt){var ze=Mt.numPoints,Wt=ze>=1e4?Math.round(ze/1e3)+"k":ze>=1e3?Math.round(ze/100)/10+"k":ze;return yn(yn({},Mt.properties),{cluster:!0,cluster_id:Mt.id,point_count:ze,point_count_abbreviated:Wt})}function wt(Mt){return Mt/360+.5}function et(Mt){var ze=Math.sin(Mt*Math.PI/180),Wt=.5-.25*Math.log((1+ze)/(1-ze))/Math.PI;return Wt<0?0:Wt>1?1:Wt}function mr(Mt){return(Mt-.5)*360}function pr(Mt){var ze=(180-Mt*360)*Math.PI/180;return 360*Math.atan(Math.exp(ze))/Math.PI-90}function yn(Mt,ze){for(var Wt in ze)Mt[Wt]=ze[Wt];return Mt}function bi(Mt){return Mt.x}function $n(Mt){return Mt.y}return De})}}]);
}());